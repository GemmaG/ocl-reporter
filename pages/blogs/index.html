<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- DO NOT EDIT: file automatically generated by ucampas. -->
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><meta content="text/css" http-equiv="Content-Style-Type" /><title>Computer Laboratory &#8211; OCaml Labs: Blogs</title><link href="http://www.cl.cam.ac.uk/style/layout.css" media="all" rel="stylesheet" type="text/css" /><link href="http://www.cl.cam.ac.uk/style/print.css" media="print" rel="stylesheet" type="text/css" /><link href="http://www.cl.cam.ac.uk/style/blue.css" media="all" rel="stylesheet" type="text/css" /><!--[if IE 6]><link rel="stylesheet" href="http://www.cl.cam.ac.uk/style/ie6.css" type="text/css" media="screen" /><script type="text/javascript" src="http://www.cam.ac.uk/global/js/minmax.js"></script><![endif]--><!--[if IE 7]><link rel="stylesheet" href="http://www.cl.cam.ac.uk/style/ie7.css" type="text/css" media="screen" /><![endif]--><link href="http://www.cl.cam.ac.uk/projects/ocamllabs/blogs/rss10.xml" rel="alternate" title="" type="application/rss+xml" /><style>    a.icon-github {
	background: url(../github.png) no-repeat 0 0;
        background: url(../github.png) no-repeat 0 0;
	padding: 0 0 2px 2em;
    }
    a.icon-cloud {
	background: url(../cloud.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    a.icon-bullhorn {
	background: url(../bullhorn.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    a.icon-wrench {
	background: url(../wrench.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    h2.posttitle {
        font-size: 120%;
    }
div.toc {
    background-color: rgb(239, 239, 239);
    margin: 0.5em 0em 1.5em 1px;
    border: 1px solid black;
    font-size: 0.7em;
    padding: 0px 0px 1ex;
    font-size: 100%;
}
</style><link href="../tasks/index.html" rel="Next" /><link href="../index.html" rel="Up" /></head>
<body class="two-col dept">
<div id="skip"> <a accesskey="2" href="#skip-content">Skip to content</a>&#160;|&#160;<a accesskey="0" href="http://www.cam.ac.uk/site/accesskeys.html">Access key help</a> </div><div id="header">  <div id="branding"><a accesskey="1" href="http://www.cam.ac.uk/"><img alt="University of Cambridge" class="ucam" src="http://www.cl.cam.ac.uk/images/identifier.gif" /></a>
  </div>

    <div id="site-search">
    <form action="http://www.google.co.uk/search" method="get">      <fieldset>      <label for="search-term">Search</label>
      <input accesskey="4" id="search-term" name="q" type="text" value="" />      <input alt="Search" id="search-button" src="http://www.cl.cam.ac.uk/images/button-search.gif" title="Search" type="image" value="Search" />
      

      <input name="domains" type="hidden" value="cam.ac.uk;www.cl.cam.ac.uk" /><input name="sitesearch" type="hidden" value="www.cl.cam.ac.uk" /></fieldset>
    </form>

  <ul><li class="last"><a href="http://www.cl.cam.ac.uk/search/">Advanced search</a></li><li><a href="http://www.cl.cam.ac.uk/az/">A&#8211;Z</a></li><li><a href="http://www.cl.cam.ac.uk/contact/">Contact us</a></li></ul>
  </div>
</div>

<div id="dept-title"><h1><a href="../index.html">Computer Laboratory</a></h1>
</div>

<div id="container"> <a id="skip-content" name="skip-content"></a>
<ul id="nav-breadcrumb"><li class="first"><a href="http://www.cam.ac.uk/">University of Cambridge</a></li><li><a href="http://www.cl.cam.ac.uk/">Computer Laboratory</a></li><li><a href="../index.html">OCaml Labs</a></li><li><a href="index.html">Blogs</a></li></ul><ul id="nav-primary"><li><div><a href="../index.html">OCaml Labs</a></div></li><li><div><a href="../news/index.html">News</a></div></li><li class="active"><div><a href="index.html">Blogs</a></div></li><li><div><a href="../tasks/index.html">Projects</a></div></li><li><div><a href="../people/index.html">People</a></div></li><li><div><a href="../outputs/index.html">Outputs</a></div></li><li><div><a href="../collaboration.html">Collaboration</a></div></li><li><div><a href="../contact.html">Contact Us</a></div></li></ul><div id="content"><div id="sub-brand"><p class="section">OCaml Labs</p></div><div id="content-primary">
<div id="container">
<h4>Recent Posts</h4>
<table width="90%">  <tbody><tr>    <td><i>Sun, 15 Sep 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools">Camlpdf, the first good command-line PDF tool I've found</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Thu, 12 Sep 2013</i></td>
    <td><a href="#http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html">OMD: a Markdown parser in OCaml</a></td>
    <td>Philippe Wang</td>
  </tr>
  <tr>    <td><i>Mon, 09 Sep 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=153">OCaml Development in Vim</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Sun, 08 Sep 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/09/09/ocamlot-autotriaging">OCamlot--exploring the edges of OPAM packages</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Wed, 28 Aug 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=25">ICFP, CUFP &amp; OCaml2013</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Fri, 23 Aug 2013</i></td>
    <td><a href="#http://openmirage.org/blog/introducing-vchan">Introducing vchan</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Mon, 19 Aug 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=86">Real World OCaml beta3 release</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Thu, 08 Aug 2013</i></td>
    <td><a href="#http://openmirage.org/blog/oscon13-trip-report">Mirage travels to OSCON'13: a trip report</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Mon, 05 Aug 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2">Final Real World OCaml beta; the good, the bad and the ugly</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Thu, 01 Aug 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=99">OCaml Lecture Notes</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Thu, 18 Jul 2013</i></td>
    <td><a href="#http://openmirage.org/blog/xen-block-devices-with-mirage">Creating Xen block devices with Mirage</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Wed, 10 Jul 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=64">Profiling OCaml &#8211; Getting Started Guide</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Wed, 03 Jul 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=90">Learning Async</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Sun, 16 Jun 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available">Phew, Real World OCaml beta now available.</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Sat, 01 Jun 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01">Jun 2013 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Mon, 20 May 2013</i></td>
    <td><a href="#http://openmirage.org/blog/the-road-to-a-dev-release">The road to a developer preview at OSCON 2013</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Wed, 01 May 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01">May 2013 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Mon, 01 Apr 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01">Apr 2013 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Thu, 14 Mar 2013</i></td>
    <td><a href="#http://amirchaudhry.com/wireframe-demos-for-ocamlorg">Wireframe demos for OCaml.org</a></td>
    <td>Amir Chaudhry</td>
  </tr>
  <tr>    <td><i>Sun, 10 Mar 2013</i></td>
    <td><a href="#http://lpw25.net/2013/03/10/ocaml-namespaces">Adding namespaces to OCaml</a></td>
    <td>Leo White</td>
  </tr>
  <tr>    <td><i>Fri, 01 Mar 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-03-01">Mar 2013 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Tue, 05 Feb 2013</i></td>
    <td><a href="#http://lpw25.net/2013/02/05/camlp4-alternative-part-2">An alternative to camlp4 - Part 2</a></td>
    <td>Leo White</td>
  </tr>
  <tr>    <td><i>Fri, 01 Feb 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-02-01">Feb 2013 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Wed, 23 Jan 2013</i></td>
    <td><a href="#http://lpw25.net/2013/01/23/camlp4-alternative-part-1">An alternative to camlp4 - Part 1</a></td>
    <td>Leo White</td>
  </tr>
  <tr>    <td><i>Tue, 01 Jan 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-01-01">Jan 2013 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Sat, 01 Dec 2012</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-12-01">Dec 2012 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Thu, 29 Nov 2012</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/index.html">System programming in OCaml &#8211; Part 2</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Wed, 28 Nov 2012</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/index.html">Ocaml 2 HTML</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Wed, 28 Nov 2012</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/index.html">System programming in OCaml &#8211; Part 1</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Thu, 01 Nov 2012</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-11-01">Nov 2012 news update</a></td>
    <td>Monthly News</td>
  </tr>
  <tr>    <td><i>Thu, 01 Nov 2012</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/2012/11/getting-to-grips-with-opam/index.html">Getting to grips with OPAM</a></td>
    <td>Heidi Howard</td>
  </tr>
  <tr>    <td><i>Thu, 18 Oct 2012</i></td>
    <td><a href="#http://anil.recoil.org/2012/10/19/announcing-ocaml-labs">Announcing the OCaml Labs project</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Wed, 17 Oct 2012</i></td>
    <td><a href="#http://openmirage.org/blog/breaking-up-is-easy-with-opam">Breaking up is easy to do (with OPAM)</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Wed, 12 Sep 2012</i></td>
    <td><a href="#http://openmirage.org/blog/xenstore-stub-domain">Building a "xenstore stub domain" with Mirage</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Mon, 30 Jul 2012</i></td>
    <td><a href="#http://anil.recoil.org/2012/07/31/the-functional-week">Why you should go to ICFP 2012</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Wed, 29 Feb 2012</i></td>
    <td><a href="#http://openmirage.org/blog/announcing-mirage-openflow">Connected Cloud Control: OpenFlow in Mirage</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Sat, 25 Feb 2012</i></td>
    <td><a href="#http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml">Dreaming of an ARM OCaml</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Thu, 29 Sep 2011</i></td>
    <td><a href="#http://openmirage.org/blog/an-outing-to-cufp">An Outing to CUFP 2011</a></td>
    <td>MirageOS</td>
  </tr>
  <tr>    <td><i>Mon, 08 Aug 2011</i></td>
    <td><a href="#http://anil.recoil.org/2011/08/09/cufp2011-schedule">Commercial Users of Functional Programming 2011 Schedule</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Fri, 17 Jun 2011</i></td>
    <td><a href="#http://anil.recoil.org/2011/06/18/datacaml-with-ciel">DataCaml - a first look at distributed dataflow programming in OCaml</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
</tbody></table>




<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools"><a name="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools.html">Camlpdf, the first good command-line PDF tool I've found</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>The fine folks at O&#8217;Reilly have been proof-reading the <a href="https://realworldocaml.org">Real World OCaml</a> book that I&#8217;ve been working on. My heart leapt with joy when the copyeditor commented that she thought it was very well written, but my joy was short-lived when it turns out that all her comments were safely ensconced as PDF comments. A few hundreds comments that required a response from us, too.</p>

<p><em>&#8220;No problem! MacOS X Preview can handle these!&#8221;</em> was of course my first response, but it turns out it&#8217;s totally broken with PDF notes. The first note that you select will appear as the content of all the other subsequent notes. Yaron Minsky then experimented with Adobe Acrobat, which I&#8217;ve sworn never to install again after an unfortunate incident involving the uninstaller a couple of years ago. That turned out to be incredibly slow. I tried a few open-source tools such as <a href="http://en.wikipedia.org/wiki/Skim_(software">Skim</a> which, while otherwise an excellent bit of software, couldn&#8217;t render these particular annotations.</p>
<table><tbody><tr><td><a href="http://anil.recoil.org/images/anil-jumping-acropolis.jpg"><img src="http://anil.recoil.org/images/anil-jumping-acropolis-thumb.jpg" width="207" /></a>
</td></tr>
<tr><td width="210"><i><small>I <a href="http://www.theguardian.com/media/mind-your-language/2012/jan/29/literally-a-much-misused-word">literally</a> jumped off my seat upon discovering cpdf.</small></i></td></tr>
</tbody></table>
<p>Meanwhile, John Whitington just announced the release of the <a href="http://coherentpdf.com/blog/?p=68">Coherent PDF</a> command-line tools. Since these are all written in OCaml (and have been developed over quite a few years now), he also sent in an OPAM <a href="https://github.com/OCamlPro/opam-repository/pull/977">pull request</a> to add it to the database. And most conveniently, this ended up solving my little PDF conundrum in less than an hour of hacking, and has almost cured me of my lifelong fear of dealing with anything in a PDF-like format. Here&#8217;s what I did:</p>

<ul><li><p>I installed the tools via <code>opam install cpdf</code>. This installed the library but not the binary (<a href="https://github.com/OCamlPro/opam-repository/pull/1100">swiftly fixed</a>).</p>
</li>

<li><p>Reading the license told me that it&#8217;s for non-commercial use only, so I bought a license from the <a href="http://coherentpdf.com">Coherent PDF</a> website (a bargain price, given how much it does!).</p>
</li>

<li><p>I ran <code>cpdf -list-annotations</code> over the PDF, and it dumped out all the comments as a text file to stdout. This wasn&#8217;t quite enough for me, since I needed to match the annotation to a page number. But since John has released it as open-source, I forked the repository and patched the support directly into the command-line tools, and sent a <a href="https://github.com/johnwhitington/cpdf-source/pull/2">pull request</a> back over to John. Since it&#8217;s under a non-standard license, I decided to place my patch in the public domain to make it easier for him to accept it if he chooses.</p>
</li>

<li><p>My co-authors can just run <code>opam pin cpdf git://github.com/avsm/cpdf-source#annotation-page-numbers</code> to pin their local copy of CPDF to my forked branch in their own OPAM installations, and easily use my copy until John gets a chance to integrate my changes properly upstream.</p>
</li>
</ul>

<p>Total time including this blog post: 40 minutes. Now, onto fixing the author responses comments for Real World OCaml now. I&#8217;m so happy to have <code>cpdf</code> as a simple, hackable PDF utility, as it does things like page combining and rotations that have always been a little flaky in other tools for me. It&#8217;s the <a href="http://johnmacfarlane.net/pandoc/">Pandoc</a> of PDFs!</p></div>







<p class="date"><a href="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools.html">Sun, 15 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/pwang.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html"><a name="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html"> </a>
<h1 class="posttitle"><a href="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html">OMD: a Markdown parser in OCaml</a>
(<a href="http://pw374.github.io/" title="pw374">Philippe Wang</a>)
</h1>
<hr /><div class="entry"><div class="content"><h3 id="Motivations"> Motivations</h3>
<p>There  are  so many  existing  implementations  of  Markdown, why  yet
another one?   Well, after asking  the OCaml community  about existing
ways to parse and manipulate  Markdown documents, it seemed that there
were no stand-alone complete Markdown parser written in OCaml, meaning
that they  were incomplete (i.e., not fully  compatible with Markdown)
or  interfaces  to  some  Markdown  parsers  implemented  using  other
languages than OCaml.</p>
<p>Since in OCaml  Labs we're working a lot with  Github, and Github uses
Markdown a  lot (Github  web pages hosting,  Github issues,  etc.) and
other  sites are also  using Markdown  as well,  and Markdown  is very
popular and  easy to  learn, and  flexible in the  sense that  you can
always  fall back  to HTML  when you  want to  express  something that
doesn't have  a special syntax in  Markdown, blah blah blah,  it was -
somehow - time to have  a Markdown parser implemented using OCaml. And
preferably  OCaml alone,  meaning that  one that  has  OCaml installed
should be able  to use it easily without having to  deal with too many
dependencies. Well, there it is: OMD!</p>
<h3 id="IssueswereessentiallywithMarkdownitself"> Issues... were essentially with Markdown itself</h3>
<p>Every computer  scientist knows how to  write a parser  for a language
that is as simple as Markdown. Well, no, not every computer scientist,
sadly, but at least every programmer should. Ok, sadly it isn't really
the case either. Anyways.</p>
<p>Markdown is a rather simple language,  if you look at the specs. Well,
that depends on what you actuall call "specs", of course. According to
<a href="http://en.wikipedia.org/wiki/Markdow">Wikipedia</a>,     Markdown    was
invented by <a href="http://daringfireball.net">John Gruber</a>, and Aaron Swartz
helped  him. Then the  original document  that describes  the Markdown
language          is          available         online          there:
<a href="http://daringfireball.net/projects/markdown/syntax">http://daringfireball.net/projects/markdown/syntax</a>.  And you can see
that         searching        for         <a href="https://www.google.com/#q=Markdown+syntax">"Markdown+syntax"        on
Google</a> makes that page the
top result (and here again, I'm kind  of helping it be and stay on the
top...).</p>
<p>Actually, Markdown is not that  simple to parse.  Why? Because so many
things are  just left to the  imagination of the  people who implement
parsers  for  this  language,   because  programmes  can't  decide  by
themselves  what's right  to do.   It's  really the  author(s) of  the
programme that  decides what the  programme does. And in  Markdown, so
many  things  are ambiguous  and  Gruber's  document doesn't  actually
describe a  grammar at all.  It just tells  you how to write  this and
that, but if you write it slightly differently, it doesn't tell you
what the outcome would be. 
<em><strong>In other words, there are no errors in Markdown.</strong></em>
Every text file is a valid Markdown file, it might just be converted 
to some HTML you wouldn't expect. For instance, you may write a link 
using this  syntax:</p>
<pre><code>[blah blah blah](the-url-which-can-be-absolute-or-relative)
</code></pre>
<p>and it gets converted to</p>
<pre><code>&lt;a href="the-url-which-can-be-absolute-or-relative"&gt;blah blah blah&lt;/a&gt;
</code></pre>
<p>But if you forget the closing parenthesis, then it becomes this instead</p>
<pre><code>&lt;p&gt;[blah blah blah](the-url-which-can-be-absolute-or-relative&lt;/p&gt;
</code></pre>
<p>precisely because nothing is wrong in Markdown.</p>
<p>And what if there are parentheses in your URL? What if they are unbalanced?</p>
<h4 id="FlagrantAmbiguity"> Flagrant Ambiguity</h4>
<p>The following is some text that has to mean something in Markdown...</p>
<pre><code>* Alice is falling in love with Bob.
    * Bob is secretly in love with Alice, but he's seeing Eve.
  * Eve is in-between, she loves both Alice and Bob, she can't help it.
</code></pre>
<p>So, Pandoc, which a tool that converts a document in language A to a
document in language B, where A and B can be the same or different
languages amongst LaTeX, HTML, Markdown and (many) others, considers
that Eve is on the same level as Bob. So its HTML output is</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Alice is falling in love with Bob.
&lt;ul&gt;
&lt;li&gt;Bob is secretly in love with Alice, but he's seeing Eve.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Eve is in-between, she loves both Alice and Bob, she can't help it.&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>But if instead you add Dylan as in</p>
<pre><code>* Alice is falling in love with Bob.
   * Dylan, a new character, is being conceived here.
    * Bob is secretly in love with Alice, but he's seeing Eve.
  * Eve is in-between, she loves both Alice and Bob, she can't help it.
</code></pre>
<p>then <em>of course</em> Eve is not on the same level as Bob anymore and goes
with Dylan and Alice, Bob is on his own.</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Alice is falling in love with Bob.&lt;/li&gt;
&lt;li&gt;Dylan, a new character, is being conceived here.
&lt;ul&gt;
&lt;li&gt;Bob is secretly in love with Alice, but he's seeing Eve.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Eve is in-between, she loves both Alice and Bob, she can't help it.&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>This doesn't make much sense...</p>
<p>And Github's embedded Markdown  to HTML converter chooses some similar
broken semantics. If one writes bullets on different levels, it shouldn't
be meaningless.</p>
<p>Also, on Github, if you write</p>
<pre><code>* 1
  * 2
    * 3
      * 4
        * 5
          * 6
            * 7
              * 8
                * 9
                  * 10
</code></pre>
<p>Then 2 and 3 are on the same level, as for 4 and 5, 6 and 7, and 8 and 9.
1 and 10 are on their own. And if you extract 2 and 3, meaning</p>
<pre><code>  * 2
    * 3
</code></pre>
<p>then 2 and 3 are not on the same level anymore! 
See for yourself:</p>
<ul> <li>raw version: <a href="https://raw.github.com/pw374/sandbox/master/mad-lists.md">https://raw.github.com/pw374/sandbox/master/mad-lists.md</a>
 </li>
 <li>rendered-by-Github version: <a href="https://github.com/pw374/sandbox/blob/master/mad-lists.md">https://github.com/pw374/sandbox/blob/master/mad-lists.md</a></li>
</ul>

<p>With OMD, hopefully, there is a deterministic meaning for each level of indentation. The list where there were Alice, Bob and Eve is converted to this to the least insane semantics I could think of.</p>
<p>The idea  is that, since Eve  is neither on  the same level as  Bob or
Alice, Eve should be in a new list (because, obviously, she's the only
one on that  level anyway). So she  is in a new list.  And since she's
not on a deeper level than Bob, she shouldn't be on a sub-list of his.
But  she is  on a  deeper level  than Alice,  so she  has to  be  on a
sub-list of hers. So, here is the HTML that OMD produces:</p>
<pre><code>&lt;ul&gt;
 &lt;li&gt;Alice is falling in love with Bob.
  &lt;ul&gt;
   &lt;li&gt;Bob is secretly in love with Alice, but he&amp;apos;s seeing Eve.
   &lt;/li&gt;
  &lt;/ul&gt;
  &lt;ul&gt;
   &lt;li&gt;Eve is in-between, she loves both Alice and Bob, she can&amp;apos;t help it.
   &lt;/li&gt;
  &lt;/ul&gt;
 &lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>Oh,  you might  have  noticed  that OMD  converts  quotes to  <code>&amp;apos;</code>
because otherwise I  would need to differentiate when  they have to be
converted from when it's optional.</p>
<h3 id="Implementation"> Implementation</h3>
<p>Pandoc's documentation says</p>
<blockquote><p>In contrast to most existing tools for converting markdown to HTML,
which use regex substitutions, Pandoc has a modular design: it
consists of a set of readers, which parse text in a given format and
produce a native representation of the document, and a set of writers,
which convert this native representation into a target format.
Thus, adding an input or output format requires only adding a reader
or writer.</p>
</blockquote>
<p>Come on,  most tools are using regular  expressions substitutions?!  I
can only imagine the nightmare that  it must be to implement and debug
such an implementation  -- no wait, I can't because  I just don't want
to imagine such a nightmare.</p>
<p>I used functions and function calls, a lot of them are tail recursive,
not  all of  them but  then it  means  I don't  need them  to be  tail
recursive, and  those functions  basically take a  list of  tokens and
return a  new list  with possibly fewer  tokens and the  expression to
which the missing ones were converted into.</p>
<p>So far, in version 0.4 (which is  not released yet at the time I write
this), there's a little less than  8k lines of pure OCaml code.  (Note
that I didn't write "pure functional", I wrote "pure OCaml".)</p>
<p>OMD is an  open-source free and libre software  library that any OCaml
developer can use  (hopefully quite easily since it  doesn't depend on
anything else  that the standard  OCaml compiler and library).  And of
course, it's also  a tool for any one who write  Markdown and wants it
to be  converted (quickly)  to HTML.  OMD, so far,  is about  10 times
faster than  Pandoc, and  I didn't  even make any  efforts to  make it
fast.</p>
<h4 id="Compatibility"> Compatibility</h4>
<p>OMD has been developed using OCaml 4.0.1, <a href="https://github.com/pw374/omd/issues/19">Christophe Troestler made
me make it compatible with OCaml
3.12.1</a>.  Then I guess it
might work with older version of OCaml but it's not certain (mainly
because OCaml's standard library has slightly changed, as I think I
don't use any language features that were introduced in 3.12 or 4.0).</p>
<p>By  the way,  thank  you  Christophe for  your  support, interest  and
contributions to OMD :-)</p>
<h3 id="FutureofOMD"> Future of OMD</h3>
<p>OMD  already is  in OPAM.   A  very stable  version of  OMD should  be
released soon.   As a  tool, it takes  Markdown as input  and produces
HTML as output.   A Markdown backend has been  freshly implemented, so
you can output  Markdown as well, which is  quite useful for debugging
or if you  want to know how many iterations you  need before you reach
the fix  point. You  can also  output "text", in  the sense  that it's
basically the HTML  without the HTML tags, so  it's very non-formatted
text.  There  also are  options to output  HTML table of  contents and
parametrise their depths.</p>
<h3 id="OMDandOCamlorg"> OMD and OCaml.org</h3>
<p>We    are    at   OCaml    Labs    making    a    new   website    for
<a href="http://ocaml.org">ocaml.org</a>.   The  design   is  being  provided  by
<a href="http://www.onespacemedia.com">onespacemedia</a>.    At   the  time   I'm
writing  these  lines, I'm  using  the  HTML/CSS/JS  for the  upcoming
OCaml.org to style my new Github-hosted website, so I can play with it
<em>more</em>.</p>
<p>Most pages will be written in Markdown instead of HTML, so that people
of the OCaml community may contribute to it in a more convenient way.</p>
<p>And of course, that means that OMD will be used for OCaml.org.</p>
<p><em>started on 2013-09-05 22:31:26+01:00, (re)generated on 2013-09-12 16:36:22+01:00
</em></p></div>







<p class="date"><a href="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html">by Philippe Wang at Thu, 12 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=153" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=153"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/09/ocaml-development-in-vim/">OCaml Development in Vim</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>This is a quick run-through of how I set up my development environment in vim:</p>
<p><strong>Install&#160;pathogen.vim</strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>mkdir</span> <span>-p</span> ~<span>/</span>.vim<span>/</span>autoload ~<span>/</span>.vim<span>/</span>bundle; \
curl <span>-Sso</span> ~<span>/</span>.vim<span>/</span>autoload<span>/</span>pathogen.vim \
    https:<span>//</span>raw.github.com<span>/</span>tpope<span>/</span>vim-pathogen<span>/</span>master<span>/</span>autoload<span>/</span>pathogen.vim</pre></td></tr></tbody></table></div>

<p>Add the following to ~/.vimrc:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="vim"><span>execute</span> pathogen#infect<span>(</span><span>)</span>
<span>syntax</span> <span>on</span>
<span>filetype</span> <span>plugin</span> <span>indent</span> <span>on</span></pre></td></tr></tbody></table></div>

<p><strong>Install Syntastic </strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>cd</span> ~<span>/</span>.vim<span>/</span>bundle
<span>git clone</span> https:<span>//</span>github.com<span>/</span>scrooloose<span>/</span>syntastic.git</pre></td></tr></tbody></table></div>

<p>Then quit vim and used :Helptags to check installs so far have worked.</p>
<p><strong>Install Merlin</strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">opam switch 4.01.0dev+trunk
opam update
opam upgrade
opam <span>install</span> merlin</pre></td></tr></tbody></table></div>

<p>Add the following to ~/.vimrc</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="vim"><span>:</span><span>set</span> <span>rtp</span><span>+</span>=<span>~/.</span>opam<span>/</span>4<span>.</span>01<span>.</span>0dev<span>+</span>trunk<span>/</span>share<span>/</span>ocamlmerlin<span>/</span>vim
<span>:</span><span>set</span> <span>rtp</span><span>+</span>=<span>~/.</span>opam<span>/</span>4<span>.</span>01<span>.</span>0dev<span>+</span>trunk<span>/</span>share<span>/</span>ocamlmerlin<span>/</span>vimbufsync
<span>let</span> g<span>:</span>syntastic_ocaml_checkers=<span>[</span><span>'merlin'</span><span>]</span></pre></td></tr></tbody></table></div>

<p>:SyntasticInfo will return a list of syntax checkers available to Syntastic, check that this now includes merlin</p>
<p><strong>Install OCP Indent</strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">opam <span>install</span> ocp-indent</pre></td></tr></tbody></table></div>

<p>Add the following to ~/.vimrc</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="vim"><span>autocmd</span> <span>FileType</span> ocaml source <span>/</span>home<span>/</span>heidi<span>-</span>ann<span>/.</span>opam<span>/</span>4<span>.</span>01<span>.</span>0dev<span>+</span>trunk<span>/</span>share<span>/</span>typerex<span>/</span>ocp<span>-</span><span>indent</span><span>/</span>ocp<span>-</span><span>indent</span><span>.</span>vim</pre></td></tr></tbody></table></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/09/ocaml-development-in-vim/">by Heidi-ann at Mon, 09 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging"><a name="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html">OCamlot--exploring the edges of OPAM packages</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>The new release of OCaml (4.01.0) was just <a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html">announced</a>! The runup to a major release like this is normally a frantic time to test that your favourite applications don&#8217;t break unexpectedly due to some incompatible language feature. This release cycle has a little different though, as we&#8217;ve been working hard on using the <a href="http://opam.ocamlpro.com">OPAM</a> package database to build an online regression testing infrastructure to mechanize much of this process.</p>

<p>I wanted to share some of what OCamlot does today, some of the results from about 3 months worth of runs that may help OCaml package maintainers, and finally where we&#8217;re going with future developments. This work has been done in collaboration with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html">David Sheets</a> (who built the OCamlot daemon) and the OPAM team ably led by <a href="http://gazagnaire.org">Thomas Gazagnaire</a> at <a href="http://ocamlpro.com">OCamlPro</a>. We&#8217;ve also had a lot of help from <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/ysulsky">Yury Sulsky</a> from Jane Street and <a href="http://dave.recoil.org">Dave Scott</a> and <a href="http://jon.recoil.org">Jon Ludlam</a> from Citrix acting as guinea pigs for their respective regular releases of the <a href="https://github.com/janestreet">Core</a> and <a href="https://github.com/xapi-project">Xen/XAPI</a> releases to OPAM.</p>

<h2 id="towards_a_truely_portable_ocaml">Towards a truely portable OCaml</h2>

<p>The upstream OCaml toolchain is built on very UNIX-like principles, with a number of command-line tools that form a build pipeline. This process usually ends with linking the intermediate object files with a <a href="https://github.com/ocaml/ocaml/tree/trunk/byterun">runtime library</a> that provides the garbage collector and other intrinsic OS functions.</p>

<p>Given these raw compiler tools, it&#8217;s very easy to compile OCaml into all sorts of weird and wonderful architectures. We&#8217;ve seen it run on <a href="http://www.algo-prog.info/ocaml_for_pic/web/index.php">8-bit PICs</a>, several efficient Javascript backends (originally <a href="http://jaked.github.io/ocamljs/">ocamljs</a> and more recently <a href="http://ocsigen.org/js_of_ocaml">js_of_ocaml</a>), and of course my own <a href="http://openmirage.org">Mirage</a> Xen unikernel.</p>

<p>While the compiler tools themselves are quite portable and work on almost any UNIX-like system, the build system scaffolding around third-party packages is less portable. Some features such as C bindings often contribute to build breakage on some less-used operating systems such as FreeBSD or OpenBSD, as they usually require probing for header file locations or adding custom <code>CFLAGS</code> before building.</p>
<table align="center" width="90%"><tbody><tr><td class="bimg" width="30%"><a href="http://anil.recoil.org/images/dreamplug-nest-1.jpg"><img border="0" src="http://anil.recoil.org/images/dreamplug-nest-1-thumb.jpg" width="200" /></a><br />Every Internet of Things starts with a tangled pile of ARM Dreamplugs.</td>
<td class="bimg" width="30%"><a href="http://anil.recoil.org/images/sparc-macppc-openbsd-1.jpg"><img border="0" src="http://anil.recoil.org/images/sparc-macppc-openbsd-1-thumb.jpg" width="200" /></a><br />And in our server room, venerable Sparc and PowerPC G4 OpenBSD boxen still live.</td>
<td class="bimg" width="30%"><a href="http://anil.recoil.org/images/macppc-desktop-1.jpg"><img border="0" src="http://anil.recoil.org/images/macppc-desktop-1-thumb.jpg" width="200" /></a><br />Finding older machines is getting tough, but here's <a href="http://dave.recoil.org">Dave's</a> old iMac G5 running Linux.</td>
</tr>
</tbody></table>
<p>Most OCaml developers use x86-based machines and so foreign architectures also get less day-to-day testing (OCaml has superb support for fast native code compilation on ARM, PowerPC, Sparc32, and we&#8217;re working on MIPS64 here as part of the <a href="http://www.cl.cam.ac.uk/research/security/ctsrd/cheri.html">CHERI</a> project).</p>

<p>We want to make sure that OCaml and its package ecosystem works just as well in the embedded ecosystem as well as it does on vanilla x86 Linux. This includes running on my Linux iMac G5, my <a href="https://wiki.freebsd.org/FreeBSD/arm/Raspberry%20Pi">FreeBSD Raspberry Pi</a>, my <a href="http://www.openbsd.org/beagle.html">OpenBSD Pandaboard</a>, or even on a bytecode-only architecture like an <a href="http://www.openbsd.org/sparc64.html">OpenBSD/Sparc64</a>.</p>

<p>In the longer term, this paves the way to reliable cross-compiled packages for Windows, <a href="https://github.com/vouillon/ocaml-android">Android</a> and <a href="http://psellos.com/ocaml/compile-to-iphone.html">iPhone</a> (all of which have OCaml ports, but aren&#8217;t heavily tested with the full package database). The only practical way to get started on this is by building an automated test infrastructure for OCaml that explores the feature matrix (which eerily for me, happened in the early days of Xen too, via <a href="http://blogs.citrix.com/2013/08/30/xenserver-automated-testing-and-lab-orchestration-introducing-xenrt/">XenRT</a> to stabilize the hypervisor).</p>

<h3 id="why_not_jenkins_or_travis">Why not Jenkins or Travis?</h3>

<p>When we first started hacking on the OPAM testing infrastructure earlier this year, I maintained a local <a href="http://jenkins-ci.org">Jenkins</a> installation that monitored the repository. While Jenkins is a superb tool for many continuous integration tasks, it fell over badly when trying to use it on the non-x86 and non-Linux (or Windows) operating systems. Jenkins requires a full Java runtime stack to be available on each of the client machines, which was taking up more time to get up and running than a simple OCaml-based client and server that could compile to both portable bytecode or fast native code.</p>

<p>The other difficulty with OPAM is selecting which packages actually need to be tested, as it has a constraint-based package solver that supports expressive forwards and backwards version restrictions. While basic tests of the latest packages worked with Jenkins, we needed to increasingly customize it to automate interfacing directly with the OPAM libraries and calculating test schedules based on incoming change requests.</p>

<p>Another factor that ruled out depending on hosted services such as <a href="https://travis-ci.org">Travis</a> is that they tend to support x86-only architectures, whereas we really want to test the full spectrum of CPU variants supported by OCaml. This doesn&#8217;t mean that there&#8217;s no place for Travis of course, and in fact Mike Lin has already <a href="http://blog.mlin.net/2013/02/testing-ocaml-projects-on-travis-ci.html">made this work</a> with OPAM.</p>

<p>For our full testing needs though, <a href="https://github.com/ocamllabs/ocamlot">OCamlot</a> was born: an OCaml client and server system which coordinates different versions of the compiler, architectures and OPAM versions and records the results for triage and fixing issues.</p>

<h3 id="running_ocamlot">Running OCamlot</h3>

<p>The latest alpha release of OCamlot is pretty straightforward to run locally, if you are so inclined. First start a server process:</p>

<pre><code>$ git clone git://github.com/ocamllabs/ocamlot
$ cd ocamlot
$ ./install_deps.sh
$ oasis setup
# (edit lib/config.ml if you need to change ports)
$ make
$ ./_build/lib/ocamlot_cmd.native --help
$ ./_build/lib/ocamlot_cmd.native serve</code></pre>

<p>The server listens on localhost only by default, and normally an SSL-to-TCP proxy is deployed to listen for external connections (I use <a href="https://github.com/bumptech/stud">stud</a>, which is fast and easy to configure).</p>

<p>The OCamlot clients require a local compilation of OCaml, and they autodetect their local CPU architecture and operating system. I&#8217;ve put a <a href="https://gist.github.com/avsm/6393649">gist script</a> together that automates this on most Linux and BSD variants. Just customize the top variables (set <code>MAKE</code> to <code>gmake</code> under BSD) and set the hostname to your server process.</p>

<h3 id="the_results_repository_and_autotriage">The results repository and auto-triage</h3>

<p>Once the client is running, the server dispatches tasks from its test matrix, which is calculated from the OPAM package repository. The server maintains a <a href="https://github.com/ocamlot/ocamlot-state">results repository</a>, which is a Git filesystem database that records the build results and logs via an s-expression per task. It also uses <a href="https://github.com/mirage/ocaml-cohttp">Cohttp</a> to serve up the results for a web browser.</p>

<p>It&#8217;s very convenient using Git repositories like this since we can use GitHub (or any other Git host) to coordinate and record results, and restart the server without needing any local state. So convenient, in fact, that Thomas and I have been working on a more formal engine for this called <a href="https://github.com/samoht/irminsule">Irminsule</a> (more on that in a later post, though).</p>

<p>It&#8217;s almost unheard of to have a full OCamlot run go by without some errors, and so David put together the <code>ocamlot triage</code> command. This takes the state repository and runs a set of regular expressions over it to classify them into common errors. The full file is <a href="https://github.com/ocamllabs/ocamlot/blob/master/lib/result.ml">here</a>, but an excerpt should give you an idea of what we look for:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="c">(* ordered minor to severe *)</span>
	<span class="k">type</span> <span class="n">analysis</span> <span class="o">=</span>
	  <span class="o">|</span> <span class="nc">Solver</span> <span class="k">of</span> <span class="n">solver_error</span> <span class="n">option</span>
	  <span class="o">|</span> <span class="nc">Dep</span> <span class="k">of</span> <span class="kt">string</span> <span class="o">*</span> <span class="n">analysis</span>
	  <span class="o">|</span> <span class="nc">Transient</span> <span class="k">of</span> <span class="n">transient_error</span>
	  <span class="o">|</span> <span class="nc">System</span> <span class="k">of</span> <span class="n">system_error</span>
	  <span class="o">|</span> <span class="nc">Meta</span> <span class="k">of</span> <span class="n">meta_error</span>
	  <span class="o">|</span> <span class="nc">Ext_dep</span> <span class="k">of</span> <span class="n">ext_dep_error</span>
	  <span class="o">|</span> <span class="nc">Build</span> <span class="k">of</span> <span class="n">build_error</span>
	  <span class="o">|</span> <span class="nc">Multiple</span> <span class="k">of</span> <span class="n">analysis</span> <span class="kt">list</span>
	    <span class="k">with</span> <span class="n">sexp</span>
	
</code></pre>
</div>
<p>The errors are ordered by severity to aid in color highlighting. They start with OPAM solver failures and dependency failures (e.g. due to trying to build a package that requires a specific OCaml version that isn&#8217;t available), and move onto missing package dependencies or system libraris.</p>

<h2 id="testing_the_run_up_to_ocaml_401">Testing the run up to OCaml 4.01</h2>

<p>Of course, running all these tests is useless without taking action on the results. I&#8217;ve been keeping track of them in <a href="https://github.com/OCamlPro/opam-repository/issues/1029">issue #1029</a>. The nice thing about GitHub issues is that when this bug is referenced in commits (even in other repositories) a cross-reference shows up on that webpage and lets everything be tracked nicely.</p>

<p>So what were the most common failures in the runup to 4.01, and what should you avoid when writing your own code?</p>

<h3 id="different_standard_library_module_signatures">Different standard library module signatures</h3>

<p>There have been a few changes to some of the functor signatures in the standard library, such as adding a <code>find</code> function to Set (<a href="http://caml.inria.fr/mantis/view.php?id=5864">mantis #5864</a>). A third-party library that tries to match the functor signature will fail to compile with a type error, such as this one below for <a href="http://anil.recoil.org/feeds/atom-ocaml.xml">zipperposition.0.2</a>:</p>

<pre><code>Error: The implementation src/ptset.ml
       does not match the interface src/ptset.cmi:
       ...
       In module Big:
       The field `find' is required but not provided</code></pre>

<p>The relevant code in <code>zipperposition</code> makes it clear what the problem is:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="c">(* Big-endian Patricia trees *)</span>
	<span class="k">module</span> <span class="nc">Big</span> <span class="o">:</span> <span class="k">sig</span>
	  <span class="k">include</span> <span class="nn">Set</span><span class="p">.</span><span class="nc">S</span> <span class="k">with</span> <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="kt">int</span>
	  <span class="k">val</span> <span class="n">intersect</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
	<span class="k">end</span>
	
</code></pre>
</div>
<p>This particular bug was <a href="https://github.com/c-cube/zipperposition/issues/1">reported upstream</a>, and the fix requires implementing the <code>find</code> function for the Patricia-tree-based <code>Set</code>. Since the OPAM package will always be broken on OCaml 4.01, it was marked with a <a href="https://github.com/ocamlpro/opam-repository/commit/e45530205987f67d4316a958446d3dcc954b19ec">compiler version constraint</a> to prevent it being selected for installation under that compiler. When a new version with the fix is uploaded to OPAM, it will always be selected in preference to this broken one.</p>

<p>One other 4.01 change that temporarily broke most of the bigger networking libraries such as <a href="https://github.com/janestreet/core">Core</a>, <a href="https://ocsigen.org/lwt">Lwt</a> and <a href="http://batteries.forge.ocamlcore.org">Batteries</a> was the addition of the <a href="http://caml.inria.fr/mantis/view.php?id=5568">close-on-exec</a> flag to the <code>Unix</code> module. This change only affects upstream packages that redefine the UNIX module for their own purposes (such as adding an asynchronous I/O monad as Lwt does), hence it affects the standard library replacement packages.</p>

<p>The fix here was to locally add patches into the relevant OPAM packages to immediately unbreak things when the fix when into the 4.01 branch of the compiler, and notify upstream maintainers to release new versions of their projects. There&#8217;s a subtle problem here: when a patch such as this goes into an unreleased branch of the compiler (such as <code>4.01.0dev</code>), it&#8217;s hard to reliably detect if the user has got the very latest version of the compiler or not. If you do have problems like this in the future, try recompiling via <code>opam switch reinstall &lt;version&gt;</code> to the latest branch.</p>

<p>It&#8217;s very useful to be able to drop in bleeding-edge compiler tools into the OPAM repository using compiler constraints like this. For an example, see Alain Frisch&#8217;s <a href="https://github.com/OCamlPro/opam-repository/blob/master/packages/ppx_tools.0.1/opam">ppx_tools</a>, that require the very latest 4.02dev trunk release to compile his new extension-points feature.</p>

<h3 id="multiple_object_definitions">Multiple object definitions</h3>

<p>OCaml 4.01 also restricts multiple method definitions with the same name in the same object. This leaves only inheritance as the way to override method names, but some packages such as OCamlnet and Mlorg had minor uses of the old mechanism.</p>

<p>You can see this by using <code>opam switch</code>:</p>

<pre><code>$ opam switch 4.00.1
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
- : &lt; x : int &gt; = &lt;obj&gt;
$ opam switch 4.01.0
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
Error: The method `x' has multiple definitions in this object</code></pre>

<h3 id="new_warnings_and_the_dreaded_warningsaserrors">New warnings, and the dreaded warnings-as-errors</h3>

<p>After a decade of being deprecated, the <code>(or)</code> and <code>(&amp;)</code> operators finally had a warning turned on by default.</p>

<pre><code>$ ocaml
# true or false;;
Warning 3: deprecated feature: operator (or); you should use (||) instead
- : bool = true</code></pre>

<p>This wouldn&#8217;t normally be so bad, except that a surprising number of released packages also turn warnings into fatal errors (by using the <code>-w @</code> flags explained in the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/comp.html">manual</a>). Warnings-as-errors is extremely useful when <em>developing</em> code but is rather harmful in released code, since a future compiler can choose to emit new warnings that aren&#8217;t necessarily fatal bugs.</p>

<p>Packages that failed like this include ocamlgraph, spotlib, quickcheck, OPA, Lablgtk-extras and many more. Please do make an effort to not leave this option turned on in your packages, or else it makes life more difficult for testing your code on bleeding edge versions of the compiler in the future.</p>

<p>It&#8217;s worth noting here that OCaml 4.01 has introduced a fair number of new and very useful warnings across a number of areas, mainly to do with detecting unexpected ambiguation or shadowing of values. I&#8217;ll cover more on these in a future post about the new 4.01 goodies.</p>

<h3 id="external_system_dependencies">External system dependencies</h3>

<p>While there any many packages in OPAM that are pure OCaml, there are also a substantial number that require other system tools to be installed. The Lablgtk GUI library obviously requires the C <code>gtk</code> library to be installed.</p>

<p>Determining if these libraries are installed on a particular OS is well beyond the scope of OPAM, as there are almost as many package managers as there are operating systems. However, it&#8217;s important for automated testing and user-friendly error messages to have some notion of detecting if the environment is ready for the OCaml package or not.</p>

<p>We&#8217;re solving this by using a <code>depexts</code> field in OPAM that consists of a set of tags that identify OS-specific packages that need to be present. A separate script can query these tags from OPAM and do the OS-specific tests or installation.</p>

<p>For example, here&#8217;s the <code>sqlite3-ocaml</code> OPAM description:</p>

<pre><code>opam-version: "1"
maintainer: "markus.mottl@gmail.com"
build: [
  ["ocaml" "setup.ml" "-configure"]
  ["ocaml" "setup.ml" "-build"]
  ["ocaml" "setup.ml" "-install"]
]
remove: [ ["ocamlfind" "remove" "sqlite3"] ]
depends: ["ocamlfind"]
depexts: [
  [ ["debian"  ] [ "libsqlite3-dev"]    ]
  [ ["freebsd" ] [ "database/sqlite3"]  ]
  [ ["openbsd" ] [ "database/sqlite3"]  ]
]</code></pre>

<p>The <code>depexts</code> field here lists APT package for Debian, and the ports tree locations for FreeBSD and OpenBSD. It could also list more specialised tags for particular versions of an OS. You can query this from OPAM as follows:</p>

<pre><code>$ opam install -e debian sqlite3-ocaml
libsqlite3-dev
$ opam install -e openbsd sqlite3-ocaml
database/sqlite3</code></pre>

<p>OCamlot therefore needs to query the <code>depexts</code> field from the package and run the right <code>apt</code> or <code>pkg_add</code> commands. I&#8217;ll write about this in more detail when it&#8217;s fully baked, as we&#8217;ve modified the semantics of the tag querying between OPAM 1.0 and OPAM 1.1 to make it easier to use in OCamlot.</p>

<h3 id="portable_shell_scripts">Portable shell scripts</h3>

<p>Once we&#8217;ve gotten past the hurdle of the compiler version causing failures, there is the small matter of testing non-Linux operating systems, as well as non-x86 CPU architectures. The <a href="https://github.com/OCamlPro/opam-repository/issues/1029">#1029 overview</a> lists many of these failures under the Portability section.</p>
<a href="http://www.openbsd.org"><img src="http://anil.recoil.org/images/ppuf200X181.gif" /></a>
<p>Damien Doligez made some excellent points about how to write <a href="http://gallium.inria.fr/blog/portable-conditionals-in-makefiles/">portable Makefiles</a> that works across both GNU and BSD makes. This is why the carefully crafted OCaml Makefiles do not require GNU make to be installed when compiling on FreeBSD or OpenBSD (MacOS X gave up the fight a long time ago and installs GNU make as its default <code>make</code> command).</p>

<p>OPAM tries to help out BSD by providing a <code>make</code> macro in <code>opam</code> files that is substituted with either <code>"make"</code> (by default) or <code>"gmake"</code> (for BSD). While this works for for the toplevel invocation of the Makefile, it fails if the Makefile recursively invokes further targets without using the <code>$(MAKE)</code> variable instead of directly calling the command. Patching these sorts of things is easy but tedious: see the <a href="https://github.com/OCamlPro/opam-repository/blob/master/packages/facile.1.1/files/bsdmake.patch">patchfile</a> for the Facile constraint programming library for an example.</p>

<p>The real problem here, of course, is that package maintainers cannot be reasonably expected to test their code on systems that they don&#8217;t normally use&#8211;if we demanded perfect portability to be present in the main OPAM repository, we would&#8217;t get any submissions!</p>

<p>OCamlot automates this nicely though, by finding lots of portability bugs automatically, and maintainers are by-and-large very responsive when we report the problem upstream.</p>

<h2 id="the_emerging_distributed_workflow">The emerging distributed workflow</h2>

<p>The big drawback to OCamlot in its current form is the amount of triage effort it puts on the OPAM maintainers. The package database has now exceeded 500 packages in just a short few months, and has over 1500 unique versions that all need build testing and more accurate constraints. The wider community has been <em>really</em> keen to participate in helping with triage (just look at all the other people that leapt in on <a href="https://github.com/OCamlPro/opam-repository/issues/1029">bug #1029</a>), so its our immediate priority to make OCamlot more transparent for people that want to use it to improve their own packages, and in the future also use it to test various hypotheses about all the available open-source OCaml code (see Jacques&#8217; experiment with <a href="http://gallium.inria.fr/blog/monomorphic_let/">monomorphic let</a> as an example of something that can benefit from wider automated compilation).</p>

<p>I&#8217;ll talk more about how we&#8217;re solving this in my upcoming <a href="http://ocaml.org/meetings/ocaml/2013/">OCaml 2013 Workshop</a> talk about the Platform. I don&#8217;t want spoil it too much, but it involves a lovely distributed Git workflow, an enhanced <a href="https://github.com/OCamlPro/opam2web">opam2web</a>, and a brand new metadata overlay system for OPAM that lets us enhance the package database with extra information such as statistics, portability and test results, but without polluting the main Git repository with all this extra non-essential data.</p>

<p>If you&#8217;re really curious to know right now, then you can see the outline of the new system at Amir&#8217;s <a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">new ocaml.org wireframes</a> blog post, where Part III contains the continuous integration workflow. A lot of infrastructure work has gone into building all of this over the summer, and now it&#8217;s all starting to be deployed in a very satisfying way&#8230;</p></div>







<p class="date"><a href="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html">Sun, 08 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=25" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=25"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/08/icfp-cufp-ocaml2013/">ICFP, CUFP &amp; OCaml2013</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>I&#8217;m busy planning my first trip across the&#160;Atlantic to attend ICFP, CUFP and OCaml 2013. Today, I&#8217;ve been given the duty of &#8220;live blogging&#8221; the event, over at the <a href="http://www.syslog.cl.cam.ac.uk/" title="syslog">syslog</a>, the Cambridge&#160;Systems Research Group blog.</p>
<p>My other job for the event is to improve the documentation for <a href="http://janestreet.github.io/guide-async.html">Janestreet&#8217;s Async</a> library. if anyone else is keen, I would love to organise a doc-a-thon to populate the .mli files</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/08/icfp-cufp-ocaml2013/">by Heidi-ann at Wed, 28 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/introducing-vchan"><a name="http://openmirage.org/blog/introducing-vchan"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/introducing-vchan">Introducing vchan</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p><b>In Theory</b></p><p>Unless you are familiar with Xen's source code, there is little chance that you've ever heard of the <b>vchan</b> library or protocol. Documentation about it is very scarce: a description can be found on vchan's <a href="http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=xen/include/public/io/libxenvchan.h;hb=HEAD">public header file</a>, that I quote here for convenience:</p><blockquote> <p>Originally borrowed from the <a href="http://www.qubes-os.org">Qubes OS Project</a>, this code (i.e. libvchan) has been substantially rewritten [...] This is a library for inter-domain communication.  A standard Xen ring buffer is used, with a datagram-based interface built on top.  The grant reference and event channels are shared in XenStore under a user-specified path.</p> </blockquote><p>This protocol uses shared memory for inter-domain communication, i.e. between two VMs residing in the same Xen host, and uses Xen's mechanisms -- more specifically, <a href="http://www.informit.com/articles/article.aspx?p=1160234&amp;seqNum=3">ring buffers</a> and <a href="http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=tools/libxc/xenctrl.h;h=f2cebafc9ddd4815ffc73fcf9e0d292b1d4c91ff;hb=HEAD#l934">event channels</a> -- in order to achieve its aims. <b>Datagram-based interface</b> simply means that the <a href="http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=tools/libvchan/libxenvchan.h;h=6365d36a06f8c8f56454724cefc4c2f1d39beba2;hb=HEAD">interface</a> resembles UDP, although there is support for stream based communication (like TCP) as well.</p><p>Over the last two months or so, I worked on a <a href="http://github.com/mirage/ocaml-vchan">pure OCaml implementation</a> of this library, meaning that Mirage-based unikernels can now take full advantage of <b>vchan</b> to communicate with neighboring VMs! If your endpoint -- a Linux VM or another unikernel -- is on the same host, it is much faster and more efficient to use vchan rather than the network stack (although unfortunately, it is currently incompatible with existing programs written against the <code>socket</code> library under UNIX or the <code>Flow</code> module of Mirage, although this will improve). It also provides a higher level of security compared to network sockets as messages will never leave the host's shared memory.</p><p><b>Building the vchan echo domain</b></p><p>Provided that you have a Xen-enabled machine, do the following from dom0:</p><div class="ocaml"><pre><code>opam install mirari mirage-xen mirage vchan
</code></pre></div><p>This will install the library and its dependencies. <code>mirari</code> is necessary to build the <b>echo unikernel</b>:</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/mirage/ocaml-vchan
cd test
mirari configure --xen --no-install
mirari build --xen
sudo mirari run --xen
</code></pre></div><p>This will boot a <code>vchan echo domain</code> for dom0, with connection parameters stored in xenstore at <code>/local/domain/&lt;domid&gt;/data/vchan</code>, where <code>&lt;domid&gt;</code> is the domain id of the vchan echo domain. The echo domain is simply an unikernel hosting a vchan server accepting connections from dom0, and echo'ing everything that is sent to it.</p><p>The command <code>xl list</code> will give you the domain id of the echo server.</p><p><b>Building the vchan CLI from Xen's sources</b></p><p>You can try it using a vchan client that can be found in Xen's sources at <code>tools/libvchan</code>: Just type <code>make</code> in this directory. It will compile the executable <code>vchan-node2</code> that you can use to connect to our freshly created echo domain:</p><div class="ocaml"><pre><code>./vchan-node2 client <span class="keyword2">&lt;</span>domid<span class="keyword2">&gt;</span>/local/domain/<span class="keyword2">&lt;</span>domid<span class="keyword2">&gt;</span>/data/vchan
</code></pre></div><p>If everything goes well, what you type in there will be echoed.</p><p>You can obtain the full API documentation for <b>ocaml-vchan</b> by doing a <code>cd ocaml-vchan &amp;&amp; make doc</code>. If you are doing network programming under UNIX, vchan's interface will not surprise you. If you are already using vchan for a C project, you will see that the OCaml API is nearly identical to what you are used to.</p><p>Please let us know if you use or plan to use this library in any way! If you need tremedous speed or more security, this might fit your needs.</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/introducing-vchan">by Vincent Bernardoff (vb@luminar.eu.org) at Fri, 23 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=86" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=86"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/08/real-world-ocaml-beta3-release/">Real World OCaml beta3 release</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>Beta3 of RWO is now available:&#160;<a href="https://realworldocaml.org/">https://realworldocaml.org/</a>&#160;and anil (one of the co-authors) comments on the release&#160;<a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html</a></p>
<div class="wp-caption aligncenter"><img alt="" height="236" src="https://realworldocaml.org/media/img/oreilly-cover.gif" width="180" /><p class="wp-caption-text">Cover of RWO</p></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/08/real-world-ocaml-beta3-release/">by Heidi-ann at Mon, 19 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/oscon13-trip-report"><a name="http://openmirage.org/blog/oscon13-trip-report"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/oscon13-trip-report">Mirage travels to OSCON'13: a trip report</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>Now that Mirage OS is rapidly converging on a <a href="http://github.com/avsm/mirage/issues/102">Developer Preview Release 1</a>, we took it for a first public outing at <a href="http://www.oscon.com/oscon2013/">OSCON'13</a>, the O'Reilly Open Source Conference. OSCON is in its 15th year now, and is a meeting place for developers, business people and investors. It was a great opportunity to show MirageOS off to some of the movers and shakers in the OSS world.</p><p>Partly because MirageOS is about synthesising extremely specialised guest kernels from high-level code, and partly because both Anil and I are constitutionally incapable of taking the easy way out, we self-hosted the slide deck on Mirage: after some last-minute hacking -- on content not Mirage I should add! -- we built a self-contained microkernel of the talk.</p><p>This was what you might call a "full stack" presentation: the custom microkernel (flawlessly!) ran a type-safe <a href="https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml">network device driver</a>, OCaml <a href="http://github.com/mirage/mirage-net">TCP/IP stack</a> supporting an OCaml <a href="http://github.com/mirage/ocaml-cohttp">HTTP</a> framework that served slides rendered using <a href="http://lab.hakim.se/reveal-js/">reveal.js</a>. The slide deck, including the turbo-boosted <a href="http://www.youtube.com/watch?v=2Mx8Bd5JYyo">screencast</a> of the slide deck compilation, is hosted as another MirageOS virtual machine at <a href="http://decks.openmirage.org/">decks.openmirage.org</a>. We hope to add more slide decks there soon, including resurrecting the tutorial! The source code for all this is in the <a href="http://github.com/mirage/mirage-decks">mirage-decks</a> GitHub repo.</p><h3><a class="anchor-toc" name="h3-TheTalk"> The Talk</a></h3><p>The talk went down pretty well -- given we were in a graveyard slot on Friday after many people had left, attendance was fairly high (around 30-40), and the <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">feedback scores</a> have been positive (averaging 4.7/5) with comments including "excellent content and well done" and "one of the most excited projects I heard about" (though we are suspicious that just refers to Anil's usual high-energy presentation style...).</p><p> </p><p>Probably the most interesting chat after the talk was with the Rust authors at Mozilla (<a href="http://twitter.com/pcwalton">@pcwalton</a> and <a href="https://github.com/brson">@brson</a>) about combining the Mirage <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">unikernel</a> techniques with the <a href="http://www.rust-lang.org">Rust</a> runtime. But perhaps the most surprising feedback was when Anil and I were stopped in the street while walking back from some well-earned sushi, by a cyclist who loudly declared that he'd really enjoyed the talk and thought it was a really exciting project -- never done something that achieved public acclaim from the streets before :)</p><h3><a class="anchor-toc" name="h3-BookSigningandXen.org"> Book Signing and Xen.org</a></h3><p>Anil also took some time to sit in a book signing for his forthcoming <a href="http://realworldocaml.org">Real World OCaml</a> O'Reilly book.  This is really important to making OCaml easier to learn, especially given that all the Mirage libraries are using it.  Most of the dev team (and especially thanks to <a href="https://twitter.com/heidiann360">Heidi Howard</a> who bravely worked through really early alpha revisions) have been giving us feedback as the book is written, using the online commenting system.</p><p>The Xen.org booth was also huge, and we spent quite a while plotting the forthcoming Mirage/Xen/ARM backend. We're pretty much just waiting for the <a href="http://cubieboard.org">Cubieboard2</a> kernel patches to be upstreamed (keep an eye <a href="http://linux-sunxi.org/Main_Page">here</a>) so that we can boot Xen/ARM VMs on tiny ARM devices.  There's a full report about this on the <a href="http://blog.xen.org/index.php/2013/07/31/the-xen-project-at-oscon/">xen.org</a> blog post about OSCon.</p><h3><a class="anchor-toc" name="h3-GaloisandHalVM"> Galois and HalVM</a></h3><p>We also stopped by the <a href="http://corp.galois.com">Galois</a> to chat with <a href="https://twitter.com/acwpdx">Adam Wick</a>, who is the leader of the <a href="http://corp.galois.com/halvm">HalVM</a> project at Galois. This is a similar project to Mirage, but, since it's written in Haskell, has more of a focus on elegant compositional semantics rather than the more brutal performance and predictability that Mirage currently has at its lower levels.</p><p>The future of all this ultimately lies in making it easier for these multi-lingual unikernels to be managed and for all of them to communicate more easily, so we chatted about code sharing and common protocols (such as <a href="https://github.com/vbmithr/ocaml-vchan">vchan</a>) to help interoperability. Expect to see more of this once our respective implementations get more stable.</p><p>All-in-all OSCON'13 was a fun event and definitely one that we look forward returning to with a more mature version of MirageOS, to build on the momentum begun this year!  Portland was an amazing host city too, but what happens in Portland, stays in Portland...</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/oscon13-trip-report">by Richard Mortier (mort@cantab.net) at Thu, 08 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2"><a name="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">Final Real World OCaml beta; the good, the bad and the ugly</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>The second and final public beta of Real World OCaml is now available: <a href="https://realworldocaml.org">https://realworldocaml.org</a></p>

<p>Release notes:</p>

<ul><li><p>Over 2,000 comments from proofreaders have been resolved. We realize that reading early content is hard work, and hugely appreciate the spirited feedback! The book is now a week away from being handed over to the O&#8217;Reilly production team for copyediting, so the window for changes are limited after that. Comments reset between milestones and so beta2 is a clean slate; we&#8217;re still working through some remaining older issues.</p>
</li>

<li><p>The chapters on first-class modules, parsing with Menhir, and objects and classes have been significantly revised from beta1. Our thanks to Leo White for contributing significantly to the latter two chapters.</p>
</li>

<li><p>All the code snippets and terminal outputs are now mechanically generated. The source code is as close to public domain as practical, at: <a href="https://github.com/realworldocaml/examples">https://github.com/realworldocaml/examples</a></p>
</li>

<li><p>The final version will have the installation chapter moved to be online only, and we intend to publish updates there to elaborate on installation and packaging mechanisms.</p>
</li>

<li><p>Exercises will be available after we go into production, and also only be available online. We really like the collaborative spirit of the commenting system, and will likely extend this to collecting exercises from our readers on an ongoing basis.</p>
</li>
</ul>

<p>There&#8217;s been quite a bit of feedback and conversation about the book, so this also seemed like a good point to checkpoint the process somewhat.</p>

<h2 id="crowd_sourcing_community_feedback">Crowd sourcing community feedback</h2>
<a href="http://realworldocaml.org"><img align="right" src="http://anil.recoil.org/images/oreilly-cover.gif" /></a>
<p><em>Good</em>: The decision to crowdsource feedback has been exhausting but very worthwhile, with over 2,200 <a href="http://github.com/ocamllabs/rwo-comments">comments</a> posted (and over 2,000 resolved by us too!). O&#8217;Reilly has a similar platform called <a href="http://atlas.labs.oreilly.com">Atlas</a> that wasn&#8217;t quite ready when we started our book, but I&#8217;d highly encourage new authors to go down this route and not stick with a traditional editorial scheme.</p>

<p>It&#8217;s simply not possible for a small group of technical reviewers to notice as many errors as the wider community has. Having said this, it&#8217;s interesting how much more focussed and critical the comments of our editor <a href="http://radar.oreilly.com/andyo">Andy Oram</a> were when compared to most of the wider community feedback, so the commenting system is definitely a complement and not a replacement to the editorial process.</p>

<h3 id="the_github_requirement">The GitHub requirement</h3>

<p><em>Bad</em>: After the first beta, we got criticized on a <a href="https://news.ycombinator.com/item?id=5893168">Hacker News</a> thread for passing around Github oAuth tokens without SSL. This was entirely my fault, and I corrected the site to be pure-SSL within 24 hours.</p>

<p><em>Ugly</em>: In my defence though, I <em>dont want</em> the authority that all the reviewers have granted to me for their Github accounts! We need just two things to enable commenting: an identity service to cut down on spam comments, and the ability to create issues in a <a href="http://github.com/ocamllabs/rwo-comments">public repository</a>. Unfortunately, Github&#8217;s <a href="http://developer.github.com/v3/oauth/#scopes">scope</a> API requires you to also grant us access to commit to public code repositories. Add on the fact that around 6,000 people have clicked through the oAuth API to review RWO, and you start to see just how much code we potentially have access to. I did try to reduce the damage by not actually storing the oAuth tokens on the server-side. Instead, we store it in the client using a secure cookie, so you can easily reset your browser to log out.</p>

<p>It&#8217;s not just about authentication either: another reader <a href="http://www.reddit.com/r/ocaml/comments/1gil84/public_beta_of_real_world_ocaml/cal811r">points out</a> that if they use GitHub during work hours, they have no real way of separating the news streams that result.</p>

<p>Much of the frustration here is that there&#8217;s nothing I can do to fix this except wait for GitHub to hopefully improve their service. I very much hope that GitHub is listening to this and has internal plans to overhaul their privilege management APIs.</p>

<h3 id="infrastructurefree_hosting">Infrastructure-free hosting</h3>

<p><em>Good</em> and <em>Bad</em>: One of my goals with the commenting infrastructure was to try and eliminate all server-side code, so that we could simply publish the book onto Github Pages and use JavaScript for the comment creation and listing.</p>

<p>This <em>almost</em> worked out. We still need a tiny HTTP proxy for comment creation, as we add contextual information such as a milestone to every new comment to make it easier to index. Setting a milestone requires privileged access to the repository and so our server-side proxy creates the issue using the user-supplied oAuth token (so that it originates from the commenter), and then updates it (via the <a href="http://github.com/bactrian">bactrian</a> account) to add the milestone add insert a little contextual comment pointing back to the book paragraph where the comment originated from.</p>

<p><em>Good</em>: The other criticism from the <a href="http://www.reddit.com/r/programming/comments/1gipea/first_public_beta_of_real_world_ocaml_book/cakmeuz">online feedback</a> was the <em>requirement</em> to have a Github login to read the book at all. This is a restriction that we intend to lift for the final release (which will be freely available online under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/">CC-BY-NC-ND</a> license), but I think it&#8217;s absolutely the right decision to gateway early adopters to get useful feedback. Even if we lost 90% of our potential reviewers through the Github auth wall, I don&#8217;t think we could have coped with another 10,000 comments in any case.</p>

<p>On the positive side, we didn&#8217;t have a single spam comment or other abuses of the commenting system at all.</p>

<p>I&#8217;ve had quite a few queries been open-sourcing the <a href="http://github.com/realworldocaml/scripts">scripts</a> that drive the server-side commenting, and this on my TODO list for after the final book has gone to production.</p>

<h2 id="autogenerating_the_examples">Auto-generating the examples</h2>

<p><em>Bad</em>: We tried for far too long during the book writing to stumble through with manual installation instructions and hand-copied code snippets and outputs. Some of our alpha reviewers pointed out <a href="https://github.com/ocamllabs/rwo-comments/issues/236">vociferously</a> that spending time on installation and dealing with code typos was not a good use of their time.</p>

<p><em>Good</em>: <a href="http://bolinfest.com">Michael Bolin</a> was entirely correct in his criticism (and incidentally, one of our most superstar reviewers). The latest beta has an entirely mechanically generated toolchain that lets us regenerate the entire book output from a cold start by cloning the <a href="https://github.com/realworldocaml/examples">examples</a> repository. In retrospect, I should have written this infrastructure a year ago, and I&#8217;d recommend any new books of this sort focus hard on automation from the early days.</p>

<p>Luckily, my automation <a href="https://github.com/realworldocaml/scripts">scripts</a> could crib heavily from existing open-source OCaml projects that had portions of what we needed, such as <a href="https://github.com/diml/utop">uTop</a> and <a href="https://github.com/ocaml/ocaml.org">ocaml.org</a> (and my thanks to <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/Chris00">Christophe Troestler</a> for their help here).</p>

<p><em>Awesome</em>: We&#8217;re hacking on a little surprise for the final online version of the book, based on this build infrastructure. Stay <a href="http://try.ocamlpro.com">tuned</a>!</p></div>







<p class="date"><a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">Mon, 05 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=99" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=99"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/08/abstractions-and-types-for-concurrent-programming/">OCaml Lecture Notes</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>I just wanted to share these sildes from&#160;Yaron Minsky guest lecture at Princeton on &#8220;Abstractions and Types&#160;for Concurrent&#160;Programming&#8221;: [<a href="http://www.cs.princeton.edu/~dpw/courses/cos326-12/lec/asynch-and-rpc.pdf">pdf</a>] &#160;to the <a href="http://www.cs.princeton.edu/~dpw/courses/cos326-12/">COS 326</a> class and the notes from Cornell&#8217;s OCaml course called &#8220;<a href="http://www.cs.cornell.edu/Courses/cs3110/2011sp/lecturenotes.asp">Data Structures and Functional Programming</a>&#8220;, edit the URL to see notes from different years</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/08/abstractions-and-types-for-concurrent-programming/">by Heidi-ann at Thu, 01 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/xen-block-devices-with-mirage"><a name="http://openmirage.org/blog/xen-block-devices-with-mirage"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/xen-block-devices-with-mirage">Creating Xen block devices with Mirage</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.openmirage.org/">Mirage</a> is a <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">unikernel</a> or "library operating system" that allows us to build applications which can be compiled to very diverse environments: the same code can be linked to run as a regular Unix app, relinked to run as a <a href="https://github.com/pgj/mirage-kfreebsd">FreeBSD kernel module</a>, and even linked into a self-contained kernel which can run on the <a href="http://www.xenproject.org/">Xen hypervisor</a>.</p><p>Mirage has access to an extensive suite of pure OCaml <a href="https://github.com/mirage">libraries</a>, covering everything from Xen <a href="https://github.com/mirage/ocaml-xen-block-driver">block</a> and <a href="https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml">network</a> virtual device drivers, a <a href="https://github.com/mirage/mirage-net">TCP/IP stack</a>, OpenFlow learning switches and controllers, to SSH and <a href="https://github.com/mirage/ocaml-cohttp">HTTP</a> server implementations.</p><p>I normally use Mirage to deploy applications as kernels on top of a <a href="http://www.xenserver.org/">XenServer</a> hypervisor. I start by first using the Mirage libraries within a normal Unix userspace application -- where I have access to excellent debugging tools -- and then finally link my app as a high-performance Xen kernel for production.</p><p>However Mirage is great for more than simply building Xen kernels. In this post I'll describe how I've been using Mirage to create experimental virtual disk devices for existing Xen VMs (which may themselves be Linux, *BSD, Windows or even Mirage kernels). The Mirage libraries let me easily experiment with different backend file formats and protocols, all while writing only type-safe OCaml code thats runs in userspace in a normal Linux domain 0.</p><p><b>Disk devices under Xen</b></p><p>The protocols used by Xen disk and network devices are designed to permit fast and efficient software implementations, avoiding the inefficiencies inherent in emulating physical hardware in software. The protocols are based on two primitives:</p><ul> <li> <p><b>shared memory pages</b>: used for sharing both data and metadata</p> </li><li> <p><b>event channels</b>: similar to interrupts, these allow one side to signal the other</p> </li> </ul><p>In the disk block protocol, the protocol starts with the client ("frontend" in Xen jargon) sharing a page with the server ("backend"). This single page will contain the request/response metadata, arranged as a circular buffer or "ring". The client ("frontend") can then start sharing pages containing disk blocks with the backend and pushing request structures to the ring, updating shared pointers as it goes. The client will give the server end a kick via an event channel signal and then both ends start running simultaneously. There are no locks in the protocol so updates to the shared metadata must be handled carefully, using write memory barriers to ensure consistency.</p><p><b>Xen disk devices in Mirage</b></p><p>Like everything else in Mirage, Xen disk devices are implemented as libraries. The ocamlfind library called "xenctrl" provides support for manipulating blocks of raw memory pages, "granting" access to them to other domains and signalling event channels. There are two implementations of "xenctrl": <a href="https://github.com/mirage/mirage-platform/tree/master/xen/lib">one that invokes Xen "hypercalls" directly</a> and one which uses the <a href="https://github.com/xapi-project/ocaml-xen-lowlevel-libs">Xen userspace library libxc</a>. Both implementations satisfy a common signature, so it's easy to write code which will work in both userspace and kernelspace.</p><p>The ocamlfind library <a href="https://github.com/mirage/shared-memory-ring">shared-memory-ring</a> provides functions to create and manipulate request/response rings in shared memory as used by the disk and network protocols. This library is a mix of 99.9% OCaml and 0.1% asm, where the asm is only needed to invoke memory barrier operations to ensure that metadata writes issued by one CPU core appear in the same order when viewed from another CPU core.</p><p>Finally the ocamlfind library <a href="https://github.com/mirage/ocaml-xen-block-driver">xenblock</a> provides functions to hotplug and hotunplug disk devices, together with an implementation of the disk block protocol itself.</p><p><b>Making custom virtual disk servers with Mirage</b></p><p>Let's experiment with making our own virtual disk server based on the Mirage example program, <a href="https://github.com/mirage/xen-disk">xen-disk</a>.</p><p>First, install <a href="http://www.xen.org/">Xen</a>, <a href="http://www.ocaml.org/">OCaml</a> and <a href="http://opam.ocamlpro.com/">OPAM</a>. Second initialise your system:</p><div class="ocaml"><pre><code>opam init
eval `opam config env`
</code></pre></div><p>At the time of writing, not all the libraries were released as upstream OPAM packages, so it was necessary to add some extra repositories. This should not be necessary after the Mirage developer preview at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">OSCON 2013</a>.</p><div class="ocaml"><pre><code>opam remote add mirage-dev git<span class="keyword2">:</span>//github.com/mirage/opam-repo-dev
opam remote add xapi-dev git<span class="keyword2">:</span>//github.com/xapi-project/opam-repo-dev
</code></pre></div><p>Install the unmodified <code>xen-disk</code> package, this will ensure all the build dependencies are installed:</p><div class="ocaml"><pre><code>opam install xen-disk
</code></pre></div><p>When this completes it will have installed a command-line tool called <code>xen-disk</code>. If you start a VM using your Xen toolstack of choice ("xl create ..." or "xe vm-install ..." or "virsh create ...") then you should be able to run:</p><div class="ocaml"><pre><code>xen-disk connect <span class="keyword2">&lt;</span>vmname<span class="keyword2">&gt;</span>
</code></pre></div><p>which will hotplug a fresh block device into the VM "&lt;vmname&gt;" using the "discard" backend, which returns "success" to all read and write requests, but actually throws all data away. Obviously this backend should only be used for basic testing!</p><p>Assuming that worked ok, clone and build the source for <code>xen-disk</code> yourself:</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/mirage/xen-disk
cd xen-disk
make
</code></pre></div><p><b>Making a custom virtual disk implementation</b></p><p>The <code>xen-disk</code> program has a set of simple built-in virtual disk implementations. Each one satisifies a simple signature, contained in <a href="https://github.com/mirage/xen-disk/blob/master/src/storage.mli">src/storage.mli</a>:</p><div class="ocaml"><pre><code><span class="keyword4">type</span> configuration <span class="keyword2">=</span> <span class="keyword2">{</span>
  filename<span class="keyword2">:</span> <span class="keyword3">string</span><span class="keyword2">;</span>      <span class="comments">(** path where the data will be stored *)</span>
  format<span class="keyword2">:</span> <span class="keyword3">string</span> option<span class="keyword2">;</span> <span class="comments">(** format of physical data *)</span>
<span class="keyword2">}</span>
<span class="comments">(** Information needed to "open" a disk *)</span>

<span class="keyword4">module</span> <span class="keyword4">type</span> <span class="keyword6">S </span><span class="keyword2">=</span> <span class="keyword4">sig</span>
  <span class="comments">(** A concrete mechanism to access and update a virtual disk. *)</span>

  <span class="keyword4">type</span> t
  <span class="comments">(** An open virtual disk *)</span>

  <span class="keyword4">val</span> open_disk<span class="keyword2">:</span> configuration -<span class="keyword2">&gt;</span> t option <span class="keyword5">Lwt.</span>t
  <span class="comments">(** Given a configuration, attempt to open a virtual disk *)</span>

  <span class="keyword4">val</span> size<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> int64
  <span class="comments">(** [size t] is the size of the virtual disk in bytes. The actual
      number of bytes stored on media may be different. *)</span>

  <span class="keyword4">val</span> read<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword5">Cstruct.</span>t -<span class="keyword2">&gt;</span> int64 -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t
  <span class="comments">(** [read t buf offset_sectors len_sectors] copies [len_sectors]
      sectors beginning at sector [offset_sectors] from [t] into [buf] *)</span>

  <span class="keyword4">val</span> write<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword5">Cstruct.</span>t -<span class="keyword2">&gt;</span> int64 -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t
  <span class="comments">(** [write t buf offset_sectors len_sectors] copies [len_sectors]
      sectors from [buf] into [t] beginning at sector [offset_sectors]. *)</span>
<span class="keyword4">end</span>
</code></pre></div><p>Let's make a virtual disk implementation which uses an existing disk image file as a "gold image", but uses copy-on-write so that no writes persist. This is a common configuration in Virtual Desktop Infrastructure deployments and is generally handy when you want to test a change quickly, and revert it cleanly afterwards.</p><p>A useful Unix technique for file I/O is to "memory map" an existing file: this associates the file contents with a range of virtual memory addresses so that reading and writing within this address range will actually read or write the file contents. The "mmap" C function has a number of flags, which can be used to request "copy on write" behaviour. Reading the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.Genarray.html">OCaml manual Bigarray.map_file</a> it says:</p><blockquote> <p>If shared is true, all modifications performed on the array are reflected in the file. This requires that fd be opened with write permissions. If shared is false, modifications performed on the array are done in memory only, using copy-on-write of the modified pages; the underlying file is not affected.</p> </blockquote><p>So we should be able to make a virtual disk implementation which memory maps the image file and achieves copy-on-write by setting "shared" to false. For extra safety we can also open the file read-only.</p><p>Luckily there is already an <a href="https://github.com/mirage/xen-disk/blob/master/src/backend.ml#L63">"mmap" implementation</a> in <code>xen-disk</code>; all we need to do is tweak it slightly. Note that the <code>xen-disk</code> program uses a co-operative threading library called <a href="http://ocsigen.org/lwt/">lwt</a> which replaces functions from the OCaml standard library which might block with non-blocking variants. In particular <code>lwt</code> uses <code>Lwt_bytes.map_file</code> as a wrapper for the <code>Bigarray.Array1.map_file</code> function. In the "open-disk" function we simply need to set "shared" to "false" to achieve the behaviour we want i.e.</p><div class="ocaml"><pre><code><span class="keyword4">let</span> open_disk configuration <span class="keyword2">=</span>
  <span class="keyword4">let</span> fd <span class="keyword2">=</span> <span class="keyword5">Unix.</span>openfile configuration.filename <span class="keyword2">[</span> <span class="keyword5">Unix.O_RDONLY </span><span class="keyword2">]</span> <span class="keyword8">0</span>o0 <span class="keyword4">in</span>
  <span class="keyword4">let</span> stats <span class="keyword2">=</span> <span class="keyword5">Unix.</span><span class="keyword5">LargeFile.</span>fstat fd <span class="keyword4">in</span>
  <span class="keyword4">let</span> mmap <span class="keyword2">=</span> <span class="keyword5">Lwt_bytes.</span>map_file ~fd ~shared<span class="keyword2">:</span>false <span class="keyword2">(</span><span class="keyword2">)</span> <span class="keyword4">in</span>
  <span class="keyword5">Unix.</span>close fd<span class="keyword2">;</span>
  return <span class="keyword2">(</span><span class="keyword6">Some </span><span class="keyword2">(</span>stats.<span class="keyword5">Unix.</span><span class="keyword5">LargeFile.</span>st_size, <span class="keyword5">Cstruct.</span>of_bigarray mmap<span class="keyword2">)</span><span class="keyword2">)</span>
</code></pre></div><p>The read and write functions can be left as they are:</p><div class="ocaml"><pre><code><span class="keyword4">let</span> read <span class="keyword2">(</span><span class="keyword8">_</span>, mmap<span class="keyword2">)</span> buf offset_sectors len_sectors <span class="keyword2">=</span>
  <span class="keyword4">let</span> offset_sectors <span class="keyword2">=</span> <span class="keyword5">Int64.</span>to_int offset_sectors <span class="keyword4">in</span>
  <span class="keyword4">let</span> len_bytes <span class="keyword2">=</span> len_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword4">let</span> offset_bytes <span class="keyword2">=</span> offset_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword5">Cstruct.</span>blit mmap offset_bytes buf <span class="keyword8">0</span> len_bytes<span class="keyword2">;</span>
  return <span class="keyword2">(</span><span class="keyword2">)</span>

<span class="keyword4">let</span> write <span class="keyword2">(</span><span class="keyword8">_</span>, mmap<span class="keyword2">)</span> buf offset_sectors len_sectors <span class="keyword2">=</span>
  <span class="keyword4">let</span> offset_sectors <span class="keyword2">=</span> <span class="keyword5">Int64.</span>to_int offset_sectors <span class="keyword4">in</span>
  <span class="keyword4">let</span> offset_bytes <span class="keyword2">=</span> offset_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword4">let</span> len_bytes <span class="keyword2">=</span> len_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword5">Cstruct.</span>blit buf <span class="keyword8">0</span> mmap offset_bytes len_bytes<span class="keyword2">;</span>
  return <span class="keyword2">(</span><span class="keyword2">)</span>
</code></pre></div><p>Now if we rebuild and run something like:</p><div class="ocaml"><pre><code>dd <span class="keyword1">if</span><span class="keyword2">=</span>/dev/zero <span class="keyword2">of</span><span class="keyword2">=</span>disk.raw bs<span class="keyword2">=</span><span class="keyword8">1</span><span class="keyword6">M </span>seek<span class="keyword2">=</span><span class="keyword8">1024</span> count<span class="keyword2">=</span><span class="keyword8">1</span>
losetup /dev/loop0 disk.raw
mkfs.ext3 /dev/loop0
losetup -d /dev/loop0

dist/build/xen-disk/xen-disk connect <span class="keyword2">&lt;</span>myvm<span class="keyword2">&gt;</span> --path disk.raw
</code></pre></div><p>Inside the VM we should be able to do some basic speed testing:</p><div class="ocaml"><pre><code># dd <span class="keyword1">if</span><span class="keyword2">=</span>/dev/xvdb <span class="keyword2">of</span><span class="keyword2">=</span>/dev/null bs<span class="keyword2">=</span><span class="keyword8">1</span><span class="keyword6">M </span>iflag<span class="keyword2">=</span>direct count<span class="keyword2">=</span><span class="keyword8">100</span>
<span class="keyword8">100</span><span class="keyword2">+</span><span class="keyword8">0</span> records <span class="keyword4">in</span>
<span class="keyword8">100</span><span class="keyword2">+</span><span class="keyword8">0</span> records out
<span class="keyword8">104857600</span> bytes <span class="keyword2">(</span><span class="keyword8">105</span> MB<span class="keyword2">)</span> copied, <span class="keyword8">0</span>.<span class="keyword8">125296</span> s, <span class="keyword8">837</span> MB/s
</code></pre></div><p>Plus we should be able to mount the filesystem inside the VM, make changes and then disconnect (send SIGINT to xen-disk by hitting Control+C on your terminal) without disturbing the underlying disk contents.</p><p><b>So what else can we do?</b></p><p>Thanks to Mirage it's now really easy to experiment with custom storage types for your existing VMs. If you have a cunning scheme where you want to hash block contents, and use the hashes as keys in some distributed datastructure -- go ahead, it's all easy to do. If you have ideas for improving the low-level block access protocol then Mirage makes those experiments very easy too.</p><p>If you come up with a cool example with Mirage, then send us a <a href="https://github.com/mirage">pull request</a> or send us an email to the <a href="http://www.openmirage.org/about/">Mirage mailing list</a> -- we'd love to hear about it!</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/xen-block-devices-with-mirage">by Dave Scott (dave@recoil.org) at Thu, 18 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=64" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=64"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/07/profiling-ocaml-getting-started-guide/">Profiling OCaml &#8211; Getting Started Guide</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>&#8220;Perf&#8221; is a common command line linux tool used for code profiling, (<a href="https://perf.wiki.kernel.org/index.php/Tutorial">perf wiki</a>). A alpha version of a OCaml native code compiler that output code, that can be analysis by perf is now avalaible in OPAM</p>
<p><strong>Installation</strong></p>
<p>Installing the perf compatible OCaml compiler is straight forward with OPAM, though quite time-consuming due to the need to re-install many packages</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">$ opam remote add perf git:<span>//</span>github.com<span>/</span>mshinwell<span>/</span>opam-repo-dev
$ opam switch <span>4.01</span>-perf-annotate
$ <span>eval</span> <span>`</span>opam config <span>env</span><span>`</span>
$ opam <span>install</span></pre></td></tr></tbody></table></div>

<p>Installing perf was also straight forward, in fact I already had it via the linux-tools package in apt-get for Ubuntu.</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>sudo</span> <span>apt-get install</span> linux-tools</pre></td></tr></tbody></table></div>

<p><strong>Usage</strong><br />Compiling with the new perf-compatable Ocaml compiler was beautifully simple, running make within an existing project working first time without any further changes necessary.</p>
<p><strong>Basics</strong><br />Basic reporting is collected and viewed using:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>sudo</span> perf record .<span>/</span>myprogram.native <span>-o</span> myreport.data
<span>sudo</span> perf report <span>-i</span> myreport.data
<span>sudo</span> perf script <span>-i</span> myreport.data</pre></td></tr></tbody></table></div>

<p>Similarly basic stats can be collected using:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>sudo</span> perf <span>stat</span> .<span>/</span>myprogram.native <span>-o</span> myreport.data
<span>sudo</span> <span>cat</span> myreport.data</pre></td></tr></tbody></table></div>

<p>When finished you can switch back to your normal compiler version, i.e.</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">$ opam switch 4.00.1
$ <span>eval</span> <span>`</span>opam config <span>env</span><span>`</span></pre></td></tr></tbody></table></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/07/profiling-ocaml-getting-started-guide/">by Heidi-ann at Wed, 10 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=90" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=90"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/07/learning-async/">Learning Async</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>If your taking your first steps in Janestreet&#8217;s Async library, here&#8217;s some sources of help &amp; support:</p>
<p><strong>My top 5 sources of Async Documentation</strong></p>
<ol><li>Official Janestreet Docs for Async/Core:&#160;<a href="https://ocaml.janestreet.com/ocaml-core/latest/doc/">https://ocaml.janestreet.com/ocaml-core/latest/doc/</a>&#160;These are generated from the .mli&#8217;s in the Async source and you will quickly find places where ocamldoc has failed to cope with Core/Async complex module structure. In this case, I recommend the source code:&#160;<a href="https://github.com/janestreet/async">https://github.com/janestreet/async</a></li>
<li>Dummy&#8217;s guide to Async, a useful intro to bind, upon and map (the 3 fundemental functions):&#160;<a href="http://janestreet.github.io/guide-async.html">http://janestreet.github.io/guide-async.html</a></li>
<li>Real World OCaml chapter on Async, covers Deferred basics, Ivars, Reader/Writer, TCP server, running the scheduler, Command, Pipes, Monitors, Delays, Choose and System Threads:&#160;<a href="https://realworldocaml.org/beta3/en/html/concurrent-programming-with-async.html">https://realworldocaml.org/beta3/en/html/concurrent-programming-with-async.html</a></li>
<li>Yaron Minsky (one of co-authors of RWO) provides a nice little example of Async&#8217;s RPC libraries:&#160;<a href="https://bitbucket.org/yminsky/core-hello-world">https://bitbucket.org/yminsky/core-hello-world</a></li>
<li>My favourite project for example Async and Lwt code is cohttp:&#160;<a href="https://github.com/mirage/ocaml-cohttp">https://github.com/mirage/ocaml-cohttp</a>, otherwise there&#8217;s&#160;OPAM&#8217;s list of Async dependent project, useful for finding more example code:&#160;<a href="http://opam.ocamlpro.com/pkg/async.109.38.00.html">http://opam.ocamlpro.com/pkg/async.109.38.00.html</a></li>
</ol>
<p><strong>Community</strong></p>
<p>Google group for Janestreet&#8217;s Core &amp; Async, the JS team are really helpful <img alt=":)" class="wp-smiley" src="http://hh360.user.srcf.net/blog/wp-includes/images/smilies/icon_smile.gif" />  :&#160;<a href="https://groups.google.com/forum/#!forum/ocaml-core">https://groups.google.com/forum/#!forum/ocaml-core</a></p>
<p>Async issue tracker on Github is quiet but still a good point to start a conversation:&#160;<a href="https://github.com/janestreet/async/issues?state=open">https://github.com/janestreet/async/issues?state=open</a></p>
<p><strong>Installation</strong></p>
<p>I recommend the installation chapter of Real World Ocaml:&#160;<a href="https://realworldocaml.org/beta3/en/html/installation.html">https://realworldocaml.org/beta3/en/html/installation.html</a>&#160;and install instructions for OPAM:&#160;<a href="http://opam.ocamlpro.com/doc/Quick_Install.html">http://opam.ocamlpro.com/doc/Quick_Install.html</a></p>
<p>Janestreet provide some installation hints, though this is covered for comprehensively in RWO (linked above):&#160;<a href="http://janestreet.github.io/installation.html">http://janestreet.github.io/installation.html</a></p>
<p>Very light background reading:&#160;<a href="https://ocaml.janestreet.com/?q=node/100">https://ocaml.janestreet.com/?q=node/100</a></p>
<p>&#160;</p>
<p>&#160;</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/07/learning-async/">by Heidi-ann at Wed, 03 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available"><a name="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available.html">Phew, Real World OCaml beta now available.</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>When I finished writing my PhD, I swore (as most recent graduates do) to never write a thesis again. Instead, life would be a series of pleasantly short papers, interspersed with the occasional journal article, and lots of not-writing-huge-book-activity in general.</p>
<a href="http://realworldocaml.org"><img align="right" src="http://anil.recoil.org/images/oreilly-cover.gif" /></a>
<p>Then <a href="http://cufp.org/conference/2011">CUFP 2011</a> happened, and I find myself in a bar in Tokyo with <a href="https://twitter.com/yminsky">Yaron Minsky</a> and <a href="http://monkey.org/~marius">Marius Eriksen</a>, and a dangerous bet ensued. A few short weeks after that, and Yaron and I are chatting with <a href="https://plus.google.com/111219778721183890368">Jason Hickey</a> in California about writing a book about the language we love. I&#8217;m still telling myself that this will never actually happen, but then everyone&#8217;s favourite Californirishman <a href="http://www.serpentine.com/blog/">Bryan O&#8217;Sullivan</a> puts us in touch with O&#8217;Reilly, who published his excellent <a href="http://realworldhaskell.org">Haskell</a> tome.</p>

<p>O&#8217;Reilly arranged everything incredibly fast, with our editor <a href="http://radar.oreilly.com/andyo">Andy Oram</a> driving us through the process. We decided early on that we wanted to write a book that had opinions based our personal experience: about how OCaml code should be written, about the standard library involved, and generally making functional programming more accessible. Along the way, we&#8217;ve been working incredibly hard on the underlying software platform too, with <a href="http://ocaml.janestreet.com">Jane Street</a>, <a href="http://ocamlpro.com">OCamlPro</a> and my own group <a href="http://ocaml.io">OCaml Labs</a> working together on all the pieces. There&#8217;s still a lot of work left to do, of course, but we&#8217;re right on track to get all this released very soon now.</p>

<p>So, without further ado, I was very pleased to send this e-mail this morning. (and once again reaffirm my committment to never writing another book ever again. Until next time!)</p>

<blockquote><p>Yaron Minsky, Jason Hickey and I are pleased to announce the beta release of our forthcoming O&#8217;Reilly book, called &#8220;Real World OCaml&#8221;, available online at <a href="http://realworldocaml.org">http://realworldocaml.org</a></p>

<p>The book is split into three parts: language concepts, tools and techniques, and understanding the runtime. As promised last year, we are making a public beta available for community review and to help us hunt down inaccuracies and find areas that need more clarification.</p>

<p>We&#8217;ve had the book in closed alpha for six months or so and have developed a feedback system that uses Github to record your comments. This lets us follow up to each review with clarifications and keep track of our progress in fixing issues. During alpha, we&#8217;ve received over 1400 comments in this fashion (and addressed the vast majority of them!). However, since we anticipate more comments coming in from a public beta, we would request that you read the FAQ to avoid drowning us in repeat comments: <a href="http://www.realworldocaml.org/#faq">http://www.realworldocaml.org/#faq</a>.</p>

<p>(TL;DR followup another comment on Github directly if you can instead of creating a new issue via the web interface)</p>

<p>This release is available in HTML format online at: <a href="http://realworldocaml.org">http://www.realworldocaml.org</a></p>

<p>O&#8217;Reilly is currently preparing a Rough Cuts release that will make the beta available as PDF and in popular eBook formats. We anticipate that this will be available later this week, and I&#8217;ll send a followup when that happens.</p>

<p>Finally, we would especially like to thank our alpha reviewers. Their <a href="https://github.com/ocamllabs/rwo-comments/issues">feedback</a> has been invaluable to the beta release. The book also includes substantial contributions to individual chapters from Jeremy Yallop (FFI), Stephen Weeks (GC) and Leo White (objects).</p>

<p>If you have any comments that you&#8217;d like to send directly by e-mail, please contact us at <a href="mailto:rwo-authors@recoil.org">rwo-authors@recoil.org</a>.</p>

<p>Release notes for beta1:</p>

<ul><li>The first-class modules chapter is incomplete, pending some portability improvements to the ocaml-plugins Core library.</li>

<li>The binary serialization chapter is also incomplete, but has just enough to teach you about the Async RPC library.</li>

<li>The installation chapter will be revised in anticipation of the OCaml 4.1 release, and is currently quite source-based.</li>

<li>The packaging and build systems chapter hasn&#8217;t been started yet. We&#8217;re still deciding whether or not to make this an online pointer rather than a print chapter, since it&#8217;s likely to change quite fast.</li>

<li>We are preparing exercises per chapter that are not included in this particular beta release, but will be available online as soon as possible.</li>

<li>The code examples will all be clonable as a separate repository in beta2.</li>
</ul>

<p>best, Yaron, Jason and Anil</p>
</blockquote></div>







<p class="date"><a href="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available.html">Sun, 16 Jun 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jun%202013">Jun 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/rwo-celebration.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/rwo-celebration-thumb.jpg" /></a>
The rain continues to plummet down relentlessly as "summer" starts in OCaml
Labs. The most exciting news has been the public release of the <a href="https://realworldocaml.org">Real World
OCaml</a>, which hit the front page of the usual news
aggregators and generated huge interest!  This (reminiscent of the Xen 1.0
release) promptly took down servers for a couple of hours, but we managed to
minimise downtime in time for the Californians waking up.</p>
<p>O'Reilly has also started selling PDF copies of the book under their <a href="http://shop.oreilly.com/product/0636920024743.do">Rough
Cuts</a> program.  This gives you
a copy of the final book when it's released too.  Commenting is still open
on the <a href="http://realworldocaml.org">online version</a>, so please do feel free to
participate there if you have time.</p>
<h3 id="SystemsProjects"> Systems Projects</h3>
<p><b>Mirage</b>: Anil and Dave did the last of the sweeping build changes to make
Mirage friendlier to use for beginners.  Previously, we required a custom OPAM
switch to build kernels, but now we use <a href="http://www.openmirage.org/wiki/weekly-2013-06-11">virtual
packages</a> to separate the
choice of compiler and packages.  This of course breaks all our documentation,
but we're going to do a big sweep in July before
<a href="http://www.oscon.com/oscon2013/public/schedule/speaker/109140">OSCON</a> with the
new scheme.  Vincent has also been burning through the core platform libraries,
cleaning them up and adding documentation strings.  He is also building a
shared memory <a href="http://github.com/vbmithr/ocaml-vchan">vchan</a> driver that will
make parallel-Mirage unikernels very easy to coordinate on the same host.</p>
<p>The huge news from our friends at Citrix is the open-sourcing of
<a href="http://www.xenserver.org">XenServer</a>, which is the popular Citrix product that
embeds the <a href="https://github.com/xapi-project">OCaml XAPI</a> cloud management
stack.  There are almost 100 major components
<a href="http://github.com/xenserver">released</a> as part of this, several of which can
be directly reused with Mirage.  Mirage was always an ambitious project, but
it's all coming together now thanks to bold moves such as this from Citrix!</p>
<p><b>Signpost:</b> We woke up to the excellent but slightly scary news that
our <a href="https://www.usenix.org/conference/foci13">USENIX FOCI</a> paper was accepted.
This now means that we get to present it in August at USENIX Security, but
the team is now racing to pull together the prototypes into a complete system
before the conference.  Nothing like a deadline to focus the mind!  We're
also working on the camera-ready version of the paper, which we will share
here when it's ready.</p>
<h3 id="PlatformProjects"> Platform Projects</h3>
<p><b>OCamlot:</b> David Sheets did an astounding job at pulling together a
working continuous build system in a very short amount of time, and promptly
managed to melt some of the older <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool">non-x86
machines</a> in Anil's office.  Once Anil
sadly replaced them, the builder churned through a matrix of different compiler
versions (4.0,4.1dev,4.2dev), architectures (x86, x86_64, ARM, PowerPC), and
operating systems (Debian, Ubuntu, FreeBSD, OpenBSD to start with).  There's
a <a href="https://ocaml-www3.ocamllabs.cl.cam.ac.uk/github/OCamlPro/opam-repository">development URL</a>, but
the next step is to retire this and move it to a proper home at <a href="http://ocaml.org">ocaml.org</a>.</p>
<p>Having continuous build for OPAM is really, really useful though, as it lets us
vet pull requests on several architectures before merging them. It also let
Anil repair OCaml on <a href="https://github.com/avsm/ocaml/commit/c1da5f35cda0ee85e576197b88f503333ed9e9a1">OpenBSD/macppc</a>
too, which is possibly the most obscure fix he's done in a while.</p>
<p>The next steps with OCamlot are to take a shot at porting the core to
<a href="http://github.com/janestreet/jenga">Jenga</a>, which is Jane Street's next-generation
distributed build system.  This should let us improve the fault-tolerance and
logging aspects of it before putting it properly into production later in the summer.</p>
<p><b>Ctypes:</b> The May <a href="http://github.com/ocamllabs/ocaml-ctypes">release</a>
brought with it a good chunk of feedback, so Jeremy spent time incorporating
that and contributing to the Real World OCaml ctypes chapter.  He also added
support for garbage-collecting closures passed to C, and also very cool support
for <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/27">printing C types and values</a>.
Our friends at Citrix have started looking at ctypes, and Rob Hoes has already
used it to write <a href="https://github.com/robhoes/ocaml-libnl">bindings</a> to the
Netlink Protocol Library Suite.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/daniel-presentation-vg.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/daniel-presentation-vg-thumb.jpg" /></a>
<b>OPAM-doc</b>: Vincent Botbol got the documentation generator stable enough
to pass the Core library through.  This is particularly challenging since Core
exercises pretty much every trick in the book when it comes to the use of the
module system.  However, Vincent successfully demonstrated the workflow of
OPAM-doc at the end-of-month meeting, and is aiming to have a public release
via OPAM in July (hopefully in time for the next beta release of Real World OCaml,
which uses Core heavily).</p>
<p><b>Visualisation libraries:</b> <a href="http://erratique.ch/contact.en">Daniel B&#252;nzli</a> has
been spending a few months based in Citrix, working on a foundational new
declarative drawing library written in pure OCaml.  The <a href="http://erratique.ch/software/vg">Vg</a> is already quite functional despite
still being in beta, and features a <a href="http://erratique.ch/software/vg/demos/rhtmlc.html#arrowhead">Javascript backend</a>
that renders to both SVG and Canvas in HTML5.  That's not all though!  He's
also developing the <a href="http://erratique.ch/software/vz">Vz</a> visualization library
that uses Vg to assemble more complex scenes and graphs.  Daniel's going to
join us in OCaml Labs for the remainder of the summer, so we're looking
forward to developing this more and using it on our various Platform projects
such as OCamlot.</p>
<h3 id="Outreach"> Outreach</h3>
<p><b>Real World OCaml:</b> As mentioned earlier, the beta release of RWO went
splendidly, with a pleasing vibe that the book is what people expected.  There
were some interesting criticisms of the choice of Github authentication, but
we've had over 6000 registered commentators despite this (and of course, we
have plans <a href="http://nymote.org">brewing</a> to tackle the identity problem).</p>
<p>No beta release is perfect, of course, and our now-public commenting system has
resulted in <a href="https://github.com/ocamllabs/rwo-comments/issues">over 1500</a>
issues being raised.  Well, that's all of Yaron, Anil and Jason's free time
gone for some time!</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/amir-shisha.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/amir-shisha-thumb.jpg" /></a>
<b>OCaml.org</b>: We're in the process of looking at the site as a whole and
designing the workflow we'd like to have for growing and maintaining it.  Some
discussions have taken place about using Markdown in place of the current HTML
snippets, which would make it easier for external contributors to get involved.
In the meantime, Amir has converted the current site to Markdown format to see
how this process would work in practice.  You can see his experimenting and
scripts in the <a href="https://github.com/ocamllabs/ocaml.org-temp">temporary repo</a> in
the <code>markdown-site/</code> folder.
Philippe also showed off <a href="https://github.com/pw374/MPP-language-blender">MPP</a>
at the internal meetings, and is stabilising it for a public release this
summer (once it has been integrated into the ocaml.org workflow).</p>
<p>This month also had a number of programming language gurus show up at the Lab
for the <em>Algebraic Effects and Handlers</em> workshop organised by <a href="http://www.cl.cam.ac.uk/~ss368/">Sam
Staton</a>.  Most of the group attended this, as
we're all interested in how to encode effects for several of our projects (most
notably <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html#Irminsule">Irminsule</a>).</p>
<p>We also enjoyed a visit by <a href="https://github.com/bvaugon">Beno&#238;t Vaugon</a>, who gave a talk on his
<a href="http://oud.ocaml.org/2012/slides/oud2012-paper10-slides.pdf">OCamlCC</a>
OCaml-to-C compiler, and also participated in a talk on
<a href="http://www.algo-prog.info/ocaml_for_pic/web/index.php?id=ocapic">OCAPIC</a>. He
also chatted with us about his alternative <a href="http://caml.inria.fr/mantis/view.php?id=6017">GADT-based implementation of
Printf</a>, which promises to both
speed up and simplify the printer support in OCaml (and also relieve Mirage of
another dependency on <code>libc</code>).<br /></p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-community" href="http://blog.xen.org/index.php/2013/06/25/xenserver-org-and-the-xen-project/">XenServer open-sourced!</a> <em>(Jun 25th)</em>
 </li>
 <li><a class="icon-quick-links" href="http://realworldocaml.org">Real World OCaml public beta now available.</a> <em>(Jun 17th)</em>
 </li>
</ul>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jun%202013">by Anil Madhavapeddy (anil@recoil.org) at Sat, 01 Jun 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/the-road-to-a-dev-release"><a name="http://openmirage.org/blog/the-road-to-a-dev-release"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/the-road-to-a-dev-release">The road to a developer preview at OSCON 2013</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>There's been a crazy stream of activity since the start of the year, but the most important news is that we have a release target for an integrated developer preview of the Mirage stack: a talk at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">O'Reilly OSCon</a> in July!  Do turn up there and find <a href="http://dave.recoil.org">Dave Scott</a> and <a href="http://anil.recoil.org">Anil Madhavapeddy</a> showing off interactive demonstrations.</p><p>Meanwhile, another significant announcement has been that Xen is <a href="http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project">joining the Linux Foundation</a> as a collaborative project.  This is great news for Mirage: as a library operating system, we can operate just as easily under other hypervisors, and even on bare-metal devices such as the <a href="http://raspberrypi.org">Raspberry Pi</a>.  We're very much looking forward to getting the Xen-based developer release done, and interacting with the wider Linux community (and FreeBSD, for that matter, thanks to Gabor Pali's <a href="https://github.com/pgj/mirage-kfreebsd">kFreeBSD</a> backend).</p><p>Here's some other significant news from the past few months:</p><ul> <li> <p><a href="http://www.ocamlpro.com/blog/2013/03/14/opam-1.0.0.html">OPAM 1.0 was released</a>, giving Mirage a solid package manager for handling the many libraries required to glue an application together.  <a href="https://github.com/vbmithr">Vincent Bernardoff</a> joined the team at Citrix and has been building a Mirage build-frontend called <a href="https://github.com/mirage/mirari">Mirari</a> to hide much of the system complexity from a user who isn't too familiar with either Xen or OCaml.</p> </li><li> <p>A new group called the <a href="http://ocaml.io">OCaml Labs</a> has started up in the <a href="http://www.cl.cam.ac.uk">Cambridge Computer Laboratory</a>, and is working on improving the OCaml toolchain and platform.  This gives Mirage a big boost, as we can re-use several of the documentation, build and test improvements in our own releases.  You can read up on the group's activities via the <a href="http://ocaml.io/news">monthly updates</a>, or browse through the various <a href="http://ocaml.io/tasks">projects</a>.  One of the more important projects is the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot">OCamlot</a> continuous build infrastructure, which will also be testing Mirage kernels as one of the supported backends.</p> </li><li> <p>As we head into release mode, we've started <a href="http://openmirage.org/wiki/tag/overview/meetings">weekly meetings</a> to coordinate all the activities.  We're keeping notes as we go along, so you should be able to skim the notes and <a href="https://lists.cam.ac.uk/pipermail/cl-mirage/">mailing list archives</a> to get a feel for the overall activities.  Anil is maintaining a <a href="http://openmirage.org/wiki/dev-preview-checklist">release checklist</a> for the summer developer preview.</p> </li><li> <p>Anil (along with Yaron Minsky and Jason Hickey) is finishing up an O'Reilly book on <a href="http://realworldocaml.org">Real World OCaml</a>, which will be a useful guide to using OCaml for systems and network programming. If you'd like to review an early copy, please get in touch.  The final book is anticipated to be released towards the end of the year, with a <a href="http://shop.oreilly.com/category/roughcuts.do">Rough Cut</a> at the end of the summer.</p> </li><li> <p>The core system was described in an <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">ASPLOS 2013</a> paper, which should help you understand the background behind library operating systems. Some of the Mirage libraries are also currently being integrated into the next-generation <a href="http://blogs.citrix.com/2012/05/17/introducing-windsor-a-new-xen-based-virtualization-architecture/">Windsor</a> release of the Xen Cloud Platform, which means that several of the libraries will be used in production and hence move beyond research-quality code.</p> </li> </ul><p>In the next few months, the installation notes and getting started guides will all be revamped to match the reality of the new tooling, so expect some flux there.   If you want to take an early try of Mirage beforehand, don't forget to hop on the <code>#mirage</code> IRC channel on Freenode and ping us with questions directly.  We will also be migrating some of the project infrastructure to be fully self-hosted on Mirage and Xen, and placing some of the services onto the new <a href="http://xenproject.org">xenproject.org</a> infrastructure.</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/the-road-to-a-dev-release">by Anil Madhavapeddy (anil@recoil.org) at Mon, 20 May 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#May%202013">May 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/thomas-nycoug-2013.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/thomas-nycoug-2013-thumb.jpg" /></a>
May is exam time in Cambridge, and the corridors of the OCaml Labs resounded
with the wailing of frantic students finishing their dissertations and
preparing for exams.  We welcomed <a href="https://github.com/vincent-botbol">Vincent Botbol</a> to join us for a summer internship,
and he started hacking on the new <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OPAM%20Doc">opam-doc</a>
right away.</p>
<p>Anil, Thomas, Leo and Amir also visited <a href="http://janestreet.com">Jane
Street</a> HQ in New York City, where we had a productive
couple of days reviewing our projects and getting feedback from them about
approaches to multicore and type system enhancements. <a href="http://ashishagarwal.org">Ashish
Agarwal</a> also organised a fun evening with the <a href="http://www.meetup.com/NYC-OCaml/events/117222022/">New
York OCaml Users Group</a>,
where Anil and Thomas presented our plans for the nascent OCaml Platform.</p>
<h3 id="SystemsProjects"> Systems Projects</h3>
<p><b>Mirage:</b> This was a month of consolidation and bugfixing in Mirage.  We've
been settling into weekly meetings to coordinate the hacking between us and
Citrix, and the minutes (<a href="http://www.openmirage.org/wiki/weekly-2013-05-14">1</a>
<a href="http://www.openmirage.org/wiki/weekly-2013-05-21">2</a>
<a href="http://www.openmirage.org/wiki/weekly-2013-05-28">3</a>) may be useful if you
want to catch up.  The biggest bugbear is always the build system, and we've
been exploring the use of <a href="http://github.com/janestreet/jenga">Jenga</a> as the
eventual async-aware coordination and build system for running Mirage kernels.
Dave made great progress with a
<a href="http://github.com/djs55/message-switch">message-switch</a> that coordinates
multiple kernels, and Balraj fixed several performance regressions in the
TCP/IP stack by building unit tests that spawn millions of parallel TCP
connections.</p>
<p><b>Signpost:</b> We took a break from building prototypes to submit a paper on the
basic design to the USENIX Free and Open Communications (<a href="https://www.usenix.org/conference/foci13">FOCI
2013</a>) workshop.  Haris and Heidi
blazed a path on writing this paper, and we've got even more ideas rolling
around about how to use DNSSEC to break the cloud deadlock.  The
<a href="http://github.com/mirage/ocaml-dns">ocaml-dns</a> continues to grow features too.</p>
<h3 id="PlatformProjects"> Platform Projects</h3>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nycoug-drinkup-2013.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nycoug-drinkup-2013-thumb.jpg" /></a>
<b>Ctypes:</b> Jeremy
<a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-06/msg00046.html">announced</a>
the first release of a new foreign-function mechanism for OCaml that doesn't
require you to write any C stubs at all!  You can browse the <a href="https://github.com/ocamllabs/ocaml-ctypes">source
code</a> and
<a href="https://github.com/ocamllabs/ocaml-ctypes/wiki/ctypes-tutorial">tutorial</a>, and
install it via OPAM.  This is very much the first 0.1 release, and we have
exciting future developments to turn this into a full-fledged replacement for
the fast-but-rather-difficult-to-use-right OCaml FFI.</p>
<p><b>OPAM-doc:</b> Vincent Botbol started building on Leo's work on the new
<a href="http://github.com/vincent-botbol/opam-doc">opam-doc</a> tool. This is intended to
replace the venerable <code>ocamldoc</code> with one that uses all the latest features of
the compiler.  In particular, it can use the new typed AST <code>cmt</code> output to
avoid duplicating the compiler functionality, and can also build up a global
package table to generate complete cross-references across an entire OPAM 
collection.</p>
<p><b>OCamlot:</b> David has been building up the libraries and tools needed for
the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot%200.2.0">continuous build</a> infrastructure.
This includes much-improved
<a href="http://github.com/avsm/ocaml-github">ocaml-github</a>, bindings, which are now
being used to power the <a href="https://realworldocaml.org">Real World OCaml</a> site as
well as well as OCamlot.  In addition, he's got an interesting collection of
regular expressions to automatically triage common failures from OPAM
(such as missing external dependencies), that should help reduce the manual
burden of getting thousands of tests results dumped on the small OPAM team.</p>
<h3 id="CompilerProjects"> Compiler Projects</h3>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/janestreet-hq-2013.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/janestreet-hq-2013-thumb.jpg" /></a>
<b>OCaml-Java</b>: Xavier Clerc has been hacking away at his next-generation
OCaml-Java backend (using many new features in JDK7). He's released a
<a href="http://ocamljava.x9c.fr/preview/concurrency.html">preview</a> of the bindings to
Java concurrency, and is looking for feedback on it.</p>
<p><b>Performance profiling</b>: Mark Shinwell has been hacking on improving the
integration of the runtime with <code>perf</code>.  This should give us the hooks to
reliably track where memory was allocated.  His branch isn't going to land in
OCaml 4.1, but should be available as an OPAM switch for people to easily
try out when it's more stable.</p>
<h3 id="Outreach"> Outreach</h3>
<p><b>OCaml.org:</b> Philippe and Amir have been putting their heads together with
Christophe and Ashish to turn the <a href="http://ocaml.org">ocaml.org</a> build pipeline
into something a little more structured.  Philippe is building a <a href="https://github.com/pw374/MPP-language-blender">template
processor</a> for this purpose.
The OCaml site is a more complicated than the average site due to our desire to
embed <a href="http://ocsigen.org/js_of_ocaml">js_of_ocaml</a> interactive toplevels
throughout the tutorials, and also to have active OPAM integration throughout
the site to make it easier for newcomers to sample the language.</p>
<p>The design of a handful of pages are also now available to preview, if you
don't mind some manual git cloning. The best way to do this is to clone the
<a href="https://github.com/ocamllabs/ocaml.org-temp">temporary repo</a> onto your local
machine and look in the <code>new-design/_site</code> directory.  There are examples of
the home page, 100 lines of OCaml page and several others.  Since we're just
getting started with applying these changes the site isn't clicky (yet).  For
some extra fun, try resizing your browser window and see how the pages reflow
to suit smaller (mobile) screens!</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nyc-trip-balcony-view-2013.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nyc-trip-balcony-view-2013-thumb.jpg" /></a>
<b>Real World OCaml:</b> Anil, Yaron and Jason continue to work hard on getting
a release out of the door.  We shipped a final alpha6 this month that is 
chapter-complete, and have been preparing for a big public June release of
the book.  Thousands of comments have been received and closed already,
making this an unusually active (but incredibly useful) ongoing review
process.  Leo and Jeremy also contributed portions of text for the Objects
and FFI chapters in alpha6, and join Stephen Weeks as external contributors
to the book.</p>
<p>Meanwhile, Leo himself has recovered from the elation of being granted his PhD,
to the harsh reality of having to finish corrections.  He has been forced by
his colleagues to stop hacking on OCaml and submit his final thesis.  Rumours
are that he will reemerge in June after delivering his <a href="http://staticanalysis.org/SAS13/papers.html">SAS
2013</a> talk on using an
implication-algebra generalisation of logic programming to concisely analyse
OpenMP programs for parallisation opportunities.</p>
<p>This month's talk was courtesy of <a href="http://www.lip6.fr/actualite/personnes-fiche.php?ident=D1161&amp;LANG=en">Mathias Bourgoin</a>,
who visited from France and gave a talk on his PhD work on GPU processing.  His
tool, <a href="http://www.algo-prog.info/spoc/web/index.php?id=spoc">SPOC</a> has been
released onto OPAM and is a set of easy-to-use tools for generating CUDA and
OpenCL code, and also a camlp4 extension to write external kernels directly in
OCaml.  Thanks for visiting, Mathias!</p>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#May%202013">by Anil Madhavapeddy (anil@recoil.org) at Wed, 01 May 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Apr%202013">Apr 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/leo-oculus.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/leo-oculus-thumb.jpg" width="150px" /></a>
It's been a heads-down month of hacking at the Labs for April, as the
group have settled into their projects and are concentrating on getting code
out.  We did take the opportunity to redesign the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html">project pages</a> as the active projects grew.</p>
<p>We welcomed <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/euan.html">Euan Harris</a> as a new visitor, and he has
begun work on a distributed actor library in the vein of Erlang's
<a href="https://github.com/erlang/otp">OTP</a>.  The prolific <a href="http://erratique.ch">Daniel B&#252;nzli</a> also joined us for the summer to work on his <a href="http://erratique.ch/software/vg/">Vg</a> visualisation library.  He's based out of the Citrix offices, and is also contributing to the Xen project.</p>
<h3 id="Platformprojects"> Platform projects</h3>
<p><b>OPAM: </b> The project has entered a bug fixing stage after its release, and
the package set has steadily grown via external contributors. David Sheets has
been hacking away on the automated <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot">OCamlot</a>
bot, and we released improved <a href="https://github.com/avsm/ocaml-github">Github</a>
API bindings.  We're aiming to get OCamlot live and running in May, so stay
tuned!  There is a <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool">steadily growing
collection</a> of odd ARM and PowerPC
devices in Anil's desk that will generally make it easier to test your OCaml
code in unusual environments.</p>
<p><b>OCaml.org redesign:</b> Progress on the website continues and we're now
working on the actual HTML/CSS from the earlier
<a href="https://github.com/ocaml/ocaml.org/wiki/Site-Redesign">mockups</a>.  We'll be
publishing these in a fork of the website
<a href="https://github.com/ocamllabs/ocaml.org">repository</a>, so do feel free to create
issues there with your comments.  Philippe has begun the
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#Meta%20preprocessor">MPP</a> templating tool to glue together
all the website scripts more coherently. Discussions about this take place on
the <a href="http://lists.ocaml.org/listinfo/infrastructure">infrastructure</a> mailing
list, which is open to all.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/makespace-apr-2013.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/makespace-apr-2013-thumb.jpg" width="150px" /></a>
The monthly OCaml get togethers in the <a href="http://makespace.org">Cambridge
Makespace</a> are also really fun.  This month saw around 30
people wander through the doors, and work through the latest excerpts of
<a href="http://realworldocaml.org">Real World OCaml</a>. And around midnight, Jeremy and
Leo competed to find more and more obscure
<a href="http://caml.inria.fr/mantis/view.php?id=5992">bugs</a> in the corners of the
OCaml type system...  You can track the subsequent meetups via the <a href="http://www.meetup.com/Cambridge-NonDysFunctional-Programmers/events/114286762/">NonDysFunctional Meetup group</a>, which includes functional programmers from around the Cambridgeshire area.  Jon and Anil also attended the <a href="http://developer.yahoo.com/events/hack_europe_london/">Yahoo Hackday</a> in London, where Jon met a giant robot and started <a href="https://github.com/jonludlam/mssl">SSL bindings</a>, and Anil experimented with <a href="http://github.com/avsm/ocaml-js-localstorage">js_of_ocaml LocalStorage</a> for Irminsule.</p>
<h3 id="Systemsprojects"> Systems projects</h3>
<p><b>Mirage</b>: We've finally got a release date for the first preview of
Mirage, which will be at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">O'Reilly OSCON</a> this July!  Pulling together the release is a big endeavour, and the
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">team</a> has started weekly calls to work through the
project.  The minutes for these are online, so you can
<a href="http://www.openmirage.org/wiki/tag/overview/meetings">browse</a> them to catch
up. There's also a slightly scary
<a href="http://www.openmirage.org/wiki/dev-preview-checklist">checklist</a> of all the
libraries that need to be released before July, so the team has its work cut
out for it!  The Xen group also announced that it is joining the Linux Foundation,
and the <a href="http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project">press release</a> gave Mirage a prominent mention as one of the key recent developments in Xen.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/jon-robot-yahoo.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/jon-robot-yahoo-thumb.jpg" width="120px" /></a>
<b>Irminsule</b>: Thomas now has a full implementation of the git file format
in his <a href="http://github.com/samoht/cagit">cagit</a> repository, and the interfaces
for Irminsule's branch-consistent model are coming together.  He gave a demo to
the Mirage team, with <a href="http://www.openmirage.org/wiki/weekly-2013-04-23">discussion
notes</a> available.</p>
<h3 id="Compilerprojects"> Compiler projects</h3>
<p><b>Multicore and Concurrency</b>: Stephen Dolan's made great progress on bringing up a multicore
runtime using <a href="https://github.com/stedolan/ocaml">thread-local storage</a>, which results
in a surprisingly compact diff to the OCaml runtime.  We're now moving onto the
higher-level bindings to use the parallel runtimes effectively from within OCaml.
We also began a <a href="http://lists.ocaml.org/listinfo/wg-parallel">wg-parallel</a> working
group in order to start figuring out the evolution of the <a href="http://ocsigen.org/lwt">Lwt</a> and 
<a href="https://github.com/janestreet/async">Async</a> concurrency libraries.</p>
<p><b>libffi</b>: Jeremy got frustrated by the difficulty of writing safe C bindings,
and started the <a href="http://github.com/ocamllabs/ocaml-ctypes">ctypes</a> library, which
offers a pure OCaml solution. This even includes managing callbacks across the
OCaml/C divide, and uses <a href="https://github.com/atgreen/libffi">libffi</a> under the hood
to remain efficient and platform-independent.  There is the exciting possibility
about hooking this library with the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/compiler.html#Compile-time%20meta%20programming">compile-time metaprogramming</a> to eliminate all performance cost, so we're going to spend some time
on this project to make it a well-documented alternative to the existing C FFI.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/mezzo-talk.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/mezzo-talk.jpg" width="120px" /></a>
The OCaml Labs talk series continued with a visit from <a href="http://gallium.inria.fr/~fpottier/">Francois
Pottier</a> ad <a href="http://www.xulforum.org">Jonathan
Protzenko</a> from the INRIA
<a href="http://gallium.inria.fr">Gallium</a> research team.  Jonathan presented their
<a href="http://gallium.inria.fr/~protzenk/mezzo-lang">Mezzo</a> language, which places
emphasis on aliasing and controlled access to mutation.  This is of particular
interest to several of our systems projects that do not require the full power of
OCaml to build low-level systems components, and Raphael, Alan, Leo and Anil
had productive discussions about how we could try Mezzo out when it's released.</p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-rss" href="http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project">Xen and MirageOS to join Linux Foundation</a> <em>(Apr 14th)</em>
 </li>
 <li><a class="icon-community" href="http://www.meetup.com/Cambridge-NonDysFunctional-Programmers/events/114286762/">OCaml Hacking/Meetup Session</a> <em>(Apr 18th)</em>
 </li>
 <li><a class="icon-quick-links" href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">OSCon Mirage talk selected.</a> <em>(Apr 21st)</em>
 </li>
</ul>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Apr%202013">by Anil Madhavapeddy (anil@recoil.org) at Mon, 01 Apr 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/amir.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://amirchaudhry.com/wireframe-demos-for-ocamlorg"><a name="http://amirchaudhry.com/wireframe-demos-for-ocamlorg"> </a>
<h1 class="posttitle"><a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg">Wireframe demos for OCaml.org</a>
(<a href="http://amirchaudhry.com" title="Amir Chaudhry - 'ocaml-labs'">Amir Chaudhry</a>)
</h1>
<hr /><div class="entry"><div class="content"><h3 id="making_mockups">Making mockups</h3>

<p>Over the last few months, I&#8217;ve been working on various aspects of the <a href="http://ocaml.org">OCaml.org</a> design project. This covers things like the design, information architecture and how to incorporate new functionality. One of the methods for thinking through these was to put together a bunch of wireframes using <a href="http://www.balsamiq.com">Balsamiq</a> and use these to express (and generate) ideas as well as get feedback quickly.</p>

<p>If you haven&#8217;t used wireframes before, think of them as a slightly more advanced form of sketching things out on a whiteboard. The best aspect is that it&#8217;s far quicker, easier and <em>cheaper</em> to iterate using wireframes than on an actual website. As you&#8217;ll see below, you can also convey a lot of information about how a site might work by showing people a clickable demo.</p>

<p>I want to make this work public and I thought the best way would be to show you some screencasts of how the upcoming <a href="http://ocaml.org">OCaml.org</a> website might work and also make the demo available to all of you. The three videos below cover three aspects of the site and I&#8217;d encourage you to go through them in order (about 16 minutes in total). Apologies if my screen isn&#8217;t particularly clear in the videos but you can visit the demo for yourself and see things in more detail (link and info on feedback at the end of this post).</p>

<h3 id="video_walkthroughs">Video walkthroughs</h3>

<p>For those who&#8217;d like to watch the videos back-to-back and scaled to fit your browser window, you can <a href="http://vimeo.com/couchmode/album/2301640">view the Vimeo album in &#8216;couchmode&#8217;</a>. Otherwise, individual videos are embedded below (total time 16m17s).</p>

<p>  Video Part 1 - Overview - http://player.vimeo.com/video/61768157</p>

<p>  Video Part 2 - Documentation - http://player.vimeo.com/video/61768235</p>

<p>  Video Part 3 - Continuous Integration - http://player.vimeo.com/video/61768273</p>

<h3 id="public_wireframe_demo">Public wireframe demo</h3>

<p>A demo you can interact with can be found at <a href="https://ocaml.mybalsamiq.com/projects/public-demo/naked/0_home?key=b897ea86d8a8199c6e46b3295ddf630dfa33e5e1">OCaml.org wireframe demo</a> and image files for each page are available on the <a href="https://github.com/ocaml/ocaml.org/wiki/Wireframes">github ocaml.org wiki</a>. Please bear in mind the following:</p>

<ul><li><p>Not everything that looks like it might be clickable actually is (and vice versa). There&#8217;ll be a toggle on the bottom right of the browser window that will highlight what can be clicked.</p>
</li>

<li><p>There are parts of the site which are &#8216;work in progress&#8217; and are marked as such.</p>
</li>

<li><p>The designs you see aren&#8217;t necessarily final. Your feedback will help shape our decisions and the best way to provide it is via the <a href="http://lists.ocaml.org/listinfo/infrastructure">infrastructure mailing list</a>.</p>
</li>
</ul></div>







<p class="date"><a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg">by Amir Chaudhry at Thu, 14 Mar 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/lpw25.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://lpw25.net/2013/03/10/ocaml-namespaces"><a name="http://lpw25.net/2013/03/10/ocaml-namespaces"> </a>
<h1 class="posttitle"><a href="http://lpw25.net/2013/03/10/ocaml-namespaces.html">Adding namespaces to OCaml</a>
(<a href="http://lpw25.net/" title="lpw25">Leo White</a>)
</h1>
<hr /><div class="entry"><div class="content"><div class="well well-small">  <h4>Contents
</h4>
<ul id="markdown-toc">  <li><a href="http://www.lpw25.net/atom.xml#problems-with-pack">Problems with pack</a></li>
  <li><a href="http://www.lpw25.net/atom.xml#formal-semantics">Formal semantics</a></li>
  <li><a href="http://www.lpw25.net/atom.xml#design-goals">Design goals</a></li>
  <li><a href="http://www.lpw25.net/atom.xml#design-choices">Design choices</a>    <ul>      <li><a href="http://www.lpw25.net/atom.xml#flat-or-hierarchical">Flat or hierarchical?</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#should-namespaces-be-opened-explicitly-in-source-code">Should namespaces be opened explicitly in source code?</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#how-should-the-compiler-find-modules-in-the-presence-of-namespaces">How should the compiler find modules in the presence of namespaces?</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#how-should-namespaces-specified">How should namespaces specified?</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#how-rich-should-a-description-language-be">How rich should a description language be?</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#should-namespaces-support-automatically-opened-members">Should namespaces support automatically opened members?</a></li>
    </ul>
  </li>
  <li><a href="http://www.lpw25.net/atom.xml#proposal">Proposal</a>    <ul>      <li><a href="http://www.lpw25.net/atom.xml#simple-namespaces-through-filenames">Simple namespaces through filenames</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#an-alternative-to-search-paths">An alternative to search paths</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#the--name-argument">The &#8220;-name&#8221; argument</a></li>
      <li><a href="http://www.lpw25.net/atom.xml#the--open-argument">The &#8220;-open&#8221; argument</a></li>
    </ul>
  </li>
</ul>

</div>

<p>Recently there has been a lot of discussion on
<a href="http://lists.ocaml.org/listinfo/platform">platform@lists.ocaml.org</a> about
proposals for adding namespaces to OCaml. I&#8217;ve written this post to summarise
the design decisions for such a proposal and to make my own proposal.</p>

<p>Before discussing what namespaces are and the issues surrounding their
implementation, it is important to explain why they are needed in the first
place. </p>

<p>The most important reason for adding namespaces is to provide some means for
grouping the components of a library together. Up to now this has been
achieved using the OCaml module system. Since the components of an OCaml
library are modules, a module can be created that contains all the components
of the library as sub-modules. The &#8220;-pack&#8221; option for the compiler was created
to allow this module to be created while still keeping each component of the
library in its own file.</p>

<h3 id="problems-with-pack">Problems with pack</h3>

<p>There are some critical problems with using &#8220;-pack&#8221; to create a single module
containing the whole library:</p>

<ul>  <li>    <p>The packed module is a single unit that has to be linked or not as a
unit. This means that any program using part of the library must include the
entire library.</p>
  </li>
  <li>    <p>The packed module is a choke-point in the dependency graph.  If a file
depends on one thing in the packed module then it needs to be recompiled if
anything in the packed module changes.</p>
  </li>
  <li>    <p>Opening a large packed module is very slow and can seriously affect build
performance.</p>
  </li>
</ul>

<p>These problems are all caused by the fact that pack creates an OCaml
module. To understand this consider the run-time semantics of the module
system.</p>

<p>At run-time a module is a record. Initialising a module involves initialising
every component of the module and placing them in this record.  Initialising
these components can involve executing arbitrary code; in fact the execution
of an OCaml program is simply the initialisation of all its modules.</p>

<p>The problems with pack are related to these dynamic semantics. In order to
be a module pack must create a record to represent this module. This means
that it must initialise all of its components. It is this (rather than any
detail of pack&#8217;s implementation) that causes the problems identified above.</p>

<p>Access to the components of a top-level module could proceed without the
existence of this record. However, the record is required in order to &#8220;alias&#8221;
the module, use the module as a first-class value or use it as the argument to
a functor.</p>

<p>Any attempt to overcome the problems with pack, whilst still maintaining
the illusion that the &#8220;pack&#8221; is a normal module, would result (at the very
least) in one of the following unhealthy situations:</p>

<ul>  <li>    <p>The module type of the &#8220;packed module&#8221; would depend on which of its
components were accessed by the program.</p>
  </li>
  <li>    <p>Any use of the &#8220;packed module&#8221; other than as a simple container
(e.g.
<span class="highlight"><code><span class="k">module</span>
<span class="nc">CS</span>
<span class="o">=</span>
<span class="nn">Core</span><span class="p">.</span><span class="nc">Std</span></code></span> 
) could have a dramatic effect on what was
linked into the program and potentially on the semantics of the program.</p>
  </li>
</ul>

<p>Namespaces are basically modules that can only be used as a simple
container. This means that they do not need a corresponding record at
run-time (or any other run-time representation). This avoids the problems
with pack as well as enabling other useful features.</p>

<h3 id="formal-semantics">Formal semantics</h3>

<p>Following the semantics and description language for namespaces described by
<a href="http://gallium.inria.fr/~scherer/namespaces/spec.pdf">Gabriel Scherer et al</a>,
I will consider namespaces to be name-labelled trees whose leaves are
compilation units. I will use 
<span class="highlight"><code><span class="o">#</span></code></span> 
to represent projection on namespaces, so the 
<span class="highlight"><code><span class="nc">Bar</span></code></span>
member of the 
<span class="highlight"><code><span class="nc">Foo</span></code></span>
namespace will be referred to as 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>.</p>

<h3 id="design-goals">Design goals</h3>

<p>Some design goals that we might want from a proposal for adding namespaces to
OCaml include:</p>

<ul>  <li>    <p><strong>Allow library components to be grouped together without creating a module
containing them.</strong></p>
  </li>
  <li>    <p><strong>Allow users to group together modules from different libraries as they see
fit.</strong> This means letting people change which namespace a library module is
in.</p>
  </li>
  <li>    <p><strong>Allow library components to be given multiple names.</strong> For example
<span class="highlight"><code><span class="nc">Lib</span><span class="o">#</span><span class="nc">Foo</span></code></span>
and 
<span class="highlight"><code><span class="nc">Lib</span><span class="o">#</span><span class="nc">Stable</span><span class="o">#</span><span class="nc">Foo</span></code></span>
, where 
<span class="highlight"><code><span class="nc">Lib</span><span class="o">#</span><span class="nc">Stable</span></code></span>
is a namespace containing only those components whose interfaces are stable.</p>
  </li>
  <li>    <p><strong>Be simple and easy to explain to beginners.</strong></p>
  </li>
  <li>    <p><strong>Allow multiple source files to share the same filename.</strong> Each module that
is linked into an OCaml program must have a unique name. Currently, a
module&#8217;s name is completely determined by its filename. This forces library
developers to either use pack (which gives its components new long names) or
give their source files long names like &#8220;libName_Foo.ml&#8221;. A namespaces
proposal may be able to alleviate this problem.</p>
  </li>
  <li>    <p><strong>Allow libraries to control which modules are open by default.</strong> By default
OCaml opens the standard library&#8217;s 
<span class="highlight"><code><span class="nc">Pervasives</span></code></span>
module. Libraries that wish to replace the standard library may also wish to
provide their own
<span class="highlight"><code><span class="nc">Pervasives</span></code></span>
module and have it opened by default.</p>
  </li>
  <li>    <p><strong>Support libraries that wish to remain compatible with versions of OCaml
without namespaces.</strong></p>
  </li>
  <li>    <p><strong>Require minimal changes to existing build systems.</strong> Since a namespace
proposal changes how a library&#8217;s components are named, it may require
changes to some build systems. If these changes are too invasive then users
of some build systems will probably be unable to use namespaces in the near
future.</p>
  </li>
</ul>

<h3 id="design-choices">Design choices</h3>

<h4 id="flat-or-hierarchical">Flat or hierarchical?</h4>

<p>In order to replace pack, namespaces must be able to contain modules. It is
not clear, however, whether they need to be able to contain other
namespaces. We call namespaces that can contain other namespaces
<em>hierarchical</em>, as opposed to <em>flat</em>.</p>

<p>In favour of flat namespaces:</p>

<ul>  <li>    <p>Hierarchical namespaces might lead to arbitrary categorising of components
(e.g.<br /><span class="highlight"><code><span class="nc">Data</span><span class="o">#</span><span class="nc">Array</span></code></span>
). These add syntactic clutter and do not bring any real benefit.  </p>
  </li>
  <li>    <p>Hierarchical namespaces might lead to deep java-style hierarchies
(e.g.<br /><span class="highlight"><code><span class="nc">Com</span><span class="o">#</span><span class="nc">Janestreet</span><span class="o">#</span><span class="nc">Core</span><span class="o">#</span><span class="nc">Std</span></code></span>
). These add syntactic clutter without adding any actual information.</p>
  </li>
</ul>

<p>In favour of hierarchical namespaces:</p>

<ul><li>A library may wish to provide multiple versions of some of its components. For
example:

<ul><li>    
<span class="highlight"><code><span class="nc">Http</span><span class="o">#</span><span class="nc">Async</span><span class="o">#</span><span class="nc">IO</span></code></span>
 and 
<span class="highlight"><code><span class="nc">Http</span><span class="o">#</span><span class="nc">Lwt</span><span class="o">#</span><span class="nc">IO</span></code></span>
</li>
<li><span class="highlight"><code><span class="nc">File</span><span class="o">#</span><span class="nc">Windows</span><span class="o">#</span><span class="nc">Directories</span></code></span>
and 
<span class="highlight"><code><span class="nc">File</span><span class="o">#</span><span class="nc">Unix</span><span class="o">#</span><span class="nc">Directories</span></code></span>
</li>
<li><span class="highlight"><code><span class="nc">Core</span><span class="o">#</span><span class="nc">Mutex</span></code></span>
and 
<span class="highlight"><code><span class="nc">Core</span><span class="o">#</span><span class="nc">Testing</span><span class="o">#</span><span class="nc">Mutex</span></code></span>
</li>
</ul>

In such situations it is useful to be able to write both


<div class="highlight"><pre><code class="ocaml"><span class="k">open</span> <span class="nc">Core</span>
<span class="o">[...]</span>
<span class="nc">Testing</span><span class="o">#</span><span class="nn">Mutex</span><span class="p">.</span><span class="n">lock</span> <span class="n">x</span>
</code></pre></div>


and


<div class="highlight"><pre><code class="ocaml"><span class="k">open</span> <span class="nc">Core</span><span class="o">#</span><span class="nc">Testing</span>
<span class="o">[...]</span>
<span class="nn">Mutex</span><span class="p">.</span><span class="n">lock</span> <span class="n">x</span>
</code></pre></div>

</li>
<li>None of the systems of namespaces that have been proposed have any
additional cost for supporting hierarchical namespaces.
</li>
</ul>

<h4 id="should-namespaces-be-opened-explicitly-in-source-code">Should namespaces be opened explicitly in source code?</h4>

<p>There was some debate on the platform mailing list about whether to support
opening namespaces explicitly in source code. This means allowing a syntax
like:</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">open</span> <span class="k">namespace</span> <span class="nc">Foo</span></code></pre>
</div>

<p>that allows the members of namespace 
<span class="highlight"><code><span class="nc">Foo</span></code></span>
to be referenced directly (i.e.
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
can be referred to as 
<span class="highlight"><code><span class="nc">Bar</span></code></span>).</p>

<p>The alternative would be to only support opening namespaces through a
command-line argument.</p>

<p>In favour of supporting explicit opens:</p>

<ul>  <li>    <p>If you open two namespaces with commonly named sub-components then the order
of those opens matters. If the opens are command-line arguments then the
order of those command-line arguments (often determined by build systems and
other tools) matters. This is potentially very fragile.</p>
  </li>
  <li>    <p>Explicit opens in a source file give valuable information about which
libraries are being used by that source file. If a file contains &#8220;open
namespace Core&#8221; then you know it uses the Core library.</p>
  </li>
  <li>    <p>Local namespace opens provide users more precise control over their naming
environment.</p>
  </li>
</ul>

<p>Against supporting explicit opens:</p>

<ul>  <li>They require a new syntactic construct.</li>
</ul>

<h4 id="how-should-the-compiler-find-modules-in-the-presence-of-namespaces">How should the compiler find modules in the presence of namespaces?</h4>

<p>Currently, when looking for a module 
<span class="highlight"><code><span class="nc">Bar</span></code></span>
that is not in the current environment, the OCaml compiler will search the
directories in its search path for a file called &#8220;bar.cmi&#8221;.</p>

<p>In the presence of namespaces this becomes more complicated: how does the
compiler find the module 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
?</p>

<p>The suggested possible methods for finding modules in the presence of
namespaces fall into four categories.</p>

<h5 id="using-filenames">Using filenames</h5>

<p>By storing the interface for 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
in a file named &#8220;foo-bar.cmi&#8221; the compiler can continue to simply look-up
modules in its search path.</p>

<p>Note that &#8220;-&#8220; is an illegal character in module names so there is no risk of
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
being confused with a module called 
<span class="highlight"><code><span class="nc">Foo-bar</span></code></span>.</p>

<p>This simple scheme does not support placing a module within multiple
namespaces or allowing users to put existing modules in a new namespace.</p>

<h5 id="checking-multiple-cmi-files">Checking multiple &#8220;.cmi&#8221; files</h5>

<p>The name of the namespace containing a compilation unit could be included in
the &#8220;.cmi&#8221; file of that unit. Then, when looking for a module 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
, the compiler would try every &#8220;bar.cmi&#8221; file in its search path until it
found one that was part of the &#8220;Foo&#8221; namespace. This may require the compiler
to open all the &#8220;bar.cmi&#8221; files on its search path, which could be expensive
on certain operating systems.</p>

<p>This scheme does not support allowing users to put existing modules in a new
namespace, but can support placing a module in multiple namespaces.</p>

<p>It is difficult to detect typos in namespace open statements using this
scheme. For example, detecting that
<span class="highlight"><code><span class="k">open</span>
<span class="k">namespace</span>
<span class="nc">Core</span><span class="o">#</span><span class="nc">Sdt</span></code></span> 
should have been
<span class="highlight"><code><span class="k">open</span>
<span class="k">namespace</span>
<span class="nc">Core</span><span class="o">#</span><span class="nc">Std</span></code></span>
would require the compiler to check every file in its search path for one that
was part of namespace
<span class="highlight"><code><span class="nc">Core</span><span class="o">#</span><span class="nc">Sdt</span></code></span>.</p>

<h5 id="using-namespace-description-files">Using namespace description files</h5>

<p>The compiler could find a member of a namespace by consulting a file that
describes the members of that namespace.</p>

<p>For example, if namespace 
<span class="highlight"><code><span class="nc">Foo</span></code></span>
was described by a file &#8220;foo.ns&#8221; that was on the compiler&#8217;s search path then
the compiler could find
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
by locating &#8220;foo.ns&#8221; and using it to look-up the location of the &#8220;.cmi&#8221; file
for
<span class="highlight"><code><span class="nc">Bar</span></code></span>.</p>

<p>These namespace description files could be created automatically by some
tool. However, they must be produced before detecting dependencies with
OCamlDep, which could complicate the build process.</p>

<h5 id="using-environment-description-files">Using environment description files</h5>

<p>The compiler could find a member of a namespace by consulting a file that
describes a mapping between module names and &#8220;.cmi&#8221; files.</p>

<p>For example, if a file &#8220;foo.mlpath&#8221; included the mapping &#8220;Foo#Bar:
foo/bar.cmi&#8221; then that file could be passed as a command-line argument to the
compiler and used to look up the &#8220;bar.cmi&#8221; file directly.</p>

<p>Looking up modules using this scheme may speed up compilation by avoiding the
need to scan directories for files.</p>

<h4 id="how-should-namespaces-specified">How should namespaces specified?</h4>

<p>Perhaps the most important question for any namespaces proposal is how
namespaces are specified. It is closely related to the above question of how
the compiler finds modules in the presence of namespaces.</p>

<p>The suggested possible methods for specifying namespaces fall into five
categories.</p>

<h5 id="explicitly-in-the-source-files">Explicitly in the source files</h5>

<p>Namespaces could be specified by adding a line like:</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">namespace</span> <span class="nc">Foo</span></code></pre>
</div>

<p>to the beginning of each compilation unit that is part of the 
<span class="highlight"><code><span class="nc">Foo</span></code></span> 
namespace. </p>

<p>This has the benefit of making namespaces explicitly part of the language
itself, however it does mean that the full name of a module is specified in
two locations: partly in the filename and partly within the file itself.</p>

<h5 id="through-command-line-arguments">Through command-line arguments</h5>

<p>Namespaces could be specified by passing a command-line argument to the
compiler. For example, 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span> 
could be compiled with the command-line:</p>

<div class="highlight"><pre><code class="sh">ocamlc -c -namespace Foo bar.ml 
</code></pre></div>

<p>This scheme also means that the full name of a module is specified in two
locations: partly in the build system and partly in the filename.</p>

<h5 id="through-filenames">Through filenames</h5>

<p>Namespaces could be specified using the filenames of source files. For
example, 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span> 
would be created by compiling a file &#8220;foo-bar.ml&#8221;</p>

<p>This scheme is simple and very similar to how modules are currently named, but
it would require all source files to have long unique names.</p>

<h5 id="through-namespace-description-files">Through namespace description files</h5>

<p>Namespaces could be specified using namespace description files. The 
<span class="highlight"><code><span class="nc">Foo</span></code></span>
namespace would be specified by a file &#8220;foo.ns&#8221; that described the members of
<span class="highlight"><code><span class="nc">Foo</span></code></span>:</p>

<pre><code>module Bar = "foo_bar.cmi"
namespace Testing = "testing.ns"
</code></pre>

<h5 id="through-environment-description-files">Through environment description files</h5>

<p>Namespaces could be specified using environment description files. A namespace
<span class="highlight"><code><span class="nc">Foo</span></code></span>
would be defined by passing an environment description file to the compiler
that included mappings for each of the members of
<span class="highlight"><code><span class="nc">Foo</span></code></span>. For example:</p>

<pre><code>Foo#Bar: "foo_bar.cmi"
Foo#Testing#Bar: "foo_testing_bar.cmi"
Baz: "baz.cmi"
</code></pre>

<p>In addition to specifying namespaces, this system allows users (or a tool like
OCamlFind) to have complete control the naming environment of a program.</p>

<h4 id="how-rich-should-a-description-language-be">How rich should a description language be?</h4>

<p>For namespace proposals that use namespace or environment description files,
they must decide how rich their description language should be.</p>

<p>For example, <a href="http://gallium.inria.fr/~scherer/namespaces/spec.pdf">Gabriel Scherer et
al</a> describe a very rich
environment description language including many different operations that can
be performed on namespaces.</p>

<p>A rich description language can produce shorter descriptions. However, the
more operations a language supports the more syntax that users must understand
in order to read description files. The majority of description files are
unlikely to require complex operations.</p>

<h4 id="should-namespaces-support-automatically-opened-members">Should namespaces support automatically opened members?</h4>

<p>A feature of namespaces that has been proposed on the mailing list is to allow
some modules within a namespace to be automatically opened when the namespace
is also opened. This makes it seem that the namespace has values and types as
members.</p>

<p>This feature is based on the current design of Jane Street&#8217;s Core
library. Users of the Core library are expected to open the
<span class="highlight"><code><span class="nc">Core<span class="p">.</span>Std</span></code></span>
 module before using the library. Opening this module provides access to all
the other modules of the library (much like opening a namespace), but it also
provides types and values similar to those provided by the standard library&#8217;s
<span class="highlight"><code><span class="nc">Pervasives</span></code></span> module.</p>

<p>Supporting auto-opened modules would allow 
<span class="highlight"><code><span class="nc">Core<span class="p">.</span>Std</span></code></span>
to be directly replaced by a namespace. However, the semantics of this feature
could be awkward due to potential conflicts between members of the namespace
and sub-modules of the auto-opened modules. It also increases the overlap
between namespaces and modules.</p>

<h3 id="proposal">Proposal</h3>

<p>In the last section of this post I will outline a namespaces proposal that I
think satisfies the design goals set out earlier.</p>

<p>I think that satisfying these design goals requires a combination of
extensions to OCaml. My proposal is made up of four such extensions. To keep
things simple for users to understand, I have tried to keep each of these
extensions completely independent of the others and with a clearly defined
goal.</p>

<h4 id="simple-namespaces-through-filenames">Simple namespaces through filenames</h4>

<p>Currently, the name of a module is completely defined by its filename, and
modules are looked up using a simple search path. While it has some problems,
this simple paradigm has served OCaml well and I think that it is important to
provide some support for namespaces within this paradigm.</p>

<p>This means allowing simple namespaces to be specified using source file
names. For example, to create a module 
<span class="highlight"><code><span class="nc">Bar</span></code></span>
within the namespace 
<span class="highlight"><code><span class="nc">Foo</span></code></span>
developers can simply create an implementation file &#8220;foo-bar.ml&#8221; and an
interface file &#8220;foo-bar.mli&#8221;. This interface file would be compiled to a
&#8220;foo-bar.cmi&#8221; file. Hierarchical namespaces would be created by files with
names like &#8220;foo-bar-baz.ml&#8221;.</p>

<p>These namespaced modules can be referred to using the syntax 
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>. 
This syntax simply causes the compiler to look in its search path for a
&#8220;foo-bar.cmi&#8221; file.</p>

<p>I also propose supporting a namespace opening syntax like:
&lt;div class="highlight"&gt;</p>
<pre><code class="ocaml"><span class="k">open</span> <span class="k">namespace</span> <span class="nc">Foo</span>
[...]
<span class="nc">Bar</span></code></pre>
<p>&lt;/div&gt;</p>

<h4 id="an-alternative-to-search-paths">An alternative to search paths</h4>

<p>Forcing the name of a module to be completely defined by its (compiled)
filename makes it easy to look-up modules in a search path. However, it
prevents modules from being given multiple names or being renamed by users. So
I propose supporting an alternative look-up mechanism.</p>

<p>I propose supporting environment description files called <em>search path
files</em>. These files would have a syntax like:</p>

<pre><code>Foo#Bar : "other_bar.cmi"
Foo#Baz : Foo#Bar
</code></pre>

<p>This file can be given to the &#8220;-I&#8221; command-line argument instead of a
directory and used to look-up the locations of &#8220;.cmi&#8221; files for given module
names.</p>

<p>These search path files can be used to alias modules and to create new
namespaces. They also allow a module to be available under multiple namespaces.</p>

<p>I envisage two particular modes of use:</p>

<ul>  <li>    <p>Library authors can write &#8220;.mlpath&#8221; files and tell OCamlFind to use that
file as its search path instead of a list of directories.</p>
  </li>
  <li>    <p>A user (or potentially OCamlFind) can create search path files to define
their entire naming environment as they see fit.</p>
  </li>
</ul>

<h4 id="the--name-argument">The &#8220;-name&#8221; argument</h4>

<p>While the hard link between a module&#8217;s name and the name of its source file
makes life easier for build systems (&#8220;list.cmi&#8221; can only be produced by
compiling &#8220;list.ml&#8221;), it forces library authors to give their source files long
unique names.</p>

<p>I propose adding a &#8220;-name&#8221; command-line argument to the OCaml compiler. This
would be used as follows:</p>

<div class="highlight"><pre><code class="sh">ocamlc -c -name Foo#Bar other.ml
</code></pre></div>

<p>This command would produce a &#8220;foo-bar.cmi&#8221; file defining a module named
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
. This means that &#8220;.cmi&#8221; files would still be expected to be unique, but
source files could be named however the developer wants.</p>

<p>Obviously, any tools that assume that a module 
<span class="highlight"><code><span class="nc">Bar</span></code></span>
must be compiled from a file called &#8220;bar.ml&#8221; will not work in this
situation. However, the only OCaml tool that absolutely relies on this
assumption is &#8220;OCamlDep&#8221; when it is producing makefile formatted output.</p>

<p>Build systems would not be required to support the &#8220;-name&#8221; argument, however
it would make it easy for them to provide features such as:</p>

<ul>  <li>    <p>Creating namespaces to reflect a directory structure (e.g. &#8220;foo/bar.mli&#8221; becomes &#8220;foo-bar.cmi&#8221;).</p>
  </li>
  <li>    <p>Placing all the modules of a library under a common namespace (e.g. &#8220;bar.mli&#8221; becomes &#8220;foo-bar.cmi&#8221;)</p>
  </li>
</ul>

<p>This would mean that the names of source files could be kept conveniently
short.</p>

<h4 id="the--open-argument">The &#8220;-open&#8221; argument</h4>

<p>My proposals do not include support for automatically opened modules within
namespaces. I feel that this feature conflates two separate issues and it
would be better to solve the problem of automatically opened modules elsewhere. </p>

<p>Auto-opened modules are meant to allow libraries to provide their own
equivalent of the standard library&#8217;s 
<span class="highlight"><code><span class="nc">Pervasives</span></code></span>
module. I think that it would be more appropriate to have these &#8220;pervasive&#8221;
modules opened by default in any program compiled using one of these
libraries.</p>

<p>I propose adding a command-line argument &#8220;-open&#8221; that could be used to open a
module by default:</p>

<div class="highlight"><pre><code class="sh">ocamlc -c -open core-pervasives.cmi foo.ml
</code></pre></div>

<p>By adding support for this feature to OCamlFind, libraries could add this
argument to every program compiled using them. This amounts to having
automatically opened modules as part of the package system rather than part of
the namespace system.</p></div>







<p class="date"><a href="http://lpw25.net/2013/03/10/ocaml-namespaces.html">by Leo White at Sun, 10 Mar 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-03-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-03-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Mar%202013">Mar 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>The OCaml Labs hackers continue to arrive, with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html">David
Sheets</a> arriving from sunny San Francisco, and <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/xclerc.html">Xavier Clerc</a> visiting from the less-sunny
<a href="http://www.inria.fr">INRIA</a> in France.  David's done great work on several
OCaml libraries such as <a href="http://github.com/avsm/ocaml-cohttp">Cohttp</a> and on
<a href="http://www.youtube.com/watch?v=ll9z1ULtgqo&amp;feature=plcp">WebGL</a>, and he's diving
straight into a first release of <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html">OCamlot</a> before
starting his PhD later in the year. Xavier will
work on releasing his <a href="http://ocamljava.x9c.fr/preview/">OCaml Java
2.0</a> rewrite this summer, which takes
advantage of all the latest JDK features for non-Java languages.</p>
<p>A new research grant has also been awarded to <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/crowcroft.html">Jon Crowcroft</a>.
The <a href="http://hubofallthings.wordpress.com">Hub of All Things</a> is a &#163;1.2m multi-disciplinary
project funded by the <a href="http://www.rcuk.ac.uk/research/xrcprogrammes/Digital/Pages/home.aspx">RCUK Digital Economy Programme</a> and led by 
<a href="http://www2.warwick.ac.uk/fac/sci/wmg/people/profile/?wmgid=849">Irene Ng</a> 
in Warwick.  HAT aims to create a home platform, under the user's control, 
where a market to exchange their personal data for new products and 
personalised services could exist.  The Cambridge piece of this work will use
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">Mirage</a> for embedded systems programming, and
<a href="http://signpost.io">Signpost</a>, to enable devices to connect and communicate
with each-other across the edge network.</p>
<h3 id="Platformprojects"> Platform projects</h3>
<p><b>OPAM: </b> <a href="http://opam.ocamlpro.com">OPAM</a>, the popular OCaml Package Manager, recently had its <a href="http://www.ocamlpro.com/blog/2013/03/14/opam-1.0.0.html">1.0
release</a>!  OPAM has
been in development for just over a year, and this is a significant milestone
for the project.  The OPAM <a href="https://github.com/OCamlPro/opam-repository/issues">package repository</a> has had over 500 issues, closed over 400 pull requests and now contains over 450 packages
(and more than twice that number if you consider that multiple versions are
available).  This kind of user adoption is a fantastic sign for the OCaml
community.  We're very happy to be using OPAM as a key piece of the upcoming
OCaml Platform and the continuous integration and test system.</p>
<p><a href="https://github.com/ocaml/ocaml.org/wiki/Site-Redesign"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/ocaml_home_v2-2-thumb.jpg" width="220px" /></a>
<b>OCaml.org redesign:</b> Amir extended the Balsamiq mockups into more
realistic static site designs that can be <a href="https://github.com/ocaml/ocaml.org/wiki/Site-Redesign">found on the
wiki</a>.  We're building
on the theme we began with the <a href="https://github.com/ocaml/ocaml.org/wiki/Draft-OCaml-Logos">OCaml Logo</a>, but also
including the full functionality we want for the revamped site.  The samples
should give people an idea of the colour schemes and images we'll be using, and
feedback is <em>very</em> welcome.  Next, we're creating the HTML/CSS templates we
need to make these mockups a reality.</p>
<p><b>OCamlot</b>: Within hours of getting off the plane, David was already 
getting well into the OCaml-based test tool and working on the pieces we 
need to get to a usable first version.  The OCamlot workflow was last 
described in Amir's
<a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">Balsamiq mockups</a>
in case you want to catch up.  This work is made all the more important as 
Jane Street continues to demonstrate their strong commitment to open-source 
by sending in OPAM pull requests 
<a href="https://github.com/OCamlPro/opam-repository/pull/644">every week</a> 
for new releases of their <a href="http://janestreet.github.io">libraries</a>.  The 
testing for these releases is currently handled manually and we're really 
looking forward to having them dealt with automatically!</p>
<h3 id="Systemsprojects"> Systems projects</h3>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/asplos-mort.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/asplos-mort-thumb.jpg" width="120px" /></a>
<b>Mirage</b>: There is much preparation ongoing for the big 
<a href="http://wiki.xen.org/wiki/Mirage_Incubation_Project_Proposal">xen.org incubation</a>, 
which has now been approved by the Xen community board. Vincent's work on 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">Mirari</a> is going very well, and he's updated the 
<a href="http://www.openmirage.org/wiki/install">Mirage installation</a> instructions 
to use Mirari instead of the manual process required before. 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/avsm.html">Anil</a> and <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/mort.html">Mort</a> also attended 
and presented the 
<a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">ASPLOS 2013</a> paper in 
Houston.  For the curious, 
<a href="http://www.yelp.co.uk/biz/bens-beans-houston">Ben's Beans</a> is the only good 
coffee we could find suitable for a European in Texas.</p>
<p><b>Irminsule</b>: Now that the core of Mirage is heading for release, the 
team is turning their attention to the storage and distributed programming 
challenge. <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/tg.html">Thomas</a> and Anil have been working on a new 
policy-free, branch-consistent storage layer that exposed a raw git-like 
universe to Mirage applications. We're working on as part of the 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html">Trilogy2</a> that's investigating how to improve the 
reliability of congested datacenters.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/heidi-signposts.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/heidi-signposts-thumb.jpg" width="130px" /></a>
<b>Signposts</b>: <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/heidi.html">Heidi</a> gave an <em>excellent</em> talk 
about Signpost and the benefits it can offer internet users today
<i>(see right)</i>. This was one of a set of talks that took place in the 
Computer Lab, organised by <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/mycroft.html">Alan Mycroft</a>, on open 
software and open hardware with speakers such as
<a href="http://en.wikipedia.org/wiki/Jon_Hall_(programmer)">Jon 'maddog' Hall</a> of
Linux International. There was fairly unanimous agreement that Heidi's 
slides were better than Anil's.</p>
<h3 id="Compilerprojects"> Compiler projects</h3>
<p><b>Multicore</b>: Once the dreaded ICFP deadline was out of the way, 
Stephen, Leo, Raphael and Anil put their heads together to start 
architecting the support for parallel multicore support in the OCaml runtime.
A key part of the design space is to maintain the sequential performance and 
simplicity of the existing runtime, but still make it easy to extend shared 
memory onto different cores.  We'll have more details on this shortly when 
early prototypes are done and some benchmarks run.</p>
<p><b>Namespaces:</b> Leo's also been extremely busy in the 
<a href="http://lists.ocaml.org/listinfo/platform">platform mailing list</a>, which has 
been the location for the discussion of namespaces.  A few hundred emails 
have been exchanged on this topic and Leo has summarised the discussion and 
made proposals in his blog post about 
<a href="http://www.lpw25.net/2013/03/10/ocaml-namespaces.html">OCaml namespaces</a>.  Although this is a complex issue, aspects of namespaces will be important to 
the work on the OCaml Platform so we look forward to the outcome of these 
discussions.</p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-email" href="http://lists.ocaml.org/pipermail/platform/2013-March/000291.html">OPAM 1.0 Released!</a> <em>(Mar 14th)</em>
 </li>
 <li><a class="icon-rss" href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">Wireframe demos for OCaml.org</a> <em>(Mar 14th)</em>
 </li>
 <li><a class="icon-rss" href="http://www.lpw25.net/2013/03/10/ocaml-namespaces.html">Adding namespaces to OCaml</a> <em>(Mar 10th)</em>
 </li>
</ul>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Mar%202013">by Anil Madhavapeddy (anil@recoil.org) at Fri, 01 Mar 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/lpw25.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://lpw25.net/2013/02/05/camlp4-alternative-part-2"><a name="http://lpw25.net/2013/02/05/camlp4-alternative-part-2"> </a>
<h1 class="posttitle"><a href="http://lpw25.net/2013/02/05/camlp4-alternative-part-2.html">An alternative to camlp4 - Part 2</a>
(<a href="http://lpw25.net/" title="lpw25">Leo White</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>In my <a href="http://www.lpw25.net/2013/01/23/camlp4-alternative-part-1.html">previous blog post</a> I
discussed how we might use AST transformers, attributes and quotations as a
simpler alternative to camlp4. While AST transformers are much simpler to use
than camlp4 they still require knowledge of the OCaml syntax tree, and they are
still implemented outside of the language as preprocessors.</p>

<p>In this post I&#8217;ll explore how to implement extensions:</p>

<ul>  <li>within the language itself without external preprocessors</li>
  <li>without the need for detailed knowledge of the OCaml syntax tree</li>
</ul>

<p>By including these extensions in the language itself the increasing number of
tools being built to support OCaml (e.g. typerex) can handle them directly. For
instance, IDEs could show the expansions of quotations by using the information
in &#8220;.cmt&#8221; files.</p>

<p>I will start with quotations, which can be implemented without any knowledge of
the OCaml syntax tree, and then expand my proposal to include other kinds of
extension.</p>

<p>Since my previous post, there has been a lot of discussion on
<a href="http://lists.ocaml.org/listinfo/wg-camlp4">wg-camlp4@lists.ocaml.org</a> about
possible syntaxes for quotations and attributes and other kinds of extension. In
keeping with those ongoing discussions, I will use <code>{:id { string }}</code> as the
syntax for quotations (which transform a string into an AST node) and <code>(:id
expr)</code> as the syntax for extensions that transform an OCaml expression into an
AST node.</p>

<p>Note that the proposals in this post are more long-term than the &#8220;ppx&#8221; solution
discussed in the previous post. Moving an extension from ppx to the mechanism
described in this post would require only minimal work. So in the short/medium
term extension authors should implement their extensions using ppx.</p>

<h4 id="quotations">Quotations</h4>

<p>A quotation is simply a function which takes a string and returns an AST
node. To provide built-in support we need to, for every quotation <code>{:foo { bar
}}</code>:</p>

<ol>  <li>find a function that corresponds to <code>foo</code></li>
  <li>apply it to the string &#8220; bar &#8220; </li>
  <li>copy the resulting AST node in place of the original quotation</li>
</ol>

<h5 id="quotations-in-modules">Quotations in modules</h5>

<p>We might want to find the function corresponding to quotation <code>foo</code> by simply
looking in the current module, or one of the other modules in our environment,
for a function called <code>foo</code>. However there are a few problems with this simple
scheme:</p>

<ol>  <li>The function we call must exist and be compiled before we can use it.</li>
  <li>There is no clear separation between what is being executed at compile-time
and what is being executed and run-time.</li>
</ol>

<p>The first problem basically means that we can only use functions defined in
other files. The other problem is more subtle.</p>

<p>OCaml modules do not really exist at compile time. They are created at run-time,
and their creation encompasses the entire execution of the program. For example,
consider this simple module:</p>

<div class="highlight"><pre><code class="ocaml"><span class="c">(* main.ml *)</span>
<span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">"Hello, world!</span><span class="se">\n</span><span class="s2">"</span>
</code></pre></div>

<p>To create the <code>Main</code> module, we must create its member <code>x</code>. Once the creation of
<code>Main</code> is finished the <code>printf</code> has been executed and the whole program has
completed. Now if we add a quotation function <code>foo</code> to this module:</p>

<div class="highlight"><pre><code class="ocaml"><span class="c">(* main.ml *)</span>
<span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">"Hello, world!</span><span class="se">\n</span><span class="s2">"</span>

<span class="k">let</span> <span class="n">keywords</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span>
<span class="k">let</span> <span class="n">foo</span> <span class="n">str</span> <span class="o">=</span> <span class="c">(* Some expression using keywords *)</span>
</code></pre></div>

<p>How do we distinguish between data such as <code>keywords</code> which are needed at
compile-time when the quotation is run, and data like <code>x</code> whose creation is
meant to drive the program at run-time? There is nothing explicit in the
definitions of <code>foo</code> or <code>keywords</code> that indicates that they are intended for
compile-time execution.</p>

<p>These problems are related to the fact that OCaml is an impure language. Any
expression (including module definitions) can have side-effects, and the
run-time behaviour of the program is simply the combination of all these
side-effects. This makes it difficult to separate the side-effects that are
related to a quotation from the side-effects that are part of the program&#8217;s
execution.</p>

<p>Despite appearing alongside other functions in the program, <code>foo</code> must be
executed in a completely separate environment. Any side-effects (e.g. mutable
state, I/O) that are produced while creating and executing <code>foo</code> will be
completely separate from the side-effects of the other functions in its module.</p>

<h5 id="where-can-we-put-them">Where can we put them?</h5>

<p>If we don&#8217;t want to put quotation functions in our modules, where should we put
them? The module system provides the only mechanism for referring to functions in
other files, how can we refer to functions which are not included in a module?</p>

<p>The answer to these questions comes from the idea of <em>namespaces</em>. Namespaces
are a way to give longer names to top-level modules without changing the
module&#8217;s filename. They also allow these top-level modules to be grouped
together.</p>

<p>The details of proposals for namespaces vary on their details, but they
basically allow you to take the module defined by a file &#8220;baz.ml&#8221; and refer to
it as &#8220;Bar.Baz&#8221;. Here &#8220;Bar&#8221; is not a module (it cannot be used as the argument
to a functor) but a namespace.</p>

<p>Namespaces seem likely to be included in OCaml in the near future,
and they provide a convenient way to refer to quotations without putting
quotations within modules.</p>

<p>The idea is to write quotations in a &#8220;bar.mlq&#8221; file (compiled to
&#8220;bar.cmq&#8221;). These quotations would then be placed in the namespace &#8220;Bar&#8221;.</p>

<p>Quotations would be defined with a syntax like:</p>

<div class="highlight"><pre><code class="ocaml"><span class="c">(* bar.mlq *)</span>
<span class="n">quotation</span> <span class="n">foo</span> <span class="n">str</span> <span class="o">=</span> <span class="o">...</span>
</code></pre></div>

<p>This could then be used with the syntax:</p>

<div class="highlight"><pre><code class="ocaml"><span class="o">{:</span><span class="nn">Bar</span><span class="p">.</span><span class="n">foo</span><span class="o">{</span> <span class="n">some</span> <span class="n">text</span> <span class="o">}}</span>
</code></pre></div>

<p>This will make it easy for quotations to be provided by libraries. So that the
following code would perfectly possible:</p>

<div class="highlight"><pre><code class="ocaml"><span class="o">{:</span><span class="nn">Core</span><span class="p">.</span><span class="nn">Web</span><span class="p">.</span><span class="n">html</span><span class="o">{&lt;</span><span class="n">body</span><span class="o">&gt;</span> <span class="n">hello</span><span class="o">,</span> <span class="n">world</span><span class="o">!</span> <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;}}</span>
</code></pre></div>

<h5 id="quotations-in-different-contexts">Quotations in different contexts</h5>

<p>So far, we have ignored the question of what type is used to represent an AST
node. The standard library would need to provide such a type so that quotations
could be written without linking to compiler-libs. There would also need to be
different types for different kinds of AST nodes. We do not want a quotation
used as an expression returning an AST node that represents a pattern</p>

<p>However, we also might want to create quotations that can be used as both
expressions and patterns. This means that the quotation must return a different
type depending on where it is used.</p>

<p>The solution to this issue is to give quotations the type <code>'a ctx -&gt; string -&gt;
'a</code>.  The <code>ctx</code> type would be a GADT that described what context a quotation was
being used from. It could also contain other information about the context, such
as its location in the source file.</p>

<h5 id="building-quotations">Building Quotations</h5>

<p>Creating the quotation functions requires some facility for creating AST
nodes. For this purpose, the standard library would include special quotations,
for example: <code>{:Ast.expr{ x + 3 }}</code>. These quotations would be implemented
directly using the compiler&#8217;s lexer and parser.</p>

<p>It would also be useful (especially for handling anti-quotations) to allow
quotations to be built from other quotations. For this we could provide another
syntax: <code>{:foo}</code> that would refer directly to the quotation function
<code>foo</code>. Obviously, this syntax would only be allowed within &#8220;.mlq&#8221; files.</p>

<h4 id="other-extensions">Other extensions</h4>

<p>This system could easily be extended to other kinds of extension. Rather than
declaring &#8220;quotations&#8221; with type <code>'a ctx -&gt; string -&gt; 'a</code>, we could declare
<em>templates</em> with type <code>'a ctx -&gt; 'a</code>. The context would contain the arguments to
the template (a string for quotations, an AST node for other templates).</p>

<p>So a template declared as:</p>

<div class="highlight"><pre><code class="ocaml"><span class="c">(* bar.mlq *)</span>
<span class="n">template</span> <span class="n">foo</span> <span class="n">str</span> <span class="o">=</span> <span class="o">...</span>
</code></pre></div>

<p>could be used with the syntax:</p>

<div class="highlight"><pre><code class="ocaml"><span class="o">(:</span><span class="nn">Bar</span><span class="p">.</span><span class="n">foo</span> <span class="n">expr</span><span class="o">)</span>
</code></pre></div>

<p>Unlike quotations, more general templates must be able to interpret AST nodes
themselves. This means we must provide mechanisms for handling AST nodes. For
this purpose, the standard library would include a simpler version of the
<code>AstMapper</code> module that is in compiler-libs.</p>

<p>We could also allow the AST quotations (e.g. `Ast.expr) to be used as
patterns. This approach can be a bit fragile because syntactic sugar can cause a
pattern to match ASTs that it was not expected to match. However, for matching
simple AST nodes it is probably fairly robust.</p>

<h4 id="summary">Summary</h4>

<ol>  <li>Allow extensions to be written as OCaml functions within &#8220;.mlq&#8221; files.</li>
  <li>Refer to these functions by attaching them directly to namespaces.</li>
  <li>Require these functions to have type <code>'a ctx -&gt; 'a</code>, where <code>ctx</code> includes a
GADT describing the context that the extension has been used in.</li>
  <li>Provide AST quotations in the standard library (e.g. <code>{:Ast.expr{ x + 3 }}</code>)
which use the compiler&#8217;s own lexer and parser.</li>
</ol></div>







<p class="date"><a href="http://lpw25.net/2013/02/05/camlp4-alternative-part-2.html">by Leo White at Tue, 05 Feb 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-02-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-02-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Feb%202013">Feb 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>Two new people joined the core team at Cambridge: <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/yallop.html">Jeremy Yallop</a> and <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/pwang.html">Philippe Wang</a>!
Jeremy has extensive expertise with meta-programming and generic programming,
and is initially looking at the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/compiler.html#Camlp4%20redesign">camlp4 redesign</a>.
Philippe has been taking on the challenge of running OCaml well on restricted embedded systems, which
will also have knock-on benefits to x86 compilation with the same optimisations.
<a href="http://www.x9c.fr">Xavier Clerc</a> also joined us for a day in advance of his
visit in April, with much interest in his <a href="http://argot.x9c.fr">Argot</a> project
and the upcoming <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign">redesign of OCaml.org</a>.</p>
<p>Two new research grants have been awarded that are relevant to the OCaml Labs mission:</p>
<ul> <li><a href="http://gow.epsrc.ac.uk/NGBOViewGrant.aspx?GrantRef=EP/K032968/1">Network-as-a-Service</a> is a 3-year grant to solve pressing problems in "Big Data" processing, and will enable us to continue to develop <a href="http://openmirage.org">MirageOS</a> and the use of OCaml and functional programming in this space.  We're going to be collaborating with Imperial and Nottingham on this, with the Cambridge efforts led by <a href="http://www.cl.cam.ac.uk/~awm22/">Andrew Moore</a>, <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/crowcroft.html">Jon Crowcroft</a> and <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/avsm.html">Anil Madhavapeddy</a>.
 </li>
 <li><a href="http://rems.io">Rigorous Engineering of Mainstream Systems</a> asks how we can use rigorous maths to improve the quality of mainstream computer systems.  It is led by <a href="http://www.cl.cam.ac.uk/~pes20">Peter Sewell</a> at Cambridge, and most of the tools (including <a href="http://www.cl.cam.ac.uk/~pes20/ott/">Ott</a> and <a href="http://www.cs.kent.ac.uk/people/staff/sao/lem/">Lem</a>) are written in OCaml and will benefit from the ongoing work at OCaml Labs.</li>
</ul>

<h3 id="Platformprojects"> Platform projects</h3>
<p><b>OPAM</b>: <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/rdc-talk.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/rdc-talk-thumb.jpg" width="130px" /></a>
We've been working hard on an OPAM 1.0 release, and Thomas and Anil have been sweeping through the package tree to stabilise the repository via automated builds.
We also had a brilliant visit from <a href="http://www.dicosmo.org/index.html.en">Roberto Di Cosmo</a> from <a href="http://www.pps.univ-paris-diderot.fr">PPS</a>, who has contributed extensively to the open-source community over the years.  He gave a talk on the <a href="http://upsilon.cc/~zack/research/publications/infsof2012-mpm.pdf">challenges of handling large-scale versioning</a> of packages from a mathematical perspective (particularly applied to Debian), which is very useful input for the ongoing OPAM work.</p>
<p><b>Mailing lists</b>: A new <a href="http://lists.ocaml.org/listinfo/opengl">opengl@lists.ocaml.org</a> was
set up for those interested in OpenGL and WebGL on OCaml, and discussion so far
has covered LabGL on the Raspberry Pi. There are also still plans to begin
working groups for build systems and parallelism but will be announced in due
course once the preparatory work has been completed.</p>
<p><b>Real World OCaml</b>: The book is now on <a href="http://www.realworldocaml.org">alpha3</a>,
where Part 1 is nearly complete.  New sections on installation and a more
expanded prologue have also been included in this version.</p>

<p><b>Redesign: </b> As part of the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign">redesign
work</a>, and to showcase the kind of
additional functionality we'd like to create, Amir put together a set of
screencasts that talk though a wireframe demo of the new site.  These short
videos covered elements of design, the new documentation system and an overview
of how the continuous integration system would work.  You can read more and
experience the clickable demo via <a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg">Amir's blog post</a>.</p>
<h3 id="Systemsandcompilerprojects"> Systems and compiler projects</h3>
<p><b>Mirage</b>: Anil gave two tech talks about <a href="http://openmirage.org">Mirage</a> this month at Citrix and Microsoft Research, as practise talks for <a href="http://asplos13.rice.edu">ASPLOS 2013</a>. Mirage itself is nearing a release, and <a href="https://github.com/vbmithr">Vincent Bernardoff</a> has joined the Citrix engineering team to help drive it to release. He's been primarily focussed on the build frontend (dubbed <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html#Mirari">Mirari</a>) to make Mirage applications easier to compile out-of-the-box.</p>
<p><b>camlp4 redesign:</b> There has been more discussion about the future of camlp4 and <a href="http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html">Leo posted another summary</a> on his thoughts for an alternative apporach to quotations.</p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-rss" href="http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html">An alternative to camlp4 - Part 2</a> <em>(Feb 5th)</em>
 </li>
</ul>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Feb%202013">by Anil Madhavapeddy (anil@recoil.org) at Fri, 01 Feb 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/lpw25.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://lpw25.net/2013/01/23/camlp4-alternative-part-1"><a name="http://lpw25.net/2013/01/23/camlp4-alternative-part-1"> </a>
<h1 class="posttitle"><a href="http://lpw25.net/2013/01/23/camlp4-alternative-part-1.html">An alternative to camlp4 - Part 1</a>
(<a href="http://lpw25.net/" title="lpw25">Leo White</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>Since its creation camlp4 has proven to be a very useful tool. People have used
it to experiment with new features for OCaml and to provide interesting
meta-programming facilities. However, there is general agreement that camlp4 is
too powerful and complex for the applications that it is most commonly used for,
and there is a growing movement to provide a simpler alternative.</p>

<p>The <a href="http://lists.ocaml.org/listinfo/wg-camlp4">wg-camlp4@lists.ocaml.org</a>
mailing list has been created to discuss implementing this simpler
alternative. This blog post is a way of kick-starting the discussion on this
list, by explaining my thoughts on what needs to be done.</p>

<p>Personally, I think that providing a real alternative to camlp4 involves two
phases. The first phase is to provide support for implementing the most popular
camlp4 extensions without camlp4. Since the people who have implemented these
extensions already require good knowledge of the OCaml grammar it is not
unreasonable to expect a similar level of expertise to use the alternative. This
phase can easily be implemented before the next OCaml release, and I will
discuss what I think that will involve in the remainder of this post.</p>

<p>The second phase involves extending this support to allow general OCaml
programmers to write extensions, and to include such extensions within the
language itself rather than as part of a pre-processor. I will discuss my
thoughts on this phase in a later blog post.</p>

<h4 id="camlp4-in-the-wild">Camlp4 in the wild</h4>

<p>Camlp4 works by producing pre-processors that parse an OCaml file and then output
a syntax tree directly into the compiler. Extensions are written by extending
the default OCaml parser and converting any new syntax tree nodes into existing
OCaml nodes. Most of the complexity in camlp4 comes from its extensible
grammars, which gives camlp4 the ability to extend the OCaml syntax
arbitrarily. However, most applications do not need this ability. </p>

<p>From an ad-hoc survey of camlp4 extensions in the OPAM repository, most of the
popular camlp4 extensions seem to fall into one of three categories: </p>
<ul><li>Type-conv style extensions such as 
<a href="https://bitbucket.org/yminsky/ocaml-core/wiki/Home">sexplib</a>, 
<a href="https://github.com/mirage/orm">ORM</a> and 
<a href="https://github.com/mirage/dyntype">dyntype</a>. 
These extend the syntax to allow code such as:

<div class="highlight"><pre><code class="ocaml"><span class="k">type</span> <span class="n">t</span> <span class="o">=</span>
<span class="o">{</span> <span class="n">x</span> <span class="o">:</span> <span class="kt">int</span> <span class="k">with</span> <span class="n">default</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>
  <span class="n">y</span> <span class="o">:</span> <span class="kt">int</span> <span class="k">with</span> <span class="n">default</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">sexp_drop_default</span><span class="o">;</span>
  <span class="n">z</span> <span class="o">:</span> <span class="kt">int</span> <span class="k">with</span> <span class="n">default</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">sexp_drop_if</span><span class="o">(</span><span class="n">z_test</span><span class="o">);</span> 
<span class="o">}</span> <span class="k">with</span> <span class="n">sexp</span>
</code></pre></div>

</li>
<li>Extensions using camlp4's quotations syntax such as 
<a href="https://github.com/mirage/ocaml-cow">COW</a>. These look like:

<div class="highlight"><pre><code class="ocaml"><span class="o">&lt;:</span><span class="n">html</span><span class="o">&lt;</span> <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span> <span class="n">hello</span> <span class="n">world</span> <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>  <span class="o">&gt;&gt;</span>
</code></pre></div>

</li>
<li>Other syntax extensions that could be expressed using existing syntax or the
camlp4 quotation syntax. For example, 
<a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a> provides a
<code>##</code> operator for accessing javascript objects. This could easily be replaced by
a valid operator such as <code>%%</code>.
</li>
</ul>

<p>By providing support for these specific kinds of extension, we can provide an
alternative to camlp4 for the majority of its applications.</p>

<h4 id="ast-transformers-attributes-and-quotations">AST transformers, attributes and quotations</h4>

<p>A much simpler alternative to allowing arbitrary syntax extensions is to use
<em>AST transformers</em>, <em>attributes</em> and <em>quotations</em>.</p>

<p>AST transformers are simply functions that perform transformations on the OCaml
syntax tree. These can already be implemented using the new
&#8220;<a href="http://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do-it">-ppx</a>&#8221;
command line option that has been included on the OCaml development trunk by
Alain Frisch. This option accepts a program as an argument, and pipes the syntax
tree through that program after parsing and before type checking.</p>

<p>Attributes are places in the grammar where generic data can be attached to the
syntax tree. This data is simply ignored by the main OCaml compiler, but it can
used be AST transformers to control transformations. </p>

<p>Quotations are any construct that is not lexed or parsed by the compiler. These
can be attributes, expressions, patterns etc. The contents of a quotation can be
lexed and parsed by an AST transformer and converted into a regular AST node.</p>

<p>Before support for attributes and quotations can be added to the compiler
decisions need to be made about what kinds of attributes and quotations to
support. Personally I prefer quotation attributes to attributes that are parsed
by the compiler because they are more flexible. However there is no reason that
both kinds cannot be supported by the compiler using different syntax.</p>

<p>I think that it is important to support at least the following kinds of attribute:</p>
<ul><li>Simple named quotations for expressions, patterns and type expressions:

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="o">&lt;:</span><span class="nn">Foo</span><span class="p">.</span><span class="n">foo</span> <span class="o">&lt;</span> <span class="n">some</span> <span class="n">random</span> <span class="n">text</span> <span class="o">&gt;&gt;</span>
</code></pre></div>

</li>
<li>Type constructor quotation attributes:

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">x</span><span class="o">:</span> <span class="kt">int</span> <span class="o">%</span><span class="n">foo</span><span class="o">,</span> <span class="kt">float</span> <span class="o">%</span><span class="n">bar</span><span class="o">(</span> <span class="n">some</span> <span class="n">random</span> <span class="n">text</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">.</span><span class="mi">5</span><span class="o">)</span>
</code></pre></div>

</li>
<li>Type-conv style definition attributes:

<div class="highlight"><pre><code class="ocaml"><span class="k">type</span> <span class="n">t</span> <span class="o">=</span> 
<span class="o">{</span> <span class="n">x</span><span class="o">:</span> <span class="kt">int</span><span class="o">;</span>
  <span class="n">y</span><span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="o">}</span>
<span class="k">with</span> <span class="n">foo</span><span class="o">,</span> <span class="n">bar</span><span class="o">(</span> <span class="c">(* some valid expression *)</span> <span class="o">)</span>
</code></pre></div>

</li>
<li>Annotating types with syntactically valid expressions:

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">x</span><span class="o">:</span> <span class="kt">string</span> <span class="o">@@</span> <span class="c">(* some valid expression *)</span> <span class="o">=</span> <span class="bp">()</span>
</code></pre></div>

</li>
</ul>

<p>Once support for these attributes and quotations is added to OCaml I think that
the majority of camlp4 applications could be easily converted into AST
transformers.</p>

<p>In order to make this transition easy, work must also be done to provide tools
for manipulating OCaml&#8217;s AST and parsing quotations. It would also be worthwhile
trying to normalise some of the stranger corners of the OCaml syntax tree. This
will make writing AST transformers simpler and more robust</p>

<p>Finally, the &#8220;-ppx&#8221; option must be integrated into the many OCaml build
systems.</p>

<h4 id="join-the-discussion">Join the discussion</h4>

<p>The above suggestions are just the attributes and quotations that I think will
be necessary to provide a viable alternative to camlp4. However, I suspect that
they are not sufficient. It would be very useful to hear from anyone who has
written camlp4 extensions about what kind of extensions they have written, and
what they think would be necessary to support their extensions without
camlp4. So please join the
<a href="http://lists.ocaml.org/listinfo/wg-camlp4">wg-camlp4@lists.ocaml.org</a> list and post
your thoughts.</p></div>







<p class="date"><a href="http://lpw25.net/2013/01/23/camlp4-alternative-part-1.html">by Leo White at Wed, 23 Jan 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-01-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-01-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jan%202013">Jan 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>There's a lot of interest in the work we're doing, and the number of collaborative <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html">projects</a> is increasing fast. 
We held the first monthly meeting in the Computer Lab, where <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/avsm.html">Anil</a> provided
an overview of the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html">research work</a> that OCaml Labs is
starting. An interesting theme of the discussion that followed was
related to undergraduate teaching and how things like the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html">OCaml
Platform</a> and infrastructure would make it easier for
students to get to grips with programming.<br /></p>
<p>For the evening after the meeting, <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/amirmc.html">Amir</a> set up 
an informal OCaml hacking/tutorial session in Cambridge.  Around 15 eager 
people attended the event in <a href="http://makespace.org">Makespace</a> (a community 
workshop), with most of them being new to the language.  Anil introduced 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#Book%20review%20site">Real World OCaml</a> 
and shared the 
introductory chapters while Thomas provided help with OPAM.  This turned out 
to be a great test of the installation process for newcomers to OCaml, as 
well as the book's instructions. A number of issues came to light, partly 
related to a perfect storm of package issues, which everyone is keen to 
improve.  Despite these problems, attendees were very positive and were keen 
to see more gatherings like this in future.  When Amir asked for feedback, 
pretty much everyone commented on how great the pizza was.</p>
<h3 id="Platformprojects"> Platform projects</h3>
<p>OCaml Labs also hosted its first visitor this month as <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/tg.html">Thomas
Gazagnaire</a>, the CTO of OCamlPro, spent three weeks in
Cambridge.  Much effort was put into preparing Mirage for release, discussions
about parallelism and the OCaml Platform, and anything where OPAM is a crucial
component.  Worth noting is that (at time of writing) the 
<a href="https://github.com/OCamlPro/opam-repository">opam-repository</a> has now 
become the <a href="https://github.com/languages/OCaml">overall most forked OCaml project on Github</a>.<br />
The <a href="http://lists.ocaml.org/pipermail/platform/">Platform mailing list</a> 
has also been formed for discussion regarding the OCaml Platform.  Anyone 
interested in the discussions about the platform, which will include 
development on OPAM, should join this list.</p>
<p>Part of the Platform work involves creating a new 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html">design for OCaml.org</a>, which also 
<a href="http://lists.ocaml.org/pipermail/infrastructure/2013-February/000194.html">kicked-off this week</a>.<br />
Amir will keep people updated about progress via updates to the 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign">OCL website</a>, 
<a href="http://lists.ocaml.org/pipermail/infrastructure/">Infrastructure mailing list</a> and also by posting things to the 
<a href="https://github.com/ocaml/ocaml.org/wiki">OCaml.org Github wiki</a>.  The 
current stage of work involves thinking of the types of pages OCaml.org 
requires, in order to refine the templates we need.  As part of this, we 
also commissioned a new logo for OCaml and although it's still under 
development, you can see the latest draft on the 
<a href="https://github.com/ocaml/ocaml.org/wiki/Draft-OCaml-Logos">OCaml.org wiki</a>.
  Please send any feedback directly to Amir.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-2.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-2-thumb.jpg" width="130px" /></a>
The Real World OCaml book website was released as a 
<a href="http://www.realworldocaml.org">limited alpha</a> earlier in the month, with 
the aim of getting early feedback and comments. Each paragraph of the online 
book has commenting functionality, using Github issues as a backend.  This 
means that each comment made on the book website creates a new issue on 
Github, which authors/commenters can track and discuss before editing the 
content.  So far there have been over 250 comments on the alpha, with half 
them being dealt with already.</p>
<p>A new EU project also kicked-off called <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html">Trilogy 2</a>, which builds on the 
award-winning work from the original <a href="http://www.trilogy-project.org">Trilogy</a> project.  OnApp (a member of Trilogy 2), will be providing the <a href="http://lists.ocaml.org/pipermail/infrastructure/2013-February/000198.html">cloud Infrastructure for ocaml.org</a>, and Thomas and Anil will be expanding the Mirage project into distributed computing under this umbrella.  As befits an EU project, it kicked off with an especially nice dinner at <a href="http://www.christs.cam.ac.uk">Christ's College</a>...</p>
<h3 id="Systemsresearch"> Systems research</h3>
<p><b>Mirage:</b> This was formally proposed as an 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">incubated Xen.org project</a> and the proposal was put forward for 
<a href="http://wiki.xen.org/wiki/Mirage_Incubation_Project_Proposal">community review</a>. There were many positive 
comments on the Xen mailing lists (along the lines of 
<a href="http://lists.xen.org/archives/html/xen-devel/2013-01/msg01084.html">"Mirage is cool stuff"</a>)
and voting is currently underway by eligible members of the Xen community.
Assuming a positive outcome, incubation would give the Mirage project greater
visibility and access to resources.  This would accelerate progress towards an
alpha release in Q1/Q2 this year.  In 
addition to this, a proposal for an 
<a href="http://www.oscon.com/oscon2013">OSCON talk</a> was also submitted and the camera-ready version of the ASPLOS paper is 
<a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">now available</a>.<br /></p>
<p><b>Illuminate</b>: A related research topic where Mirage could be useful is in embedded systems 
and the Internet of Things.  One specific use case is the 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/illuminate.html">Illuminate Project</a>, where Mirage can be used 
to create appliances running on the ARM microcontrollers alongside an LED 
lighting network.  Such a lighting system is now deployed in large parts of 
the Computer Laboratory and will form an excellent test-bed to explore these 
ideas further.</p>
<p><b>Signpost:</b>: <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-1.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-1-thumb.jpg" width="130px" /></a>
Signpost is also achieving greater outreach with 
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/crowcroft.html">Jon Crowcroft</a> discussing such technologies at a 
meeting in Dagstul on <a href="http://www.dagstuhl.de/en/program/calendar/semhp/?semnr=13062">Decentralized Systems for Privacy
Preservation</a>.
Cambridge also hosted <a href="http://en.wikipedia.org/wiki/Eric_Schmidt">Eric Schmidt</a>
from Google, where he is the Humanitas Visiting Professor in Media for 2013.
Eric delivered a <a href="http://www.crassh.cam.ac.uk/events/2332/">talk</a> on the future
of conflict, combat and intervention.  Anil and Jon got an opportunity to
discuss Signposts with him for 20 minutes, which was an interesting clash of
opinions (we want decentralised identity, Google want it all to go through
them).  Either way, we're even more motivated to get the Signpost tech out to
the big bad world as soon as possible.  Meanwhile, Haris found his identical
twin brother in <a href="http://en.wikipedia.org/wiki/St_John%27s_College,_Cambridge#The_Master.27s_Lodge_and_Garden">St Johns Masters Lodge</a>...</p>
<h3 id="Compilerprojects"> Compiler projects</h3>
<p>Several mailing lists are in progress for various community-driven projects.
The first of these is a working group on the future of syntax extensions in 
OCaml (<a href="http://lists.ocaml.org/pipermail/wg-camlp4">wg-camlp4</a>).  This group is 
chaired by <a href="http://alain.frisch.fr">Alain Frisch</a> and Leo White and has 
generated a great deal of discussion in the last two weeks.  Leo is 
summarising his thoughts in a series of <a href="http://www.lpw25.net">blog posts</a> 
as he goes.  Further working groups on parallelism in OCaml and build systems are under 
discussion and will be announced in due course.<br /></p>
<p>As well as all the research and development activity we've also been 
recruiting.  We've had several rounds of interviews and made a number of 
offers so hopefully we'll be announcing new members of the OCaml Labs team 
in the coming months.  In addition, we'd also like to mention that Leo 
successfully defended his PhD Thesis in January.  Finally, we'd like to 
welcome a new honorary member of OCaml Labs, Nathan Scott, born on 30th 
January.  Congratulations <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/djs.html">Dave</a>!</p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-rss" href="http://www.lpw25.net/2013/01/23/camlp4-alternative-part-1.html">An alternative to camlp4 - Part 1</a> <em>(Jan 23rd)</em></li>
</ul>


   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jan%202013">by Anil Madhavapeddy (anil@recoil.org) at Tue, 01 Jan 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-12-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-12-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Dec%202012">Dec 2012 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/cam-snow.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/cam-snow-thumb.jpg" width="130px" /></a>
OCaml Labs kicked-off with an internal meeting of the Cambridge-based members,
who battled endless snow to make it to the meeting.
There are over 20 people involved just within the building and over 30
including those outside the University. We welcomed a few new members,
including Leo White (Postdoc), Raphael Proust (PhD student) and Stephen Dolan
(PhD student).  At this initial gathering Anil talked over some of the projects
that were already taking place in the Lab, as well as the new work that would
be supported by OCaml Labs.</p>
<p>Significant progress was made on the research side too.
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">Mirage</a> has had a flurry of new releases as we
prepare for a first public release, and we're in the final stages of being
officially incubated as a <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">xen.org project</a>.
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/illuminate.html#Signpost%20prototype">Signpost</a> is also
taking shape, mainly due to the addition of DNSSEC to the
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/illuminate.html#Signpost%20prototypew">ocaml-dns</a> implementation.
There's been industrial interest in the applications of Signpost and the team
is pursuing these for more use cases.</p>
<p>We also began work on a new website for the <a href="http://realworldocaml.org">Real World
OCaml</a>.  We took inspiration from our friends who wrote
Real World Haskell, and the site will have commenting functionality so that
people can suggest improvements before the book is finalised.  As part of this,
we also worked with a design firm to begin creating a <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign">new logo for the OCaml
language</a>.<br />
The logo will be placed into the
public domain for use by anyone.</p>
<p>Last, but certainly not least, Ashish put the new <a href="http://ocaml.org">ocaml.org</a>
website live, to much electronic <a href="https://twitter.com/jakedonham/status/281170330700095488">applause</a>.
A great way to end 2012!</p>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Dec%202012">by Anil Madhavapeddy (anil@recoil.org) at Sat, 01 Dec 2012</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/" lang="en-US"><a name="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/">System programming in OCaml &#8211; Part 2</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>Now we are going to take a look at manipulating files in OCaml. We will be focusing on the Unix file system.</p>
<p>In Unix the term &#8220;file&#8221; refers to a greater range of objects that you might expect. This includes:</p>
<ul><li>standard files like .txt, .html, .doc or .ml</li>
<li>directories (or folders if your used to windows) like /photos or /music</li>
<li>symbolic links (or shortcuts if your used to windows)</li>
<li>special files to access devices i.e. files in /dev</li>
<li>named pipe ( this is a named version of using | in the terminal )</li>
<li>sockets</li>
</ul>
<p>All files are represented by an i-node, a data structure which holds the meta-data on the file. Directories are files that map filenames to i-nodes. The directories form a tree structure, where all files are directly or indirectly children of the root directory called &#8216;/&#8217;.</p>
<p>A absolute path name of the file is one that begins at the root. A relative path name is one that begins in the current directory. Every directory has &#8216;.&#8217; and &#8216;..&#8217; which are symbolic links to the current and parent directories.</p>
<p>OCaml makes use of the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Filename.html">Filename module</a> to help handle paths in a portable manner</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/">by Heidi-ann at Thu, 29 Nov 2012</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/" lang="en-US"><a name="http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/">Ocaml 2 HTML</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><div><a href="http://1.bp.blogspot.com/-r31qRagcDkA/ULZ_402U4NI/AAAAAAAAAMg/yEQ5QdhTGnM/s1600/images.jpeg"><img alt="" border="0" src="http://1.bp.blogspot.com/-r31qRagcDkA/ULZ_402U4NI/AAAAAAAAAMg/yEQ5QdhTGnM/s1600/images.jpeg" /></a></div>
<p>As I&#8217;m often adding OCaml code to blog posts I really wanted to find an automatic way to add syntax highlighting. The first solution that I have found is <a href="http://caml.inria.fr/cgi-bin/hump.en.cgi?contrib=61">caml2html</a> but I&#8217;m still looking for something better &#8230; suggestions welcome</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/">by Heidi-ann at Wed, 28 Nov 2012</a>
</p>
</div>
</div>




<div class="entrygroup" id="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/" lang="en-US"><a name="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/">System programming in OCaml &#8211; Part 1</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>This series of articles will follow my journey through &#8220;Unix system programming in OCaml&#8221;, available as a pdf <a href="http://ocamlunix.forge.ocamlcore.org/">here</a>. After this series, I hope to move onto a series on Mirage system programming in OCaml and working with Signposts (a framework for managing end-to-end connectivity between devices using DNS infrastructure for signalling)</p>
<h4>Introducing the Sys and Unix</h4>
<div><a href="http://3.bp.blogspot.com/-1RDROc_BYpo/ULaAP6BBbLI/AAAAAAAAAMo/UmCCrs1WqOA/s1600/unix_plate.jpg"><img alt="" border="0" height="162" src="http://3.bp.blogspot.com/-1RDROc_BYpo/ULaAP6BBbLI/AAAAAAAAAMo/UmCCrs1WqOA/s320/unix_plate.jpg" width="320" /></a></div>
<p>The modules that give access to the system in OCaml are:</p>
<ul><li>Sys &#8211; functions common to all OS&#8217;s that run OCaml</li>
<li>Unix &#8211; functions specific to unix</li>
</ul>
<p>To make use of these modules in some OCaml code, we can add open Sys or/and open Unix to the top of the OCaml program.</p>
<p>NOTE that Unix and Sys can overwrite some of the functions in the Pervasive module, so to access a function from the Pervasive module you need to add Pervasives. in front of the function call.</p>
<p>When using ocamlc to compile OCaml programs that made use of&#160; Unix, you need to pass unix.cma to the compiler e.g.</p>
<p>$ ocamlc unix.cma hello.ml -o hello</p>
<p>The same is not true of sys.cma</p>
<h4>PASSING INFORMATION TO YOUR PROGRAM</h4>
<p><a href="http://4.bp.blogspot.com/-4dF_PbMKaCY/ULaAv9rtW5I/AAAAAAAAAMw/mO_Ksnyby4o/s1600/letter_tiles1.png"><img alt="" border="0" src="http://4.bp.blogspot.com/-4dF_PbMKaCY/ULaAv9rtW5I/AAAAAAAAAMw/mO_Ksnyby4o/s1600/letter_tiles1.png" /></a>Now we are going to consider 2 different ways of passing information from your terminal to your ocaml program</p>
<p>1) Passing the information as arguments to the executable. For this we are going to use Sys.argv which will return a string array of arguments passed to the program. The first index of the argument array that we use here is 1, this is because the 0th element in the array is the command used to call the program. Consider the following simple example:</p>
<div></div>
<div></div>
<div><i>open Sys;;<br />print_string argv.(1)</i></div>
<div></div>
<div>Now provided that at least one argument is passed to the program, this argument will be printed. We can now extend this program, to print the number of arguments and then exactly what the user will have just entered</div>
<div></div>
<div><i>open Sys;;</i></div>
<p>let args = Array.length argv;;<br />print_int args ;;<br />print_newline ();;<br />for i=0 to args-1 do<br />print_string argv.(i);<br />print_char &#8216; &#8216;;<br />done;</p>
<p>2a ) Passing information using the environment variables, this can be fetched from within the OCaml programing using Sys.enviroment, this will return as array of environment variables</p>
<p>open Unix;;</p>
<p>let env = environment();;<br />for i=0 to (Array.length env) -1&#160; do<br />print_string env.(i);<br />print_newline);<br />done;</p>
<p>Don&#8217;t forget then when you compile this, you need to add unix.cma to the command as we are making use of the Unix library</p>
<p>2b ) We can also lookup the values of environment variables using the Sys.getenv (or Unix.getenv) functions that takes a variable name and returns the value associated with it</p>
<p><i>open Sys;;</i></p>
<p>let var = argv.(1);;<br />print_string (getenv var)</p>
<h4>Exceptions</h4>
<p>Unless otherwise stated in the documentation, all function in the Unix module raise the exception Unix_error.</p>
<p><i>Exception Unix_error of error * string * string</i></p>
<p>The first argument is the error code, the second argument is the name of the system call that raised the error and third argument identifies the object on which the error was called.</p>
<p>If an exception reaches the top-level then the program will halt. The Unix module provides a function for clearly describing exceptions. We can make 2a use this function as follows:<br /><i><br /></i><i>open Unix;;</i><br /><i><br />let prog () =&#160; </i><br /><i>&#160; let env = environment();;<br />for i=0 to (Array.length env) -1&#160; do<br />print_string env.(i);<br />print_newline);<br />done;</i><br /><i>&#160;done;</i></p>
<p><i>&#160;handle_unix_error prog ();;</i></p>
<div><a href="http://4.bp.blogspot.com/-kgybOBLFeGU/ULaBNfKRf8I/AAAAAAAAAM4/eVjnpihDSGw/s1600/289-rule-34-no-exceptions.jpg"><img alt="" border="0" height="508" src="http://4.bp.blogspot.com/-kgybOBLFeGU/ULaBNfKRf8I/AAAAAAAAAM4/eVjnpihDSGw/s640/289-rule-34-no-exceptions.jpg" width="640" /></a></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/">by Heidi-ann at Wed, 28 Nov 2012</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-11-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-11-01"> </a>
<h1 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Nov%202012">Nov 2012 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>OCaml Labs finally opened its doors with announcements from
<a href="https://ocaml.janestreet.com/?q=node/109">Yaron</a> and
<a href="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html">Anil</a>!  Although
much of the remainder of November was spent on administration and wiring up
machines for the forthcoming <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool">test cluster</a>, we
also celebrated the acceptance of a paper on <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">Mirage</a>
to <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">ASPLOS 2013</a>.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/caml-consortium-20121101.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/caml-consortium-20121101-thumb.jpg" width="130px" /></a>
We also had a very productive visit from <a href="http://www.ocamlpro.com">OCamlPro</a>.
Fabrice, Thomas and Pierre came over to discuss the new
<a href="http://opam.ocamlpro.com">OPAM</a> package manager and the plans for building an
OCaml Platform in 2013. This was in preparation for the subsequent Consortium
meeting of the industrial board of OCaml, where Anil was able to present (and
get approved) an overview of what <a href="http://ocaml.org">ocaml.org</a> would become.
You can see the <a href="http://anil.recoil.org/slides/OCaml-Consortium-2012-OCamlLabs.pdf">slides of his talk online</a>.  An
interesting thing to note is just how broad the set of OCaml language users
are: right the way from formal methods, to systems projects, and even web
developers.</p>
<p>Since the Consortium meeting, the infrastructure behind ocaml.org is being
built out and there's already been helpful input via the
<a href="http://lists.ocaml.org/listinfo/infrastructure">infrastructure mailing list</a>.  A continuous build system has been put together for internal testing, with
support from Citrix, and <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/#opam">OPAM</a> itself continues to mature and grow in
popularity.</p>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Nov%202012">by Anil Madhavapeddy (anil@recoil.org) at Thu, 01 Nov 2012</a>
</p>
</div>
</div>



</div>
<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/2012/11/getting-to-grips-with-opam/" lang="en-US"><a name="http://hh360.user.srcf.net/blog/2012/11/getting-to-grips-with-opam/"> </a>
<h1 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2012/11/getting-to-grips-with-opam/">Getting to grips with OPAM</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h1>
<hr /><div class="entry"><div class="content"><p><code>What is OPAM ?</code></p>
<p><code>OPAM is a OCaml Package Manager. Its basic use is similar to apt-get on linux, both package managers help to automate the process of installing, removing and updating software by tracking the complex web of dependencies that exist between bodies of code.</code><br /><code>Why use OPAM ?</code></p>
<p><code>OPAM gives the user more control of the choice of specific libraries and compiler versions used to run OCaml code. </code></p>
<p><code>How to do I run OPAM ?</code></p>
<p><code>I am only going to run OPAM and not install it (long story). To do this, I executed the following from my root directory </code></p>
<p><code>wget http://opam.ocamlpro.com/build/opam64 </code></p>
<p><code>chmod +x opam64 </code></p>
<p><code>./opam64 init </code></p>
<p><code>How can install a package using OPAM ? What is the advantage over using OPAM intend of using the traditional methods ?</code></p>
<p><code>You can view the list of available packages using ./opam64 list and you can search using ./opam64 search .</code></p>
<p><code>On of the libraries used by Signposts is lwt. Lwt is a very useful library for anyone who want to do multi-threading in Ocaml. So I try the following query:</code></p>
<p><code>opam64 search lwt</code></p>
<p><code>Available packages for system:</code></p>
<p><code>cohttp&#160;&#160; --&#160; HTTP library for Lwt, Async and Mirage</code></p>
<p><code>lwt&#160;&#160; --&#160; A cooperative threads library for OCaml</code></p>
<p><code>lwt-zmq&#160;&#160; --&#160; Lwt-friendly wrapping around ZeroMQ sockets</code></p>
<p><code>release&#160;&#160; --&#160; Release is a multi-process Lwt-enabled daemon framework for OCaml.</code></p>
<p><code>The second of these results is the package that I want to install so</code></p>
<p><code>How do I install a package from a Ocaml project on Git ?</code></p>
<p><code>Firstly find the package that you want to install, for me this is git://github.com/mirage/opam-repo-dev</code></p>
<p><code>opam remote -add dev git://github.com/mirage/opam-repo-dev</code><br /><code>Now in future, when I issue opam upgrade, the latest version of the git repo will be downloaded and any depandencies recompiled </code><code></code><br /><code></code></p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2012/11/getting-to-grips-with-opam/">by Heidi-ann at Thu, 01 Nov 2012</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs"><a name="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html">Announcing the OCaml Labs project</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>I&#8217;m very excited to announce <em><a href="http://www.cl.cam.ac.uk/projects/ocamllabs">OCaml Labs</a></em>, the latest project to hit the Cambridge Computer Lab. As anyone that hangs out near me probably realises, I very much enjoy functional programming. My weapon of choice tends to be <a href="http://www.ocaml-lang.org">OCaml</a>, as it condenses <a href="http://events.inf.ed.ac.uk/Milner2012/X_Leroy-html5-mp4.html">decades of research</a> into a pragmatic blend of functional, imperative and object-oriented programming styles. What&#8217;s perhaps less well known are the steady <a href="http://www.ocaml-lang.org/companies.html">inroads</a> that OCaml has been making into mission-critical areas of industry. At <a href="http://ocaml.janestreet.com">Jane Street</a>, billions of dollars of transactions are routed through a huge ML code-base that is designed to catch bugs <a href="http://vimeo.com/14313378">at compile-time</a>. At <a href="http://github.com/xen-org/xen-api">Citrix</a>, the Xen management toolstack that powers <a href="http://blogs.citrix.com/2012/10/09/one-in-a-million/">millions</a> of hosts in the cloud is <a href="http://anil.recoil.org/papers/2010-icfp-xen.pdf">largely written in OCaml</a>. Facebook does sophisticated <a href="https://github.com/facebook/pfff/wiki/Main">static analysis</a> using OCaml over their vast PHP codebase to close security holes.</p>

<p>The OCaml community is small but dedicated, but there is always more to do to improve the language and ecosystem. So, thanks to a generous platform grant from <a href="http://ocaml.janestreet.com">Jane Street</a>, we are launching a program to help with the open-source development of OCaml from Cambridge.</p>

<p>The <em><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/">OCaml Labs</a></em> are based in the <a href="http://www.cl.cam.ac.uk">Cambridge Computer Lab</a> and led my myself, <a href="http://www.cl.cam.ac.uk/~am21/">Alan Mycroft</a> and <a href="http://www.cl.cam.ac.uk/~iml1/">Ian Leslie</a>. We&#8217;re closely affiliated with other <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/collaboration.html">groups</a>, and will be:</p>

<ul><li><p>developing the OCaml Platform, which will bundle the official OCaml compiler from INRIA with a tested set of community libraries that refreshed every six months.</p>
</li>

<li><p>working with the core OCaml team at INRIA&#8217;s <a href="http://gallium.inria.fr/">Gallium</a> group on the compiler, and with commercial partners like <a href="http://ocamlpro.com">OCamlPro</a> on tool development. OCamlPro are making some very impressive progress already with the <a href="http://opam.ocamlpro.com">OPAM</a> packge manager and <a href="http://www.typerex.org">TypeRex</a> IDE helper.</p>
</li>

<li><p>supporting the online presence with more teaching material and content. Yaron, Jason and I are working hard on a <a href="http://realworldocaml.org">new book</a> that will be published next year, and the OCaml Web team (led by <a href="http://ashishagarwal.org">Ashish</a> and <a href="https://plus.google.com/109604597514379193052/posts">Christophe</a>) have made great progress on a <a href="http://www.ocaml-lang.org">brand new website</a> that we will move to the <code>ocaml.org</code> domain soon.</p>
</li>
</ul>

<h3 id="research_efforts">Research efforts</h3>

<p>Of course, it is difficult to hack on a language in a void, and we also <em>use</em> OCaml heavily in our own research. The other half of OCaml Lab&#8217;s goals are more disruptive (and riskier!):</p>

<ul><li><p>The upcoming first beta release of <a href="http://openmirage.org">Mirage</a>, which is an operating system designed for cloud and embedded environments, and is written almost entirely from the ground up in OCaml. The outputs of Mirage include a <a href="http://www.openmirage.org/blog/breaking-up-is-easy-with-opam">large number of libraries</a> which are usable separately, such as pure implementations of TCP/IP, DNS, SSH, DHCP and HTTP. The Xen hackers, led by <a href="http://dave.recoil.org">David Scott</a>, are out in force to integrate Mirage into their <a href="http://www.xen.org/xensummit/xs12na_talks/T2.html">next-generation</a> platform. Meanwhile, Raphael Proust is busy eliminating the <a href="http://anil.recoil.org/papers/drafts/2012-places-limel-draft1.pdf">garbage collector</a> with his cut-down &#8220;LinearML&#8221; variant.</p>
</li>

<li><p>Working with our collaborators at the <a href="http://horizon.ac.uk">Horizon Institute</a> on privacy-preserving technologies such as <a href="http://anil.recoil.org/papers/2012-sigcomm-signposts-demo.pdf">Signposts</a> which let you build and maintain your own personal clouds that operate <a href="http://anil.recoil.org/papers/2011-icdcn-droplets.pdf">autonomously</a> from the central cloud. You can read more about our <a href="http://www.cam.ac.uk/research/features/privacy-by-design/">privacy-by-design</a> philosophy too.</p>
</li>

<li><p>Extending OCaml to run on secure hardware platforms that doesn&#8217;t compromise on performance, using the MIPS64-based <a href="http://www.cl.cam.ac.uk/research/security/ctsrd/cheri.html">capability processor</a> that is being developed at at the Lab.</p>
</li>

<li><p>The <a href="http://www.trilogy-project.org">Trilogy</a> was a hugely successful EU-funded effort on future evolution of the Internet, and resulted in <a href="http://trilogy-project.org/publications/standards-contributions.html">numerous RFCs</a> on subjects such as multipath-TCP. We&#8217;re partipating in the follow-up (imaginatively dubbed &#8220;Trilogy2&#8221;), and look forward to working on more structured abstractions for programming large-scale networks.</p>
</li>
</ul>

<h3 id="getting_involved">Getting involved</h3>

<p>So, how can you get involved? We are initially advertising three positions for full-time developers and researchers (<a href="http://www.jobs.cam.ac.uk/job/-21662/">junior</a> and <a href="http://www.jobs.cam.ac.uk/job/-21942/">senior</a>) to help us get started with the OCaml Platform and compiler development. These aren&#8217;t conventional pure research jobs, and a successful candidate should enjoy the open-source development cycle (you retain your own copyright for your own projects). The Computer Lab offers a pretty unique environment: a friendly, non-hierarchical group in a beautiful city, and some of the best faculty and students you could hope to hang out with.</p>

<p>And finally, there is a longer lead time on <a href="http://www.cl.cam.ac.uk/admissions/phd/">applying for PhDs</a>, but this is a great time to get involved. When I started at the Lab in 2002, a little project called <a href="http://xen.org">Xen</a> was just kicking off, and many of us had a wild (and oft great) time riding that wave. Get in touch with myself, <a href="http://www.cl.cam.ac.uk/~am21/">Alan</a>, <a href="http://www.cl.cam.ac.uk/~iml1/">Ian</a> or <a href="http://www.cl.cam.ac.uk/~jac22/">Jon</a> soon if you are interested in applying! There&#8217;s some more information available on the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/collaboration.html">OCaml Labs pages</a> about options.</p></div>







<p class="date"><a href="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html">Thu, 18 Oct 2012</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/breaking-up-is-easy-with-opam"><a name="http://openmirage.org/blog/breaking-up-is-easy-with-opam"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/breaking-up-is-easy-with-opam">Breaking up is easy to do (with OPAM)</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>When we first started developing Mirage in 2009, we were rewriting huge chunks of operating system and runtime code in OCaml. This ranged from low-level device drivers to higher-level networking protocols such as TCP/IP or HTTP.  The changes weren't just straight rewrites of C code either, but also involved experimenting with interfaces such as iteratees and <a href="http://openmirage.org/wiki/tutorial-lwt">lightweight threading</a> to take advantage of OCaml's static type system.  To make all of this easy to work with, we decided to lump everything into a <a href="http://github.com/avsm/mirage">single Git repository</a> that would bootstrap the entire system with a single <code>make</code> invocation.</p><p>Nowadays though, Mirage is self-hosting, the interfaces are settling down, the number of libraries are growing every day, and portions of it are being used in <a href="http://openmirage.org/blog/xenstore-stub-domain">the Xen Cloud Platform</a>. So for the first developer release, we wanted to split up the monolithic repository into more manageable chunks, but still make it as easy as possible for the average OCaml developer to try out Mirage.</p><p>Thanks to much hard work from <a href="http://gazagnaire.org">Thomas</a> and his colleagues at <a href="http://ocamlpro.com">OCamlPro</a>, we now have <a href="http://opam.ocamlpro.com">OPAM</a>: a fully-fledged package manager for Mirage!  OPAM is a source-based package manager that supports a growing number of community OCaml libraries.  More importantly for Mirage, it can also switch between multiple compiler installations, and so support cross-compiled runtimes and modified standard libraries.</p><p>OPAM includes compiler variants for Mirage-friendly environments for Xen and the UNIX <code>tuntap</code> backends.  The <a href="http://openmirage.org/wiki/install">installation instructions</a> now give you instructions on how to use OPAM, and the old monolithic repository is considered deprecated.  We're still working on full documentation for the first beta release, but all the repositories are on the <a href="http://github.com/mirage">Mirage organisation</a> on Github, with some of the important ones being:</p><ul> <li> <p><a href="http://github.com/mirage/mirage-platform">mirage-platform</a> has the core runtime for Xen and UNIX, implemented as the <code>OS</code> module.</p> </li><li> <p><a href="http://github.com/mirage/mirage-net">mirage-net</a> has the TCP/IP networking stack.</p> </li><li> <p><a href="http://github.com/mirage/ocaml-cstruct">ocaml-cstruct</a> has the camlp4 extension to manipulate memory like C <code>struct</code>s, but with type-safe accessors in OCaml.</p> </li><li> <p><a href="http://github.com/mirage/ocaml-xenstore">ocaml-xenstore</a> has a portable implementation of the Xenstore protocol to communicate with the Xen management stack from a VM (or even act as a <a href="http://openmirage.org/blog/xenstore-stub-domain">server in a stub domain</a>).</p> </li><li> <p><a href="http://github.com/mirage/ocaml-dns">ocaml-dns</a> is a pure OCaml implementation of the DNS protocol, including a server and stub resolver.</p> </li><li> <p><a href="http://github.com/mirage/ocaml-re">ocaml-re</a> is a pure OCaml version of several regular expression engines, including Perl compatibility.</p> </li><li> <p><a href="http://github.com/mirage/ocaml-uri">ocaml-uri</a> handles parsing the surprisingly complex URI strings.</p> </li><li> <p><a href="http://github.com/mirage/ocaml-cohttp">ocaml-cohttp</a> is a portable HTTP parser, with backends for Mirage, Lwt and Core/Async. This is a good example of how to factor out OS-specific concerns using the OCaml type system (and I plan to blog more about this soon).</p> </li><li> <p><a href="http://github.com/mirage/ocaml-cow">ocaml-cow</a> is a set of syntax extensions for JSON, CSS, XML and XHTML, which are explained <a href="http://openmirage.org/wiki/cow">here</a>, and used by this site.</p> </li><li> <p><a href="http://github.com/mirage/dyntype">ocaml-dyntype</a> uses camlp4 to <a href="http://anil.recoil.org/papers/2011-dynamics-ml.pdf">generate dynamic types</a> and values from OCaml type declarations.</p> </li><li> <p><a href="http://github.com/mirage/orm">ocaml-orm</a> auto-generates SQL scheme from OCaml types via Dyntype, and currently supports SQLite.</p> </li><li> <p><a href="http://github.com/mirage/ocaml-openflow">ocaml-openflow</a> implements an OCaml switch and controller for the Openflow protocol.</p> </li> </ul><p>There are quite a few more that are still being hacked for release by the team, but we're getting there very fast now. We also have the Mirage ports of <a href="http://github.com/avsm/ocaml-ssh">SSH</a> to integrate before the first release this year, and Haris has got some <a href="http://github.com/mirage/ocaml-crypto-keys">interesting DNSSEC</a> code!  If you want to get involved, join the <a href="http://openmirage.org/about">mailing list</a> or IRC channel!</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/breaking-up-is-easy-with-opam">by Anil Madhavapeddy (anil@recoil.org) at Wed, 17 Oct 2012</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/xenstore-stub-domain"><a name="http://openmirage.org/blog/xenstore-stub-domain"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/xenstore-stub-domain">Building a "xenstore stub domain" with Mirage</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>On all hosts running <a href="http://www.xen.org/">Xen</a>, there is a critical service called <a href="http://wiki.xen.org/wiki/XenStore">xenstore</a>. Xenstore is used to allow <b>untrusted</b> user VMs to communicate with <b>trusted</b> system VMs, so that</p><ul> <li> <p>virtual disk and network connections can be established</p> </li><li> <p>performance statistics and OS version information can be shared</p> </li><li> <p>VMs can be remotely power-cycled, suspended, resumed, snapshotted and migrated.</p> </li> </ul><p>If the xenstore service fails then at best the host cannot be controlled (i.e. no VM start or shutdown) and at worst VM isolation is compromised since an untrusted VM will be able to gain unauthorised access to disks or networks. This blog post examines how to disaggregate xenstore from the monolithic domain 0, and run it as an independent <a href="http://www.cl.cam.ac.uk/~dgm36/publications/2008-murray2008improving.pdf">stub domain</a>.</p><p>Recently in the Xen community, Daniel De Graaf and Alex Zeffertt have added support for <a href="http://lists.xen.org/archives/html/xen-devel/2012-01/msg02349.html">xenstore stub domains</a> where the xenstore service is run directly as an OS kernel in its own isolated VM. In the world of Xen, a running VM is a "domain" and a "stub" implies a single-purpose OS image rather than a general-purpose machine. Previously if something bad happened in "domain 0" (the privileged general-purpose OS where xenstore traditionally runs) such as an out-of-memory event or a performance problem, then the critical xenstore process might become unusable or fail altogether. Instead if xenstore is run as a "stub domain" then it is immune to such problems in domain 0. In fact, it will even allow us to <b>reboot</b> domain 0 in future (along with all other privileged domains) without incurring any VM downtime during the reset!</p><p>The new code in <a href="http://xenbits.xensource.com/xen-unstable.hg">xen-unstable.hg</a> lays the necessary groundwork (Xen and domain 0 kernel changes) and ports the original C xenstored to run as a stub domain.</p><p>Meanwhile, thanks to <a href="http://tab.snarc.org">Vincent Hanquez</a> and <a href="http://gazagnaire.org">Thomas Gazagnaire</a>, we also have an <a href="http://gazagnaire.org/pub/SSGM10.pdf">OCaml implementation of xenstore</a> which, as well as the offering memory-safety, also supports a high-performance transaction engine, necessary for surviving a stressful "VM bootstorm" event on a large server in the cloud. Vincent and Thomas' code is Linux/POSIX only.</p><p>Ideally we would have the best of both worlds:</p><ul> <li> <p>a fast, memory-safe xenstored written in OCaml,</p> </li><li> <p>running directly as a Xen stub domain i.e. as a specialised kernel image without Linux or POSIX</p> </li> </ul><p>We can now do both, using Mirage!  If you're saying, "that sounds great! How do I do that?" then read on...</p><p><b>Step 1: remove dependency on POSIX/Linux</b></p><p>If you read through the existing OCaml xenstored code, it becomes obvious that the main uses of POSIX APIs are for communication with clients, both Unix sockets and for a special Xen inter-domain shared memory interface. It was a fairly painless process to extract the required socket-like IO signature and turn the bulk of the server into a <a href="http://caml.inria.fr/pub/docs/manual-ocaml-4.00/manual004.html">functor</a>. The IO signature ended up looking approximately like:</p><div class="ocaml"><pre><code><span class="keyword4">type</span> t
<span class="keyword4">val</span> read<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword3">string</span> -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> <span class="keyword5">Lwt.</span>t
<span class="keyword4">val</span> write<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword3">string</span> -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t
<span class="keyword4">val</span> destroy<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t
</code></pre></div><p>For now the dependency on <a href="http://ocsigen.org/lwt/">Lwt</a> is explicit but in future I'll probably make it more abstract so we can use <a href="https://ocaml.janestreet.com/?q=node/100">Core Async</a> too.</p><p><b>Step 2: add a Mirage Xen IO implementation</b></p><p>In a stub-domain all communication with other domains is via shared memory pages and "event channels". Mirage already contains extensive support for using these primitives, and uses them to create fast network and block virtual device drivers. To extend the code to cover the Xenstore stub domain case, only a few tweaks were needed to add the "server" side of a xenstore ring communication, in addition to the "client" side which was already present.</p><p>In Xen, domains share memory by a system of explicit "grants", where a client (called "frontend") tells the hypervisor to allow a server (called "backend") access to specific memory pages. Mirage already had code to create such grants, all that was missing was a few simple functions to receive grants from other domains.</p><p>These changes are all in the current <a href="https://github.com/mirage/mirage-platform">mirage-platform</a> tree.</p><p><b>Step 3: add a Mirage Xen "main" module and Makefile</b></p><p>The Mirage "main" module necessary for a stub domain looks pretty similar to the normal Unix userspace case except that it:</p><ul> <li> <p>arranges to log messages via the VM console (rather than a file or the network, since a disk or network device cannot be created without a working xenstore, and it's important not to introduce a bootstrap problem here)</p> </li><li> <p>instantiates the server functor with the shared memory inter-domain IO module.</p> </li> </ul><p>The Makefile looks like a regular Makefile, invoking ocamlbuild. The whole lot is built with <a href="http://oasis.forge.ocamlcore.org/">OASIS</a> with a small extension added by <a href="http://anil.recoil.org/">Anil</a> to set a few options required for building Xen kernels rather than regular binaries.</p><p>... and it all works!</p><p>The code is in two separate repositories:</p><ul> <li> <p><a href="https://github.com/djs55/ocaml-xenstore">ocaml-xenstore</a>: contains all the generic stuff</p> </li><li> <p><a href="https://github.com/djs55/ocaml-xenstore-xen">ocaml-xenstore-xen</a>: contains the unix userspace and xen stub domain IO modules and "main" functions</p> </li><li> <p>(optional) To regenerate the OASIS file, grab the <code>add-xen</code> branch from this <a href="http://github.com/avsm/oasis">OASIS fork</a>.</p> </li> </ul><p><b>Example build instructions</b></p><p>If you want to try building it yourself, try the following on a modern 64-bit OS. I've tested these instructions on a fresh install of Debian Wheezy.</p><p>First install OCaml and the usual build tools:</p><div class="ocaml"><pre><code>apt-get install ocaml build-essential git curl rsync
</code></pre></div><p>Then install the OCamlPro <code>opam</code> package manager to simplify the installation of extra packages</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/OCamlPro/opam.git
cd opam
make
make install
cd ..
</code></pre></div><p>Initialise OPAM with the default packages:</p><div class="ocaml"><pre><code>opam --yes init
eval `opam config -env`
</code></pre></div><p>Add the "mirage" development package source (this step will not be needed once the package definitions are upstreamed)</p><div class="ocaml"><pre><code>opam remote -add dev git<span class="keyword2">:</span>//github.com/mirage/opam-repo-dev
</code></pre></div><p>Switch to the special "mirage" version of the OCaml compiler</p><div class="ocaml"><pre><code>opam --yes switch -install <span class="keyword8">3</span>.<span class="keyword8">12</span>.<span class="keyword8">1</span><span class="keyword2">+</span>mirage-xen
opam --yes switch <span class="keyword8">3</span>.<span class="keyword8">12</span>.<span class="keyword8">1</span><span class="keyword2">+</span>mirage-xen
eval `opam config -env`
</code></pre></div><p>Install the generic Xenstore protocol libraries</p><div class="ocaml"><pre><code>opam --yes install xenstore
</code></pre></div><p>Install the Mirage development libraries</p><div class="ocaml"><pre><code>opam --yes install mirage
</code></pre></div><p>If this fails with "+ runtime/dietlibc/lib/atof.c:1: sorry, unimplemented: 64-bit mode not compiled in" it means you need a 64-bit build environment. Next, clone the xen stubdom tree</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/djs55/ocaml-xenstore-xen
</code></pre></div><p>Build the Xen stubdom</p><div class="ocaml"><pre><code>cd ocaml-xenstore-xen
make
</code></pre></div><p>The binary now lives in <code>xen/_build/src/server_xen.xen</code></p><p><b>Deploying on a Xen system</b></p><p>Running a stub Xenstored is a little tricky because it depends on the latest and greatest Xen and Linux PVops kernel. In the future it'll become much easier (and probably the default) but for now you need the following:</p><ul> <li> <p>xen-4.2 with XSM (Xen Security Modules) turned on</p> </li><li> <p>A XSM/FLASK policy which allows the stubdom to call the "domctl getdomaininfo". For the moment it's safe to skip this step with the caveat that xenstored will leak connections when domains die.</p> </li><li> <p>a Xen-4.2-compatible toolstack (either the bundled xl/libxl or xapi with <a href="http://github.com/djs55/xen-api/tree/xen-4.2">some patches</a>)</p> </li><li> <p>Linux-3.5 PVops domain 0 kernel</p> </li><li> <p>the domain builder binary <code>init-xenstore-domain</code> from <code>xen-4.2/tools/xenstore</code>.</p> </li> </ul><p>To turn the stub xenstored on, you need to edit whichever <code>init.d</code> script is currently starting xenstore and modify it to call</p><div class="ocaml"><pre><code>init-xenstore-domain /path/<span class="keyword1">to</span>/server_xen.xen <span class="keyword8">256</span> flask_label
</code></pre></div> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/xenstore-stub-domain">by Dave Scott (dave@recoil.org) at Wed, 12 Sep 2012</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2012/07/31/the-functional-week"><a name="http://anil.recoil.org/2012/07/31/the-functional-week"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2012/07/31/the-functional-week.html">Why you should go to ICFP 2012</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>Functional programming has been gaining popularity pretty rapidly recently. We&#8217;ve got serious projects from big Internet shops (<a href="http://cufp.org/videos/f-embracing-functional-programming-visual-studio-2010-luke-hoban-mic">Microsoft</a>, <a href="http://cufp.org/videos/large-scale-internet-services-using-scala">Twitter</a> and <a href="http://cufp.org/videos/functional-programming-facebook">Facebook</a>), to varied domains such as <a href="http://cufp.org/videos/fourteen-days-haskell">radio</a>, <a href="http://cufp.org/videos/functional-programming-freebase-warren-harris-metaweb">knowledge
bases</a>, <a href="http://cufp.org/videos/discrete-event-simulation-using-erlang">the energy
grid</a>, <a href="http://cufp.org/videos/theorem-based-derivation-aes-implementation">cryptography</a>, NoSQL <a href="http://cufp.org/conference/sessions/2010/riak-core-building-distributed-applications-withou">databases</a> and <a href="http://cufp.org/videos/ocaml-and-acunu-experience-report">storage</a>, intricate <a href="http://cufp.org/videos/functional-mzscheme-dsls-game-development">PS3 games</a>, and even <a href="http://cufp.org/videos/model-based-testing-autosar-automotive-components">making
safer cars</a>. Throughout all of this, one conference has been around since the very beginning: the <a href="http://icfpconference.org/">ACM SIGPLAN
International Conference on Functional Programming</a>. The early days consisted of academics (some with fine <a href="http://homepages.inf.ed.ac.uk/wadler/">beards</a> and <a href="http://research.microsoft.com/en-us/people/simonpj/">sandals</a>) developing the tools and theories behind FP, and spawned the famous <a href="http://en.wikipedia.org/wiki/ICFP_Programming_Contest">ICFP Programming Contest</a>. The modern ICFP, however, also caters to the practical industry practitioner at all levels of knowledge, and this blog post is meant to introduce you to what to expect this year.</p>

<p>ICFP 2012 is a week-long <a href="http://www.icfpconference.org/icfp2012/">conference</a> on September 9-15th, held in beautiful Copenhagen. The theory-oriented workshops are held just before the main event on Sunday, on topics such as <a href="http://workshops.inf.ed.ac.uk/xldi2012/">cross-model</a>, <a href="http://www.wgp-sigplan.org/2012">generic</a> and <a href="http://hope2012.mpi-sws.org">higher-order</a> programming. The main conference lasts three days, with a <a href="http://www.icfpconference.org/icfp2012/program.html">combination</a> of academic papers and experience reports that are formally published by the ACM (see my <a href="http://anil.recoil.org/papers/2010-icfp-xen.pdf">experience report</a> or a <a href="http://thomas.gazagnaire.org/pub/GH09.pdf">Xenstored full paper</a> for two Xen-related publications).</p>

<p>The main conference finishes mid-week, and the focus switches to more informal, interactive workshops that are relevant to the FP practitioner. The <a href="http://anil.recoil.org/feeds/atom-ocaml.xml#icfpreg">registration system</a> lets you buy a day pass and attend any combination, so here&#8217;s a list that I&#8217;ve come up, along with &#8220;who&#8221; it is intended for. Needless to say, these are my personal views (although I&#8217;m co-chairing CUFP and the OCaml Workshop, and any mistakes there would be bad!).</p>

<h2 id="commercial_users_of_functional_programming_">Commercial Users of Functional Programming (<a href="http://cufp.org/conference/schedule">CUFP</a>)</h2>

<p>CUFP has been going since <a href="http://cufp.org/archive/2004/main.html">2004</a>, acting as a voice for commercial users of functional programming languages and technology. CUFP is the biggest workshop at ICFP and spread over <a href="http://cufp.org/conference/schedule/2012">the last three days</a> of the conference week.</p>

<ul><li><p><em>Never done any Functional Programming before</em>: For the first time, CUFP offers day-long tutorials for complete beginners to functional programming. You can spend a full day learning the basics of <a href="http://cufp.org/conference/sessions/2012/scala-primer-heiko-seeberger-typesafe">Scala</a> or two days on <a href="http://cufp.org/conference/sessions/2012/introductory-haskell-concurrent-haskell-jeremy-gib">Haskell</a> (including concurrency and multicore). These tutorials are separate events with their own <a href="http://anil.recoil.org/feeds/atom-ocaml.xml#icfpreg">registrations</a> so you can attend just them if you wish, and still meet the other attendees during the regular breaks and evening events.</p>
</li>

<li><p><em>Done some FP, and want to improve or learn a new language</em>: There are half-day tutorials that are more focussed on specific topics: real-world <a href="http://cufp.org/conference/sessions/2012/t1-real-world-ocaml-anil-madhavapeddy-university-c">OCaml</a> (by me and Yaron!), <a href="http://cufp.org/conference/sessions/2012/t4-hands-real-world-clojure-lau-jensen-best-class-">Clojure</a> and <a href="http://cufp.org/conference/sessions/2012/functional-concepts-real-world-f-tomas-petricek-un">F#</a>, and popular web frameworks in <a href="http://cufp.org/conference/sessions/2012/t2-erlang-web-frameworks-steve-vinoski-basho-techn">Erlang</a> and <a href="http://cufp.org/conference/sessions/2012/t3-haskell-lazy-web-developer-introduction-happsta">Haskell</a>.</p>
</li>

<li><p><em>There&#8217;s safety in crowds</em>: <a href="http://anil.recoil.org/images/icfp2011-4.jpg"><img align="right" alt="Team Twitter talking about Scala at CUFP 2011" src="http://anil.recoil.org/images/icfp2011-4-thumb.jpg" width="120" /></a>The final day of CUFP (on Saturday 15th) is a full day of experience reports from industry speakers who have applied FP techniques to their day-to-day work. These talks are not intended to be deeply technical, but instead reflect on the social and engineering challenges around integrating a new (and often risky) technology into an existing business. The sessions <a href="http://cufp.org/conference/schedule">this year</a> are diverse, with talks from Citrix on client-side cloud computing, on building NoSQL databases, and a number of talks on biotech (<a href="http://cufp.org/conference/sessions/2012/ashish-agarwal-nyu-functional-big-data-genomics">bigdata</a>, <a href="http://cufp.org/conference/sessions/2012/adam-granicz-intellifactory-developing-f-bioinform">visualisation</a> and <a href="http://cufp.org/conference/sessions/2012/stefan-wehr-factis-research-developing-medical-sof">medical software</a>), developing <a href="http://cufp.org/conference/sessions/2012/sebastian-egner-entelios-functional-programs-conne">real-time</a> and <a href="http://cufp.org/conference/sessions/2012/kevin-lynagh-keming-labs-clojure-ipad-analytics-da">offline</a> analytics for national power grids, and even using FP to write software that runs directly on <a href="http://cufp.org/conference/sessions/2012/peter-braam-parallel-scientific-awesome-haskell-fp">FPGAs</a> (including directly on a new 10GBs switch from <a href="http://aristanetworks.com">Arista networks</a>). We really try to make this talk session a balanced view of the upsides and downsides of using FP, and encourage speakers to relate what went <em>wrong</em> as well as right in their experiences.</p>
</li>

<li><p><em>CTO/executive, aka &#8220;schmoozing&#8221;</em>: A huge part of CUFP is the great networking between engineers and academics (with job-hunting grad students thrown into the mix). There are regular breaks which are full of animated conversations, and we are planning an industrial reception where vendors can show off their wares (either on Thursday or Friday) where you find commercial support, or recruit bright graduate students from top schools across the world. The breaks are also a chance to corner your favourite language hacker-professor and make them aware of your particular needs!</p>
</li>
</ul>

<p>I&#8217;m co-chairing CUFP this year along with <a href="http://www.deinprogramm.de/sperber/">Michael Sperber</a>, so feel free to direct any questions you have about it to us, and see below for <a href="http://anil.recoil.org/feeds/atom-ocaml.xml#icfpreg">registration information</a>.</p>

<h2 id="language_workshops">Language Workshops</h2>

<p>Some of the bigger communities have <a href="http://www.icfpconference.org/icfp2012/affiliated.html">day-long workshops</a> which are a combination of short presentations and regular breaks for discussions. If you are using (or just considering the use of) these languages, then these are a good way to meet all the right people who could help you with your efforts.</p>

<h3 id="ocaml_and_ml">OCaml and ML</h3>

<p>I&#8217;m co-chairing the first <a href="http://oud.ocaml.org">OCaml Users and Developers</a> workshop on Friday (Sep 14th). This event has traditionally been run in Paris in <a href="http://anil.recoil.org/feeds/coil.org/2011/04/15/ocaml-users-group.html">past years</a>, but we decided it was getting big enought to run alongside ICFP. The <a href="http://cufp.org/conference/sessions/2012/peter-braam-parallel-scientific-awesome-haskell-fp">talk schedule</a> is a mix of experience reports and pratical new toolchain developments. There will be talks on all the latest development tools (memory profiling, concurrent programming), standard library efforts (<a href="https://bitbucket.org/yminsky/ocaml-core">Core</a>, <a href="http://github.com/OCamlPro/opam">OPAM</a> packaging), as well as experience reports (the <a href="http://arakoon.org">Arakoon k/v store</a>, <a href="http://www.xen.org/products/cloudxen.html">Xen Cloud</a>, and building <a href="http://blog.ashimagroup.net/2011/04/22/exploring-the-moon-with-webgl-and-ocaml/">3D WebGL engines for NASA</a>, among others). The hot topic at this workshop is the emerging consensus on building a more integrated OCaml Platform that acts as a stable base for larger applications, and the state-of-the-world talks from Xavier Leroy, Yaron Minsky and Fabrice le Fessant will no doubt kick off heated discussions that will go on late into dinner (last year, we all ended up in a very fine Tokyo restaurant drinking sake and arguing about GADTs and the global financial crisis).</p>

<p>OCaml is the most widely used variant of the <a href="http://en.wikipedia.org/wiki/ML_(programming_language)">ML family</a>, and the <a href="http://www.lexifi.com/ml2012/">ML workshop</a> on the day before (Sep 13) takes a broader view on the theory and implementations of ML. Talks here include the <a href="http://www.lexifi.com/ml2012/abstract_coq.txt">Coq theorem prover</a>, efficient implementations of OCaml <a href="http://www.lexifi.com/ml2012/abstract_9.txt">running on the JVM</a>, <a href="http://www.lexifi.com/ml2012/abstract_10.txt">multicore-ML</a>, and experimental extensions to ML-style programming (<a href="http://www.lexifi.com/ml2012/abstract_1.txt">effect tracking</a>, <a href="http://www.lexifi.com/ml2012/abstract_3.txt">model checking</a>, <a href="http://www.lexifi.com/ml2012/abstract_15.txt">applicative functors</a>, and <a href="http://www.lexifi.com/ml2012/abstract_7.txt">GADTs</a>).</p>

<p>Both of these workshops are convenient to attend over a two-day period (Thu and Fri), and will give you a huge amount of information about the latest developments in the land of ML.</p>

<h3 id="haskell">Haskell</h3>

<p>The Haskell community has been growing <a href="https://plus.google.com/115274377971493973150/posts/SK3urbQxcaf">rather fast</a> over the last few years, and so there are two separate days of talks.</p>

<p>The <a href="http://www.haskell.org/haskell-symposium/2012/">Haskell Symposium</a> has formal published proceedings, and consists of a diverse array of research work that has direct implications on the future of Haskell. My personal highlights include the <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/ndp/haskell12-lippmeier.pdf">parallel array fusion</a> and vectorisation for data processing on modern hardware, the intriguing &#8220;Wormhole&#8221; effect-tracking FRP, and <a href="http://www.haskell.org/ghc/docs/7.2.2/html/users_guide/safe-haskell.html">Safe Haskell</a> for practical information-flow tracking.</p>

<p>The second day has the <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2012">Haskell Implementors Workshop</a>, which is a more informal affair aimed at the day-to-day infrastructure and toolchain needs of Haskell. The schedule includes overview talks from the two Simons, and ongoing work on <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2012/deVries">distributed programming</a> and <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2012/Stutterheim">Javascript compilation</a>.</p>

<p>So if you are after a broad overview of Haskell then attend the Symposium, and if you wish to join the Haskell Hogwarts and start compiler hacking, then the implementors workshop will have all the right people to help you out.</p>

<h3 id="erlang">Erlang</h3>

<p>The <a href="http://www.cse.chalmers.se/~rjmh/EWCFP.html">Erlang workshop</a> at ICFP has been running for eleven years now, and tends to be a combination of big projects and work-in-progress reports. This year has the latest on porting Erlang to use <a href="http://www.softlab.ntua.gr/~gtsiour/files/erllvm_pres-20111107.pdf">LLVM</a> for high-performance computing, as well as experience reports on scalability testing and the widely-used <a href="http://wiki.basho.com">Riak</a> distributed database. Despite my prelediction towards static typing, Erlang is a language that I keep intending to make bigger use of, so I plan to drop into this session for sure.</p>
<table align="center" width="90%"><tbody><tr><td class="bimg" width="30%"><a href="http://anil.recoil.org/images/icfp2011-1.jpg"><img border="0" src="http://anil.recoil.org/images/icfp2011-1-thumb.jpg" width="120" /></a><br /><i>Last year we had to learn Japanese, the hardest functional language</i></td>
<td class="bimg" width="30%"><a href="http://anil.recoil.org/images/icfp2011-2.jpg"><img border="0" src="http://anil.recoil.org/images/icfp2011-2-thumb.jpg" width="120" /></a><br /><i>We also made a lot of new local friends</i></td>
<td class="bimg" width="30%"><a href="http://anil.recoil.org/images/icfp2011-3.jpg"><img border="0" src="http://anil.recoil.org/images/icfp2011-3-thumb.jpg" width="120" /></a><br /><i>Luckily, the weather made us feel at home though</i></td>
</tr>
</tbody></table><a name="icfpreg">&#160;</a>
<h2 id="registration">Registration</h2>

<p>This has been a whirlwind tour of the ICFP week (or rather, me writing this down while planning my own schedule). The early registration deadline is <em>next week</em> (Aug 9th), and the <b><a href="http://www.icfpconference.org/icfp2012/registration.html">online registration</a></b> has all the details of the full schedule and day prices. There is also <a href="http://www.icfpconference.org/icfp2012/local.html">local information</a> about where to stay and visit in Copenhagen, if you want to take a late-summer break while making the trip.</p>

<p>Something worth noting is that all of this is run under the auspices of the ACM by volunteers, which accounts for the somewhat chaotic spread of information across all the websites. We&#8217;ve tried to demystify the CUFP process <a href="http://cufp.org/cufp-2012-registration">here</a>, but <em>please</em> get in touch with any of the organisers if you are confused and want some help. We always welcome volunteer offers too, and the first round of drinks is on me for anyone who helps out during the week!</p></div>







<p class="date"><a href="http://anil.recoil.org/2012/07/31/the-functional-week.html">Mon, 30 Jul 2012</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/announcing-mirage-openflow"><a name="http://openmirage.org/blog/announcing-mirage-openflow"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/announcing-mirage-openflow">Connected Cloud Control: OpenFlow in Mirage</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>[<b>N.B.  Due to continuing development, some of the details in this blog post are now out-of-date. It is archived here.</b> ]</p><p>Something we've been working on for a little while now that we're pretty excited about is an <a href="http://openflow.org/">OpenFlow</a> implementation for Mirage. For those who're not networking types, in short, OpenFlow is a protocol and framework for devolving network control to software running on platforms other than the network elements themselves. It consists of three main parts:</p><ul> <li> <p>a <b>controller</b>, responsible for exercising control over the network;</p> </li><li> <p><b>switches</b>, consisting of switching hardware, with flow tables that apply forwarding behaviours to matching packets; and</p> </li><li> <p>the <b>protocol</b>, by which controllers and switches communicate.</p> </li> </ul><p>For more -- and far clearer! -- explanations, see any of the many online OpenFlow resources such as <a href="http://openflowhub.org">OpenFlowHub</a>.</p><p>Within Mirage we have an OpenFlow implementation in two parts: individual libraries that provide controller and switch functionality. Linking the switch library enables your application to become a software-based OpenFlow switch. Linking in the controller library enables your application to exercise direct control over OpenFlow network elements.</p><p>The controller is modelled after the <a href="http://noxrepo.org/">NOX</a> open-source controller and currently provides only relatively low-level access to the OpenFlow primitives: a very cool thing to build on top of it would be a higher-level abstraction such as that provided by <a href="http://haskell.cs.yale.edu/?page_id=376">Nettle</a> or <a href="http://www.frenetic-lang.org/">Frenetic</a>.</p><p>The switch is primarily intended as an experimental platform -- it is hopefully easier to extend than some of the existing software switches while still being sufficiently high performance to be interesting!</p><p>By way of a sample of how it fits together, here's a skeleton for a simple controller application:</p><div class="ocaml"><pre><code><span class="keyword4">type</span> mac_switch <span class="keyword2">=</span> <span class="keyword2">{</span>
  addr<span class="keyword2">:</span> <span class="keyword5">OP.</span>eaddr<span class="keyword2">;</span>
  switch<span class="keyword2">:</span> <span class="keyword5">OP.</span>datapath_id<span class="keyword2">;</span>
<span class="keyword2">}</span>

<span class="keyword4">type</span> switch_state <span class="keyword2">=</span> <span class="keyword2">{</span>
  <span class="keyword1">mutable</span> mac_cache<span class="keyword2">:</span>
        <span class="keyword2">(</span>mac_switch, <span class="keyword5">OP.</span><span class="keyword5">Port.</span>t<span class="keyword2">)</span> <span class="keyword5">Hashtbl.</span>t<span class="keyword2">;</span>
  <span class="keyword1">mutable</span> dpid<span class="keyword2">:</span> <span class="keyword5">OP.</span>datapath_id <span class="keyword3">list</span>
<span class="keyword2">}</span>

<span class="keyword4">let</span> switch_data <span class="keyword2">=</span> <span class="keyword2">{</span>
  mac_cache <span class="keyword2">=</span> <span class="keyword5">Hashtbl.</span>create <span class="keyword8">7</span><span class="keyword2">;</span>
  dpid <span class="keyword2">=</span> <span class="keyword2">[</span><span class="keyword2">]</span><span class="keyword2">;</span>
<span class="keyword2">}</span>

<span class="keyword4">let</span> join_cb controller dpid evt <span class="keyword2">=</span>
  <span class="keyword4">let</span> dp <span class="keyword2">=</span> <span class="keyword1">match</span> evt <span class="keyword1">with</span>
      <span class="keyword2">|</span> <span class="keyword5">OE.Datapath_join </span>c -<span class="keyword2">&gt;</span> c
      <span class="keyword2">|</span> <span class="keyword8">_</span> -<span class="keyword2">&gt;</span> invalid_arg <span class="keyword7">"bogus datapath_join"</span>
  <span class="keyword4">in</span>
  switch_data.dpid <span class="keyword2">&lt;</span>- switch_data.dpid <span class="keyword2">@</span> <span class="keyword2">[</span>dp<span class="keyword2">]</span>

<span class="keyword4">let</span> packet_in_cb controller dpid evt <span class="keyword2">=</span>
  <span class="comments">(* algorithm details omitted for space *)</span>

<span class="keyword4">let</span> init ctrl <span class="keyword2">=</span>
  <span class="keyword5">OC.</span>register_cb ctrl <span class="keyword5">OE.DATAPATH_JOIN </span>join_cb<span class="keyword2">;</span>
  <span class="keyword5">OC.</span>register_cb ctrl <span class="keyword5">OE.PACKET_IN </span>packet_in_cb

<span class="keyword4">let</span> main <span class="keyword2">(</span><span class="keyword2">)</span> <span class="keyword2">=</span>
  <span class="keyword5">Net.</span><span class="keyword5">Manager.</span>create <span class="keyword2">(</span><span class="keyword1">fun</span> mgr interface id -<span class="keyword2">&gt;</span>
    <span class="keyword4">let</span> port <span class="keyword2">=</span> <span class="keyword8">6633</span> <span class="keyword4">in</span>
    <span class="keyword5">OC.</span>listen mgr <span class="keyword2">(</span>None, port<span class="keyword2">)</span> init
  <span class="keyword2">)</span>
</code></pre></div><p>We've written up some of the gory details of the design, implementation and performance in a <a href="http://openmirage.org/docs/iccsdn12-mirage.pdf">short paper</a> to the <a href="http://www.ieee-icc.org/">ICC</a> <a href="http://sdn12.mytestbed.net/">Software Defined Networking</a> workshop. Thanks to some sterling work by <a href="http://www.cl.cam.ac.uk/~cr409/">Haris</a> and <a href="mailto:balraj.singh@cl.cam.ac.uk">Balraj</a>, the headline numbers are pretty good though: the unoptimised Mirage controller implementation is only 30--40% lower performance than the highly optimised NOX <b>destiny-fast</b> branch, which drops most of the programmability and flexibility of NOX; but is about <b>six times</b> higher performance than the fully flexible current NOX release. The switch's performance  running as a domU virtual machine is indistinguishable from the current <a href="http://openvswitch.org/">Open vSwitch</a> release.</p><p>For more details see <a href="http://openmirage.org/docs/iccsdn12-mirage.pdf">the paper</a> or contact <a href="mailto:mort@cantab.net">Mort</a>, <a href="mailto:charalampos.rotsos@cl.cam.ac.uk">Haris</a> or <a href="mailto:anil@recoil.org">Anil</a>. Please do get in touch if you've any comments or questions, or you do anything interesting with it!</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/announcing-mirage-openflow">by Richard Mortier (mort@cantab.net) at Wed, 29 Feb 2012</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml"><a name="http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml.html">Dreaming of an ARM OCaml</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><a href="http://www.flickr.com/photos/tlamer/5693063642/" title="dreamplug by tlamer, on Flickr"><img align="right" alt="dreamplug" height="134" src="http://farm6.staticflickr.com/5230/5693063642_47aa7c4c99.jpg" width="200" /></a>
<p>I&#8217;ve been meaning to play with <a href="http://www.plugcomputer.org/">Plug Computers</a> for some time now, as I need a low-power embedded system around the house. I recently bought a <a href="http://soekris.com/products/net6501.html">Soekris Net6501</a> (a pretty powerful Intel CPU, that even has VT support), but had annoying <a href="http://marc.info/?l=soekris-tech&amp;m=132915532912206&amp;w=2">issues</a> getting it working reliably. I ordered an ARM-based <a href="http://www.newit.co.uk/shop/products.php?cat=21">Dreamplug</a> as an alternative (and as a bonus, the Dreamplug is 6x cheaper than the Soekris!). Here are my notes on getting it to work.</p>

<p>Requirements:</p>

<ul><li>Aside from the Dreamplug itself, make sure you order the optional JTAG module. This provides a serial console that is essential to getting any development done with it.</li>

<li>I also grabbed the extra 16GB Class 10 SLC SD Card, to act as my home directory.</li>

<li>You will also need another functional system running Debian (or a VM on your Mac; whatever is easiest). The JTAG drivers for the USB serial are easiest to get running on Linux.</li>
</ul>

<p>The Dreamplug arrived with a working installation, but running the absolutely ancient Debian Lenny. A dist-upgrade through to Wheezy led to bricking it almost immediately, and so I did a fresh installation from scratch.</p>

<p>For a fresh installation, place a USB stick of suitable size (greater than 2GB is best) into your functional Debian installation. Then:</p>

<ul><li><p>The Marvell bootloader boots from a VFAT partition, so you will need two partitions. The first should be a small <code>fat16</code> (I picked 150MB) and the remainder an <code>ext3</code> partition for Linux itself. There are good instructions available on the <a href="https://trac.torproject.org/projects/tor/wiki/doc/DebianDreamPlug">Tor/Dreamplug</a> wiki which show you how to do this.</p>
</li>

<li><p>I grabbed the latest kernel (at this time, 3.2.7) from <a href="http://sheeva.with-linux.com/sheeva/3/3.2/3.2.7/">with-linux</a>, and installed it with the following commands (assuming your USB stick is <code>/dev/sdb</code>).</p>
</li>
</ul>
<div class="highlight"><pre><code class="sh">	<span class="nv">$ </span>sudo mount /dev/sdb1 /mnt
	<span class="nv">$ </span>sudo cp uImage /mnt
	<span class="nv">$ </span>sudo umount /mnt
	
</code></pre>
</div>
<ul><li><p>You now need to use <code>debootstrap</code> to install a fresh root image. Because it is ARM and your main PC is probably an x86, you will need to setup the QEMU CPU emulator. An extremely cool feature of QEMU is that it can do <a href="http://wiki.debian.org/QemuUserEmulation">transparent emulation</a> of foreign binaries, so you can chroot directly into the ARM filesystem and run commands as if they were x86. The <code>qemu-deboostrap</code> command will take care of this for you, if you perform the steps below (again, assuming your USB stick is <code>/dev/sdb</code>).</p>
</li>
</ul>
<div class="highlight"><pre><code class="sh">	<span class="nv">$ </span>sudo apt-get install qemu-user-static debootstrap
	<span class="nv">$ </span>sudo mount /dev/sdb2 /mnt
	<span class="nv">$ </span>sudo mkdir -p /mnt/usr/bin
	<span class="nv">$ </span>sudo cp /usr/bin/qemu-arm-static /mnt/usr/bin/
	<span class="nv">$ </span>sudo qemu-debootstrap --arch<span class="o">=</span>armel wheezy http://ftp.uk.debian.org/debian/
	
</code></pre>
</div>
<ul><li><p>Now grab the kernel modules from the same place as your uImage (for 3.2.7, from <a href="http://sheeva.with-linux.com/sheeva/3/3.2/3.2.7/sheeva-3.2.7-Modules.tar.gz">here</a>). Then, chroot into your fresh installation and untar them.</p>
</li>
</ul>
<div class="highlight"><pre><code class="sh">	<span class="nv">$ </span><span class="nb">cd</span> /mnt
	<span class="nv">$ </span>sudo tar -zxvf ~/sheeva-3.2.7-Modules.tar.gz
	<span class="nv">$ </span>sudo chroot /mnt
	<span class="nv">$ </span>depmod -a
	<span class="c"># edit /etc/network/interfaces</span>
	<span class="c"># edit /etc/resolv.conf</span>
	
</code></pre>
</div>
<ul><li><p>The wireless setup involves some extremely crap firmware which relentlessly kernel panicked for me, so I just disabled it by adding the following to <code>/etc/modprobe.d/dpwifiap.conf</code>, as I only want wired access:</p>
</li>
</ul>
<div class="highlight"><pre><code class="sh">	blacklist libertas
	blacklist libertas_sdio
	
</code></pre>
</div>
<ul><li>From there on, put the USB stick into the Dreamplug, and follow the rest of the boot instructions from the <a href="https://trac.torproject.org/projects/tor/wiki/doc/DebianDreamPlug">Tor wiki</a> to interact with the Marvell BIOS and boot from the USB stick. I copied the contents of the USB stick onto the internal MicroSD, and it all boots standalone now.</li>
</ul>

<h2 id="ocaml_on_arm">OCaml on ARM</h2>

<p>One of the reasons I wanted an ARM-based setup is to experiment with the OCaml native code generation. <a href="http://www.home.unix-ag.org/bmeurer/index.html">Benedikt Meurer</a> has been doing some excellent work on <a href="http://old.nabble.com/New-ARM-backend-merged-into-trunk-td33262083.html">improving code generation</a> for embedded systems, including support for 16-bit Thumb code, exception backtraces, and dynamic linking and profiling.</p>

<p>Once Linux was up and running, compiling up the latest ocaml-trunk was straightforward.</p>
<div class="highlight"><pre><code class="bash">	<span class="nv">$ </span>sudo apt-get install build-essential git
	<span class="nv">$ </span>git clone http://github.com/OCamlPro/ocp-ocaml svn-trunk
	<span class="nv">$ </span><span class="nb">cd </span>ocp-ocaml
	<span class="nv">$ </span>./configure <span class="o">&amp;&amp;</span> make world opt opt.opt install
	
</code></pre>
</div>
<p>This compiles the bytecode and native code compilers, and then compiles them again using the native code generator. This takes a while to do on the poor little ARM CPU. Once that finished, I compiled up a few simple modules and they worked great! Since the trunk of OCaml is a development branch, you may run into a few packaging issues (use the very latest OASIS to regenerate any <code>setup.ml</code>, and you will need a small patch until <a href="http://caml.inria.fr/mantis/view.php?id=5503">PR 5503</a> is applied).</p>

<p>Incidentally, if anyone is interested in working on a <a href="http://openmirage.org">Mirage</a> port to ARM as an internship in the <a href="http://www.cl.cam.ac.uk/research/srg/netos/">Cambridge Computer Lab</a>, do get in touch with me&#8230;</p></div>







<p class="date"><a href="http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml.html">Sat, 25 Feb 2012</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/an-outing-to-cufp"><a name="http://openmirage.org/blog/an-outing-to-cufp"> </a>
<h1 class="posttitle"><a href="http://openmirage.org/blog/an-outing-to-cufp">An Outing to CUFP 2011</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h1>
<hr /><div class="entry"><div class="content"><div>      <p>The team signed up to do a tutorial at <a href="http://cufp.org">CUFP</a> on the topic of <a href="http://cufp.org/conference/sessions/2011/t3-building-functional-os">Building a Functional OS</a>, which meant zooming off to Tokyo!  This was the first public show of the project, and resulted in a furious <a href="https://github.com/avsm/mirage/graphs/impact">flurry of commits</a> from the whole team to get it ready. The 45-strong crowd at the tutorial were really full of feedback, and particular thanks to <a href="http://www.deinprogramm.de/sperber/">Michael</a> for organising the event, and <a href="http://ocaml.janestreet.com/?q=blog/5">Yaron</a>, <a href="http://monkey.org/~marius/">Marius</a>, <a href="https://twitter.com/#!/stevej">Steve</a>, <a href="https://twitter.com/wil">Wil</a>, <a href="https://twitter.com/#!/adoemon">Adrian</a> and the rest for shouting out questions regularly!</p><ul> <li> <p><b>The tutorial</b> is <a href="http://github.com/avsm/mirage-tutorial">a Mirage application</a>, so you can clone it and view it locally through your web browser. The content is mirrored at <a href="http://tutorial.openmirage.org">tutorial.openmirage.org</a>, although it does require cleanup to make it suitable to an online audience. The SVG integration is awkward and it only works on Chrome/Safari, so I will probably rewrite it using <a href="http://imakewebthings.github.com/deck.js/">deck.js</a> soon. The tutorial is a good showcase of Mirage, as it compiles to Xen, UNIX (both kernel sockets and direct tuntap) with a RAMdisk or external filesystem, and is a good way to mess around with application synthesis (look at the <code>Makefile</code> targets in <code>slides/</code>).</p> </li><li> <p><b>Installation</b>: <a href="http://openmirage.org/wiki/install">instructions</a> have been simplified, and we now only require OCaml on the host and include everything else in-tree. Thomas has also made Emacs and Vim plugins that are compatible with the ocamlbuild layout.</p> </li><li> <p><b>Lwt</b>: a <a href="http://openmirage.org/wiki/tutorial-lwt">new tutorial</a> which walks you through the cooperative threading library we use, along with exercises (all available in <a href="http://github.com/avsm/mirage-tutorial">mirage-tutorial</a>). Raphael and Balraj are looking for feedback on this, so get in touch!</p> </li><li> <p><b>Javascript</b>: via <a href="http://nodejs.org">node.js</a> did not work in time for the tutorial, as integrating I/O is a tangled web that will take some time to sort out. Raphael is working on this in a <a href="https://github.com/raphael-proust/nodejs_of_ocaml">separate tree</a> for now.  As part of this effort though, he integrated a pure OCaml <a href="http://openmirage.org/wiki/ocaml-regexp">regular expression library</a> that does not require C bindings, and is surprisingly fast.</p> </li><li> <p><b>Devices</b>: we can now synthesise binaries that share common code but have very different I/O interfaces. This is due to a new device manager, and David also heroically wrote a complete <a href="http://github.com/avsm/mirage/tree/master/lib/fs">FAT12/16/32 library</a> that we demonstrated.  Yaron Minsky suggested a <a href="https://gist.github.com/1245418">different approach</a> to the device manager using <a href="http://caml.inria.fr/pub/docs/manual-ocaml/manual021.html#toc81">first-class modules</a> instead of objects, so I am experimentally trying this before writing documentation on it.</p> </li><li> <p><b>TCP</b>: the notorious Mirage stack is far more robust due to our resident networking guru Balraj hunting down last-minute bugs. Although it held together with sticky tape during the tutorial, he is now adding retransmission and congestion control to make it actually standards-compliant.  Still, if you dont have any packet loss, the <a href="http://xen.openmirage.org/">microkernel version</a> of this website does actually serve pages.</p> </li><li> <p><b>OpenFlow</b>: is a new <a href="http://www.openflow.org/wk/index.php/OpenFlow_v1.0">standard</a> for <a href="http://networkheresy.wordpress.com/">Software Defined Networking</a>, and Haris and Mort have been hacking away at a complete implementation directly in Mirage!  We will be giving a tutorial on this at the <a href="http://changeofelia.info.ucl.ac.be/">OFELIA summer school</a> in November (it is summer somewhere, I guess). The prospect of a high-speed microkernel switching fabric for the cloud, programmed in a functional style, is something I am really looking forward to seeing!</p> </li><li> <p><b>Jane Street Core</b>: preceeding us was Yaron's <a href="http://cufp.org/conference/sessions/2011/t2-janestreets-ocaml-core-library">Core</a> tutorial. Since Mirage provides it own complete standard library, we can adopt portions of Core that do not require OS threads or UNIX-specific features.  I really like the idea that Mirage enforces a discipline on writing portable interfaces, as dependencies on OS-specific features do sneak in insiduously and make switching to different platforms very difficult (e.g. Windows support). Incidentally, Yaron's <a href="http://queue.acm.org/detail.cfm?id=2038036&amp;ref=fullrss">ACM Queue</a> article is a great introduction to OCaml.</p> </li> </ul><p>So as you can see, it has been a busy few months!  Much of the core of Mirage is settling down now, and we are writing a paper with detailed performance benchmarks of our various backends.  Keep an eye on the <a href="https://github.com/avsm/mirage/issues?milestone=2&amp;state=open">Github milestone</a> for the preview release, join our <a href="https://lists.cam.ac.uk/mailman/listinfo/cl-mirage">new mailing list</a>, or follow the newly sentient <a href="http://twitter.com/openmirage">openmirage on twitter</a>!</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/an-outing-to-cufp">by Anil Madhavapeddy (anil@recoil.org) at Thu, 29 Sep 2011</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2011/08/09/cufp2011-schedule"><a name="http://anil.recoil.org/2011/08/09/cufp2011-schedule"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2011/08/09/cufp2011-schedule.html">Commercial Users of Functional Programming 2011 Schedule</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><div id="content-area"><div class="view view-Schedule view-id-Schedule view-display-id-page_1 view-dom-id-29"><div class="view-header"><p>The CUFP 2011 schedule is now <a href="http://cufp.org/conference/schedule/2011">available</a> and the <a href="https://regmaster3.com/2011conf/ICFP11/register.php">conference registration</a> is open!
The <tt>cufp.org</tt> website is having a few DNS propagation issues at the moment and is unreachable, so I have replicated the schedule below for
your perusal.  Hope to see lots of new faces in Tokyo!</p>
</div>
<div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><h3>September 22nd, <b>2011</b></h3>
<br /><div class="view view-Schedule-Header view-id-Schedule_Header view-display-id-default view-dom-id-1"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"></div>
</div>
</div>
<div class="view view-Schedule-By-Day view-id-Schedule_By_Day view-display-id-default view-dom-id-6"><div class="view-content"><table class="views-table cols-4"><thead><tr><th>Time</th><th>Speakers</th></tr>
</thead>
<tbody><tr class="odd views-row-first"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">09:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">12:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t1-building-reliable-client-server-applications-er">T1: Building Reliable Client-Server Applications in Erlang</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-2"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/francescoc">Francesco
Cesarini</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Erlang
Solutions Ltd.</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">09:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">12:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t2-janestreets-ocaml-core-library">T2:
JaneStreet's OCaml Core Library</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-3"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/yminsky">Yaron
Minsky</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Jane
Street</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">02:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">05:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t3-building-functional-os">T3: Building
a Functional OS</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-4"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/avsm">Anil
Madhavapeddy</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>University of Cambridge</em></span></div>
</div>
<div class="views-row views-row-2 views-row-even"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/djs55">David Scott</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Citrix</em></span></div>
</div>
<div class="views-row views-row-3 views-row-odd views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/mort">Richard
Mortier</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>university of nottingham</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even views-row-last"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">02:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">05:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t4-collaborative-scientific-software">T4:
Collaborative Scientific Software</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-5"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/ashish">Ashish
Agarwal</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>New
York University</em></span></div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h3>September 23rd, <b>2011</b></h3>
<br /><div class="view view-Schedule-Header view-id-Schedule_Header view-display-id-default view-dom-id-7"></div>
<div class="view view-Schedule-By-Day view-id-Schedule_By_Day view-display-id-default view-dom-id-12"><div class="view-content"><table class="views-table cols-4"><thead><tr><th>Time</th><th>Speakers</th></tr>
</thead>
<tbody><tr class="odd views-row-first"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">09:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">12:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t5-parallel-programming-haskell-simon-peyton-jones">T5: Parallel Programming in Haskell (Simon Peyton Jones, Simon
Marlow, Manuel Chakravarty)</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-8"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/simonpj">Simon
Peyton-Jones</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Microsoft</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">09:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">12:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t6-systems-programming-scala-steven-jenson-marius-">T6: Systems Programming in Scala (Steven Jenson, Marius
Eriksen)</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-9"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/marius-eriksen">Marius
Eriksen</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Twitter</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">02:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">05:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t7-snap-framework-web-applications-haskell-gregory">T7: The Snap Framework for web applications in Haskell (Gregory
Collins)</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-10"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://anil.recoil.org/user/"></a></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even views-row-last"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">02:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">05:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/t8-f-working-functional-programmer">T8:
F# for the Working Functional Programmer</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-11"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/msperber">Michael
Sperber</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Active
Group</em></span></div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h3>September 24th, <b>2011</b></h3>
<br /><div class="view view-Schedule-Header view-id-Schedule_Header view-display-id-default view-dom-id-13"></div>
<div class="view view-Schedule-By-Day view-id-Schedule_By_Day view-display-id-default view-dom-id-28"><div class="view-content"><table class="views-table cols-14"><thead><tr><th>Time</th><th>Speakers</th>
</tr>
</thead>
<tbody><tr class="odd views-row-first"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">09:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">10:00 AM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/keynote-pragmatic-haskell">Keynote:
Pragmatic Haskell</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-14"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/lennartaugustsson">Lennart
Augustsson</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Standard Chartered Bank</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">10:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">10:30 AM</span></span></td>
<td class="views-field views-field-title">Tea Break</td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-15"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://anil.recoil.org/user/"></a></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">10:30 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">11:00 AM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/theorem-based-derivation-aes-implementation">Theorem-based derivation of an AES Implementation</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-16"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/jlaunchbury">John
Launchbury</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Galois</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">11:00 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">11:30 AM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/discrete-event-simulation-using-erlang">Discrete
Event Simulation using Erlang</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-17"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/olivier-boudeville">Mr. Olivier
Boudeville</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>EDF
R&amp;D</em>, <em>energy utility</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">11:30 AM</span> <span class="date-display-separator">-</span> <span class="date-display-end">12:00 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/model-based-testing-autosar-automotive-components">Model based testing of AUTOSAR automotive components</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-18"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/thomas">Dr. Thomas
Arts</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>QuviQ</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">12:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">01:30 PM</span></span></td>
<td class="views-field views-field-title">Lunch Break</td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-19"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://anil.recoil.org/user/"></a></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">01:30 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">02:00 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/html5-web-application-development-ocaml">HTML5 web application development in OCaml</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-20"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/keigoi">Mr. Keigo
Imai</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>IT
Planning, Inc.</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">02:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">02:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/large-scale-internet-services-scala-twitter">Large-scale Internet Services in Scala at Twitter</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-21"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/wilhelm-bierbaum">Wilhelm
Bierbaum</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Twitter</em></span></div>
</div>
<div class="views-row views-row-2 views-row-even views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/stevejenson">Steve
Jenson</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Twitter</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">02:30 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">03:00 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/applying-functional-programming-build-platform-ind">Applying Functional Programming to Build Platform-Independent
Mobile Applications</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-22"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/agranicz">Adam
Granicz</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>IntelliFactory</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">03:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">03:30 PM</span></span></td>
<td class="views-field views-field-title">Tea Break</td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-23"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://anil.recoil.org/user/"></a></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">03:30 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">04:00 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/fourteen-days-haskell-real-time-programming-projec">Fourteen Days of Haskell: A Real Time Programming Project in Real
Time</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-24"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/gregorywright">Gregory
Wright</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Alcatel-Lucent</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">04:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">04:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/disco-using-erlang-implement-mapreduce-nokia">Disco: using Erlang to implement Mapreduce, Nokia</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-25"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/jaredflatow">Jared
Flatow</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Erlang</em>, <em>Nokia</em></span></div>
</div>
<div class="views-row views-row-2 views-row-even"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/prashanthmundkur">Prashanth
Mundkur</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Erlang</em>, <em>Nokia</em></span></div>
</div>
<div class="views-row views-row-3 views-row-odd views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/tuulos">Ville
Tuulos</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Nokia
Research</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="odd"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">04:30 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">05:00 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/functional-mzscheme-dsls-game-development">Functional mzScheme DSLs in Game Development</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-26"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/danliebgold">Dan
Liebgold</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Naughty Dog Inc.</em></span></div>
</div>
</div>
</div>
</td>
</tr>
<tr class="even views-row-last"><td class="views-field views-field-field-sesion-time-value active"><span class="date-display-single"><span class="date-display-start">05:00 PM</span> <span class="date-display-separator">-</span> <span class="date-display-end">05:30 PM</span></span></td>
<td class="views-field views-field-title"><a href="http://cufp.org/conference/sessions/2011/ocaml-and-acunu-experience-report">OCaml
and Acunu Experience Report</a></td>
<td class="views-field views-field-phpcode-1"><div class="view view-Speakers view-id-Speakers view-display-id-default view-dom-id-27"><div class="view-content"><div class="views-row views-row-1 views-row-odd views-row-first"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/andrewbyde">Andrew
Byde</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Acunu</em></span></div>
</div>
<div class="views-row views-row-2 views-row-even views-row-last"><div class="views-field-phpcode"><span class="field-content"><a href="http://cufp.org/users/tomwilkie">Tom
Wilkie</a></span></div>
<div class="views-field-tid"><span class="field-content"><em>Acunu</em></span></div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div></div>







<p class="date"><a href="http://anil.recoil.org/2011/08/09/cufp2011-schedule.html">Mon, 08 Aug 2011</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2011/06/18/datacaml-with-ciel"><a name="http://anil.recoil.org/2011/06/18/datacaml-with-ciel"> </a>
<h1 class="posttitle"><a href="http://anil.recoil.org/2011/06/18/datacaml-with-ciel.html">DataCaml - a first look at distributed dataflow programming in OCaml</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h1>
<hr /><div class="entry"><div class="content"><p>Distributed programming frameworks like <a href="http://wiki.apache.org/hadoop">Hadoop</a> and <a href="http://research.microsoft.com/en-us/projects/dryad/">Dryad</a> are popular for performing computation over large amounts of data. The reason is programmer convenience: they accept a query expressed in a simple form such as <a href="http://wiki.apache.org/hadoop/HadoopMapReduce">MapReduce</a>, and automatically take care of distributing computation to multiple hosts, ensuring the data is available at all nodes that need it, and dealing with host failures and stragglers.</p>

<p>A major limitation of Hadoop and Dryad is that they are not well-suited to expressing <a href="http://en.wikipedia.org/wiki/Iterative_method">iterative algorithms</a> or <a href="http://en.wikipedia.org/wiki/Dynamic_programming">dynamic programming</a> problems. These are very commonly found patterns in many algorithms, such as <a href="http://en.wikipedia.org/wiki/K-means_clustering">k-means clustering</a>, <a href="http://en.wikipedia.org/wiki/Binomial_options_pricing_model">binomial options pricing</a> or <a href="http://en.wikipedia.org/wiki/Smith&#8211;Waterman_algorithm">Smith Waterman</a> for sequence alignment.</p>

<p>Over in the SRG in Cambridge, <a href="http://www.cl.cam.ac.uk/research/srg/netos/ciel/who-we-are/">we</a> developed a Turing-powerful distributed execution engine called <a href="http://www.cl.cam.ac.uk/research/srg/netos/ciel/">CIEL</a> that addresses this. The <a href="http://anil.recoil.org/papers/2011-nsdi-ciel.pdf">NSDI 2011</a> paper describes the system in detail, but here&#8217;s a shorter introduction.</p>

<h2 id="the_ciel_execution_engine">The CIEL Execution Engine</h2>

<p>CIEL consists of a master coordination server and workers installed on every host. The engine is job-oriented: a job consists of a graph of tasks which results in a deterministic output. CIEL tasks can run in any language and are started by the worker processes as needed. Data flows around the cluster in the form of <em>references</em> that are fed to tasks as dependencies. Tasks can publish their outputs either as <em>concrete</em> references if they can finish the work immediately or as a <em>future</em> reference. Additionally, tasks can dynamically spawn more tasks and delegate references to them, which makes the system Turing-powerful and suitable for iterative and dynamic programming problems where the task graph cannot be computed statically.</p>

<p>The first iteration of CIEL used a domain-specific language called <a href="http://anil.recoil.org/papers/2011-nsdi-ciel.pdf">Skywriting</a> to coordinate how tasks should run across a cluster. Skywriting is an interpreted language that is &#8220;native&#8221; to CIEL, and when it needs to block it stores its entire execution state inside CIEL as a continuation. <a href="http://www.cl.cam.ac.uk/~dgm36/">Derek Murray</a> has written a blog post <a href="http://www.syslog.cl.cam.ac.uk/2011/04/06/ciel/">explaining this in more detail</a>.</p>

<p>More recently, we have been working on eliminating the need for Skywriting entirely, by adding direct support for CIEL into languages such as <a href="http://www.stackless.com/">Python</a>, Java, <a href="http://www.scala-lang.org/">Scala</a>, and the main subject of this post &#8211; <a href="http://caml.inria.fr">OCaml</a>. It works via libraries that communicate with CIEL to spawn tasks, publish references, or suspend itself into the cluster to be woken up when a future reference is completed.</p>

<h2 id="datacaml_api">DataCaml API</h2>

<p>Rather than go into too much detail about the innards of CIEL, this post describes the OCaml API and gives some examples of how to use it. The simplest interface to start with is:</p>
<div class="highlight"><pre><code class="ocaml">	  <span class="k">type</span> <span class="k">'</span><span class="n">a</span> <span class="n">ref</span>
	  <span class="k">val</span> <span class="n">deref</span> <span class="o">:</span> <span class="k">'</span><span class="n">a</span> <span class="n">ref</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span>
	
</code></pre>
</div>
<p>The type <code>'a ref</code> represents a CIEL reference. This data might not be immediately present on the current node, and so must be dereferenced using the <code>deref</code> function.</p>

<p>If the reference has been completed, then the OCaml value is unmarshalled and returned. If it is not present, then the program needs to wait until the computation involving the reference has completed elsewhere. The future reference might contain a large data structure and be on another host entirely, and so we should serialise the program state and spawn a task that is dependent on the future&#8217;s completion. This way, CIEL can resume execution on whatever node finished that computation, avoiding the need to move data across the network.</p>

<p>Luckily, we do not need to serialise the entire heap to suspend the program. DataCaml uses the <a href="http://okmij.org/ftp/continuations/implementations.html">delimcc</a> delimited continuations library to walk the stack and save only the subset required to restart this particular task. Delimcc abstracts this in the form a &#8220;restartable exception&#8221; that supplies a closure which can be called later to resume the execution, as if the exception had never happened. Delimcc supports serialising this closure to an output channel, which you can read about in Oleg&#8217;s <a href="http://okmij.org/ftp/continuations/caml-shift.pdf">paper</a>.</p>

<p>So how do we construct references? Lets fill in more of the interface:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="k">module</span> <span class="nc">Ciel</span> <span class="o">=</span> <span class="k">struct</span>
	  <span class="k">type</span> <span class="k">'</span><span class="n">a</span> <span class="n">ref</span>
	  <span class="k">val</span> <span class="n">deref</span> <span class="o">:</span> <span class="k">'</span><span class="n">a</span> <span class="n">ref</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span>
	  <span class="k">val</span> <span class="n">spawn</span> <span class="o">:</span> <span class="o">(</span><span class="k">'</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">b</span> <span class="n">ref</span>
	  <span class="k">val</span> <span class="n">run</span> <span class="o">:</span> <span class="o">(</span><span class="kt">string</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">'</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">string</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
        <span class="k">end</span>
	
</code></pre>
</div>
<p>The <code>spawn</code> function accepts a closure and an argument, and returns a future of the result as a reference. The <code>run</code> function begins the execution of a job, with the first parameter taking some <code>string arguments</code> and returning an <code>'a</code> value. We also supply a pretty-printer second argument to convert the <code>'a</code> into a string for returning as the result of the job (this can actually be any JSON value in CIEL, and just simplified here).</p>
<div class="highlight"><pre><code class="ocaml">	<span class="k">let</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">spawn</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span><span class="o">)</span> <span class="n">arg1</span> <span class="k">in</span>
  	<span class="k">let</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">spawn</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">deref</span> <span class="n">r1</span> <span class="o">+</span> <span class="mi">5</span><span class="o">)</span> <span class="n">arg1</span> <span class="k">in</span>
	<span class="n">deref</span> <span class="n">r2</span> 
	
</code></pre>
</div>
<p>We first spawn a function <code>r1</code> which simply adds 5 to the job argument. A job in CIEL is <em>lazily scheduled</em>, so this marshals the function to CIEL, creates a future, and returns immediately. Next, the <code>r2</code> function spawns a task which also adds 5, but to the dereferenced value of <code>r1</code>. Again, it is not scheduled yet as the return reference has not been dereferenced.</p>

<p>Finally, we attempt to dereference <code>r2</code>, which causes it be scheduled on a worker. While executing, it will try to dereference <code>r1</code> that will schedule it, and all the tasks will run to completion.</p>

<p>Programming language boffins will recognise that this interface is very similar to <a href="http://www.ps.uni-saarland.de/alice/">AliceML</a>&#8217;s concept of <a href="http://www.ps.uni-saarland.de/alice/manual/futures.html">lazy futures</a>. The main difference is that it is implemented as a pure OCaml library, and uses a general-purpose distributed engine that can also work with other languages.</p>

<h2 id="streaming_references">Streaming References</h2>

<p>The references described so far only have two states: they are either concrete or futures. However, there are times when a task can progressively accept input and make forward progress. For these situations, references can also be typed as <em>opaque</em> references that are accessed via <code>in_channel</code> and <code>out_channel</code>, as networks are:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="k">type</span> <span class="n">opaque_ref</span>

	<span class="k">val</span> <span class="n">spawn_ref</span> <span class="o">:</span> <span class="o">(</span><span class="kt">unit</span> <span class="o">-&gt;</span> <span class="n">opaque_ref</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">opaque_ref</span>
	<span class="k">val</span> <span class="n">output</span> <span class="o">:</span> <span class="o">?</span><span class="n">stream</span><span class="o">:</span><span class="kt">bool</span> <span class="o">-&gt;</span> <span class="o">?</span><span class="n">pipe</span><span class="o">:</span><span class="kt">bool</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">out_channel</span> <span class="o">-&gt;</span> <span class="kt">unit</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">opaque_ref</span>
	<span class="k">val</span> <span class="n">input</span> <span class="o">:</span> <span class="o">(</span><span class="n">in_channel</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">opaque_ref</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span>
	
</code></pre>
</div>
<p>This interface is a lower-level version of the previous one:</p>

<ul><li><code>spawn_ref</code> creates a lazy future as before, but the type of references here is completely opaque to the program.</li>

<li>Inside a spawned function, <code>output</code> is called with a closure that accepts an <code>out_channel</code>. The <code>stream</code> argument informs CIEL that a dependent task can consume the output before it is completed, and <code>pipe</code> forms an even more closely coupled shared-memory connection (requiring the tasks to be scheduled on the same host). Piping is more efficient, but will require more work to recover from a fault, and so using it is left to the programmer to decide.</li>

<li>The <code>input</code> function is used by the receiving task to parse the input as a standard <code>in_channel</code>.</li>
</ul>

<p>The CIEL engine actually supports multiple concurrent input and output streams to a task, but I&#8217;ve just bound it as a single version for now while the bindings find their feet. Here&#8217;s an example of how streaming references can be used:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="k">let</span> <span class="n">x_ref</span> <span class="o">=</span> <span class="n">spawn_ref</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">()</span> <span class="o">-&gt;</span>
	  <span class="n">output</span> <span class="o">~</span><span class="n">stream</span><span class="o">:</span><span class="bp">true</span> <span class="o">(</span><span class="k">fun</span> <span class="n">oc</span> <span class="o">-&gt;</span>
	    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">5</span> <span class="k">do</span>
	      <span class="nn">Unix</span><span class="p">.</span><span class="n">sleep</span> <span class="mi">1</span><span class="o">;</span>
	      <span class="n">fprintf</span> <span class="n">oc</span> <span class="s2">"%d</span><span class="se">\n</span><span class="s2">%!"</span> <span class="n">i</span><span class="o">;</span>
	    <span class="k">done</span>
	  <span class="o">)</span>
	<span class="o">)</span> <span class="k">in</span>
	<span class="k">let</span> <span class="n">y_ref</span> <span class="o">=</span> <span class="n">spawn_ref</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">()</span> <span class="o">-&gt;</span>
	  <span class="n">input</span> <span class="o">(</span><span class="k">fun</span> <span class="n">ic</span> <span class="o">-&gt;</span>
	    <span class="n">output</span> <span class="o">~</span><span class="n">stream</span><span class="o">:</span><span class="bp">true</span> <span class="o">(</span><span class="k">fun</span> <span class="n">oc</span> <span class="o">-&gt;</span>
	      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">5</span> <span class="k">do</span>
	        <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">ic</span> <span class="k">in</span>
	        <span class="n">fprintf</span> <span class="n">oc</span> <span class="s2">"LINE=%s</span><span class="se">\n</span><span class="s2">%!"</span> <span class="n">line</span>
	      <span class="k">done</span>
	    <span class="o">)</span>
	  <span class="o">)</span> <span class="n">x_ref</span>
	<span class="o">)</span> <span class="k">in</span>
	
</code></pre>
</div>
<p>We first spawn an <code>x_ref</code> which pretends to do 5 seconds of work by sleeping and outputing a number. This would of course be heavy number crunching in a real program. The <code>y_ref</code> then inputs this stream, and outputs its own result by prepending a string to each line.</p>

<h2 id="try_it_out">Try it out</h2>

<p>If you are interested in a more real example, then read through the <a href="https://github.com/avsm/ciel/blob/master/src/ocaml/binomial.ml">binomial options</a> calculator that uses streaming references to parallelise a dynamic programming problem (this would be difficult to express in MapReduce). On my Mac, I can run this by:</p>

<ul><li>check out CIEL from from Derek&#8217;s <a href="http://github.com/mrry/ciel">Git repository</a>.</li>

<li>install all the Python libraries required (see the <code>INSTALL</code> file) and OCaml libraries (<a href="http://okmij.org/ftp/continuations/implementations.html">delimcc</a> and <a href="http://martin.jambon.free.fr/yojson.html">Yojson</a>).</li>

<li>add <code>&lt;repo&gt;/src/python</code> to your <code>PYTHONPATH</code></li>

<li>in one terminal: <code>./scripts/run_master.sh</code></li>

<li>in another terminal: <code>./scripts/run_worker.sh -n 5</code> (this allocates 5 execution slots)</li>

<li>build the OCaml libraries: <code>cd src/ocaml &amp;&amp; make</code></li>

<li>start the binomial options job: <code>./scripts/sw-start-job -m http://localhost:8000 ./src/package/ocaml_binopt.pack</code></li>

<li>there will be a URL printed which shows the execution progress in real-time</li>

<li>you should see log activity on the worker(s), and a result reference with the answer (<code>10.x</code>)</li>

<li>let us know the happy news if it worked or sad news if something broke</li>
</ul>

<h2 id="discussion">Discussion</h2>

<p>The DataCaml bindings outlined here provide an easy way to write distributed, fault-tolerant and cluster-scheduled jobs in OCaml. The current implementation of the engine is aimed at cluster computation, but <a href="http://www.cl.cam.ac.uk/~ms705">Malte</a> has been working on <a href="http://www.cl.cam.ac.uk/~ms705/pub/papers/2011-ciel-sfma.pdf">condensing CIEL onto multicore hardware</a>. Thus, this could be one approach to &#8216;solving the OCaml multicore problem&#8217; for problems that fit nicely into the dataflow paradigm.</p>

<p>The biggest limitation for using these bindings is that delimited continuation serialisation only works in bytecode. Native code delimcc supports <code>shift/reduce</code> in the same program, but serialising is problematic since native code continuations contain a C stack, which may have unwrapped integers. One way to work around this is by switching to a monadic approach to dereferencing, but I find delimcc programming more natural (also see <a href="http://www.openmirage.org/wiki/delimcc-vs-lwt">this discussion</a>).</p>

<p>Another important point is that tasks are lazy and purely functional (remind you of Haskell?). This is essential for reliable fault-tolerance and reproducibility, while allowing individual tasks to run fast, strict and mutable OCaml code. The tasks must remain referentially transparent and idempotent, as CIEL may choose to schedule them multiple times (in the case of faults or straggler correction). Derek has been working on <a href="http://www.cl.cam.ac.uk/~dgm36/publications/2011-murray2011nondet.pdf">integrating non-determinism into CIEL</a>, so this restriction may be relaxed soon.</p>

<p>Finally, these ideas are not limited to OCaml at all, but also apply to Scala, Java, and Python. We have submitted a draft paper dubbed <em>&#8217;<a href="http://www.cl.cam.ac.uk/~ms705/pub/papers/2011-ciel-socc-draft.pdf">A Polyglot Approach to Cloud Programming</a>&#8217;</em> with more details and the ubiquitous evaluation versus Hadoop. There is a really interesting line to explore between low-level <a href="http://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a> coding and high-level MapReduce, and we think CIEL is a useful spot in that design space.</p>

<p>Incidentally, I was recently hosted by <a href="http://research.nokia.com/">Nokia Research</a> in Palo Alto by my friend <a href="http://www.linkedin.com/pub/prashanth-mundkur/6/b44/27">Prashanth Mundkur</a>, where they work on the Python/Erlang/OCaml <a href="http://discoproject.org/">Disco</a> MapReduce engine. I&#8217;m looking forward to seeing more critical comparisons and discussions of alternatives to Hadoop, from them and others.</p>

<p><em>Thanks are due to <a href="http://www.cl.cam.ac.uk/~dgm36/">Derek</a>, <a href="https://twitter.com/#!/chrissmowton">Chris</a> and <a href="http://www.cl.cam.ac.uk/~ms705">Malte</a> for answering my incessant CIEL questions while writing this post! Remember that DataCaml is a work in progress and a research prototype, and feedback is most welcome.</em></p></div>







<p class="date"><a href="http://anil.recoil.org/2011/06/18/datacaml-with-ciel.html">Fri, 17 Jun 2011</a>
</p>
</div>
</div>


</div>

</div>

<p><strong>Last updated:</strong><br />Tue, 17 Sep 2013<br /><em>All times are UTC.</em><br /><br /></p><div align="center">Powered by: <a href="http://www.planetplanet.org/"><img alt="Planet" border="0" height="15" src="images/planet.png" width="80" /></a></div>
</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>

<ul id="site-info"><li class="copy">&#169; 2012-2013 Anil Madhavapeddy<br />Information provided by <a href="mailto:avsm2@cl.cam.ac.uk">Anil Madhavapeddy</a></li></ul>
</div>
</body></html>