<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- DO NOT EDIT: file automatically generated by ucampas. -->
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><meta content="text/css" http-equiv="Content-Style-Type" /><title>Computer Laboratory &#8211; OCaml Labs: Blogs</title><link href="http://www.cl.cam.ac.uk/style/layout.css" media="all" rel="stylesheet" type="text/css" /><link href="http://www.cl.cam.ac.uk/style/print.css" media="print" rel="stylesheet" type="text/css" /><link href="http://www.cl.cam.ac.uk/style/blue.css" media="all" rel="stylesheet" type="text/css" /><!--[if IE 6]><link rel="stylesheet" href="http://www.cl.cam.ac.uk/style/ie6.css" type="text/css" media="screen" /><script type="text/javascript" src="http://www.cam.ac.uk/global/js/minmax.js"></script><![endif]--><!--[if IE 7]><link rel="stylesheet" href="http://www.cl.cam.ac.uk/style/ie7.css" type="text/css" media="screen" /><![endif]--><link href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/rss10.xml" rel="alternate" title="" type="application/rss+xml" /><style>    a.icon-github {
	background: url(../github.png) no-repeat 0 0;
        background: url(../github.png) no-repeat 0 0;
	padding: 0 0 2px 2em;
    }
    a.icon-cloud {
	background: url(../cloud.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    a.icon-bullhorn {
	background: url(../bullhorn.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    a.icon-wrench {
	background: url(../wrench.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    h2.posttitle {
        font-size: 120%;
    }
div.toc {
    background-color: rgb(239, 239, 239);
    margin: 0.5em 0em 1.5em 1px;
    border: 1px solid black;
    font-size: 0.7em;
    padding: 0px 0px 1ex;
    font-size: 100%;
}
</style><link href="../tasks/index.html" rel="Next" /><link href="../index.html" rel="Up" /></head>
<body class="two-col dept">
<div id="skip"> <a accesskey="2" href="#skip-content">Skip to content</a>&#160;|&#160;<a accesskey="0" href="http://www.cam.ac.uk/site/accesskeys.html">Access key help</a> </div><div id="header">  <div id="branding"><a accesskey="1" href="http://www.cam.ac.uk/"><img alt="University of Cambridge" class="ucam" src="http://www.cl.cam.ac.uk/images/identifier.gif" /></a>
  </div>

    <div id="site-search">
    <form action="http://www.google.co.uk/search" method="get">      <fieldset>      <label for="search-term">Search</label>
      <input accesskey="4" id="search-term" name="q" type="text" value="" />      <input alt="Search" id="search-button" src="http://www.cl.cam.ac.uk/images/button-search.gif" title="Search" type="image" value="Search" />
      

      <input name="domains" type="hidden" value="cam.ac.uk;www.cl.cam.ac.uk" /><input name="sitesearch" type="hidden" value="www.cl.cam.ac.uk" /></fieldset>
    </form>

  <ul><li class="last"><a href="http://www.cl.cam.ac.uk/search/">Advanced search</a></li><li><a href="http://www.cl.cam.ac.uk/az/">A&#8211;Z</a></li><li><a href="http://www.cl.cam.ac.uk/contact/">Contact us</a></li></ul>
  </div>
</div>

<div id="dept-title"><h1><a href="../index.html">Computer Laboratory</a></h1>
</div>

<div id="container"> <a id="skip-content" name="skip-content"></a>
<ul id="nav-breadcrumb"><li class="first"><a href="http://www.cam.ac.uk/">University of Cambridge</a></li><li><a href="http://www.cl.cam.ac.uk/">Computer Laboratory</a></li><li><a href="../index.html">OCaml Labs</a></li><li><a href="index.html">Blogs</a></li></ul><ul id="nav-primary"><li><div><a href="../index.html">OCaml Labs</a></div></li><li><div><a href="../news/index.html">News</a></div></li><li class="active"><div><a href="index.html">Blogs</a></div></li><li><div><a href="../tasks/index.html">Projects</a></div></li><li><div><a href="../people/index.html">People</a></div></li><li><div><a href="../outputs/index.html">Outputs</a></div></li><li><div><a href="../collaboration.html">Collaboration</a></div></li><li><div><a href="../contact.html">Contact Us</a></div></li></ul><div id="content"><div id="sub-brand"><p class="section">OCaml Labs</p></div><div id="content-primary">
<div id="container">
<h4>Recent Posts</h4>
<table width="90%">  <tbody><tr>    <td><i>Sun, 15 Sep 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools">Camlpdf, the first good command-line PDF tool I've found</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Thu, 12 Sep 2013</i></td>
    <td><a href="#http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html">OMD: a Markdown parser in OCaml</a></td>
    <td>Philippe Wang</td>
  </tr>
  <tr>    <td><i>Mon, 09 Sep 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=153">OCaml Development in Vim</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Sun, 08 Sep 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/09/09/ocamlot-autotriaging">OCamlot--exploring the edges of OPAM packages</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Fri, 06 Sep 2013</i></td>
    <td><a href="#urn:uuid:0f9d7209-2382-5f9c-9874-00401db52a24">Uutf 0.9.3 and Xmlm 1.2.0</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Wed, 28 Aug 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=25">ICFP, CUFP &amp; OCaml2013</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Fri, 23 Aug 2013</i></td>
    <td><a href="#http://openmirage.org/blog/introducing-vchan">Introducing vchan</a></td>
    <td>Vincent Bernardoff</td>
  </tr>
  <tr>    <td><i>Mon, 19 Aug 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=86">Real World OCaml beta3 release</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Thu, 08 Aug 2013</i></td>
    <td><a href="#http://openmirage.org/blog/oscon13-trip-report">Mirage travels to OSCON'13: a trip report</a></td>
    <td>Richard Mortier</td>
  </tr>
  <tr>    <td><i>Mon, 05 Aug 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2">Final Real World OCaml beta; the good, the bad and the ugly</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Thu, 01 Aug 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=99">OCaml Lecture Notes</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Thu, 18 Jul 2013</i></td>
    <td><a href="#http://openmirage.org/blog/xen-block-devices-with-mirage">Creating Xen block devices with Mirage</a></td>
    <td>Dave Scott</td>
  </tr>
  <tr>    <td><i>Wed, 10 Jul 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=64">Profiling OCaml &#8211; Getting Started Guide</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Thu, 04 Jul 2013</i></td>
    <td><a href="#urn:uuid:5222d531-d414-5ae8-a340-2eb88ed31fc0">On the book &#171; OCaml from the very beginning &#187;</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Wed, 03 Jul 2013</i></td>
    <td><a href="#http://hh360.user.srcf.net/blog/?p=90">Learning Async</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Sun, 16 Jun 2013</i></td>
    <td><a href="#http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available">Phew, Real World OCaml beta now available.</a></td>
    <td></td>
  </tr>
  <tr>    <td><i>Sat, 01 Jun 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01">Jun 2013 news update</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Mon, 20 May 2013</i></td>
    <td><a href="#http://openmirage.org/blog/the-road-to-a-dev-release">The road to a developer preview at OSCON 2013</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Wed, 01 May 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01">May 2013 news update</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
  <tr>    <td><i>Mon, 01 Apr 2013</i></td>
    <td><a href="#http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01">Apr 2013 news update</a></td>
    <td>Anil Madhavapeddy</td>
  </tr>
</tbody></table>




<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools"><a name="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools"> </a>
<h2 class="posttitle"><a href="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools.html">Camlpdf, the first good command-line PDF tool I've found</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>The fine folks at O&#8217;Reilly have been proof-reading the <a href="https://realworldocaml.org">Real World OCaml</a> book that I&#8217;ve been working on. My heart leapt with joy when the copyeditor commented that she thought it was very well written, but my joy was short-lived when it turns out that all her comments were safely ensconced as PDF comments. A few hundreds comments that required a response from us, too.</p>

<p><em>&#8220;No problem! MacOS X Preview can handle these!&#8221;</em> was of course my first response, but it turns out it&#8217;s totally broken with PDF notes. The first note that you select will appear as the content of all the other subsequent notes. Yaron Minsky then experimented with Adobe Acrobat, which I&#8217;ve sworn never to install again after an unfortunate incident involving the uninstaller a couple of years ago. That turned out to be incredibly slow. I tried a few open-source tools such as <a href="http://en.wikipedia.org/wiki/Skim_(software">Skim</a> which, while otherwise an excellent bit of software, couldn&#8217;t render these particular annotations.</p>
<table><tbody><tr><td><a href="http://anil.recoil.org/images/anil-jumping-acropolis.jpg"><img src="http://anil.recoil.org/images/anil-jumping-acropolis-thumb.jpg" width="207" /></a>
</td></tr>
<tr><td width="210"><i><small>I <a href="http://www.theguardian.com/media/mind-your-language/2012/jan/29/literally-a-much-misused-word">literally</a> jumped off my seat upon discovering cpdf.</small></i></td></tr>
</tbody></table>
<p>Meanwhile, John Whitington just announced the release of the <a href="http://coherentpdf.com/blog/?p=68">Coherent PDF</a> command-line tools. Since these are all written in OCaml (and have been developed over quite a few years now), he also sent in an OPAM <a href="https://github.com/OCamlPro/opam-repository/pull/977">pull request</a> to add it to the database. And most conveniently, this ended up solving my little PDF conundrum in less than an hour of hacking, and has almost cured me of my lifelong fear of dealing with anything in a PDF-like format. Here&#8217;s what I did:</p>

<ul><li><p>I installed the tools via <code>opam install cpdf</code>. This installed the library but not the binary (<a href="https://github.com/OCamlPro/opam-repository/pull/1100">swiftly fixed</a>).</p>
</li>

<li><p>Reading the license told me that it&#8217;s for non-commercial use only, so I bought a license from the <a href="http://coherentpdf.com">Coherent PDF</a> website (a bargain price, given how much it does!).</p>
</li>

<li><p>I ran <code>cpdf -list-annotations</code> over the PDF, and it dumped out all the comments as a text file to stdout. This wasn&#8217;t quite enough for me, since I needed to match the annotation to a page number. But since John has released it as open-source, I forked the repository and patched the support directly into the command-line tools, and sent a <a href="https://github.com/johnwhitington/cpdf-source/pull/2">pull request</a> back over to John. Since it&#8217;s under a non-standard license, I decided to place my patch in the public domain to make it easier for him to accept it if he chooses.</p>
</li>

<li><p>My co-authors can just run <code>opam pin cpdf git://github.com/avsm/cpdf-source#annotation-page-numbers</code> to pin their local copy of CPDF to my forked branch in their own OPAM installations, and easily use my copy until John gets a chance to integrate my changes properly upstream.</p>
</li>
</ul>

<p>Total time including this blog post: 40 minutes. Now, onto fixing the author responses comments for Real World OCaml now. I&#8217;m so happy to have <code>cpdf</code> as a simple, hackable PDF utility, as it does things like page combining and rotations that have always been a little flaky in other tools for me. It&#8217;s the <a href="http://johnmacfarlane.net/pandoc/">Pandoc</a> of PDFs!</p></div>







<p class="date"><a href="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools.html">Sun, 15 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/pwang.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html"><a name="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html"> </a>
<h2 class="posttitle"><a href="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html">OMD: a Markdown parser in OCaml</a>
(<a href="http://pw374.github.io/" title="pw374">Philippe Wang</a>)
</h2>
<hr /><div class="entry"><div class="content"><h3 id="Motivations"> Motivations</h3>
<p>There  are  so many  existing  implementations  of  Markdown, why  yet
another one?   Well, after asking  the OCaml community  about existing
ways to parse and manipulate  Markdown documents, it seemed that there
were no stand-alone complete Markdown parser written in OCaml, meaning
that they  were incomplete (i.e., not fully  compatible with Markdown)
or  interfaces  to  some  Markdown  parsers  implemented  using  other
languages than OCaml.</p>
<p>Since in OCaml  Labs we're working a lot with  Github, and Github uses
Markdown a  lot (Github  web pages hosting,  Github issues,  etc.) and
other  sites are also  using Markdown  as well,  and Markdown  is very
popular and  easy to  learn, and  flexible in the  sense that  you can
always  fall back  to HTML  when you  want to  express  something that
doesn't have  a special syntax in  Markdown, blah blah blah,  it was -
somehow - time to have  a Markdown parser implemented using OCaml. And
preferably  OCaml alone,  meaning that  one that  has  OCaml installed
should be able  to use it easily without having to  deal with too many
dependencies. Well, there it is: OMD!</p>
<h3 id="IssueswereessentiallywithMarkdownitself"> Issues... were essentially with Markdown itself</h3>
<p>Every computer  scientist knows how to  write a parser  for a language
that is as simple as Markdown. Well, no, not every computer scientist,
sadly, but at least every programmer should. Ok, sadly it isn't really
the case either. Anyways.</p>
<p>Markdown is a rather simple language,  if you look at the specs. Well,
that depends on what you actuall call "specs", of course. According to
<a href="http://en.wikipedia.org/wiki/Markdow">Wikipedia</a>,     Markdown    was
invented by <a href="http://daringfireball.net">John Gruber</a>, and Aaron Swartz
helped  him. Then the  original document  that describes  the Markdown
language          is          available         online          there:
<a href="http://daringfireball.net/projects/markdown/syntax">http://daringfireball.net/projects/markdown/syntax</a>.  And you can see
that         searching        for         <a href="https://www.google.com/#q=Markdown+syntax">"Markdown+syntax"        on
Google</a> makes that page the
top result (and here again, I'm kind  of helping it be and stay on the
top...).</p>
<p>Actually, Markdown is not that  simple to parse.  Why? Because so many
things are  just left to the  imagination of the  people who implement
parsers  for  this  language,   because  programmes  can't  decide  by
themselves  what's right  to do.   It's  really the  author(s) of  the
programme that  decides what the  programme does. And in  Markdown, so
many  things  are ambiguous  and  Gruber's  document doesn't  actually
describe a  grammar at all.  It just tells  you how to write  this and
that, but if you write it slightly differently, it doesn't tell you
what the outcome would be. 
<em><strong>In other words, there are no errors in Markdown.</strong></em>
Every text file is a valid Markdown file, it might just be converted 
to some HTML you wouldn't expect. For instance, you may write a link 
using this  syntax:</p>
<pre><code>[blah blah blah](the-url-which-can-be-absolute-or-relative)
</code></pre>
<p>and it gets converted to</p>
<pre><code>&lt;a href="the-url-which-can-be-absolute-or-relative"&gt;blah blah blah&lt;/a&gt;
</code></pre>
<p>But if you forget the closing parenthesis, then it becomes this instead</p>
<pre><code>&lt;p&gt;[blah blah blah](the-url-which-can-be-absolute-or-relative&lt;/p&gt;
</code></pre>
<p>precisely because nothing is wrong in Markdown.</p>
<p>And what if there are parentheses in your URL? What if they are unbalanced?</p>
<h4 id="FlagrantAmbiguity"> Flagrant Ambiguity</h4>
<p>The following is some text that has to mean something in Markdown...</p>
<pre><code>* Alice is falling in love with Bob.
    * Bob is secretly in love with Alice, but he's seeing Eve.
  * Eve is in-between, she loves both Alice and Bob, she can't help it.
</code></pre>
<p>So, Pandoc, which a tool that converts a document in language A to a
document in language B, where A and B can be the same or different
languages amongst LaTeX, HTML, Markdown and (many) others, considers
that Eve is on the same level as Bob. So its HTML output is</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Alice is falling in love with Bob.
&lt;ul&gt;
&lt;li&gt;Bob is secretly in love with Alice, but he's seeing Eve.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Eve is in-between, she loves both Alice and Bob, she can't help it.&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>But if instead you add Dylan as in</p>
<pre><code>* Alice is falling in love with Bob.
   * Dylan, a new character, is being conceived here.
    * Bob is secretly in love with Alice, but he's seeing Eve.
  * Eve is in-between, she loves both Alice and Bob, she can't help it.
</code></pre>
<p>then <em>of course</em> Eve is not on the same level as Bob anymore and goes
with Dylan and Alice, Bob is on his own.</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Alice is falling in love with Bob.&lt;/li&gt;
&lt;li&gt;Dylan, a new character, is being conceived here.
&lt;ul&gt;
&lt;li&gt;Bob is secretly in love with Alice, but he's seeing Eve.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Eve is in-between, she loves both Alice and Bob, she can't help it.&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>This doesn't make much sense...</p>
<p>And Github's embedded Markdown  to HTML converter chooses some similar
broken semantics. If one writes bullets on different levels, it shouldn't
be meaningless.</p>
<p>Also, on Github, if you write</p>
<pre><code>* 1
  * 2
    * 3
      * 4
        * 5
          * 6
            * 7
              * 8
                * 9
                  * 10
</code></pre>
<p>Then 2 and 3 are on the same level, as for 4 and 5, 6 and 7, and 8 and 9.
1 and 10 are on their own. And if you extract 2 and 3, meaning</p>
<pre><code>  * 2
    * 3
</code></pre>
<p>then 2 and 3 are not on the same level anymore! 
See for yourself:</p>
<ul> <li>raw version: <a href="https://raw.github.com/pw374/sandbox/master/mad-lists.md">https://raw.github.com/pw374/sandbox/master/mad-lists.md</a>
 </li>
 <li>rendered-by-Github version: <a href="https://github.com/pw374/sandbox/blob/master/mad-lists.md">https://github.com/pw374/sandbox/blob/master/mad-lists.md</a></li>
</ul>

<p>With OMD, hopefully, there is a deterministic meaning for each level of indentation. The list where there were Alice, Bob and Eve is converted to this to the least insane semantics I could think of.</p>
<p>The idea  is that, since Eve  is neither on  the same level as  Bob or
Alice, Eve should be in a new list (because, obviously, she's the only
one on that  level anyway). So she  is in a new list.  And since she's
not on a deeper level than Bob, she shouldn't be on a sub-list of his.
But  she is  on a  deeper level  than Alice,  so she  has to  be  on a
sub-list of hers. So, here is the HTML that OMD produces:</p>
<pre><code>&lt;ul&gt;
 &lt;li&gt;Alice is falling in love with Bob.
  &lt;ul&gt;
   &lt;li&gt;Bob is secretly in love with Alice, but he&amp;apos;s seeing Eve.
   &lt;/li&gt;
  &lt;/ul&gt;
  &lt;ul&gt;
   &lt;li&gt;Eve is in-between, she loves both Alice and Bob, she can&amp;apos;t help it.
   &lt;/li&gt;
  &lt;/ul&gt;
 &lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>Oh,  you might  have  noticed  that OMD  converts  quotes to  <code>&amp;apos;</code>
because otherwise I  would need to differentiate when  they have to be
converted from when it's optional.</p>
<h3 id="Implementation"> Implementation</h3>
<p>Pandoc's documentation says</p>
<blockquote><p>In contrast to most existing tools for converting markdown to HTML,
which use regex substitutions, Pandoc has a modular design: it
consists of a set of readers, which parse text in a given format and
produce a native representation of the document, and a set of writers,
which convert this native representation into a target format.
Thus, adding an input or output format requires only adding a reader
or writer.</p>
</blockquote>
<p>Come on,  most tools are using regular  expressions substitutions?!  I
can only imagine the nightmare that  it must be to implement and debug
such an implementation  -- no wait, I can't because  I just don't want
to imagine such a nightmare.</p>
<p>I used functions and function calls, a lot of them are tail recursive,
not  all of  them but  then it  means  I don't  need them  to be  tail
recursive, and  those functions  basically take a  list of  tokens and
return a  new list  with possibly fewer  tokens and the  expression to
which the missing ones were converted into.</p>
<p>So far, in version 0.4 (which is  not released yet at the time I write
this), there's a little less than  8k lines of pure OCaml code.  (Note
that I didn't write "pure functional", I wrote "pure OCaml".)</p>
<p>OMD is an  open-source free and libre software  library that any OCaml
developer can use  (hopefully quite easily since it  doesn't depend on
anything else  that the standard  OCaml compiler and library).  And of
course, it's also  a tool for any one who write  Markdown and wants it
to be  converted (quickly)  to HTML.  OMD, so far,  is about  10 times
faster than  Pandoc, and  I didn't  even make any  efforts to  make it
fast.</p>
<h4 id="Compatibility"> Compatibility</h4>
<p>OMD has been developed using OCaml 4.0.1, <a href="https://github.com/pw374/omd/issues/19">Christophe Troestler made
me make it compatible with OCaml
3.12.1</a>.  Then I guess it
might work with older version of OCaml but it's not certain (mainly
because OCaml's standard library has slightly changed, as I think I
don't use any language features that were introduced in 3.12 or 4.0).</p>
<p>By  the way,  thank  you  Christophe for  your  support, interest  and
contributions to OMD :-)</p>
<h3 id="FutureofOMD"> Future of OMD</h3>
<p>OMD  already is  in OPAM.   A  very stable  version of  OMD should  be
released soon.   As a  tool, it takes  Markdown as input  and produces
HTML as output.   A Markdown backend has been  freshly implemented, so
you can output  Markdown as well, which is  quite useful for debugging
or if you  want to know how many iterations you  need before you reach
the fix  point. You  can also  output "text", in  the sense  that it's
basically the HTML  without the HTML tags, so  it's very non-formatted
text.  There  also are  options to output  HTML table of  contents and
parametrise their depths.</p>
<h3 id="OMDandOCamlorg"> OMD and OCaml.org</h3>
<p>We    are    at   OCaml    Labs    making    a    new   website    for
<a href="http://ocaml.org">ocaml.org</a>.   The  design   is  being  provided  by
<a href="http://www.onespacemedia.com">onespacemedia</a>.    At   the  time   I'm
writing  these  lines, I'm  using  the  HTML/CSS/JS  for the  upcoming
OCaml.org to style my new Github-hosted website, so I can play with it
<em>more</em>.</p>
<p>Most pages will be written in Markdown instead of HTML, so that people
of the OCaml community may contribute to it in a more convenient way.</p>
<p>And of course, that means that OMD will be used for OCaml.org.</p>
<p><em>started on 2013-09-05 22:31:26+01:00, (re)generated on 2013-09-12 16:36:22+01:00
</em></p></div>







<p class="date"><a href="http://pw374.github.io/posts/2013-09-05-21-31-26-about-omd.html">by Philippe Wang at Thu, 12 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=153" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=153"> </a>
<h2 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/09/ocaml-development-in-vim/">OCaml Development in Vim</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>This is a quick run-through of how I set up my development environment in vim:</p>
<p><strong>Install&#160;pathogen.vim</strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>mkdir</span> <span>-p</span> ~<span>/</span>.vim<span>/</span>autoload ~<span>/</span>.vim<span>/</span>bundle; \
curl <span>-Sso</span> ~<span>/</span>.vim<span>/</span>autoload<span>/</span>pathogen.vim \
    https:<span>//</span>raw.github.com<span>/</span>tpope<span>/</span>vim-pathogen<span>/</span>master<span>/</span>autoload<span>/</span>pathogen.vim</pre></td></tr></tbody></table></div>

<p>Add the following to ~/.vimrc:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="vim"><span>execute</span> pathogen#infect<span>(</span><span>)</span>
<span>syntax</span> <span>on</span>
<span>filetype</span> <span>plugin</span> <span>indent</span> <span>on</span></pre></td></tr></tbody></table></div>

<p><strong>Install Syntastic </strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>cd</span> ~<span>/</span>.vim<span>/</span>bundle
<span>git clone</span> https:<span>//</span>github.com<span>/</span>scrooloose<span>/</span>syntastic.git</pre></td></tr></tbody></table></div>

<p>Then quit vim and used :Helptags to check installs so fat have worked.</p>
<p><strong>Install Merlin</strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">opam switch 4.01.0dev+trunk
opam update
opam upgrade
opam <span>install</span> merlin</pre></td></tr></tbody></table></div>

<p>Add the following to ~/.vimrc</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="vim"><span>:</span><span>set</span> <span>rtp</span><span>+</span>=<span>~/.</span>opam<span>/</span>4<span>.</span>01<span>.</span>0dev<span>+</span>trunk<span>/</span>share<span>/</span>ocamlmerlin<span>/</span>vim
<span>:</span><span>set</span> <span>rtp</span><span>+</span>=<span>~/.</span>opam<span>/</span>4<span>.</span>01<span>.</span>0dev<span>+</span>trunk<span>/</span>share<span>/</span>ocamlmerlin<span>/</span>vimbufsync
<span>let</span> g<span>:</span>syntastic_ocaml_checkers=<span>[</span><span>'merlin'</span><span>]</span></pre></td></tr></tbody></table></div>

<p>:SyntasticInfo will return a list of syntax checkers available to Syntastic, check that this now includes merlin</p>
<p><strong>Install OCP Indent</strong></p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">opam <span>install</span> ocp-indent</pre></td></tr></tbody></table></div>

<p>Add the following to ~/.vimrc</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="vim"><span>autocmd</span> <span>FileType</span> ocaml source <span>/</span>home<span>/</span>heidi<span>-</span>ann<span>/.</span>opam<span>/</span>4<span>.</span>01<span>.</span>0dev<span>+</span>trunk<span>/</span>share<span>/</span>typerex<span>/</span>ocp<span>-</span><span>indent</span><span>/</span>ocp<span>-</span><span>indent</span><span>.</span>vim</pre></td></tr></tbody></table></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/09/ocaml-development-in-vim/">by Heidi-ann at Mon, 09 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging"><a name="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging"> </a>
<h2 class="posttitle"><a href="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html">OCamlot--exploring the edges of OPAM packages</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>The new release of OCaml (4.01.0) was just <a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html">announced</a>! The runup to a major release like this is normally a frantic time to test that your favourite applications don&#8217;t break unexpectedly due to some incompatible language feature. This release cycle has a little different though, as we&#8217;ve been working hard on using the <a href="http://opam.ocamlpro.com">OPAM</a> package database to build an online regression testing infrastructure to mechanize much of this process.</p>

<p>I wanted to share some of what OCamlot does today, some of the results from about 3 months worth of runs that may help OCaml package maintainers, and finally where we&#8217;re going with future developments. This work has been done in collaboration with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html">David Sheets</a> (who built the OCamlot daemon) and the OPAM team ably led by <a href="http://gazagnaire.org">Thomas Gazagnaire</a> at <a href="http://ocamlpro.com">OCamlPro</a>. We&#8217;ve also had a lot of help from <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/ysulsky">Yury Sulsky</a> from Jane Street and <a href="http://dave.recoil.org">Dave Scott</a> and <a href="http://jon.recoil.org">Jon Ludlam</a> from Citrix acting as guinea pigs for their respective regular releases of the <a href="https://github.com/janestreet">Core</a> and <a href="https://github.com/xapi-project">Xen/XAPI</a> releases to OPAM.</p>

<h2 id="towards_a_truely_portable_ocaml">Towards a truely portable OCaml</h2>

<p>The upstream OCaml toolchain is built on very UNIX-like principles, with a number of command-line tools that form a build pipeline. This process usually ends with linking the intermediate object files with a <a href="https://github.com/ocaml/ocaml/tree/trunk/byterun">runtime library</a> that provides the garbage collector and other intrinsic OS functions.</p>

<p>Given these raw compiler tools, it&#8217;s very easy to compile OCaml into all sorts of weird and wonderful architectures. We&#8217;ve seen it run on <a href="http://www.algo-prog.info/ocaml_for_pic/web/index.php">8-bit PICs</a>, several efficient Javascript backends (originally <a href="http://jaked.github.io/ocamljs/">ocamljs</a> and more recently <a href="http://ocsigen.org/js_of_ocaml">js_of_ocaml</a>), and of course my own <a href="http://openmirage.org">Mirage</a> Xen unikernel.</p>

<p>While the compiler tools themselves are quite portable and work on almost any UNIX-like system, the build system scaffolding around third-party packages is less portable. Some features such as C bindings often contribute to build breakage on some less-used operating systems such as FreeBSD or OpenBSD, as they usually require probing for header file locations or adding custom <code>CFLAGS</code> before building.</p>
<table align="center" width="90%"><tbody><tr><td class="bimg" width="30%"><a href="http://anil.recoil.org/images/dreamplug-nest-1.jpg"><img border="0" src="http://anil.recoil.org/images/dreamplug-nest-1-thumb.jpg" width="200" /></a><br />Every Internet of Things starts with a tangled pile of ARM Dreamplugs.</td>
<td class="bimg" width="30%"><a href="http://anil.recoil.org/images/sparc-macppc-openbsd-1.jpg"><img border="0" src="http://anil.recoil.org/images/sparc-macppc-openbsd-1-thumb.jpg" width="200" /></a><br />And in our server room, venerable Sparc and PowerPC G4 OpenBSD boxen still live.</td>
<td class="bimg" width="30%"><a href="http://anil.recoil.org/images/macppc-desktop-1.jpg"><img border="0" src="http://anil.recoil.org/images/macppc-desktop-1-thumb.jpg" width="200" /></a><br />Finding older machines is getting tough, but here's <a href="http://dave.recoil.org">Dave's</a> old iMac G5 running Linux.</td>
</tr>
</tbody></table>
<p>Most OCaml developers use x86-based machines and so foreign architectures also get less day-to-day testing (OCaml has superb support for fast native code compilation on ARM, PowerPC, Sparc32, and we&#8217;re working on MIPS64 here as part of the <a href="http://www.cl.cam.ac.uk/research/security/ctsrd/cheri.html">CHERI</a> project).</p>

<p>We want to make sure that OCaml and its package ecosystem works just as well in the embedded ecosystem as well as it does on vanilla x86 Linux. This includes running on my Linux iMac G5, my <a href="https://wiki.freebsd.org/FreeBSD/arm/Raspberry%20Pi">FreeBSD Raspberry Pi</a>, my <a href="http://www.openbsd.org/beagle.html">OpenBSD Pandaboard</a>, or even on a bytecode-only architecture like an <a href="http://www.openbsd.org/sparc64.html">OpenBSD/Sparc64</a>.</p>

<p>In the longer term, this paves the way to reliable cross-compiled packages for Windows, <a href="https://github.com/vouillon/ocaml-android">Android</a> and <a href="http://psellos.com/ocaml/compile-to-iphone.html">iPhone</a> (all of which have OCaml ports, but aren&#8217;t heavily tested with the full package database). The only practical way to get started on this is by building an automated test infrastructure for OCaml that explores the feature matrix (which eerily for me, happened in the early days of Xen too, via <a href="http://blogs.citrix.com/2013/08/30/xenserver-automated-testing-and-lab-orchestration-introducing-xenrt/">XenRT</a> to stabilize the hypervisor).</p>

<h3 id="why_not_jenkins_or_travis">Why not Jenkins or Travis?</h3>

<p>When we first started hacking on the OPAM testing infrastructure earlier this year, I maintained a local <a href="http://jenkins-ci.org">Jenkins</a> installation that monitored the repository. While Jenkins is a superb tool for many continuous integration tasks, it fell over badly when trying to use it on the non-x86 and non-Linux (or Windows) operating systems. Jenkins requires a full Java runtime stack to be available on each of the client machines, which was taking up more time to get up and running than a simple OCaml-based client and server that could compile to both portable bytecode or fast native code.</p>

<p>The other difficulty with OPAM is selecting which packages actually need to be tested, as it has a constraint-based package solver that supports expressive forwards and backwards version restrictions. While basic tests of the latest packages worked with Jenkins, we needed to increasingly customize it to automate interfacing directly with the OPAM libraries and calculating test schedules based on incoming change requests.</p>

<p>Another factor that ruled out depending on hosted services such as <a href="https://travis-ci.org">Travis</a> is that they tend to support x86-only architectures, whereas we really want to test the full spectrum of CPU variants supported by OCaml. This doesn&#8217;t mean that there&#8217;s no place for Travis of course, and in fact Mike Lin has already <a href="http://blog.mlin.net/2013/02/testing-ocaml-projects-on-travis-ci.html">made this work</a> with OPAM.</p>

<p>For our full testing needs though, <a href="https://github.com/ocamllabs/ocamlot">OCamlot</a> was born: an OCaml client and server system which coordinates different versions of the compiler, architectures and OPAM versions and records the results for triage and fixing issues.</p>

<h3 id="running_ocamlot">Running OCamlot</h3>

<p>The latest alpha release of OCamlot is pretty straightforward to run locally, if you are so inclined. First start a server process:</p>

<pre><code>$ git clone git://github.com/ocamllabs/ocamlot
$ cd ocamlot
$ ./install_deps.sh
$ oasis setup
# (edit lib/config.ml if you need to change ports)
$ make
$ ./_build/lib/ocamlot_cmd.native --help
$ ./_build/lib/ocamlot_cmd.native serve</code></pre>

<p>The server listens on localhost only by default, and normally an SSL-to-TCP proxy is deployed to listen for external connections (I use <a href="https://github.com/bumptech/stud">stud</a>, which is fast and easy to configure).</p>

<p>The OCamlot clients require a local compilation of OCaml, and they autodetect their local CPU architecture and operating system. I&#8217;ve put a <a href="https://gist.github.com/avsm/6393649">gist script</a> together that automates this on most Linux and BSD variants. Just customize the top variables (set <code>MAKE</code> to <code>gmake</code> under BSD) and set the hostname to your server process.</p>

<h3 id="the_results_repository_and_autotriage">The results repository and auto-triage</h3>

<p>Once the client is running, the server dispatches tasks from its test matrix, which is calculated from the OPAM package repository. The server maintains a <a href="https://github.com/ocamlot/ocamlot-state">results repository</a>, which is a Git filesystem database that records the build results and logs via an s-expression per task. It also uses <a href="https://github.com/mirage/ocaml-cohttp">Cohttp</a> to serve up the results for a web browser.</p>

<p>It&#8217;s very convenient using Git repositories like this since we can use GitHub (or any other Git host) to coordinate and record results, and restart the server without needing any local state. So convenient, in fact, that Thomas and I have been working on a more formal engine for this called <a href="https://github.com/samoht/irminsule">Irminsule</a> (more on that in a later post, though).</p>

<p>It&#8217;s almost unheard of to have a full OCamlot run go by without some errors, and so David put together the <code>ocamlot triage</code> command. This takes the state repository and runs a set of regular expressions over it to classify them into common errors. The full file is <a href="https://github.com/ocamllabs/ocamlot/blob/master/lib/result.ml">here</a>, but an excerpt should give you an idea of what we look for:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="c">(* ordered minor to severe *)</span>
	<span class="k">type</span> <span class="n">analysis</span> <span class="o">=</span>
	  <span class="o">|</span> <span class="nc">Solver</span> <span class="k">of</span> <span class="n">solver_error</span> <span class="n">option</span>
	  <span class="o">|</span> <span class="nc">Dep</span> <span class="k">of</span> <span class="kt">string</span> <span class="o">*</span> <span class="n">analysis</span>
	  <span class="o">|</span> <span class="nc">Transient</span> <span class="k">of</span> <span class="n">transient_error</span>
	  <span class="o">|</span> <span class="nc">System</span> <span class="k">of</span> <span class="n">system_error</span>
	  <span class="o">|</span> <span class="nc">Meta</span> <span class="k">of</span> <span class="n">meta_error</span>
	  <span class="o">|</span> <span class="nc">Ext_dep</span> <span class="k">of</span> <span class="n">ext_dep_error</span>
	  <span class="o">|</span> <span class="nc">Build</span> <span class="k">of</span> <span class="n">build_error</span>
	  <span class="o">|</span> <span class="nc">Multiple</span> <span class="k">of</span> <span class="n">analysis</span> <span class="kt">list</span>
	    <span class="k">with</span> <span class="n">sexp</span>
	
</code></pre>
</div>
<p>The errors are ordered by severity to aid in color highlighting. They start with OPAM solver failures and dependency failures (e.g. due to trying to build a package that requires a specific OCaml version that isn&#8217;t available), and move onto missing package dependencies or system libraris.</p>

<h2 id="testing_the_run_up_to_ocaml_401">Testing the run up to OCaml 4.01</h2>

<p>Of course, running all these tests is useless without taking action on the results. I&#8217;ve been keeping track of them in <a href="https://github.com/OCamlPro/opam-repository/issues/1029">issue #1029</a>. The nice thing about GitHub issues is that when this bug is referenced in commits (even in other repositories) a cross-reference shows up on that webpage and lets everything be tracked nicely.</p>

<p>So what were the most common failures in the runup to 4.01, and what should you avoid when writing your own code?</p>

<h3 id="different_standard_library_module_signatures">Different standard library module signatures</h3>

<p>There have been a few changes to some of the functor signatures in the standard library, such as adding a <code>find</code> function to Set (<a href="http://caml.inria.fr/mantis/view.php?id=5864">mantis #5864</a>). A third-party library that tries to match the functor signature will fail to compile with a type error, such as this one below for <a href="http://anil.recoil.org/feeds/atom-ocaml.xml">zipperposition.0.2</a>:</p>

<pre><code>Error: The implementation src/ptset.ml
       does not match the interface src/ptset.cmi:
       ...
       In module Big:
       The field `find' is required but not provided</code></pre>

<p>The relevant code in <code>zipperposition</code> makes it clear what the problem is:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="c">(* Big-endian Patricia trees *)</span>
	<span class="k">module</span> <span class="nc">Big</span> <span class="o">:</span> <span class="k">sig</span>
	  <span class="k">include</span> <span class="nn">Set</span><span class="p">.</span><span class="nc">S</span> <span class="k">with</span> <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="kt">int</span>
	  <span class="k">val</span> <span class="n">intersect</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
	<span class="k">end</span>
	
</code></pre>
</div>
<p>This particular bug was <a href="https://github.com/c-cube/zipperposition/issues/1">reported upstream</a>, and the fix requires implementing the <code>find</code> function for the Patricia-tree-based <code>Set</code>. Since the OPAM package will always be broken on OCaml 4.01, it was marked with a <a href="https://github.com/ocamlpro/opam-repository/commit/e45530205987f67d4316a958446d3dcc954b19ec">compiler version constraint</a> to prevent it being selected for installation under that compiler. When a new version with the fix is uploaded to OPAM, it will always be selected in preference to this broken one.</p>

<p>One other 4.01 change that temporarily broke most of the bigger networking libraries such as <a href="https://github.com/janestreet/core">Core</a>, <a href="https://ocsigen.org/lwt">Lwt</a> and <a href="http://batteries.forge.ocamlcore.org">Batteries</a> was the addition of the <a href="http://caml.inria.fr/mantis/view.php?id=5568">close-on-exec</a> flag to the <code>Unix</code> module. This change only affects upstream packages that redefine the UNIX module for their own purposes (such as adding an asynchronous I/O monad as Lwt does), hence it affects the standard library replacement packages.</p>

<p>The fix here was to locally add patches into the relevant OPAM packages to immediately unbreak things when the fix when into the 4.01 branch of the compiler, and notify upstream maintainers to release new versions of their projects. There&#8217;s a subtle problem here: when a patch such as this goes into an unreleased branch of the compiler (such as <code>4.01.0dev</code>), it&#8217;s hard to reliably detect if the user has got the very latest version of the compiler or not. If you do have problems like this in the future, try recompiling via <code>opam switch reinstall &lt;version&gt;</code> to the latest branch.</p>

<p>It&#8217;s very useful to be able to drop in bleeding-edge compiler tools into the OPAM repository using compiler constraints like this. For an example, see Alain Frisch&#8217;s <a href="https://github.com/OCamlPro/opam-repository/blob/master/packages/ppx_tools.0.1/opam">ppx_tools</a>, that require the very latest 4.02dev trunk release to compile his new extension-points feature.</p>

<h3 id="multiple_object_definitions">Multiple object definitions</h3>

<p>OCaml 4.01 also restricts multiple method definitions with the same name in the same object. This leaves only inheritance as the way to override method names, but some packages such as OCamlnet and Mlorg had minor uses of the old mechanism.</p>

<p>You can see this by using <code>opam switch</code>:</p>

<pre><code>$ opam switch 4.00.1
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
- : &lt; x : int &gt; = &lt;obj&gt;
$ opam switch 4.01.0
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
Error: The method `x' has multiple definitions in this object</code></pre>

<h3 id="new_warnings_and_the_dreaded_warningsaserrors">New warnings, and the dreaded warnings-as-errors</h3>

<p>After a decade of being deprecated, the <code>(or)</code> and <code>(&amp;)</code> operators finally had a warning turned on by default.</p>

<pre><code>$ ocaml
# true or false;;
Warning 3: deprecated feature: operator (or); you should use (||) instead
- : bool = true</code></pre>

<p>This wouldn&#8217;t normally be so bad, except that a surprising number of released packages also turn warnings into fatal errors (by using the <code>-w @</code> flags explained in the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/comp.html">manual</a>). Warnings-as-errors is extremely useful when <em>developing</em> code but is rather harmful in released code, since a future compiler can choose to emit new warnings that aren&#8217;t necessarily fatal bugs.</p>

<p>Packages that failed like this include ocamlgraph, spotlib, quickcheck, OPA, Lablgtk-extras and many more. Please do make an effort to not leave this option turned on in your packages, or else it makes life more difficult for testing your code on bleeding edge versions of the compiler in the future.</p>

<p>It&#8217;s worth noting here that OCaml 4.01 has introduced a fair number of new and very useful warnings across a number of areas, mainly to do with detecting unexpected ambiguation or shadowing of values. I&#8217;ll cover more on these in a future post about the new 4.01 goodies.</p>

<h3 id="external_system_dependencies">External system dependencies</h3>

<p>While there any many packages in OPAM that are pure OCaml, there are also a substantial number that require other system tools to be installed. The Lablgtk GUI library obviously requires the C <code>gtk</code> library to be installed.</p>

<p>Determining if these libraries are installed on a particular OS is well beyond the scope of OPAM, as there are almost as many package managers as there are operating systems. However, it&#8217;s important for automated testing and user-friendly error messages to have some notion of detecting if the environment is ready for the OCaml package or not.</p>

<p>We&#8217;re solving this by using a <code>depexts</code> field in OPAM that consists of a set of tags that identify OS-specific packages that need to be present. A separate script can query these tags from OPAM and do the OS-specific tests or installation.</p>

<p>For example, here&#8217;s the <code>sqlite3-ocaml</code> OPAM description:</p>

<pre><code>opam-version: "1"
maintainer: "markus.mottl@gmail.com"
build: [
  ["ocaml" "setup.ml" "-configure"]
  ["ocaml" "setup.ml" "-build"]
  ["ocaml" "setup.ml" "-install"]
]
remove: [ ["ocamlfind" "remove" "sqlite3"] ]
depends: ["ocamlfind"]
depexts: [
  [ ["debian"  ] [ "libsqlite3-dev"]    ]
  [ ["freebsd" ] [ "database/sqlite3"]  ]
  [ ["openbsd" ] [ "database/sqlite3"]  ]
]</code></pre>

<p>The <code>depexts</code> field here lists APT package for Debian, and the ports tree locations for FreeBSD and OpenBSD. It could also list more specialised tags for particular versions of an OS. You can query this from OPAM as follows:</p>

<pre><code>$ opam install -e debian sqlite3-ocaml
libsqlite3-dev
$ opam install -e openbsd sqlite3-ocaml
database/sqlite3</code></pre>

<p>OCamlot therefore needs to query the <code>depexts</code> field from the package and run the right <code>apt</code> or <code>pkg_add</code> commands. I&#8217;ll write about this in more detail when it&#8217;s fully baked, as we&#8217;ve modified the semantics of the tag querying between OPAM 1.0 and OPAM 1.1 to make it easier to use in OCamlot.</p>

<h3 id="portable_shell_scripts">Portable shell scripts</h3>

<p>Once we&#8217;ve gotten past the hurdle of the compiler version causing failures, there is the small matter of testing non-Linux operating systems, as well as non-x86 CPU architectures. The <a href="https://github.com/OCamlPro/opam-repository/issues/1029">#1029 overview</a> lists many of these failures under the Portability section.</p>
<a href="http://www.openbsd.org"><img src="http://anil.recoil.org/images/ppuf200X181.gif" /></a>
<p>Damien Doligez made some excellent points about how to write <a href="http://gallium.inria.fr/blog/portable-conditionals-in-makefiles/">portable Makefiles</a> that works across both GNU and BSD makes. This is why the carefully crafted OCaml Makefiles do not require GNU make to be installed when compiling on FreeBSD or OpenBSD (MacOS X gave up the fight a long time ago and installs GNU make as its default <code>make</code> command).</p>

<p>OPAM tries to help out BSD by providing a <code>make</code> macro in <code>opam</code> files that is substituted with either <code>"make"</code> (by default) or <code>"gmake"</code> (for BSD). While this works for for the toplevel invocation of the Makefile, it fails if the Makefile recursively invokes further targets without using the <code>$(MAKE)</code> variable instead of directly calling the command. Patching these sorts of things is easy but tedious: see the <a href="https://github.com/OCamlPro/opam-repository/blob/master/packages/facile.1.1/files/bsdmake.patch">patchfile</a> for the Facile constraint programming library for an example.</p>

<p>The real problem here, of course, is that package maintainers cannot be reasonably expected to test their code on systems that they don&#8217;t normally use&#8211;if we demanded perfect portability to be present in the main OPAM repository, we would&#8217;t get any submissions!</p>

<p>OCamlot automates this nicely though, by finding lots of portability bugs automatically, and maintainers are by-and-large very responsive when we report the problem upstream.</p>

<h2 id="the_emerging_distributed_workflow">The emerging distributed workflow</h2>

<p>The big drawback to OCamlot in its current form is the amount of triage effort it puts on the OPAM maintainers. The package database has now exceeded 500 packages in just a short few months, and has over 1500 unique versions that all need build testing and more accurate constraints. The wider community has been <em>really</em> keen to participate in helping with triage (just look at all the other people that leapt in on <a href="https://github.com/OCamlPro/opam-repository/issues/1029">bug #1029</a>), so its our immediate priority to make OCamlot more transparent for people that want to use it to improve their own packages, and in the future also use it to test various hypotheses about all the available open-source OCaml code (see Jacques&#8217; experiment with <a href="http://gallium.inria.fr/blog/monomorphic_let/">monomorphic let</a> as an example of something that can benefit from wider automated compilation).</p>

<p>I&#8217;ll talk more about how we&#8217;re solving this in my upcoming <a href="http://ocaml.org/meetings/ocaml/2013/">OCaml 2013 Workshop</a> talk about the Platform. I don&#8217;t want spoil it too much, but it involves a lovely distributed Git workflow, an enhanced <a href="https://github.com/OCamlPro/opam2web">opam2web</a>, and a brand new metadata overlay system for OPAM that lets us enhance the package database with extra information such as statistics, portability and test results, but without polluting the main Git repository with all this extra non-essential data.</p>

<p>If you&#8217;re really curious to know right now, then you can see the outline of the new system at Amir&#8217;s <a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">new ocaml.org wireframes</a> blog post, where Part III contains the continuous integration workflow. A lot of infrastructure work has gone into building all of this over the summer, and now it&#8217;s all starting to be deployed in a very satisfying way&#8230;</p></div>







<p class="date"><a href="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html">Sun, 08 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/dbuenzli.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="urn:uuid:0f9d7209-2382-5f9c-9874-00401db52a24" lang="en"><a name="urn:uuid:0f9d7209-2382-5f9c-9874-00401db52a24"> </a>
<h2 class="posttitle"><a href="http://erratique.ch/software">Uutf 0.9.3 and Xmlm 1.2.0</a>
(<a href="http://erratique.ch/" title="Erratique">Daniel Buenzli</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>Release of Uutf 0.9.3 and Xmlm 1.2.0. Consult the individual release notes for details.</p></div>







<p class="date"><a href="http://erratique.ch/software">Fri, 06 Sep 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=25" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=25"> </a>
<h2 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/08/icfp-cufp-ocaml2013/">ICFP, CUFP &amp; OCaml2013</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>I&#8217;m busy planning my first trip across the&#160;Atlantic to attend ICFP, CUFP and OCaml 2013. Today, I&#8217;ve been given the duty of &#8220;live blogging&#8221; the event, over at the <a href="http://www.syslog.cl.cam.ac.uk/" title="syslog">syslog</a>, the Cambridge&#160;Systems Research Group blog.</p>
<p>My other job for the event is to improve the documentation for <a href="http://janestreet.github.io/guide-async.html">Janestreet&#8217;s Async</a> library. if anyone else is keen, I would love to organise a doc-a-thon to populate the .mli files</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/08/icfp-cufp-ocaml2013/">by Heidi-ann at Wed, 28 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/introducing-vchan"><a name="http://openmirage.org/blog/introducing-vchan"> </a>
<h2 class="posttitle"><a href="http://openmirage.org/blog/introducing-vchan">Introducing vchan</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p><b>In Theory</b></p><p>Unless you are familiar with Xen's source code, there is little chance that you've ever heard of the <b>vchan</b> library or protocol. Documentation about it is very scarce: a description can be found on vchan's <a href="http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=xen/include/public/io/libxenvchan.h;hb=HEAD">public header file</a>, that I quote here for convenience:</p><blockquote> <p>Originally borrowed from the <a href="http://www.qubes-os.org">Qubes OS Project</a>, this code (i.e. libvchan) has been substantially rewritten [...] This is a library for inter-domain communication.  A standard Xen ring buffer is used, with a datagram-based interface built on top.  The grant reference and event channels are shared in XenStore under a user-specified path.</p> </blockquote><p>This protocol uses shared memory for inter-domain communication, i.e. between two VMs residing in the same Xen host, and uses Xen's mechanisms -- more specifically, <a href="http://www.informit.com/articles/article.aspx?p=1160234&amp;seqNum=3">ring buffers</a> and <a href="http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=tools/libxc/xenctrl.h;h=f2cebafc9ddd4815ffc73fcf9e0d292b1d4c91ff;hb=HEAD#l934">event channels</a> -- in order to achieve its aims. <b>Datagram-based interface</b> simply means that the <a href="http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=tools/libvchan/libxenvchan.h;h=6365d36a06f8c8f56454724cefc4c2f1d39beba2;hb=HEAD">interface</a> resembles UDP, although there is support for stream based communication (like TCP) as well.</p><p>Over the last two months or so, I worked on a <a href="http://github.com/mirage/ocaml-vchan">pure OCaml implementation</a> of this library, meaning that Mirage-based unikernels can now take full advantage of <b>vchan</b> to communicate with neighboring VMs! If your endpoint -- a Linux VM or another unikernel -- is on the same host, it is much faster and more efficient to use vchan rather than the network stack (although unfortunately, it is currently incompatible with existing programs written against the <code>socket</code> library under UNIX or the <code>Flow</code> module of Mirage, although this will improve). It also provides a higher level of security compared to network sockets as messages will never leave the host's shared memory.</p><p><b>Building the vchan echo domain</b></p><p>Provided that you have a Xen-enabled machine, do the following from dom0:</p><div class="ocaml"><pre><code>opam install mirari mirage-xen mirage vchan
</code></pre></div><p>This will install the library and its dependencies. <code>mirari</code> is necessary to build the <b>echo unikernel</b>:</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/mirage/ocaml-vchan
cd test
mirari configure --xen --no-install
mirari build --xen
sudo mirari run --xen
</code></pre></div><p>This will boot a <code>vchan echo domain</code> for dom0, with connection parameters stored in xenstore at <code>/local/domain/&lt;domid&gt;/data/vchan</code>, where <code>&lt;domid&gt;</code> is the domain id of the vchan echo domain. The echo domain is simply an unikernel hosting a vchan server accepting connections from dom0, and echo'ing everything that is sent to it.</p><p>The command <code>xl list</code> will give you the domain id of the echo server.</p><p><b>Building the vchan CLI from Xen's sources</b></p><p>You can try it using a vchan client that can be found in Xen's sources at <code>tools/libvchan</code>: Just type <code>make</code> in this directory. It will compile the executable <code>vchan-node2</code> that you can use to connect to our freshly created echo domain:</p><div class="ocaml"><pre><code>./vchan-node2 client <span class="keyword2">&lt;</span>domid<span class="keyword2">&gt;</span>/local/domain/<span class="keyword2">&lt;</span>domid<span class="keyword2">&gt;</span>/data/vchan
</code></pre></div><p>If everything goes well, what you type in there will be echoed.</p><p>You can obtain the full API documentation for <b>ocaml-vchan</b> by doing a <code>cd ocaml-vchan &amp;&amp; make doc</code>. If you are doing network programming under UNIX, vchan's interface will not surprise you. If you are already using vchan for a C project, you will see that the OCaml API is nearly identical to what you are used to.</p><p>Please let us know if you use or plan to use this library in any way! If you need tremedous speed or more security, this might fit your needs.</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/introducing-vchan">by Vincent Bernardoff (vb@luminar.eu.org) at Fri, 23 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=86" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=86"> </a>
<h2 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/08/real-world-ocaml-beta3-release/">Real World OCaml beta3 release</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>Beta3 of RWO is now available:&#160;<a href="https://realworldocaml.org/">https://realworldocaml.org/</a>&#160;and anil (one of the co-authors) comments on the release&#160;<a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html</a></p>
<div class="wp-caption aligncenter"><img alt="" height="236" src="https://realworldocaml.org/media/img/oreilly-cover.gif" width="180" /><p class="wp-caption-text">Cover of RWO</p></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/08/real-world-ocaml-beta3-release/">by Heidi-ann at Mon, 19 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/oscon13-trip-report"><a name="http://openmirage.org/blog/oscon13-trip-report"> </a>
<h2 class="posttitle"><a href="http://openmirage.org/blog/oscon13-trip-report">Mirage travels to OSCON'13: a trip report</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p>Now that Mirage OS is rapidly converging on a <a href="http://github.com/avsm/mirage/issues/102">Developer Preview Release 1</a>, we took it for a first public outing at <a href="http://www.oscon.com/oscon2013/">OSCON'13</a>, the O'Reilly Open Source Conference. OSCON is in its 15th year now, and is a meeting place for developers, business people and investors. It was a great opportunity to show MirageOS off to some of the movers and shakers in the OSS world.</p><p>Partly because MirageOS is about synthesising extremely specialised guest kernels from high-level code, and partly because both Anil and I are constitutionally incapable of taking the easy way out, we self-hosted the slide deck on Mirage: after some last-minute hacking -- on content not Mirage I should add! -- we built a self-contained microkernel of the talk.</p><p>This was what you might call a "full stack" presentation: the custom microkernel (flawlessly!) ran a type-safe <a href="https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml">network device driver</a>, OCaml <a href="http://github.com/mirage/mirage-net">TCP/IP stack</a> supporting an OCaml <a href="http://github.com/mirage/ocaml-cohttp">HTTP</a> framework that served slides rendered using <a href="http://lab.hakim.se/reveal-js/">reveal.js</a>. The slide deck, including the turbo-boosted <a href="http://www.youtube.com/watch?v=2Mx8Bd5JYyo">screencast</a> of the slide deck compilation, is hosted as another MirageOS virtual machine at <a href="http://decks.openmirage.org/">decks.openmirage.org</a>. We hope to add more slide decks there soon, including resurrecting the tutorial! The source code for all this is in the <a href="http://github.com/mirage/mirage-decks">mirage-decks</a> GitHub repo.</p><h3><a class="anchor-toc" name="h3-TheTalk"> The Talk</a></h3><p>The talk went down pretty well -- given we were in a graveyard slot on Friday after many people had left, attendance was fairly high (around 30-40), and the <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">feedback scores</a> have been positive (averaging 4.7/5) with comments including "excellent content and well done" and "one of the most excited projects I heard about" (though we are suspicious that just refers to Anil's usual high-energy presentation style...).</p><p> </p><p>Probably the most interesting chat after the talk was with the Rust authors at Mozilla (<a href="http://twitter.com/pcwalton">@pcwalton</a> and <a href="https://github.com/brson">@brson</a>) about combining the Mirage <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">unikernel</a> techniques with the <a href="http://www.rust-lang.org">Rust</a> runtime. But perhaps the most surprising feedback was when Anil and I were stopped in the street while walking back from some well-earned sushi, by a cyclist who loudly declared that he'd really enjoyed the talk and thought it was a really exciting project -- never done something that achieved public acclaim from the streets before :)</p><h3><a class="anchor-toc" name="h3-BookSigningandXen.org"> Book Signing and Xen.org</a></h3><p>Anil also took some time to sit in a book signing for his forthcoming <a href="http://realworldocaml.org">Real World OCaml</a> O'Reilly book.  This is really important to making OCaml easier to learn, especially given that all the Mirage libraries are using it.  Most of the dev team (and especially thanks to <a href="https://twitter.com/heidiann360">Heidi Howard</a> who bravely worked through really early alpha revisions) have been giving us feedback as the book is written, using the online commenting system.</p><p>The Xen.org booth was also huge, and we spent quite a while plotting the forthcoming Mirage/Xen/ARM backend. We're pretty much just waiting for the <a href="http://cubieboard.org">Cubieboard2</a> kernel patches to be upstreamed (keep an eye <a href="http://linux-sunxi.org/Main_Page">here</a>) so that we can boot Xen/ARM VMs on tiny ARM devices.  There's a full report about this on the <a href="http://blog.xen.org/index.php/2013/07/31/the-xen-project-at-oscon/">xen.org</a> blog post about OSCon.</p><h3><a class="anchor-toc" name="h3-GaloisandHalVM"> Galois and HalVM</a></h3><p>We also stopped by the <a href="http://corp.galois.com">Galois</a> to chat with <a href="https://twitter.com/acwpdx">Adam Wick</a>, who is the leader of the <a href="http://corp.galois.com/halvm">HalVM</a> project at Galois. This is a similar project to Mirage, but, since it's written in Haskell, has more of a focus on elegant compositional semantics rather than the more brutal performance and predictability that Mirage currently has at its lower levels.</p><p>The future of all this ultimately lies in making it easier for these multi-lingual unikernels to be managed and for all of them to communicate more easily, so we chatted about code sharing and common protocols (such as <a href="https://github.com/vbmithr/ocaml-vchan">vchan</a>) to help interoperability. Expect to see more of this once our respective implementations get more stable.</p><p>All-in-all OSCON'13 was a fun event and definitely one that we look forward returning to with a more mature version of MirageOS, to build on the momentum begun this year!  Portland was an amazing host city too, but what happens in Portland, stays in Portland...</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/oscon13-trip-report">by Richard Mortier (mort@cantab.net) at Thu, 08 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2"><a name="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2"> </a>
<h2 class="posttitle"><a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">Final Real World OCaml beta; the good, the bad and the ugly</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>The second and final public beta of Real World OCaml is now available: <a href="https://realworldocaml.org">https://realworldocaml.org</a></p>

<p>Release notes:</p>

<ul><li><p>Over 2,000 comments from proofreaders have been resolved. We realize that reading early content is hard work, and hugely appreciate the spirited feedback! The book is now a week away from being handed over to the O&#8217;Reilly production team for copyediting, so the window for changes are limited after that. Comments reset between milestones and so beta2 is a clean slate; we&#8217;re still working through some remaining older issues.</p>
</li>

<li><p>The chapters on first-class modules, parsing with Menhir, and objects and classes have been significantly revised from beta1. Our thanks to Leo White for contributing significantly to the latter two chapters.</p>
</li>

<li><p>All the code snippets and terminal outputs are now mechanically generated. The source code is as close to public domain as practical, at: <a href="https://github.com/realworldocaml/examples">https://github.com/realworldocaml/examples</a></p>
</li>

<li><p>The final version will have the installation chapter moved to be online only, and we intend to publish updates there to elaborate on installation and packaging mechanisms.</p>
</li>

<li><p>Exercises will be available after we go into production, and also only be available online. We really like the collaborative spirit of the commenting system, and will likely extend this to collecting exercises from our readers on an ongoing basis.</p>
</li>
</ul>

<p>There&#8217;s been quite a bit of feedback and conversation about the book, so this also seemed like a good point to checkpoint the process somewhat.</p>

<h2 id="crowd_sourcing_community_feedback">Crowd sourcing community feedback</h2>
<a href="http://realworldocaml.org"><img align="right" src="http://anil.recoil.org/images/oreilly-cover.gif" /></a>
<p><em>Good</em>: The decision to crowdsource feedback has been exhausting but very worthwhile, with over 2,200 <a href="http://github.com/ocamllabs/rwo-comments">comments</a> posted (and over 2,000 resolved by us too!). O&#8217;Reilly has a similar platform called <a href="http://atlas.labs.oreilly.com">Atlas</a> that wasn&#8217;t quite ready when we started our book, but I&#8217;d highly encourage new authors to go down this route and not stick with a traditional editorial scheme.</p>

<p>It&#8217;s simply not possible for a small group of technical reviewers to notice as many errors as the wider community has. Having said this, it&#8217;s interesting how much more focussed and critical the comments of our editor <a href="http://radar.oreilly.com/andyo">Andy Oram</a> were when compared to most of the wider community feedback, so the commenting system is definitely a complement and not a replacement to the editorial process.</p>

<h3 id="the_github_requirement">The GitHub requirement</h3>

<p><em>Bad</em>: After the first beta, we got criticized on a <a href="https://news.ycombinator.com/item?id=5893168">Hacker News</a> thread for passing around Github oAuth tokens without SSL. This was entirely my fault, and I corrected the site to be pure-SSL within 24 hours.</p>

<p><em>Ugly</em>: In my defence though, I <em>dont want</em> the authority that all the reviewers have granted to me for their Github accounts! We need just two things to enable commenting: an identity service to cut down on spam comments, and the ability to create issues in a <a href="http://github.com/ocamllabs/rwo-comments">public repository</a>. Unfortunately, Github&#8217;s <a href="http://developer.github.com/v3/oauth/#scopes">scope</a> API requires you to also grant us access to commit to public code repositories. Add on the fact that around 6,000 people have clicked through the oAuth API to review RWO, and you start to see just how much code we potentially have access to. I did try to reduce the damage by not actually storing the oAuth tokens on the server-side. Instead, we store it in the client using a secure cookie, so you can easily reset your browser to log out.</p>

<p>It&#8217;s not just about authentication either: another reader <a href="http://www.reddit.com/r/ocaml/comments/1gil84/public_beta_of_real_world_ocaml/cal811r">points out</a> that if they use GitHub during work hours, they have no real way of separating the news streams that result.</p>

<p>Much of the frustration here is that there&#8217;s nothing I can do to fix this except wait for GitHub to hopefully improve their service. I very much hope that GitHub is listening to this and has internal plans to overhaul their privilege management APIs.</p>

<h3 id="infrastructurefree_hosting">Infrastructure-free hosting</h3>

<p><em>Good</em> and <em>Bad</em>: One of my goals with the commenting infrastructure was to try and eliminate all server-side code, so that we could simply publish the book onto Github Pages and use JavaScript for the comment creation and listing.</p>

<p>This <em>almost</em> worked out. We still need a tiny HTTP proxy for comment creation, as we add contextual information such as a milestone to every new comment to make it easier to index. Setting a milestone requires privileged access to the repository and so our server-side proxy creates the issue using the user-supplied oAuth token (so that it originates from the commenter), and then updates it (via the <a href="http://github.com/bactrian">bactrian</a> account) to add the milestone add insert a little contextual comment pointing back to the book paragraph where the comment originated from.</p>

<p><em>Good</em>: The other criticism from the <a href="http://www.reddit.com/r/programming/comments/1gipea/first_public_beta_of_real_world_ocaml_book/cakmeuz">online feedback</a> was the <em>requirement</em> to have a Github login to read the book at all. This is a restriction that we intend to lift for the final release (which will be freely available online under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/">CC-BY-NC-ND</a> license), but I think it&#8217;s absolutely the right decision to gateway early adopters to get useful feedback. Even if we lost 90% of our potential reviewers through the Github auth wall, I don&#8217;t think we could have coped with another 10,000 comments in any case.</p>

<p>On the positive side, we didn&#8217;t have a single spam comment or other abuses of the commenting system at all.</p>

<p>I&#8217;ve had quite a few queries been open-sourcing the <a href="http://github.com/realworldocaml/scripts">scripts</a> that drive the server-side commenting, and this on my TODO list for after the final book has gone to production.</p>

<h2 id="autogenerating_the_examples">Auto-generating the examples</h2>

<p><em>Bad</em>: We tried for far too long during the book writing to stumble through with manual installation instructions and hand-copied code snippets and outputs. Some of our alpha reviewers pointed out <a href="https://github.com/ocamllabs/rwo-comments/issues/236">vociferously</a> that spending time on installation and dealing with code typos was not a good use of their time.</p>

<p><em>Good</em>: <a href="http://bolinfest.com">Michael Bolin</a> was entirely correct in his criticism (and incidentally, one of our most superstar reviewers). The latest beta has an entirely mechanically generated toolchain that lets us regenerate the entire book output from a cold start by cloning the <a href="https://github.com/realworldocaml/examples">examples</a> repository. In retrospect, I should have written this infrastructure a year ago, and I&#8217;d recommend any new books of this sort focus hard on automation from the early days.</p>

<p>Luckily, my automation <a href="https://github.com/realworldocaml/scripts">scripts</a> could crib heavily from existing open-source OCaml projects that had portions of what we needed, such as <a href="https://github.com/diml/utop">uTop</a> and <a href="https://github.com/ocaml/ocaml.org">ocaml.org</a> (and my thanks to <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/Chris00">Christophe Troestler</a> for their help here).</p>

<p><em>Awesome</em>: We&#8217;re hacking on a little surprise for the final online version of the book, based on this build infrastructure. Stay <a href="http://try.ocamlpro.com">tuned</a>!</p></div>







<p class="date"><a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">Mon, 05 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=99" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=99"> </a>
<h2 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/08/abstractions-and-types-for-concurrent-programming/">OCaml Lecture Notes</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>I just wanted to share these sildes from&#160;Yaron Minsky guest lecture at Princeton on &#8220;Abstractions and Types&#160;for Concurrent&#160;Programming&#8221;: [<a href="http://www.cs.princeton.edu/~dpw/courses/cos326-12/lec/asynch-and-rpc.pdf">pdf</a>] &#160;to the <a href="http://www.cs.princeton.edu/~dpw/courses/cos326-12/">COS 326</a> class and the notes from Cornell&#8217;s OCaml course called &#8220;<a href="http://www.cs.cornell.edu/Courses/cs3110/2011sp/lecturenotes.asp">Data Structures and Functional Programming</a>&#8220;, edit the URL to see notes from different years</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/08/abstractions-and-types-for-concurrent-programming/">by Heidi-ann at Thu, 01 Aug 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/xen-block-devices-with-mirage"><a name="http://openmirage.org/blog/xen-block-devices-with-mirage"> </a>
<h2 class="posttitle"><a href="http://openmirage.org/blog/xen-block-devices-with-mirage">Creating Xen block devices with Mirage</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.openmirage.org/">Mirage</a> is a <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">unikernel</a> or "library operating system" that allows us to build applications which can be compiled to very diverse environments: the same code can be linked to run as a regular Unix app, relinked to run as a <a href="https://github.com/pgj/mirage-kfreebsd">FreeBSD kernel module</a>, and even linked into a self-contained kernel which can run on the <a href="http://www.xenproject.org/">Xen hypervisor</a>.</p><p>Mirage has access to an extensive suite of pure OCaml <a href="https://github.com/mirage">libraries</a>, covering everything from Xen <a href="https://github.com/mirage/ocaml-xen-block-driver">block</a> and <a href="https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml">network</a> virtual device drivers, a <a href="https://github.com/mirage/mirage-net">TCP/IP stack</a>, OpenFlow learning switches and controllers, to SSH and <a href="https://github.com/mirage/ocaml-cohttp">HTTP</a> server implementations.</p><p>I normally use Mirage to deploy applications as kernels on top of a <a href="http://www.xenserver.org/">XenServer</a> hypervisor. I start by first using the Mirage libraries within a normal Unix userspace application -- where I have access to excellent debugging tools -- and then finally link my app as a high-performance Xen kernel for production.</p><p>However Mirage is great for more than simply building Xen kernels. In this post I'll describe how I've been using Mirage to create experimental virtual disk devices for existing Xen VMs (which may themselves be Linux, *BSD, Windows or even Mirage kernels). The Mirage libraries let me easily experiment with different backend file formats and protocols, all while writing only type-safe OCaml code thats runs in userspace in a normal Linux domain 0.</p><p><b>Disk devices under Xen</b></p><p>The protocols used by Xen disk and network devices are designed to permit fast and efficient software implementations, avoiding the inefficiencies inherent in emulating physical hardware in software. The protocols are based on two primitives:</p><ul> <li> <p><b>shared memory pages</b>: used for sharing both data and metadata</p> </li><li> <p><b>event channels</b>: similar to interrupts, these allow one side to signal the other</p> </li> </ul><p>In the disk block protocol, the protocol starts with the client ("frontend" in Xen jargon) sharing a page with the server ("backend"). This single page will contain the request/response metadata, arranged as a circular buffer or "ring". The client ("frontend") can then start sharing pages containing disk blocks with the backend and pushing request structures to the ring, updating shared pointers as it goes. The client will give the server end a kick via an event channel signal and then both ends start running simultaneously. There are no locks in the protocol so updates to the shared metadata must be handled carefully, using write memory barriers to ensure consistency.</p><p><b>Xen disk devices in Mirage</b></p><p>Like everything else in Mirage, Xen disk devices are implemented as libraries. The ocamlfind library called "xenctrl" provides support for manipulating blocks of raw memory pages, "granting" access to them to other domains and signalling event channels. There are two implementations of "xenctrl": <a href="https://github.com/mirage/mirage-platform/tree/master/xen/lib">one that invokes Xen "hypercalls" directly</a> and one which uses the <a href="https://github.com/xapi-project/ocaml-xen-lowlevel-libs">Xen userspace library libxc</a>. Both implementations satisfy a common signature, so it's easy to write code which will work in both userspace and kernelspace.</p><p>The ocamlfind library <a href="https://github.com/mirage/shared-memory-ring">shared-memory-ring</a> provides functions to create and manipulate request/response rings in shared memory as used by the disk and network protocols. This library is a mix of 99.9% OCaml and 0.1% asm, where the asm is only needed to invoke memory barrier operations to ensure that metadata writes issued by one CPU core appear in the same order when viewed from another CPU core.</p><p>Finally the ocamlfind library <a href="https://github.com/mirage/ocaml-xen-block-driver">xenblock</a> provides functions to hotplug and hotunplug disk devices, together with an implementation of the disk block protocol itself.</p><p><b>Making custom virtual disk servers with Mirage</b></p><p>Let's experiment with making our own virtual disk server based on the Mirage example program, <a href="https://github.com/mirage/xen-disk">xen-disk</a>.</p><p>First, install <a href="http://www.xen.org/">Xen</a>, <a href="http://www.ocaml.org/">OCaml</a> and <a href="http://opam.ocamlpro.com/">OPAM</a>. Second initialise your system:</p><div class="ocaml"><pre><code>opam init
eval `opam config env`
</code></pre></div><p>At the time of writing, not all the libraries were released as upstream OPAM packages, so it was necessary to add some extra repositories. This should not be necessary after the Mirage developer preview at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">OSCON 2013</a>.</p><div class="ocaml"><pre><code>opam remote add mirage-dev git<span class="keyword2">:</span>//github.com/mirage/opam-repo-dev
opam remote add xapi-dev git<span class="keyword2">:</span>//github.com/xapi-project/opam-repo-dev
</code></pre></div><p>Install the unmodified <code>xen-disk</code> package, this will ensure all the build dependencies are installed:</p><div class="ocaml"><pre><code>opam install xen-disk
</code></pre></div><p>When this completes it will have installed a command-line tool called <code>xen-disk</code>. If you start a VM using your Xen toolstack of choice ("xl create ..." or "xe vm-install ..." or "virsh create ...") then you should be able to run:</p><div class="ocaml"><pre><code>xen-disk connect <span class="keyword2">&lt;</span>vmname<span class="keyword2">&gt;</span>
</code></pre></div><p>which will hotplug a fresh block device into the VM "&lt;vmname&gt;" using the "discard" backend, which returns "success" to all read and write requests, but actually throws all data away. Obviously this backend should only be used for basic testing!</p><p>Assuming that worked ok, clone and build the source for <code>xen-disk</code> yourself:</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/mirage/xen-disk
cd xen-disk
make
</code></pre></div><p><b>Making a custom virtual disk implementation</b></p><p>The <code>xen-disk</code> program has a set of simple built-in virtual disk implementations. Each one satisifies a simple signature, contained in <a href="https://github.com/mirage/xen-disk/blob/master/src/storage.mli">src/storage.mli</a>:</p><div class="ocaml"><pre><code><span class="keyword4">type</span> configuration <span class="keyword2">=</span> <span class="keyword2">{</span>
  filename<span class="keyword2">:</span> <span class="keyword3">string</span><span class="keyword2">;</span>      <span class="comments">(** path where the data will be stored *)</span>
  format<span class="keyword2">:</span> <span class="keyword3">string</span> option<span class="keyword2">;</span> <span class="comments">(** format of physical data *)</span>
<span class="keyword2">}</span>
<span class="comments">(** Information needed to "open" a disk *)</span>

<span class="keyword4">module</span> <span class="keyword4">type</span> <span class="keyword6">S </span><span class="keyword2">=</span> <span class="keyword4">sig</span>
  <span class="comments">(** A concrete mechanism to access and update a virtual disk. *)</span>

  <span class="keyword4">type</span> t
  <span class="comments">(** An open virtual disk *)</span>

  <span class="keyword4">val</span> open_disk<span class="keyword2">:</span> configuration -<span class="keyword2">&gt;</span> t option <span class="keyword5">Lwt.</span>t
  <span class="comments">(** Given a configuration, attempt to open a virtual disk *)</span>

  <span class="keyword4">val</span> size<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> int64
  <span class="comments">(** [size t] is the size of the virtual disk in bytes. The actual
      number of bytes stored on media may be different. *)</span>

  <span class="keyword4">val</span> read<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword5">Cstruct.</span>t -<span class="keyword2">&gt;</span> int64 -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t
  <span class="comments">(** [read t buf offset_sectors len_sectors] copies [len_sectors]
      sectors beginning at sector [offset_sectors] from [t] into [buf] *)</span>

  <span class="keyword4">val</span> write<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword5">Cstruct.</span>t -<span class="keyword2">&gt;</span> int64 -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t
  <span class="comments">(** [write t buf offset_sectors len_sectors] copies [len_sectors]
      sectors from [buf] into [t] beginning at sector [offset_sectors]. *)</span>
<span class="keyword4">end</span>
</code></pre></div><p>Let's make a virtual disk implementation which uses an existing disk image file as a "gold image", but uses copy-on-write so that no writes persist. This is a common configuration in Virtual Desktop Infrastructure deployments and is generally handy when you want to test a change quickly, and revert it cleanly afterwards.</p><p>A useful Unix technique for file I/O is to "memory map" an existing file: this associates the file contents with a range of virtual memory addresses so that reading and writing within this address range will actually read or write the file contents. The "mmap" C function has a number of flags, which can be used to request "copy on write" behaviour. Reading the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.Genarray.html">OCaml manual Bigarray.map_file</a> it says:</p><blockquote> <p>If shared is true, all modifications performed on the array are reflected in the file. This requires that fd be opened with write permissions. If shared is false, modifications performed on the array are done in memory only, using copy-on-write of the modified pages; the underlying file is not affected.</p> </blockquote><p>So we should be able to make a virtual disk implementation which memory maps the image file and achieves copy-on-write by setting "shared" to false. For extra safety we can also open the file read-only.</p><p>Luckily there is already an <a href="https://github.com/mirage/xen-disk/blob/master/src/backend.ml#L63">"mmap" implementation</a> in <code>xen-disk</code>; all we need to do is tweak it slightly. Note that the <code>xen-disk</code> program uses a co-operative threading library called <a href="http://ocsigen.org/lwt/">lwt</a> which replaces functions from the OCaml standard library which might block with non-blocking variants. In particular <code>lwt</code> uses <code>Lwt_bytes.map_file</code> as a wrapper for the <code>Bigarray.Array1.map_file</code> function. In the "open-disk" function we simply need to set "shared" to "false" to achieve the behaviour we want i.e.</p><div class="ocaml"><pre><code><span class="keyword4">let</span> open_disk configuration <span class="keyword2">=</span>
  <span class="keyword4">let</span> fd <span class="keyword2">=</span> <span class="keyword5">Unix.</span>openfile configuration.filename <span class="keyword2">[</span> <span class="keyword5">Unix.O_RDONLY </span><span class="keyword2">]</span> <span class="keyword8">0</span>o0 <span class="keyword4">in</span>
  <span class="keyword4">let</span> stats <span class="keyword2">=</span> <span class="keyword5">Unix.</span><span class="keyword5">LargeFile.</span>fstat fd <span class="keyword4">in</span>
  <span class="keyword4">let</span> mmap <span class="keyword2">=</span> <span class="keyword5">Lwt_bytes.</span>map_file ~fd ~shared<span class="keyword2">:</span>false <span class="keyword2">(</span><span class="keyword2">)</span> <span class="keyword4">in</span>
  <span class="keyword5">Unix.</span>close fd<span class="keyword2">;</span>
  return <span class="keyword2">(</span><span class="keyword6">Some </span><span class="keyword2">(</span>stats.<span class="keyword5">Unix.</span><span class="keyword5">LargeFile.</span>st_size, <span class="keyword5">Cstruct.</span>of_bigarray mmap<span class="keyword2">)</span><span class="keyword2">)</span>
</code></pre></div><p>The read and write functions can be left as they are:</p><div class="ocaml"><pre><code><span class="keyword4">let</span> read <span class="keyword2">(</span><span class="keyword8">_</span>, mmap<span class="keyword2">)</span> buf offset_sectors len_sectors <span class="keyword2">=</span>
  <span class="keyword4">let</span> offset_sectors <span class="keyword2">=</span> <span class="keyword5">Int64.</span>to_int offset_sectors <span class="keyword4">in</span>
  <span class="keyword4">let</span> len_bytes <span class="keyword2">=</span> len_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword4">let</span> offset_bytes <span class="keyword2">=</span> offset_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword5">Cstruct.</span>blit mmap offset_bytes buf <span class="keyword8">0</span> len_bytes<span class="keyword2">;</span>
  return <span class="keyword2">(</span><span class="keyword2">)</span>

<span class="keyword4">let</span> write <span class="keyword2">(</span><span class="keyword8">_</span>, mmap<span class="keyword2">)</span> buf offset_sectors len_sectors <span class="keyword2">=</span>
  <span class="keyword4">let</span> offset_sectors <span class="keyword2">=</span> <span class="keyword5">Int64.</span>to_int offset_sectors <span class="keyword4">in</span>
  <span class="keyword4">let</span> offset_bytes <span class="keyword2">=</span> offset_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword4">let</span> len_bytes <span class="keyword2">=</span> len_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span>
  <span class="keyword5">Cstruct.</span>blit buf <span class="keyword8">0</span> mmap offset_bytes len_bytes<span class="keyword2">;</span>
  return <span class="keyword2">(</span><span class="keyword2">)</span>
</code></pre></div><p>Now if we rebuild and run something like:</p><div class="ocaml"><pre><code>dd <span class="keyword1">if</span><span class="keyword2">=</span>/dev/zero <span class="keyword2">of</span><span class="keyword2">=</span>disk.raw bs<span class="keyword2">=</span><span class="keyword8">1</span><span class="keyword6">M </span>seek<span class="keyword2">=</span><span class="keyword8">1024</span> count<span class="keyword2">=</span><span class="keyword8">1</span>
losetup /dev/loop0 disk.raw
mkfs.ext3 /dev/loop0
losetup -d /dev/loop0

dist/build/xen-disk/xen-disk connect <span class="keyword2">&lt;</span>myvm<span class="keyword2">&gt;</span> --path disk.raw
</code></pre></div><p>Inside the VM we should be able to do some basic speed testing:</p><div class="ocaml"><pre><code># dd <span class="keyword1">if</span><span class="keyword2">=</span>/dev/xvdb <span class="keyword2">of</span><span class="keyword2">=</span>/dev/null bs<span class="keyword2">=</span><span class="keyword8">1</span><span class="keyword6">M </span>iflag<span class="keyword2">=</span>direct count<span class="keyword2">=</span><span class="keyword8">100</span>
<span class="keyword8">100</span><span class="keyword2">+</span><span class="keyword8">0</span> records <span class="keyword4">in</span>
<span class="keyword8">100</span><span class="keyword2">+</span><span class="keyword8">0</span> records out
<span class="keyword8">104857600</span> bytes <span class="keyword2">(</span><span class="keyword8">105</span> MB<span class="keyword2">)</span> copied, <span class="keyword8">0</span>.<span class="keyword8">125296</span> s, <span class="keyword8">837</span> MB/s
</code></pre></div><p>Plus we should be able to mount the filesystem inside the VM, make changes and then disconnect (send SIGINT to xen-disk by hitting Control+C on your terminal) without disturbing the underlying disk contents.</p><p><b>So what else can we do?</b></p><p>Thanks to Mirage it's now really easy to experiment with custom storage types for your existing VMs. If you have a cunning scheme where you want to hash block contents, and use the hashes as keys in some distributed datastructure -- go ahead, it's all easy to do. If you have ideas for improving the low-level block access protocol then Mirage makes those experiments very easy too.</p><p>If you come up with a cool example with Mirage, then send us a <a href="https://github.com/mirage">pull request</a> or send us an email to the <a href="http://www.openmirage.org/about/">Mirage mailing list</a> -- we'd love to hear about it!</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/xen-block-devices-with-mirage">by Dave Scott (dave@recoil.org) at Thu, 18 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=64" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=64"> </a>
<h2 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/07/profiling-ocaml-getting-started-guide/">Profiling OCaml &#8211; Getting Started Guide</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>&#8220;Perf&#8221; is a common command line linux tool used for code profiling, (<a href="https://perf.wiki.kernel.org/index.php/Tutorial">perf wiki</a>). A alpha version of a OCaml native code compiler that output code, that can be analysis by perf is now avalaible in OPAM</p>
<p><strong>Installation</strong></p>
<p>Installing the perf compatible OCaml compiler is straight forward with OPAM, though quite time-consuming due to the need to re-install many packages</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">$ opam remote add perf git:<span>//</span>github.com<span>/</span>mshinwell<span>/</span>opam-repo-dev
$ opam switch <span>4.01</span>-perf-annotate
$ <span>eval</span> <span>`</span>opam config <span>env</span><span>`</span>
$ opam <span>install</span></pre></td></tr></tbody></table></div>

<p>Installing perf was also straight forward, in fact I already had it via the linux-tools package in apt-get for Ubuntu.</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>sudo</span> <span>apt-get install</span> linux-tools</pre></td></tr></tbody></table></div>

<p><strong>Usage</strong><br />Compiling with the new perf-compatable Ocaml compiler was beautifully simple, running make within an existing project working first time without any further changes necessary.</p>
<p><strong>Basics</strong><br />Basic reporting is collected and viewed using:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>sudo</span> perf record .<span>/</span>myprogram.native <span>-o</span> myreport.data
<span>sudo</span> perf report <span>-i</span> myreport.data
<span>sudo</span> perf script <span>-i</span> myreport.data</pre></td></tr></tbody></table></div>

<p>Similarly basic stats can be collected using:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash"><span>sudo</span> perf <span>stat</span> .<span>/</span>myprogram.native <span>-o</span> myreport.data
<span>sudo</span> <span>cat</span> myreport.data</pre></td></tr></tbody></table></div>

<p>When finished you can switch back to your normal compiler version, i.e.</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash">$ opam switch 4.00.1
$ <span>eval</span> <span>`</span>opam config <span>env</span><span>`</span></pre></td></tr></tbody></table></div></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/07/profiling-ocaml-getting-started-guide/">by Heidi-ann at Wed, 10 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/dbuenzli.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="urn:uuid:5222d531-d414-5ae8-a340-2eb88ed31fc0" lang="en"><a name="urn:uuid:5222d531-d414-5ae8-a340-2eb88ed31fc0"> </a>
<h2 class="posttitle"><a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&amp;ASIN=0957671105&amp;linkCode=&amp;nodeID=&amp;tag=">On the book &#171; OCaml from the very beginning &#187;</a>
(<a href="http://erratique.ch/" title="Erratique">Daniel Buenzli</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>Cambridge overflows with OCaml programmers. I got to meet John Whitington of <a href="http://www.coherentpdf.com/ocaml-libraries.html">camlpdf</a> fame. He kindly offered me a copy of his book &#171;&#160;<a href="http://ocaml-book.com">OCaml from the very beginning</a>. &#187; I read it and made a small review <a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&amp;ASIN=0957671105&amp;linkCode=&amp;nodeID=&amp;tag=">here</a>.</p></div>







<p class="date"><a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&amp;ASIN=0957671105&amp;linkCode=&amp;nodeID=&amp;tag=">Thu, 04 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/heidi.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://hh360.user.srcf.net/blog/?p=90" lang="en-US"><a name="http://hh360.user.srcf.net/blog/?p=90"> </a>
<h2 class="posttitle"><a href="http://hh360.user.srcf.net/blog/2013/07/learning-async/">Learning Async</a>
(<a href="http://hh360.user.srcf.net/blog" title="/etc/hosts &#187; OCaml">Heidi Howard</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>If your taking your first steps in Janestreet&#8217;s Async library, here&#8217;s some sources of help &amp; support:</p>
<p><strong>My top 5 sources of Async Documentation</strong></p>
<ol><li>Official Janestreet Docs for Async/Core:&#160;<a href="https://ocaml.janestreet.com/ocaml-core/latest/doc/">https://ocaml.janestreet.com/ocaml-core/latest/doc/</a>&#160;These are generated from the .mli&#8217;s in the Async source and you will quickly find places where ocamldoc has failed to cope with Core/Async complex module structure. In this case, I recommend the source code:&#160;<a href="https://github.com/janestreet/async">https://github.com/janestreet/async</a></li>
<li>Dummy&#8217;s guide to Async, a useful intro to bind, upon and map (the 3 fundemental functions):&#160;<a href="http://janestreet.github.io/guide-async.html">http://janestreet.github.io/guide-async.html</a></li>
<li>Real World OCaml chapter on Async, covers Deferred basics, Ivars, Reader/Writer, TCP server, running the scheduler, Command, Pipes, Monitors, Delays, Choose and System Threads:&#160;<a href="https://realworldocaml.org/beta3/en/html/concurrent-programming-with-async.html">https://realworldocaml.org/beta3/en/html/concurrent-programming-with-async.html</a></li>
<li>Yaron Minsky (one of co-authors of RWO) provides a nice little example of Async&#8217;s RPC libraries:&#160;<a href="https://bitbucket.org/yminsky/core-hello-world">https://bitbucket.org/yminsky/core-hello-world</a></li>
<li>My favourite project for example Async and Lwt code is cohttp:&#160;<a href="https://github.com/mirage/ocaml-cohttp">https://github.com/mirage/ocaml-cohttp</a>, otherwise there&#8217;s&#160;OPAM&#8217;s list of Async dependent project, useful for finding more example code:&#160;<a href="http://opam.ocamlpro.com/pkg/async.109.38.00.html">http://opam.ocamlpro.com/pkg/async.109.38.00.html</a></li>
</ol>
<p><strong>Community</strong></p>
<p>Google group for Janestreet&#8217;s Core &amp; Async, the JS team are really helpful <img alt=":)" class="wp-smiley" src="http://hh360.user.srcf.net/blog/wp-includes/images/smilies/icon_smile.gif" />  :&#160;<a href="https://groups.google.com/forum/#!forum/ocaml-core">https://groups.google.com/forum/#!forum/ocaml-core</a></p>
<p>Async issue tracker on Github is quiet but still a good point to start a conversation:&#160;<a href="https://github.com/janestreet/async/issues?state=open">https://github.com/janestreet/async/issues?state=open</a></p>
<p><strong>Installation</strong></p>
<p>I recommend the installation chapter of Real World Ocaml:&#160;<a href="https://realworldocaml.org/beta3/en/html/installation.html">https://realworldocaml.org/beta3/en/html/installation.html</a>&#160;and install instructions for OPAM:&#160;<a href="http://opam.ocamlpro.com/doc/Quick_Install.html">http://opam.ocamlpro.com/doc/Quick_Install.html</a></p>
<p>Janestreet provide some installation hints, though this is covered for comprehensively in RWO (linked above):&#160;<a href="http://janestreet.github.io/installation.html">http://janestreet.github.io/installation.html</a></p>
<p>Very light background reading:&#160;<a href="https://ocaml.janestreet.com/?q=node/100">https://ocaml.janestreet.com/?q=node/100</a></p>
<p>&#160;</p>
<p>&#160;</p></div>







<p class="date"><a href="http://hh360.user.srcf.net/blog/2013/07/learning-async/">by Heidi-ann at Wed, 03 Jul 2013</a>
</p>
</div>
</div>


<div class="channelgroup">







<img alt="" class="face" height="50" src="images/../../mugshots/avsm.jpg" style="float:right; padding-left: 20px;" width="" />

<div class="entrygroup" id="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available"><a name="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available"> </a>
<h2 class="posttitle"><a href="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available.html">Phew, Real World OCaml beta now available.</a>
(<a href="http://anil.recoil.org" title="anil.recoil.org">Anil Madhavapeddy</a>)
</h2>
<hr /><div class="entry"><div class="content"><p>When I finished writing my PhD, I swore (as most recent graduates do) to never write a thesis again. Instead, life would be a series of pleasantly short papers, interspersed with the occasional journal article, and lots of not-writing-huge-book-activity in general.</p>
<a href="http://realworldocaml.org"><img align="right" src="http://anil.recoil.org/images/oreilly-cover.gif" /></a>
<p>Then <a href="http://cufp.org/conference/2011">CUFP 2011</a> happened, and I find myself in a bar in Tokyo with <a href="https://twitter.com/yminsky">Yaron Minsky</a> and <a href="http://monkey.org/~marius">Marius Eriksen</a>, and a dangerous bet ensued. A few short weeks after that, and Yaron and I are chatting with <a href="https://plus.google.com/111219778721183890368">Jason Hickey</a> in California about writing a book about the language we love. I&#8217;m still telling myself that this will never actually happen, but then everyone&#8217;s favourite Californirishman <a href="http://www.serpentine.com/blog/">Bryan O&#8217;Sullivan</a> puts us in touch with O&#8217;Reilly, who published his excellent <a href="http://realworldhaskell.org">Haskell</a> tome.</p>

<p>O&#8217;Reilly arranged everything incredibly fast, with our editor <a href="http://radar.oreilly.com/andyo">Andy Oram</a> driving us through the process. We decided early on that we wanted to write a book that had opinions based our personal experience: about how OCaml code should be written, about the standard library involved, and generally making functional programming more accessible. Along the way, we&#8217;ve been working incredibly hard on the underlying software platform too, with <a href="http://ocaml.janestreet.com">Jane Street</a>, <a href="http://ocamlpro.com">OCamlPro</a> and my own group <a href="http://ocaml.io">OCaml Labs</a> working together on all the pieces. There&#8217;s still a lot of work left to do, of course, but we&#8217;re right on track to get all this released very soon now.</p>

<p>So, without further ado, I was very pleased to send this e-mail this morning. (and once again reaffirm my committment to never writing another book ever again. Until next time!)</p>

<blockquote><p>Yaron Minsky, Jason Hickey and I are pleased to announce the beta release of our forthcoming O&#8217;Reilly book, called &#8220;Real World OCaml&#8221;, available online at <a href="http://realworldocaml.org">http://realworldocaml.org</a></p>

<p>The book is split into three parts: language concepts, tools and techniques, and understanding the runtime. As promised last year, we are making a public beta available for community review and to help us hunt down inaccuracies and find areas that need more clarification.</p>

<p>We&#8217;ve had the book in closed alpha for six months or so and have developed a feedback system that uses Github to record your comments. This lets us follow up to each review with clarifications and keep track of our progress in fixing issues. During alpha, we&#8217;ve received over 1400 comments in this fashion (and addressed the vast majority of them!). However, since we anticipate more comments coming in from a public beta, we would request that you read the FAQ to avoid drowning us in repeat comments: <a href="http://www.realworldocaml.org/#faq">http://www.realworldocaml.org/#faq</a>.</p>

<p>(TL;DR followup another comment on Github directly if you can instead of creating a new issue via the web interface)</p>

<p>This release is available in HTML format online at: <a href="http://realworldocaml.org">http://www.realworldocaml.org</a></p>

<p>O&#8217;Reilly is currently preparing a Rough Cuts release that will make the beta available as PDF and in popular eBook formats. We anticipate that this will be available later this week, and I&#8217;ll send a followup when that happens.</p>

<p>Finally, we would especially like to thank our alpha reviewers. Their <a href="https://github.com/ocamllabs/rwo-comments/issues">feedback</a> has been invaluable to the beta release. The book also includes substantial contributions to individual chapters from Jeremy Yallop (FFI), Stephen Weeks (GC) and Leo White (objects).</p>

<p>If you have any comments that you&#8217;d like to send directly by e-mail, please contact us at <a href="mailto:rwo-authors@recoil.org">rwo-authors@recoil.org</a>.</p>

<p>Release notes for beta1:</p>

<ul><li>The first-class modules chapter is incomplete, pending some portability improvements to the ocaml-plugins Core library.</li>

<li>The binary serialization chapter is also incomplete, but has just enough to teach you about the Async RPC library.</li>

<li>The installation chapter will be revised in anticipation of the OCaml 4.1 release, and is currently quite source-based.</li>

<li>The packaging and build systems chapter hasn&#8217;t been started yet. We&#8217;re still deciding whether or not to make this an online pointer rather than a print chapter, since it&#8217;s likely to change quite fast.</li>

<li>We are preparing exercises per chapter that are not included in this particular beta release, but will be available online as soon as possible.</li>

<li>The code examples will all be clonable as a separate repository in beta2.</li>
</ul>

<p>best, Yaron, Jason and Anil</p>
</blockquote></div>







<p class="date"><a href="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available.html">Sun, 16 Jun 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01"> </a>
<h2 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jun%202013">Jun 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/rwo-celebration.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/rwo-celebration-thumb.jpg" /></a>
The rain continues to plummet down relentlessly as "summer" starts in OCaml
Labs. The most exciting news has been the public release of the <a href="https://realworldocaml.org">Real World
OCaml</a>, which hit the front page of the usual news
aggregators and generated huge interest!  This (reminiscent of the Xen 1.0
release) promptly took down servers for a couple of hours, but we managed to
minimise downtime in time for the Californians waking up.</p>
<p>O'Reilly has also started selling PDF copies of the book under their <a href="http://shop.oreilly.com/product/0636920024743.do">Rough
Cuts</a> program.  This gives you
a copy of the final book when it's released too.  Commenting is still open
on the <a href="http://realworldocaml.org">online version</a>, so please do feel free to
participate there if you have time.</p>
<h3 id="SystemsProjects"> Systems Projects</h3>
<p><b>Mirage</b>: Anil and Dave did the last of the sweeping build changes to make
Mirage friendlier to use for beginners.  Previously, we required a custom OPAM
switch to build kernels, but now we use <a href="http://www.openmirage.org/wiki/weekly-2013-06-11">virtual
packages</a> to separate the
choice of compiler and packages.  This of course breaks all our documentation,
but we're going to do a big sweep in July before
<a href="http://www.oscon.com/oscon2013/public/schedule/speaker/109140">OSCON</a> with the
new scheme.  Vincent has also been burning through the core platform libraries,
cleaning them up and adding documentation strings.  He is also building a
shared memory <a href="http://github.com/vbmithr/ocaml-vchan">vchan</a> driver that will
make parallel-Mirage unikernels very easy to coordinate on the same host.</p>
<p>The huge news from our friends at Citrix is the open-sourcing of
<a href="http://www.xenserver.org">XenServer</a>, which is the popular Citrix product that
embeds the <a href="https://github.com/xapi-project">OCaml XAPI</a> cloud management
stack.  There are almost 100 major components
<a href="http://github.com/xenserver">released</a> as part of this, several of which can
be directly reused with Mirage.  Mirage was always an ambitious project, but
it's all coming together now thanks to bold moves such as this from Citrix!</p>
<p><b>Signpost:</b> We woke up to the excellent but slightly scary news that
our <a href="https://www.usenix.org/conference/foci13">USENIX FOCI</a> paper was accepted.
This now means that we get to present it in August at USENIX Security, but
the team is now racing to pull together the prototypes into a complete system
before the conference.  Nothing like a deadline to focus the mind!  We're
also working on the camera-ready version of the paper, which we will share
here when it's ready.</p>
<h3 id="PlatformProjects"> Platform Projects</h3>
<p><b>OCamlot:</b> David Sheets did an astounding job at pulling together a
working continuous build system in a very short amount of time, and promptly
managed to melt some of the older <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool">non-x86
machines</a> in Anil's office.  Once Anil
sadly replaced them, the builder churned through a matrix of different compiler
versions (4.0,4.1dev,4.2dev), architectures (x86, x86_64, ARM, PowerPC), and
operating systems (Debian, Ubuntu, FreeBSD, OpenBSD to start with).  There's
a <a href="https://ocaml-www3.ocamllabs.cl.cam.ac.uk/github/OCamlPro/opam-repository">development URL</a>, but
the next step is to retire this and move it to a proper home at <a href="http://ocaml.org">ocaml.org</a>.</p>
<p>Having continuous build for OPAM is really, really useful though, as it lets us
vet pull requests on several architectures before merging them. It also let
Anil repair OCaml on <a href="https://github.com/avsm/ocaml/commit/c1da5f35cda0ee85e576197b88f503333ed9e9a1">OpenBSD/macppc</a>
too, which is possibly the most obscure fix he's done in a while.</p>
<p>The next steps with OCamlot are to take a shot at porting the core to
<a href="http://github.com/janestreet/jenga">Jenga</a>, which is Jane Street's next-generation
distributed build system.  This should let us improve the fault-tolerance and
logging aspects of it before putting it properly into production later in the summer.</p>
<p><b>Ctypes:</b> The May <a href="http://github.com/ocamllabs/ocaml-ctypes">release</a>
brought with it a good chunk of feedback, so Jeremy spent time incorporating
that and contributing to the Real World OCaml ctypes chapter.  He also added
support for garbage-collecting closures passed to C, and also very cool support
for <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/27">printing C types and values</a>.
Our friends at Citrix have started looking at ctypes, and Rob Hoes has already
used it to write <a href="https://github.com/robhoes/ocaml-libnl">bindings</a> to the
Netlink Protocol Library Suite.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/daniel-presentation-vg.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/daniel-presentation-vg-thumb.jpg" /></a>
<b>OPAM-doc</b>: Vincent Botbol got the documentation generator stable enough
to pass the Core library through.  This is particularly challenging since Core
exercises pretty much every trick in the book when it comes to the use of the
module system.  However, Vincent successfully demonstrated the workflow of
OPAM-doc at the end-of-month meeting, and is aiming to have a public release
via OPAM in July (hopefully in time for the next beta release of Real World OCaml,
which uses Core heavily).</p>
<p><b>Visualisation libraries:</b> <a href="http://erratique.ch/contact.en">Daniel B&#252;nzli</a> has
been spending a few months based in Citrix, working on a foundational new
declarative drawing library written in pure OCaml.  The <a href="http://erratique.ch/software/vg">Vg</a> is already quite functional despite
still being in beta, and features a <a href="http://erratique.ch/software/vg/demos/rhtmlc.html#arrowhead">Javascript backend</a>
that renders to both SVG and Canvas in HTML5.  That's not all though!  He's
also developing the <a href="http://erratique.ch/software/vz">Vz</a> visualization library
that uses Vg to assemble more complex scenes and graphs.  Daniel's going to
join us in OCaml Labs for the remainder of the summer, so we're looking
forward to developing this more and using it on our various Platform projects
such as OCamlot.</p>
<h3 id="Outreach"> Outreach</h3>
<p><b>Real World OCaml:</b> As mentioned earlier, the beta release of RWO went
splendidly, with a pleasing vibe that the book is what people expected.  There
were some interesting criticisms of the choice of Github authentication, but
we've had over 6000 registered commentators despite this (and of course, we
have plans <a href="http://nymote.org">brewing</a> to tackle the identity problem).</p>
<p>No beta release is perfect, of course, and our now-public commenting system has
resulted in <a href="https://github.com/ocamllabs/rwo-comments/issues">over 1500</a>
issues being raised.  Well, that's all of Yaron, Anil and Jason's free time
gone for some time!</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/amir-shisha.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/amir-shisha-thumb.jpg" /></a>
<b>OCaml.org</b>: We're in the process of looking at the site as a whole and
designing the workflow we'd like to have for growing and maintaining it.  Some
discussions have taken place about using Markdown in place of the current HTML
snippets, which would make it easier for external contributors to get involved.
In the meantime, Amir has converted the current site to Markdown format to see
how this process would work in practice.  You can see his experimenting and
scripts in the <a href="https://github.com/ocamllabs/ocaml.org-temp">temporary repo</a> in
the <code>markdown-site/</code> folder.
Philippe also showed off <a href="https://github.com/pw374/MPP-language-blender">MPP</a>
at the internal meetings, and is stabilising it for a public release this
summer (once it has been integrated into the ocaml.org workflow).</p>
<p>This month also had a number of programming language gurus show up at the Lab
for the <em>Algebraic Effects and Handlers</em> workshop organised by <a href="http://www.cl.cam.ac.uk/~ss368/">Sam
Staton</a>.  Most of the group attended this, as
we're all interested in how to encode effects for several of our projects (most
notably <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html#Irminsule">Irminsule</a>).</p>
<p>We also enjoyed a visit by <a href="https://github.com/bvaugon">Beno&#238;t Vaugon</a>, who gave a talk on his
<a href="http://oud.ocaml.org/2012/slides/oud2012-paper10-slides.pdf">OCamlCC</a>
OCaml-to-C compiler, and also participated in a talk on
<a href="http://www.algo-prog.info/ocaml_for_pic/web/index.php?id=ocapic">OCAPIC</a>. He
also chatted with us about his alternative <a href="http://caml.inria.fr/mantis/view.php?id=6017">GADT-based implementation of
Printf</a>, which promises to both
speed up and simplify the printer support in OCaml (and also relieve Mirage of
another dependency on <code>libc</code>).<br /></p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-community" href="http://blog.xen.org/index.php/2013/06/25/xenserver-org-and-the-xen-project/">XenServer open-sourced!</a> <em>(Jun 25th)</em>
 </li>
 <li><a class="icon-quick-links" href="http://realworldocaml.org">Real World OCaml public beta now available.</a> <em>(Jun 17th)</em>
 </li>
</ul>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jun%202013">by Anil Madhavapeddy (anil@recoil.org) at Sat, 01 Jun 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://openmirage.org/blog/the-road-to-a-dev-release"><a name="http://openmirage.org/blog/the-road-to-a-dev-release"> </a>
<h2 class="posttitle"><a href="http://openmirage.org/blog/the-road-to-a-dev-release">The road to a developer preview at OSCON 2013</a>
(<a href="http://openmirage.org/blog/" title="openmirage blog">MirageOS</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p>There's been a crazy stream of activity since the start of the year, but the most important news is that we have a release target for an integrated developer preview of the Mirage stack: a talk at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">O'Reilly OSCon</a> in July!  Do turn up there and find <a href="http://dave.recoil.org">Dave Scott</a> and <a href="http://anil.recoil.org">Anil Madhavapeddy</a> showing off interactive demonstrations.</p><p>Meanwhile, another significant announcement has been that Xen is <a href="http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project">joining the Linux Foundation</a> as a collaborative project.  This is great news for Mirage: as a library operating system, we can operate just as easily under other hypervisors, and even on bare-metal devices such as the <a href="http://raspberrypi.org">Raspberry Pi</a>.  We're very much looking forward to getting the Xen-based developer release done, and interacting with the wider Linux community (and FreeBSD, for that matter, thanks to Gabor Pali's <a href="https://github.com/pgj/mirage-kfreebsd">kFreeBSD</a> backend).</p><p>Here's some other significant news from the past few months:</p><ul> <li> <p><a href="http://www.ocamlpro.com/blog/2013/03/14/opam-1.0.0.html">OPAM 1.0 was released</a>, giving Mirage a solid package manager for handling the many libraries required to glue an application together.  <a href="https://github.com/vbmithr">Vincent Bernardoff</a> joined the team at Citrix and has been building a Mirage build-frontend called <a href="https://github.com/mirage/mirari">Mirari</a> to hide much of the system complexity from a user who isn't too familiar with either Xen or OCaml.</p> </li><li> <p>A new group called the <a href="http://ocaml.io">OCaml Labs</a> has started up in the <a href="http://www.cl.cam.ac.uk">Cambridge Computer Laboratory</a>, and is working on improving the OCaml toolchain and platform.  This gives Mirage a big boost, as we can re-use several of the documentation, build and test improvements in our own releases.  You can read up on the group's activities via the <a href="http://ocaml.io/news">monthly updates</a>, or browse through the various <a href="http://ocaml.io/tasks">projects</a>.  One of the more important projects is the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot">OCamlot</a> continuous build infrastructure, which will also be testing Mirage kernels as one of the supported backends.</p> </li><li> <p>As we head into release mode, we've started <a href="http://openmirage.org/wiki/tag/overview/meetings">weekly meetings</a> to coordinate all the activities.  We're keeping notes as we go along, so you should be able to skim the notes and <a href="https://lists.cam.ac.uk/pipermail/cl-mirage/">mailing list archives</a> to get a feel for the overall activities.  Anil is maintaining a <a href="http://openmirage.org/wiki/dev-preview-checklist">release checklist</a> for the summer developer preview.</p> </li><li> <p>Anil (along with Yaron Minsky and Jason Hickey) is finishing up an O'Reilly book on <a href="http://realworldocaml.org">Real World OCaml</a>, which will be a useful guide to using OCaml for systems and network programming. If you'd like to review an early copy, please get in touch.  The final book is anticipated to be released towards the end of the year, with a <a href="http://shop.oreilly.com/category/roughcuts.do">Rough Cut</a> at the end of the summer.</p> </li><li> <p>The core system was described in an <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">ASPLOS 2013</a> paper, which should help you understand the background behind library operating systems. Some of the Mirage libraries are also currently being integrated into the next-generation <a href="http://blogs.citrix.com/2012/05/17/introducing-windsor-a-new-xen-based-virtualization-architecture/">Windsor</a> release of the Xen Cloud Platform, which means that several of the libraries will be used in production and hence move beyond research-quality code.</p> </li> </ul><p>In the next few months, the installation notes and getting started guides will all be revamped to match the reality of the new tooling, so expect some flux there.   If you want to take an early try of Mirage beforehand, don't forget to hop on the <code>#mirage</code> IRC channel on Freenode and ping us with questions directly.  We will also be migrating some of the project infrastructure to be fully self-hosted on Mirage and Xen, and placing some of the services onto the new <a href="http://xenproject.org">xenproject.org</a> infrastructure.</p> 
   </div></div>







<p class="date"><a href="http://openmirage.org/blog/the-road-to-a-dev-release">by Anil Madhavapeddy (anil@recoil.org) at Mon, 20 May 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01"> </a>
<h2 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#May%202013">May 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/thomas-nycoug-2013.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/thomas-nycoug-2013-thumb.jpg" /></a>
May is exam time in Cambridge, and the corridors of the OCaml Labs resounded
with the wailing of frantic students finishing their dissertations and
preparing for exams.  We welcomed <a href="https://github.com/vincent-botbol">Vincent Botbol</a> to join us for a summer internship,
and he started hacking on the new <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OPAM%20Doc">opam-doc</a>
right away.</p>
<p>Anil, Thomas, Leo and Amir also visited <a href="http://janestreet.com">Jane
Street</a> HQ in New York City, where we had a productive
couple of days reviewing our projects and getting feedback from them about
approaches to multicore and type system enhancements. <a href="http://ashishagarwal.org">Ashish
Agarwal</a> also organised a fun evening with the <a href="http://www.meetup.com/NYC-OCaml/events/117222022/">New
York OCaml Users Group</a>,
where Anil and Thomas presented our plans for the nascent OCaml Platform.</p>
<h3 id="SystemsProjects"> Systems Projects</h3>
<p><b>Mirage:</b> This was a month of consolidation and bugfixing in Mirage.  We've
been settling into weekly meetings to coordinate the hacking between us and
Citrix, and the minutes (<a href="http://www.openmirage.org/wiki/weekly-2013-05-14">1</a>
<a href="http://www.openmirage.org/wiki/weekly-2013-05-21">2</a>
<a href="http://www.openmirage.org/wiki/weekly-2013-05-28">3</a>) may be useful if you
want to catch up.  The biggest bugbear is always the build system, and we've
been exploring the use of <a href="http://github.com/janestreet/jenga">Jenga</a> as the
eventual async-aware coordination and build system for running Mirage kernels.
Dave made great progress with a
<a href="http://github.com/djs55/message-switch">message-switch</a> that coordinates
multiple kernels, and Balraj fixed several performance regressions in the
TCP/IP stack by building unit tests that spawn millions of parallel TCP
connections.</p>
<p><b>Signpost:</b> We took a break from building prototypes to submit a paper on the
basic design to the USENIX Free and Open Communications (<a href="https://www.usenix.org/conference/foci13">FOCI
2013</a>) workshop.  Haris and Heidi
blazed a path on writing this paper, and we've got even more ideas rolling
around about how to use DNSSEC to break the cloud deadlock.  The
<a href="http://github.com/mirage/ocaml-dns">ocaml-dns</a> continues to grow features too.</p>
<h3 id="PlatformProjects"> Platform Projects</h3>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nycoug-drinkup-2013.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nycoug-drinkup-2013-thumb.jpg" /></a>
<b>Ctypes:</b> Jeremy
<a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-06/msg00046.html">announced</a>
the first release of a new foreign-function mechanism for OCaml that doesn't
require you to write any C stubs at all!  You can browse the <a href="https://github.com/ocamllabs/ocaml-ctypes">source
code</a> and
<a href="https://github.com/ocamllabs/ocaml-ctypes/wiki/ctypes-tutorial">tutorial</a>, and
install it via OPAM.  This is very much the first 0.1 release, and we have
exciting future developments to turn this into a full-fledged replacement for
the fast-but-rather-difficult-to-use-right OCaml FFI.</p>
<p><b>OPAM-doc:</b> Vincent Botbol started building on Leo's work on the new
<a href="http://github.com/vincent-botbol/opam-doc">opam-doc</a> tool. This is intended to
replace the venerable <code>ocamldoc</code> with one that uses all the latest features of
the compiler.  In particular, it can use the new typed AST <code>cmt</code> output to
avoid duplicating the compiler functionality, and can also build up a global
package table to generate complete cross-references across an entire OPAM 
collection.</p>
<p><b>OCamlot:</b> David has been building up the libraries and tools needed for
the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot%200.2.0">continuous build</a> infrastructure.
This includes much-improved
<a href="http://github.com/avsm/ocaml-github">ocaml-github</a>, bindings, which are now
being used to power the <a href="https://realworldocaml.org">Real World OCaml</a> site as
well as well as OCamlot.  In addition, he's got an interesting collection of
regular expressions to automatically triage common failures from OPAM
(such as missing external dependencies), that should help reduce the manual
burden of getting thousands of tests results dumped on the small OPAM team.</p>
<h3 id="CompilerProjects"> Compiler Projects</h3>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/janestreet-hq-2013.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/janestreet-hq-2013-thumb.jpg" /></a>
<b>OCaml-Java</b>: Xavier Clerc has been hacking away at his next-generation
OCaml-Java backend (using many new features in JDK7). He's released a
<a href="http://ocamljava.x9c.fr/preview/concurrency.html">preview</a> of the bindings to
Java concurrency, and is looking for feedback on it.</p>
<p><b>Performance profiling</b>: Mark Shinwell has been hacking on improving the
integration of the runtime with <code>perf</code>.  This should give us the hooks to
reliably track where memory was allocated.  His branch isn't going to land in
OCaml 4.1, but should be available as an OPAM switch for people to easily
try out when it's more stable.</p>
<h3 id="Outreach"> Outreach</h3>
<p><b>OCaml.org:</b> Philippe and Amir have been putting their heads together with
Christophe and Ashish to turn the <a href="http://ocaml.org">ocaml.org</a> build pipeline
into something a little more structured.  Philippe is building a <a href="https://github.com/pw374/MPP-language-blender">template
processor</a> for this purpose.
The OCaml site is a more complicated than the average site due to our desire to
embed <a href="http://ocsigen.org/js_of_ocaml">js_of_ocaml</a> interactive toplevels
throughout the tutorials, and also to have active OPAM integration throughout
the site to make it easier for newcomers to sample the language.</p>
<p>The design of a handful of pages are also now available to preview, if you
don't mind some manual git cloning. The best way to do this is to clone the
<a href="https://github.com/ocamllabs/ocaml.org-temp">temporary repo</a> onto your local
machine and look in the <code>new-design/_site</code> directory.  There are examples of
the home page, 100 lines of OCaml page and several others.  Since we're just
getting started with applying these changes the site isn't clicky (yet).  For
some extra fun, try resizing your browser window and see how the pages reflow
to suit smaller (mobile) screens!</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nyc-trip-balcony-view-2013.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/nyc-trip-balcony-view-2013-thumb.jpg" /></a>
<b>Real World OCaml:</b> Anil, Yaron and Jason continue to work hard on getting
a release out of the door.  We shipped a final alpha6 this month that is 
chapter-complete, and have been preparing for a big public June release of
the book.  Thousands of comments have been received and closed already,
making this an unusually active (but incredibly useful) ongoing review
process.  Leo and Jeremy also contributed portions of text for the Objects
and FFI chapters in alpha6, and join Stephen Weeks as external contributors
to the book.</p>
<p>Meanwhile, Leo himself has recovered from the elation of being granted his PhD,
to the harsh reality of having to finish corrections.  He has been forced by
his colleagues to stop hacking on OCaml and submit his final thesis.  Rumours
are that he will reemerge in June after delivering his <a href="http://staticanalysis.org/SAS13/papers.html">SAS
2013</a> talk on using an
implication-algebra generalisation of logic programming to concisely analyse
OpenMP programs for parallisation opportunities.</p>
<p>This month's talk was courtesy of <a href="http://www.lip6.fr/actualite/personnes-fiche.php?ident=D1161&amp;LANG=en">Mathias Bourgoin</a>,
who visited from France and gave a talk on his PhD work on GPU processing.  His
tool, <a href="http://www.algo-prog.info/spoc/web/index.php?id=spoc">SPOC</a> has been
released onto OPAM and is a set of easy-to-use tools for generating CUDA and
OpenCL code, and also a camlp4 extension to write external kernels directly in
OCaml.  Thanks for visiting, Mathias!</p>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#May%202013">by Anil Madhavapeddy (anil@recoil.org) at Wed, 01 May 2013</a>
</p>
</div>
</div>


<div class="channelgroup">









<div class="entrygroup" id="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01"><a name="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01"> </a>
<h2 class="posttitle"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Apr%202013">Apr 2013 news update</a>
(<a href="http://www.cl.cam.ac.uk/projects/ocamllabs//news/" title="OCaml Labs News">Monthly News</a>)
</h2>
<hr /><div class="entry"><div class="content"><div>      <p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/leo-oculus.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/leo-oculus-thumb.jpg" width="150px" /></a>
It's been a heads-down month of hacking at the Labs for April, as the
group have settled into their projects and are concentrating on getting code
out.  We did take the opportunity to redesign the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html">project pages</a> as the active projects grew.</p>
<p>We welcomed <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/euan.html">Euan Harris</a> as a new visitor, and he has
begun work on a distributed actor library in the vein of Erlang's
<a href="https://github.com/erlang/otp">OTP</a>.  The prolific <a href="http://erratique.ch">Daniel B&#252;nzli</a> also joined us for the summer to work on his <a href="http://erratique.ch/software/vg/">Vg</a> visualisation library.  He's based out of the Citrix offices, and is also contributing to the Xen project.</p>
<h3 id="Platformprojects"> Platform projects</h3>
<p><b>OPAM: </b> The project has entered a bug fixing stage after its release, and
the package set has steadily grown via external contributors. David Sheets has
been hacking away on the automated <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot">OCamlot</a>
bot, and we released improved <a href="https://github.com/avsm/ocaml-github">Github</a>
API bindings.  We're aiming to get OCamlot live and running in May, so stay
tuned!  There is a <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool">steadily growing
collection</a> of odd ARM and PowerPC
devices in Anil's desk that will generally make it easier to test your OCaml
code in unusual environments.</p>
<p><b>OCaml.org redesign:</b> Progress on the website continues and we're now
working on the actual HTML/CSS from the earlier
<a href="https://github.com/ocaml/ocaml.org/wiki/Site-Redesign">mockups</a>.  We'll be
publishing these in a fork of the website
<a href="https://github.com/ocamllabs/ocaml.org">repository</a>, so do feel free to create
issues there with your comments.  Philippe has begun the
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#Meta%20preprocessor">MPP</a> templating tool to glue together
all the website scripts more coherently. Discussions about this take place on
the <a href="http://lists.ocaml.org/listinfo/infrastructure">infrastructure</a> mailing
list, which is open to all.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/makespace-apr-2013.jpg"><img class="left" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/makespace-apr-2013-thumb.jpg" width="150px" /></a>
The monthly OCaml get togethers in the <a href="http://makespace.org">Cambridge
Makespace</a> are also really fun.  This month saw around 30
people wander through the doors, and work through the latest excerpts of
<a href="http://realworldocaml.org">Real World OCaml</a>. And around midnight, Jeremy and
Leo competed to find more and more obscure
<a href="http://caml.inria.fr/mantis/view.php?id=5992">bugs</a> in the corners of the
OCaml type system...  You can track the subsequent meetups via the <a href="http://www.meetup.com/Cambridge-NonDysFunctional-Programmers/events/114286762/">NonDysFunctional Meetup group</a>, which includes functional programmers from around the Cambridgeshire area.  Jon and Anil also attended the <a href="http://developer.yahoo.com/events/hack_europe_london/">Yahoo Hackday</a> in London, where Jon met a giant robot and started <a href="https://github.com/jonludlam/mssl">SSL bindings</a>, and Anil experimented with <a href="http://github.com/avsm/ocaml-js-localstorage">js_of_ocaml LocalStorage</a> for Irminsule.</p>
<h3 id="Systemsprojects"> Systems projects</h3>
<p><b>Mirage</b>: We've finally got a release date for the first preview of
Mirage, which will be at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">O'Reilly OSCON</a> this July!  Pulling together the release is a big endeavour, and the
<a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html">team</a> has started weekly calls to work through the
project.  The minutes for these are online, so you can
<a href="http://www.openmirage.org/wiki/tag/overview/meetings">browse</a> them to catch
up. There's also a slightly scary
<a href="http://www.openmirage.org/wiki/dev-preview-checklist">checklist</a> of all the
libraries that need to be released before July, so the team has its work cut
out for it!  The Xen group also announced that it is joining the Linux Foundation,
and the <a href="http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project">press release</a> gave Mirage a prominent mention as one of the key recent developments in Xen.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/jon-robot-yahoo.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/jon-robot-yahoo-thumb.jpg" width="120px" /></a>
<b>Irminsule</b>: Thomas now has a full implementation of the git file format
in his <a href="http://github.com/samoht/cagit">cagit</a> repository, and the interfaces
for Irminsule's branch-consistent model are coming together.  He gave a demo to
the Mirage team, with <a href="http://www.openmirage.org/wiki/weekly-2013-04-23">discussion
notes</a> available.</p>
<h3 id="Compilerprojects"> Compiler projects</h3>
<p><b>Multicore and Concurrency</b>: Stephen Dolan's made great progress on bringing up a multicore
runtime using <a href="https://github.com/stedolan/ocaml">thread-local storage</a>, which results
in a surprisingly compact diff to the OCaml runtime.  We're now moving onto the
higher-level bindings to use the parallel runtimes effectively from within OCaml.
We also began a <a href="http://lists.ocaml.org/listinfo/wg-parallel">wg-parallel</a> working
group in order to start figuring out the evolution of the <a href="http://ocsigen.org/lwt">Lwt</a> and 
<a href="https://github.com/janestreet/async">Async</a> concurrency libraries.</p>
<p><b>libffi</b>: Jeremy got frustrated by the difficulty of writing safe C bindings,
and started the <a href="http://github.com/ocamllabs/ocaml-ctypes">ctypes</a> library, which
offers a pure OCaml solution. This even includes managing callbacks across the
OCaml/C divide, and uses <a href="https://github.com/atgreen/libffi">libffi</a> under the hood
to remain efficient and platform-independent.  There is the exciting possibility
about hooking this library with the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/compiler.html#Compile-time%20meta%20programming">compile-time metaprogramming</a> to eliminate all performance cost, so we're going to spend some time
on this project to make it a well-documented alternative to the existing C FFI.</p>
<p><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/images/mezzo-talk.jpg"><img class="right" src="http://www.cl.cam.ac.uk/projects/ocamllabs/images/mezzo-talk.jpg" width="120px" /></a>
The OCaml Labs talk series continued with a visit from <a href="http://gallium.inria.fr/~fpottier/">Francois
Pottier</a> ad <a href="http://www.xulforum.org">Jonathan
Protzenko</a> from the INRIA
<a href="http://gallium.inria.fr">Gallium</a> research team.  Jonathan presented their
<a href="http://gallium.inria.fr/~protzenk/mezzo-lang">Mezzo</a> language, which places
emphasis on aliasing and controlled access to mutation.  This is of particular
interest to several of our systems projects that do not require the full power of
OCaml to build low-level systems components, and Raphael, Alan, Leo and Anil
had productive discussions about how we could try Mezzo out when it's released.</p>
<p><i>Link roundup:</i></p>
<ul> <li><a class="icon-rss" href="http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project">Xen and MirageOS to join Linux Foundation</a> <em>(Apr 14th)</em>
 </li>
 <li><a class="icon-community" href="http://www.meetup.com/Cambridge-NonDysFunctional-Programmers/events/114286762/">OCaml Hacking/Meetup Session</a> <em>(Apr 18th)</em>
 </li>
 <li><a class="icon-quick-links" href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">OSCon Mirage talk selected.</a> <em>(Apr 21st)</em>
 </li>
</ul>

   </div></div>







<p class="date"><a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Apr%202013">by Anil Madhavapeddy (anil@recoil.org) at Mon, 01 Apr 2013</a>
</p>
</div>
</div>


</div>

</div>

<p><strong>Last updated:</strong><br />Mon, 16 Sep 2013<br /><em>All times are UTC.</em><br /><br /></p><div align="center">Powered by: <a href="http://www.planetplanet.org/"><img alt="Planet" border="0" height="15" src="images/planet.png" width="80" /></a></div>
</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>

<ul id="site-info"><li class="copy">&#169; 2012-2013 Anil Madhavapeddy<br />Information provided by <a href="mailto:avsm2@cl.cam.ac.uk">Anil Madhavapeddy</a></li></ul>
</div>
</body></html>