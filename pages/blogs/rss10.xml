<?xml version="1.0"?>
<rdf:RDF
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:foaf="http://xmlns.com/foaf/0.1/"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns="http://purl.org/rss/1.0/"
>
<channel rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/blogs">
	<title>OCaml Labs updates</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/blogs</link>
	<description>OCaml Labs updates - http://www.cl.cam.ac.uk/projects/ocamllabs/blogs</description>

	<items>
		<rdf:Seq>
			<rdf:li rdf:resource="http://pw374.github.io/posts/2013-09-05-22-31-26-about-omd.html" />
			<rdf:li rdf:resource="http://pw374.github.io/posts/2013-09-24-01-50-14-opamdoc-take1.html" />
			<rdf:li rdf:resource="http://pw374.github.io/posts/2013-09-24-14-19-56-on-the-implementation-of-opamdoc.html" />
			<rdf:li rdf:resource="http://pw374.github.io/posts/2013-09-25-16-19-07-ones-or-zeros.html" />
			<rdf:li rdf:resource="http://www.syslog.cl.cam.ac.uk/?p=1461" />
			<rdf:li rdf:resource="http://amirchaudhry.com/ocamlorg-request-for-feedback" />
			<rdf:li rdf:resource="http://www.syslog.cl.cam.ac.uk/?p=1347" />
			<rdf:li rdf:resource="http://anil.recoil.org/2013/09/20/opam-1-1-beta" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=352" />
			<rdf:li rdf:resource="http://ocamllabs.github.com/compiler-hacking/2013/09/17/compiler-hacking-july-2013" />
			<rdf:li rdf:resource="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=153" />
			<rdf:li rdf:resource="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=25" />
			<rdf:li rdf:resource="http://openmirage.org/blog/introducing-vchan" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=86" />
			<rdf:li rdf:resource="http://openmirage.org/blog/oscon13-trip-report" />
			<rdf:li rdf:resource="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=99" />
			<rdf:li rdf:resource="http://openmirage.org/blog/xen-block-devices-with-mirage" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=64" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/?p=90" />
			<rdf:li rdf:resource="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01" />
			<rdf:li rdf:resource="http://openmirage.org/blog/the-road-to-a-dev-release" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01" />
			<rdf:li rdf:resource="http://amirchaudhry.com/wireframe-demos-for-ocamlorg" />
			<rdf:li rdf:resource="http://lpw25.net/2013/03/10/ocaml-namespaces" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-03-01" />
			<rdf:li rdf:resource="http://lpw25.net/2013/02/05/camlp4-alternative-part-2" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-02-01" />
			<rdf:li rdf:resource="http://lpw25.net/2013/01/23/camlp4-alternative-part-1" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-01-01" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-12-01" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/" />
			<rdf:li rdf:resource="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/" />
			<rdf:li rdf:resource="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-11-01" />
			<rdf:li rdf:resource="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs" />
		</rdf:Seq>
	</items>
</channel>

<item rdf:about="http://pw374.github.io/posts/2013-09-05-22-31-26-about-omd.html">
	<title>Philippe Wang: OMD: a Markdown parser in OCaml</title>
	<link>http://pw374.github.io/.html</link>
	<content:encoded>&lt;h3 id=&quot;Motivations&quot;&gt; Motivations&lt;/h3&gt;
&lt;p&gt;There  are  so many  existing  implementations  of  Markdown, why  yet
another one?   Well, after asking  the OCaml community  about existing
ways to parse and manipulate  Markdown documents, it seemed that there
were no stand-alone complete Markdown parser written in OCaml, meaning
that they  were incomplete (i.e., not fully  compatible with Markdown)
or  interfaces  to  some  Markdown  parsers  implemented  using  other
languages than OCaml.&lt;/p&gt;
&lt;p&gt;Since in OCaml  Labs we're working a lot with  Github, and Github uses
Markdown a  lot (Github  web pages hosting,  Github issues,  etc.) and
other  sites are also  using Markdown  as well,  and Markdown  is very
popular and  easy to  learn, and  flexible in the  sense that  you can
always  fall back  to HTML  when you  want to  express  something that
doesn't have  a special syntax in  Markdown, blah blah blah,  it was -
somehow - time to have  a Markdown parser implemented using OCaml. And
preferably  OCaml alone,  meaning that  one that  has  OCaml installed
should be able  to use it easily without having to  deal with too many
dependencies. Well, there it is: OMD!&lt;/p&gt;
&lt;h3 id=&quot;IssueswereessentiallywithMarkdownitself&quot;&gt; Issues... were essentially with Markdown itself&lt;/h3&gt;
&lt;p&gt;Every computer  scientist knows how to  write a parser  for a language
that is as simple as Markdown. Well, no, not every computer scientist,
sadly, but at least every programmer should. Ok, sadly it isn't really
the case either. Anyways.&lt;/p&gt;
&lt;p&gt;Markdown is a rather simple language,  if you look at the specs. Well,
that depends on what you actuall call &amp;quot;specs&amp;quot;, of course. According to
&lt;a href=&quot;http://en.wikipedia.org/wiki/Markdow&quot;&gt;Wikipedia&lt;/a&gt;,     Markdown    was
invented by &lt;a href=&quot;http://daringfireball.net&quot;&gt;John Gruber&lt;/a&gt;, and Aaron Swartz
helped  him. Then the  original document  that describes  the Markdown
language          is          available         online          there:
&lt;a href=&quot;http://daringfireball.net/projects/markdown/syntax&quot;&gt;http://daringfireball.net/projects/markdown/syntax&lt;/a&gt;.  And you can see
that         searching        for         &lt;a href=&quot;https://www.google.com/#q=Markdown+syntax&quot;&gt;&amp;quot;Markdown+syntax&amp;quot;        on
Google&lt;/a&gt; makes that page the
top result (and here again, I'm kind  of helping it be and stay on the
top...).&lt;/p&gt;
&lt;p&gt;Actually, Markdown is not that  simple to parse.  Why? Because so many
things are  just left to the  imagination of the  people who implement
parsers  for  this  language,   because  programmes  can't  decide  by
themselves  what's right  to do.   It's  really the  author(s) of  the
programme that  decides what the  programme does. And in  Markdown, so
many  things  are ambiguous  and  Gruber's  document doesn't  actually
describe a  grammar at all.  It just tells  you how to write  this and
that, but if you write it slightly differently, it doesn't tell you
what the outcome would be. 
&lt;em&gt;&lt;strong&gt;In other words, there are no errors in Markdown.&lt;/strong&gt;&lt;/em&gt;
Every text file is a valid Markdown file, it might just be converted 
to some HTML you wouldn't expect. For instance, you may write a link 
using this  syntax:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[blah blah blah](the-url-which-can-be-absolute-or-relative)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and it gets converted to&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;a href=&amp;quot;the-url-which-can-be-absolute-or-relative&amp;quot;&amp;gt;blah blah blah&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
But if you forget the closing parenthesis, then it becomes this instead&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;p&amp;gt;[blah blah blah](the-url-which-can-be-absolute-or-relative&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
precisely because nothing is wrong in Markdown.&lt;/p&gt;
&lt;p&gt;And what if there are parentheses in your URL? What if they are unbalanced?&lt;/p&gt;
&lt;h4 id=&quot;FlagrantAmbiguity&quot;&gt; Flagrant Ambiguity&lt;/h4&gt;
&lt;p&gt;The following is some text that has to mean something in Markdown...&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;* Alice is falling in love with Bob.
    * Bob is secretly in love with Alice, but he's seeing Eve.
  * Eve is in-between, she loves both Alice and Bob, she can't help it.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So, Pandoc, which a tool that converts a document in language A to a
document in language B, where A and B can be the same or different
languages amongst LaTeX, HTML, Markdown and (many) others, considers
that Eve is on the same level as Bob. So its HTML output is&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;ul&amp;gt;
&amp;lt;li&amp;gt;Alice is falling in love with Bob.
&amp;lt;ul&amp;gt;
&amp;lt;li&amp;gt;Bob is secretly in love with Alice, but he's seeing Eve.&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;Eve is in-between, she loves both Alice and Bob, she can't help it.&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But if instead you add Dylan as in&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;* Alice is falling in love with Bob.
   * Dylan, a new character, is being conceived here.
    * Bob is secretly in love with Alice, but he's seeing Eve.
  * Eve is in-between, she loves both Alice and Bob, she can't help it.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then &lt;em&gt;of course&lt;/em&gt; Eve is not on the same level as Bob anymore and goes
with Dylan and Alice, Bob is on his own.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;ul&amp;gt;
&amp;lt;li&amp;gt;Alice is falling in love with Bob.&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;Dylan, a new character, is being conceived here.
&amp;lt;ul&amp;gt;
&amp;lt;li&amp;gt;Bob is secretly in love with Alice, but he's seeing Eve.&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;Eve is in-between, she loves both Alice and Bob, she can't help it.&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This doesn't make much sense...&lt;/p&gt;
&lt;p&gt;And Github's embedded Markdown  to HTML converter chooses some similar
broken semantics. If one writes bullets on different levels, it shouldn't
be meaningless.&lt;/p&gt;
&lt;p&gt;Also, on Github, if you write&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;* 1
  * 2
    * 3
      * 4
        * 5
          * 6
            * 7
              * 8
                * 9
                  * 10
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then 2 and 3 are on the same level, as for 4 and 5, 6 and 7, and 8 and 9.
1 and 10 are on their own. And if you extract 2 and 3, meaning&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  * 2
    * 3
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
then 2 and 3 are not on the same level anymore! 
See for yourself:&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;raw version: &lt;a href=&quot;https://raw.github.com/pw374/sandbox/master/mad-lists.md&quot;&gt;https://raw.github.com/pw374/sandbox/master/mad-lists.md&lt;/a&gt;
 &lt;/li&gt;
 &lt;li&gt;rendered-by-Github version: &lt;a href=&quot;https://github.com/pw374/sandbox/blob/master/mad-lists.md&quot;&gt;https://github.com/pw374/sandbox/blob/master/mad-lists.md&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With OMD, hopefully, there is a deterministic meaning for each level of indentation. The list where there were Alice, Bob and Eve is converted to this to the least insane semantics I could think of.&lt;/p&gt;
&lt;p&gt;The idea  is that, since Eve  is neither on  the same level as  Bob or
Alice, Eve should be in a new list (because, obviously, she's the only
one on that  level anyway). So she  is in a new list.  And since she's
not on a deeper level than Bob, she shouldn't be on a sub-list of his.
But  she is  on a  deeper level  than Alice,  so she  has to  be  on a
sub-list of hers. So, here is the HTML that OMD produces:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;ul&amp;gt;
 &amp;lt;li&amp;gt;Alice is falling in love with Bob.
  &amp;lt;ul&amp;gt;
   &amp;lt;li&amp;gt;Bob is secretly in love with Alice, but he&amp;amp;apos;s seeing Eve.
   &amp;lt;/li&amp;gt;
  &amp;lt;/ul&amp;gt;
  &amp;lt;ul&amp;gt;
   &amp;lt;li&amp;gt;Eve is in-between, she loves both Alice and Bob, she can&amp;amp;apos;t help it.
   &amp;lt;/li&amp;gt;
  &amp;lt;/ul&amp;gt;
 &amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Oh,  you might  have  noticed  that OMD  converts  quotes to  &lt;code&gt;&amp;amp;apos;&lt;/code&gt;
because otherwise I  would need to differentiate when  they have to be
converted from when it's optional.&lt;/p&gt;
&lt;h3 id=&quot;Implementation&quot;&gt; Implementation&lt;/h3&gt;
&lt;p&gt;Pandoc's documentation says&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;
In contrast to most existing tools for converting markdown to HTML,
which use regex substitutions, Pandoc has a modular design: it
consists of a set of readers, which parse text in a given format and
produce a native representation of the document, and a set of writers,
which convert this native representation into a target format.
Thus, adding an input or output format requires only adding a reader
or writer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Come on,  most tools are using regular  expressions substitutions?!  I
can only imagine the nightmare that  it must be to implement and debug
such an implementation  -- no wait, I can't because  I just don't want
to imagine such a nightmare.&lt;/p&gt;
&lt;p&gt;I used functions and function calls, a lot of them are tail recursive,
not  all of  them but  then it  means  I don't  need them  to be  tail
recursive, and  those functions  basically take a  list of  tokens and
return a  new list  with possibly fewer  tokens and the  expression to
which the missing ones were converted into.&lt;/p&gt;
&lt;p&gt;So far, in version 0.4 (which is  not released yet at the time I write
this), there's a little less than  8k lines of pure OCaml code.  (Note
that I didn't write &amp;quot;pure functional&amp;quot;, I wrote &amp;quot;pure OCaml&amp;quot;.)&lt;/p&gt;
&lt;p&gt;OMD is an  open-source free and libre software  library that any OCaml
developer can use  (hopefully quite easily since it  doesn't depend on
anything else  that the standard  OCaml compiler and library).  And of
course, it's also  a tool for any one who write  Markdown and wants it
to be  converted (quickly)  to HTML.  OMD, so far,  is about  10 times
faster than  Pandoc, and  I didn't  even make any  efforts to  make it
fast.&lt;/p&gt;
&lt;h4 id=&quot;Compatibility&quot;&gt; Compatibility&lt;/h4&gt;
&lt;p&gt;OMD has been developed using OCaml 4.0.1, &lt;a href=&quot;https://github.com/pw374/omd/issues/19&quot;&gt;Christophe Troestler made
me make it compatible with OCaml
3.12.1&lt;/a&gt;.  Then I guess it
might work with older version of OCaml but it's not certain (mainly
because OCaml's standard library has slightly changed, as I think I
don't use any language features that were introduced in 3.12 or 4.0).&lt;/p&gt;
&lt;p&gt;By  the way,  thank  you  Christophe for  your  support, interest  and
contributions to OMD :-)&lt;/p&gt;
&lt;h3 id=&quot;FutureofOMD&quot;&gt; Future of OMD&lt;/h3&gt;
&lt;p&gt;OMD  already is  in OPAM.   A  very stable  version of  OMD should  be
released soon.   As a  tool, it takes  Markdown as input  and produces
HTML as output.   A Markdown backend has been  freshly implemented, so
you can output  Markdown as well, which is  quite useful for debugging
or if you  want to know how many iterations you  need before you reach
the fix  point. You  can also  output &amp;quot;text&amp;quot;, in  the sense  that it's
basically the HTML  without the HTML tags, so  it's very non-formatted
text.  There  also are  options to output  HTML table of  contents and
parametrise their depths.&lt;/p&gt;
&lt;h3 id=&quot;OMDandOCamlorg&quot;&gt; OMD and OCaml.org&lt;/h3&gt;
&lt;p&gt;We    are    at   OCaml    Labs    making    a    new   website    for
&lt;a href=&quot;http://ocaml.org&quot;&gt;ocaml.org&lt;/a&gt;.   The  design   is  being  provided  by
&lt;a href=&quot;http://www.onespacemedia.com&quot;&gt;onespacemedia&lt;/a&gt;.    At   the  time   I'm
writing  these  lines, I'm  using  the  HTML/CSS/JS  for the  upcoming
OCaml.org to style my new Github-hosted website, so I can play with it
&lt;em&gt;more&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Most pages will be written in Markdown instead of HTML, so that people
of the OCaml community may contribute to it in a more convenient way.&lt;/p&gt;
&lt;p&gt;And of course, that means that OMD will be used for OCaml.org.&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-26T20:57:09+00:00</dc:date>
	<dc:creator>Philippe Wang</dc:creator>
</item>
<item rdf:about="http://pw374.github.io/posts/2013-09-24-01-50-14-opamdoc-take1.html">
	<title>Philippe Wang: OPAM-DOC with multiple OCaml packages</title>
	<link>http://pw374.github.io/.html</link>
	<content:encoded>&lt;h3 id=&quot;OPAMDOC&quot;&gt; &lt;a href=&quot;https://github.com/ocamllabs/opam-doc/&quot;&gt;OPAM-DOC&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The tool &lt;code&gt;ocamldoc&lt;/code&gt; shipped with the standard distribution of the
OCaml compiler suffers from some limitations because it doesn't have
access to all the information it needs. Notably, if you want to build
the documentation of some package &lt;code&gt;a&lt;/code&gt; that depends on some package
&lt;code&gt;b&lt;/code&gt;, you'll find out that the documentation of the package &lt;code&gt;a&lt;/code&gt; will
not automatically refer to the documentation of the package &lt;code&gt;b&lt;/code&gt;.
Well, opamdoc solves this problem and it's very nice.&lt;/p&gt;
&lt;p&gt;On &lt;a href=&quot;http://ocaml-redesign.github.io/&quot;&gt;this site&lt;/a&gt;, which is work in progress,
you can find a &lt;a href=&quot;http://ocaml-redesign.github.io/pkg/&quot;&gt;list of packages&lt;/a&gt; 
with their descriptions. This list is built using &lt;a href=&quot;https://github.com/OCamlPro/opam2web&quot;&gt;opam2web&lt;/a&gt;.
And each package description links to its documentation. And the documentation
for all packages is built as a whole, which means that if the documentation of 
a package links to all other packages on which it depends. Isn't it nice? 
:)&lt;/p&gt;
&lt;h3 id=&quot;Installandrunopamdoc&quot;&gt; Install and run opamdoc&lt;/h3&gt;
&lt;p&gt;opamdoc is still under active development, the current step is
&lt;a href=&quot;https://github.com/ocamllabs/opam-doc/issues/&quot;&gt;finding and fixing remaining issues&lt;/a&gt; and
packaging.&lt;/p&gt;
&lt;p&gt;If you want to use opamdoc now, here's some instructions based on
&lt;a href=&quot;https://github.com/ocamllabs/opam-doc/issues/1#issuecomment-23430108&quot;&gt;Anil's instructions&lt;/a&gt;, 
which are those:&lt;/p&gt;
&lt;blockquote&gt;&lt;pre&gt;&lt;code&gt;opam remote add opamdoc git://github.com/avsm/opamdoc-dev
opam switch 4.01.0beta1+opamdoc
eval `opam config env`
opam install opamdoc
opamdoc-rebuild
opamdoc-generate
open ~/.opam/4.01.0beta1+opamdoc/opamhtml/index.html
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;code&gt;opamdoc-rebuild&lt;/code&gt; builds a database of cmt/cmd files in &lt;code&gt;~/.opam/4.01.0beta1+opamdoc/opamdoc&lt;/code&gt;.
 &lt;/li&gt;
 &lt;li&gt;&lt;code&gt;opamdoc-generate&lt;/code&gt; builds a package HTML list in &lt;code&gt;~/.opam/4.01.0beta+opamdoc/opamhtml&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Well, they work quite well, except &lt;code&gt;opamdoc-rebuild&lt;/code&gt; uses &lt;code&gt;.cmd&lt;/code&gt;  files as a base, whereas
it should use &lt;code&gt;.cmt&lt;/code&gt; files instead because sometimes &lt;code&gt;.cmt&lt;/code&gt; files exist while &lt;code&gt;.cmd&lt;/code&gt; don't.
This is a problem for a few packages (&lt;code&gt;Core&lt;/code&gt; is one of them).&lt;/p&gt;
&lt;p&gt;My advice: if something doesn't work as expect, 
please &lt;a href=&quot;https://github.com/ocamllabs/opam-doc/issues&quot;&gt;open an issue&lt;/a&gt;, 
and if you want to customize the way the documentation is built, 
don't hesitate to edit &lt;code&gt;opamdoc-rebuild&lt;/code&gt; and/or &lt;code&gt;opamdoc-generate&lt;/code&gt; (they are Bash scripts).&lt;/p&gt;
&lt;h4 id=&quot;Afewnotesaboutthoseinstructions&quot;&gt; A few notes about those instructions&lt;/h4&gt;
&lt;p&gt;The first line, which is &lt;code&gt;opam remote add opamdoc git://github.com/avsm/opamdoc-dev&lt;/code&gt;, 
will give sense to the second one, which is &lt;code&gt;opam switch 4.01.0beta1+opamdoc&lt;/code&gt;.
And &lt;code&gt;4.01.0beta1+opamdoc&lt;/code&gt; is a customised compiler that produces on the side the &lt;code&gt;.cm{t,d}{,i}&lt;/code&gt; files
that are used by opamdoc. Using it is very convenient! If you don't use it, you need to produce
those files in an other way &lt;strong&gt;of your choice&lt;/strong&gt; (really? you want to go through such trouble?).&lt;/p&gt;
&lt;p&gt;Note that opamdoc is written in such  a way that it would ask a lot of
work to  make it work  with versions of  the compiler prior  to 4.01.0
because it uses features introduced by this very version.&lt;/p&gt;
&lt;p&gt;Just in case, here follow the customised version of &lt;code&gt;opamdoc-rebuild&lt;/code&gt; and &lt;code&gt;opamdoc-generate&lt;/code&gt; that 
I used to build the documentation available on &lt;a href=&quot;http://ocaml-redesign.github.io/pkg/docs/&quot;&gt;http://ocaml-redesign.github.io/pkg/docs/&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&quot;opamdocrebuild&quot;&gt; &lt;code&gt;opamdoc-rebuild&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Here's my customised version of &lt;code&gt;opamdoc-rebuild&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#!/usr/bin/env bash
# Rebuild the cmd/cmt archive in ~/.opam/&amp;lt;switch&amp;gt;/opamdoc
# Copies all the cmt/cmti/cmd files found in the OPAM build
# dir into a single directory structure, separated by MD5
# to keep files distinct.

set -e
#dry=echo
SWITCH=$(opam switch show)
if [ &amp;quot;${SWITCH}&amp;quot; = &amp;quot;system&amp;quot; ]; then
  echo Must be using a custom OPAM switch for this to work.
  exit 1
fi

function calc_md5_for_file()
{
  if builtin command -v md5 &amp;gt; /dev/null; then
    md5=$(cat $1 | md5)
  elif builtin command -v md5sum &amp;gt; /dev/null ; then
    md5=$(cat $1 | md5sum | awk '{print $1}')
  else
    echo &amp;quot;Neither md5 nor md5sum were found in the PATH&amp;quot;
    exit 1
  fi
}

BASE=&amp;quot;$(dirname $(dirname $(ocamlc -where)))&amp;quot;
BUILD=${BASE}/build
DOC=${BASE}/opamdoc
rm -rf ${DOC}
mkdir -p ${DOC}

PKGS=$(find ${BUILD}/ -mindepth 1 -maxdepth 1 -type d &amp;quot;$@&amp;quot;)
echo ${PKGS}

for pkg in ${PKGS}; do
  pkgname=$(basename $pkg)
  echo $pkgname
  mkdir -p ${DOC}/$pkgname

  CMTS=$(find ${pkg} -type f -name '*.cmt')
  for cmt in ${CMTS}; do
    d=$(dirname $cmt)
    calc_md5_for_file &amp;quot;$cmt&amp;quot;;

    f=$(basename $cmt .cmt)
    mkdir -p ${DOC}/$pkgname/$md5
    r=${DOC}/$pkgname/$md5/$f
    for ext in cmt cmti cmd cmdi cmi ; do
        if [ -e $d/$f.$ext ]; then
            $dry cp $d/$f.$ext $r.$ext
        fi
    done
  done
done
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&quot;opamdocgenerate&quot;&gt; &lt;code&gt;opamdoc-generate&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Here's my customised version of &lt;code&gt;opamdoc-generate&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#!/usr/bin/env bash
# Rebuild the cmd/cmt archive in ~/.opam/&amp;lt;switch&amp;gt;/opamdoc
# Copies all the cmt/cmti/cmd files found in the OPAM build
# dir into a single directory structure, separated by MD5
# to keep files distinct.

set -e
#dry=echo
SWITCH=$(opam switch show)
if [ &amp;quot;${SWITCH}&amp;quot; = &amp;quot;system&amp;quot; ]; then
  echo Must be using a custom OPAM switch for this to work.
  exit 1
fi

OPAMDOC=${OPAMDOC:-opamdoc}


BASE=&amp;quot;$(dirname $(dirname $(ocamlc -where)))&amp;quot;
BUILD=${BASE}/build
DOC=${BASE}/opamdoc
HTML=${BASE}/opamhtml

rm -rf ${HTML}
mkdir -p ${HTML}

# Grab the build dir in reverse mtime order to get the
# ordering of generation &amp;quot;correct&amp;quot;.
PKGS=$(ls -1tr $BUILD)

rm -rf $HTML
mkdir -p $HTML
cd $HTML
for pkg in ${PKGS}; do
  fs=&amp;quot;$(find $DOC/$pkg -type f)&amp;quot;
  if [ &amp;quot;$fs&amp;quot; != &amp;quot;&amp;quot; ]; then
    name=$(echo $pkg | awk -F. '{print $1}')
    echo $pkg $name
    $dry $OPAMDOC -p $name $fs
  fi
done
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Enjoy.&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-26T20:57:09+00:00</dc:date>
	<dc:creator>Philippe Wang</dc:creator>
</item>
<item rdf:about="http://pw374.github.io/posts/2013-09-24-14-19-56-on-the-implementation-of-opamdoc.html">
	<title>Philippe Wang: on the Implementation of OPAMDOC</title>
	<link>http://pw374.github.io/.html</link>
	<content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/ocamllabs/opam-doc/commits/master&quot;&gt;Early this year, Leo White started the implementation of
opamdoc&lt;/a&gt;.
Then &lt;a href=&quot;https://github.com/vincent-botbol&quot;&gt;Vincent Botbol&lt;/a&gt; worked on it
from late May to mid August during his stay in Cambridge.&lt;/p&gt;
&lt;p&gt;Now, Vincent's back to studying &amp;quot;computer science research&amp;quot; in Paris,
and he continues working on opam-doc when he can on his free time.&lt;/p&gt;
&lt;p&gt;I didn't really want to get involved too deep in the implementation of
opamdoc (mainly  because it takes time). Eventually,  since I've ended
up        doing        most        of       the        &lt;a href=&quot;https://github.com/ocamllabs/sandbox-ocaml.org&quot;&gt;technical-side
implementation&lt;/a&gt; of the
&lt;a href=&quot;http://ocaml-redesign.github.io&quot;&gt;new  ocaml.org web  site&lt;/a&gt;, I  had to
eventually get into  opamdoc's source code to integrate  its output in
the website.&lt;/p&gt;
&lt;p&gt;If you look at the &lt;a href=&quot;https://github.com/ocamllabs/opam-doc/&quot;&gt;source code of
opamdoc&lt;/a&gt;, you'll see there's a
bunch of files at the root directory. Well, some of them are inherited
from the implementation of ocamldoc, and some are new.  I've mostly
contributed to
&lt;a href=&quot;https://github.com/ocamllabs/opam-doc/blob/master/generate.ml&quot;&gt;&lt;code&gt;generate.ml&lt;/code&gt;&lt;/a&gt;
and
&lt;a href=&quot;https://github.com/ocamllabs/opam-doc/blob/master/opam_doc_config.ml&quot;&gt;&lt;code&gt;opam_doc_config.ml&lt;/code&gt;&lt;/a&gt;.
The former implements the HTML backend of opamdoc, and the latter
contains the JavaScript engine that loads the documentation. This blog
post is mostly about my experience with those two files.&lt;/p&gt;
&lt;h3 id=&quot;generateml&quot;&gt; generate.ml&lt;/h3&gt;
&lt;p&gt;This big file (about 1.5 kloc) contains the functions to retrieve
the information from cmt, cmd, cmti, cmdi and cmi files in order to
build the HTML document.&lt;/p&gt;
&lt;p&gt;Side note:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;
The &lt;a href=&quot;http://www.ocamlpro.com/blog/2012/08/20/ocamlpro-and-4.00.0.html&quot;&gt;&lt;code&gt;.cmt&lt;/code&gt; files were officially introduced in the standard OCaml
compiler in version
4.00.0&lt;/a&gt;,
so it's pretty recent work. Previously, they were produced by a
separate tool developed at OCamlPro for
&lt;a href=&quot;http://www.typerex.org&quot;&gt;TypeRex&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;Tworeasonswhyit39snotsupereasy&quot;&gt; Two reasons why it's not super easy&lt;/h4&gt;
&lt;p&gt;Well, this  can actually  be explain  in just a  few words.   To begin
with, there  are many cases to  address. Well, that is  not &lt;em&gt;exact&lt;/em&gt;. I
should say that  there are may cases to address  &lt;em&gt;and&lt;/em&gt; those cases are
fairly &lt;strong&gt;poorly  documented&lt;/strong&gt;, which is &amp;quot;normal&amp;quot; given  that there was
probably no  particular motivation to put  efforts into documentation.
This is  true for the source  code of ocamldoc &lt;em&gt;and&lt;/em&gt;  for its official
documentation.&lt;/p&gt;
&lt;p&gt;For instance, if you look into
&lt;a href=&quot;https://github.com/ocamllabs/opam-doc/blob/master/info.mli&quot;&gt;&lt;code&gt;info.mli&lt;/code&gt;&lt;/a&gt;, you
can see that the first type definition is:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; style_kind &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_bold
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_italic
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_emphasize
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_center
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_left
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_right
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_superscript
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_subscript
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; SK_custom &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; string
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and the only documentation for this type is
&lt;code&gt;(** The differents kinds of style.  *)&lt;/code&gt;.
Well, you can see that there's not really any
documentation needed for those &lt;code&gt;SK_...&lt;/code&gt; until... you see
&lt;code&gt;SK_custom of string&lt;/code&gt;.  There you go! You have to guess...&lt;/p&gt;
&lt;p&gt;It's not that hard when you have to guess a few times, it's
a lot harder when you keep having to guess. That's my point.&lt;/p&gt;
&lt;p&gt;Well, the other issue is more interesting.  At the time &lt;code&gt;ocamldoc&lt;/code&gt; was
designed  and  implemented,  I  bet  no one  imagined  what  folks  at
JaneStreet would do with  OCaml!  I'm talking about the implementation
of their  open source library, known  as &lt;code&gt;Core&lt;/code&gt;.  &amp;quot;&lt;code&gt;Core&lt;/code&gt; &amp;amp;  co&amp;quot; use a
&lt;em&gt;&lt;strong&gt;lot&lt;/strong&gt;&lt;/em&gt; of  &lt;code&gt;include&lt;/code&gt; directives.  The module  &lt;code&gt;Core.Std&lt;/code&gt; includes a
lot  of other  modules, which  also include  modules. If  you  want to
generate a single  full HTML page for &lt;code&gt;Core.Std&lt;/code&gt;, you'd  end up with a
&lt;em&gt;&lt;strong&gt;huge&lt;/strong&gt;&lt;/em&gt; page.  And  such a page would contain  a lot of information
coming straight  from other  pages, so you'd  end up with  hundreds of
megabytes.  Instead of  doing so, opamdoc generates only  one page per
package and one per module. If a module includes another one, then the
first will fetch the documentation of the second and there you go.  So
we  only  have 8.4MB  of  HTML  for  {async, async_core,  async_extra,
async_unix,  core, core_bench,  core_extended,  core_kernel} in  total
(well, this  number should  increase in the  future, but  linearly, as
people  will hopefully  start  documenting all  those packages).   And
that's why we have a JavaScript loader.&lt;/p&gt;
&lt;h3 id=&quot;opamdocconfigmlordocsloaderjs&quot;&gt; opam_doc_config.ml, or docs_loader.js&lt;/h3&gt;
&lt;p&gt;Since the JavaScript  may have to load tens of  megabytes of HTML, you
have to program some nasty functions and loops... and at some point it
does become big enough for  your browser to stop responding while it's
busy  loading your documentation.  So there  are several  solutions to
that. The best would probably be to stop writing in JavaScript (and
use something else that compiles to JavaScript). But that's for next
step. Now, we're trying to make the JavaScript work.&lt;/p&gt;
&lt;p&gt;The problem  with JavaScript  is that basically  there is  one &amp;quot;event&amp;quot;
loop,  and  all events  are  happening  sequentially or  concurrently,
depending on how  you wrote your JS, but when one  event is making the
browser busy,  the browser is unable  to do anything  else. That's why
your browser may tell you at  some point that you have a script making
it ill and ask you whether  you want it to stop executing that script.
One workaround  for that problem  when you know  you ask for a  lot of
computation time is to divide  your big computation into smaller ones.
You can  use &lt;code&gt;window.setTimeout&lt;/code&gt; for that, meaning  you transform your
recursive calls like &lt;code&gt;f()&lt;/code&gt;  into &lt;code&gt;window.setTimeout(f, 0)&lt;/code&gt; so that &lt;code&gt;f&lt;/code&gt;
will be called at some point. And if you have iterative loops instead,
write them recursive and use &lt;code&gt;window.setTimeout&lt;/code&gt;. That's bad.  Because
then the browser  is unable to tell that it's  crazy busy...  and it's
still really busy. So you can increase the value 0 to 1 or 10 or more.
But if you increase it too much, it'll become too slow...&lt;/p&gt;
&lt;p&gt;Ok, well, don't use JavaScript. It's a nightmare.&lt;/p&gt;
&lt;p&gt;We will probably rewrite the script using Js_of_ocaml at some point,
mainly because when you write in OCaml, you have static type checking,
and that saves so much time!&lt;/p&gt;
&lt;p&gt;To be followed...&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-26T20:57:09+00:00</dc:date>
	<dc:creator>Philippe Wang</dc:creator>
</item>
<item rdf:about="http://pw374.github.io/posts/2013-09-25-16-19-07-ones-or-zeros.html">
	<title>Philippe Wang: Are there more 1s or 0s?</title>
	<link>http://pw374.github.io/.html</link>
	<content:encoded>&lt;p&gt;The challenge is this:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;
Provide a program that will determine,  given a set of 1s and 0s, if
there are more 0s or more 1s.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So  the   first  question  that  comes   to  my  mind   is  about  the
representation of that set of 1s and 0s. Is it a linked list, a double
linked list, an array, a tree, a string, or something else?&lt;/p&gt;
&lt;p&gt;If it's a list (single linked or double linked actually doesn't matter
much), it's going to be pretty straightforward: just read the list and
use a counter. Yes, a single counter is enough, you can add one to the
counter when you meet a 1, and  subtract one when you meet a 0. At the
end, if  your counter has  its initial value,  then you have  the same
number of 1s and 0s. If it's  lesser, then it has more 0s, else it has
more 1s.&lt;/p&gt;
&lt;p&gt;Let's declare a type for the result.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;tryocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; result &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; Equal &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; More_zeros &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; More_ones
&lt;a href=&quot;javascript:octry('type result = Equal | More_zeros | More_ones');&quot;&gt;[try]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;tryocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; count l &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let rec&lt;/span&gt; loop counter &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&gt;&lt;/span&gt; counter
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; 1&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;tl &lt;span class=&quot;k&quot;&gt;-&gt;&lt;/span&gt; loop (counter&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;1) tl
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;tl &lt;span class=&quot;k&quot;&gt;-&gt;&lt;/span&gt; loop (counter-1) tl
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;_::&lt;/span&gt;tl &lt;span class=&quot;k&quot;&gt;-&gt;&lt;/span&gt; loop counter tl
    &lt;span class=&quot;com2&quot;&gt;(* you might want &lt;span class=&quot;ic&quot;&gt;to&lt;/span&gt; debate whether you should stop &lt;/span&gt;
&lt;span class=&quot;com2&quot;&gt;       &lt;span class=&quot;ic&quot;&gt;when&lt;/span&gt; you get something &lt;span class=&quot;ic&quot;&gt;else&lt;/span&gt; than a 0 &lt;span class=&quot;ic&quot;&gt;or&lt;/span&gt; a 1. *)&lt;/span&gt;&lt;!-- end comment --&gt;
  &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; r &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; loop 0 l &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; r &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    Equal
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; r &lt;span class=&quot;o&quot;&gt;&amp;#62;&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    More_ones
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    More_zeros    
&lt;a href=&quot;javascript:octry('let count l =
  let rec loop counter = function
    | [] -&gt; counter
    | 1::tl -&gt; loop (counter+1) tl
    | 0::tl -&gt; loop (counter-1) tl
    | _::tl -&gt; loop counter tl
    (* you might want to debate whether you should stop 
       when you get something else than a 0 or a 1. *)
  in
  let r = loop 0 l in
  if r = 0 then
    Equal
  else if r &gt; 0 then
    More_ones
  else
    More_zeros    ');&quot;&gt; counter
    | 1::tl -&gt; loop (counter+1) tl
    | 0::tl -&gt; loop (counter-1) tl
    | _::tl -&gt; loop counter tl
    (* you might want to debate whether you should stop 
       when you get something else than a 0 or a 1. *)
  in
  let r = loop 0 l in
  if r = 0 then
    Equal
  else if r &gt; 0 then
    More_ones
  else
    More_zeros    ');&quot;&gt; counter
    | 1::tl -&gt; loop (counter+1) tl
    | 0::tl -&gt; loop (counter-1) tl
    | _::tl -&gt; loop counter tl
    (* you might want to debate whether you should stop 
       when you get something else than a 0 or a 1. *)
  in
  let r = loop 0 l in
  if r = 0 then
    Equal
  else if r &gt; 0 then
    More_ones
  else
    More_zeros    ');&quot;&gt;[try]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Well, what's the risk with this  program? The risk is that the integer
&lt;code&gt;counter&lt;/code&gt; overflows, of course! If you have a very long list of 1s (or
0s)  only, you  may  get things  just  wrong.  However,  in OCaml,  in
reality,  there's  not really  a  chance  that  the integer  overflows
because of  the length of a  single linked list,  especially if you're
using a 64-bit architecture based OCaml, on which the greatest integer
is 4_611_686_018_427_387_903 (about 4⨉10&lt;sup&gt;18&lt;/sup&gt;). There's really
a long way  to have such a long list because  basically you would need
to  allocate more  than (about  32⨉10&lt;sup&gt;6&lt;/sup&gt; terabytes)  at once,
since basically a linked list of  integers is made of blocks that have
2 cells  each (one for  the integer, one  for the address of  the next
cell), each cell taking 64 bits (or 8 bytes).&lt;/p&gt;
&lt;p&gt;But then,  what if you  don't have linked  lists but some  stream that
gives you  a very large number of  0s and/or 1s? Well,  to begin with,
counting from 0 to 4⨉10&lt;sup&gt;18&lt;/sup&gt; takes a really long time. If your
machine can  count from 0 to  10&lt;sup&gt;9&lt;/sup&gt; in a  single second (that
would  mean  your   machine  is  very  fast),  it   would  still  take
4⨉10&lt;sup&gt;9&lt;/sup&gt;  seconds,  which  is about  4000000000/(60&lt;em&gt;60&lt;/em&gt;24*365)
years.  Oh, that means about 126 years! So let's just assume that a 63
bit signed  integer is enough for  us. And if you  really can't assume
that for some reason, you can always implement 128 bit signed integers
quite easily, and  if you don't know  how to do that or  if you're too
lazy to do it, use the Big_int module.&lt;/p&gt;
&lt;p&gt;But let's go  back the representation of those 0s and  1s. I'd like to
make the computation as fast as  possible and I'll put those 0s and 1s
in a very compact representation. Each  0 and 1 will now only take one
bit in the  memory (with a possible constant  overhead for the whole).
For that,  let's use  OCaml's strings, which  are basically  arrays of
bytes.   The  longest  string I  can  have  on  my machine  will  bear
1_152_921_504_606_846_904  bits  (I  know  that because  I  multiplied
Sys.max_string_length   by   8),  and   that's   a   lot  (more   than
10&lt;sup&gt;8&lt;/sup&gt;).&lt;/p&gt;
&lt;p&gt;Now say  we want to know  whether there are more  0s or 1s  as fast as
possible.  How do we do that?&lt;/p&gt;
&lt;p&gt;We don't want  to count all 0s  and 1s bit by bit,  because that would
have quite  a high cost! Indeed, we  would have to get  each byte, and
for each byte  we would have to read  each of its 8 bits  (that can be
done) one by one.  We don't want to do that.&lt;/p&gt;
&lt;p&gt;Instead, since we have bytes, we can conveniently allocate an array of
size 256.   Each cell of that  array will contain the  right number to
add to the counter. This way, we can read a byte, get its number of 0s
and 1s in O(1).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;tryocaml&quot;&gt;&lt;span class=&quot;com2&quot;&gt;(* this table is computed only once *)&lt;/span&gt;&lt;!-- end comment --&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; table &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; number_for_a_byte b &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; r &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; ref 0 &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; 7 &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; (b &lt;span class=&quot;k&quot;&gt;lsr&lt;/span&gt; i) &lt;span class=&quot;k&quot;&gt;land&lt;/span&gt; 1 &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        decr r
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        incr r
    &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;r
  &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;make 256 0 &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; 255 &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    a&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;(i) &lt;span class=&quot;o&quot;&gt;&amp;#60;-&lt;/span&gt; number_for_a_byte i
  &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
  a
&lt;a href=&quot;javascript:octry('(* this table is computed only once *)
let table =
  let number_for_a_byte b =
    let r = ref 0 in
    for i = 0 to 7 do
      if (b lsr i) land 1 = 0 then
        decr r
      else
        incr r
    done;
    !r
  in
  let a = Array.make 256 0 in
  for i = 0 to 255 do
    a.(i) &lt;- number_for_a_byte i
  done;
  a');&quot;&gt;- number_for_a_byte i
  done;
  a');&quot;&gt;- number_for_a_byte i
  done;
  a');&quot;&gt;[try]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then let's abstract from the means  to read new 0s and 1s, by assuming
we'll be provided a function &lt;code&gt;f&lt;/code&gt; that given &lt;code&gt;()&lt;/code&gt; will return 8 bits in
a value  of type  &lt;code&gt;char&lt;/code&gt;, and will  raise the  exception &lt;code&gt;End_of_file&lt;/code&gt;
when it has no more bits to give.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;tryocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; more_zeros_or_ones f &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; c &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; ref 0 &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    c &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;c &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; table&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;(int_of_char(f()))
  &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; End_of_file &lt;span class=&quot;k&quot;&gt;-&gt;&lt;/span&gt; () &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;c &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    Equal
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;c &lt;span class=&quot;o&quot;&gt;&amp;#62;&lt;/span&gt; 0 &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    More_zeros
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    More_ones
&lt;a href=&quot;javascript:octry('let more_zeros_or_ones f =
  let c = ref 0 in
  begin try while true do
    c := !c + table.(int_of_char(f()))
  done with End_of_file -&gt; () end;
  if !c = 0 then
    Equal
  else if !c &gt; 0 then
    More_zeros
  else
    More_ones');&quot;&gt; () end;
  if !c = 0 then
    Equal
  else if !c &gt; 0 then
    More_zeros
  else
    More_ones');&quot;&gt; () end;
  if !c = 0 then
    Equal
  else if !c &gt; 0 then
    More_zeros
  else
    More_ones');&quot;&gt;[try]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note  that &lt;code&gt;int_of_char&lt;/code&gt;  has a  zero-cost (i.e.,  it  &amp;quot;disappears&amp;quot; at
compile-time because  &lt;code&gt;int&lt;/code&gt; and &lt;code&gt;char&lt;/code&gt;  sort of share the  same memory
representation).  If  you want  better performance, you  should inline
&lt;code&gt;f&lt;/code&gt;, provided that you  know what it is (you may want  to check if the
compiler does the inlining itself first, just in case).&lt;/p&gt;
&lt;p&gt;Also, you may want  to use a table with a size  larger than 256 if you
have a lot of memory but I'm not so sure you'd gain performance unless
you  use nasty  tricks to  read larger  integers from  a  string. Then
again, you may  not end up using  a string, in which case  you have to
think with the whole problem in mind.&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-26T20:57:09+00:00</dc:date>
	<dc:creator>Philippe Wang</dc:creator>
</item>
<item rdf:about="http://www.syslog.cl.cam.ac.uk/?p=1461">
	<title>SRG Syslog: Liveblogging OCaml Workshop 2013</title>
	<link>http://www.syslog.cl.cam.ac.uk/2013/09/24/liveblogging-ocaml-workshop-2013/</link>
	<content:encoded>&lt;p class=&quot;lead&quot;&gt;&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo10-e1380031931194.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1466&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo10-e1380031931194-225x300.jpg&quot; width=&quot;100&quot; /&gt;&lt;/a&gt;I&amp;#8217;m here bright and early at the &lt;a href=&quot;http://ocaml.org/meetings/ocaml/&quot;&gt;OCaml 2013&lt;/a&gt; workshop at ICFP with Heidi Howard, Leo White, Jeremy Yallop and David Sheets!  There&amp;#8217;s a packed session today with lots of us presenting, so we&amp;#8217;ll swap over editing this post as the day progresses.  I also need to pop out to attend a panel on the future of Haskell so I&amp;#8217;ll be missing the bindings session, sadly!&lt;/p&gt;
&lt;p&gt;&lt;span id=&quot;more-1461&quot;&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Accessing and using weather data in OCaml&lt;/h2&gt;
&lt;p&gt;Hez Carty from MDA Information Systems on doing large-scale weather data processing.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo9-e1380049811789.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1465&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo9-e1380049811789-225x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;He started with OCaml in graduate school and was looking for something better than Python, whereas they are building systems that need to run for many years with high stability.  He&amp;#8217;s not from a formal CS background but from the physical sciences, and found that the static typing made it easy to explore the language features.  The native code output is also important, and he finds predictability very important in day-to-day engineering.  The simple FFI also made a big difference.&lt;/p&gt;
&lt;p&gt;They do weather data retrieval and use HTTP/zeromq as a message bus to do language interop, and a workflow management tool to handle dependency graphs.  They take weather models frmo all these sources, and do various analyses (principal component analysis, probability models for precipitation via Monte Carlo simulations with a first order Markov chains).  More generally, there is a bunch of processing for climatology and data extraction and insertion.&lt;/p&gt;
&lt;p&gt;A NAM forecast plots the geo data of the USA, and overlays semitransparent layers (e.g. clouds) that are stacked up to get a fake satellite view of the earth, and then there are simulated radar returns where the model (e.g.) rains.  In addition to the structured formats, there is raw streaming data from sensor stations that send back raw binary data such as precipitation events, which is written as a small OCaml library to parses them into more structured formats.&lt;/p&gt;
&lt;p&gt;The big data formats are HDF4 and GRIB, which are binary data formats. There are mature C libraries to parse them and lots of existing analysis tools (e.g. wgrib which can extract lat/longs from a big file).  However, the tools arent great for doing larger scale analysis, as shelling out all the time for thousands of points is not ideal &amp;#8212; therefore they bind to OCaml to do the analysis in-house.&lt;/p&gt;
&lt;p&gt;The GRIB bindings use int, float and float arrays and bindings are entirely hand-written &amp;lt;i&amp;gt;(I&amp;#8217;m looking forward to the ctypes talk! &amp;#8211;anil)&amp;lt;/i&amp;gt;.  They expose only an OCaml friendly interface that is safe for callers.  The speaker now shows several nice graphs from CloudSat tracks from earth orbit, and how they take intersecting profiles to deduce things about what multiple satellites are seeing.&lt;/p&gt;
&lt;p&gt;They&amp;#8217;re mixing lots of different tools and satellite sources &amp;#8212; derived information from teleconnections (air surface pressure and how it varies in terms of oscillations between the north and south Atlantic).  All the analysis is written in OCaml, and he had to work with several scientists who didn&amp;#8217;t have access to their initial source code in many cases, so the experience of working with his fresh system was very positive.&lt;/p&gt;
&lt;p&gt;Challenges:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;standard issues when interfacing with C (type mismatches between C and OCaml in particular, and the question of sharing vs copying).  The worst failure mode is silent failure with bad data, which leads to bad science!&lt;/li&gt;
&lt;li&gt;&amp;#8220;Getting used to the functional way of life&amp;#8221; can tough, as is knowing when to balance elegance with the speed benefits of not copying hundreds of megabytes of data around can be tough.&lt;/li&gt;
&lt;li&gt;Development environments other than Emacs and Vim are poorly supported.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The overall project has been very successful, and the bindings for HDF4/GRIB API bindings have been used to process 1TB+/day for over 5 years now.  It&amp;#8217;s based on Bigarray and mmap, and the FFI makes getting up and running quickly.&lt;/p&gt;
&lt;p&gt;He finds OPAM with local repositories fantastic, and used GODI and odb/oasis-db before that.&lt;/p&gt;
&lt;p&gt;Q: how did he do the cool plots?&lt;/p&gt;
&lt;p&gt;A: plplot bindings on github&lt;/p&gt;
&lt;p&gt;Q: Anil: did you move from Fortran&lt;/p&gt;
&lt;p&gt;Q: Nate Foster: terabytes of data makes me wonder about GC?&lt;/p&gt;
&lt;p&gt;A: going through and folding over data generates huge amount of garbage and slows things down considerably. If the project is one-off, he tweaks the GC or manually call the GC more often. Really depends on length of code.&lt;/p&gt;
&lt;p&gt;Q: The data processed is huge, so what was the parallel computation approach?&lt;/p&gt;
&lt;p&gt;A: The task distribution system doesn&amp;#8217;t need a lot of parallelism, as he can work on one file at a time or chunk the files manually and aggregate the results.  He&amp;#8217;s looking forward to doing some semi-shared memory parallelism.&lt;/p&gt;
&lt;p&gt;Q: Pierre Chambart: Is the numerical code in OCaml or C?&lt;/p&gt;
&lt;p&gt;A: LAPACK in OCaml, but the Monte Carlo is pure OCaml and interpolation is in pure OCaml too.  Unless speed is absolutely required, it&amp;#8217;s written in OCaml.&lt;/p&gt;
&lt;h2&gt;Frenetic Network Controller&lt;/h2&gt;
&lt;p&gt;Arjun Guha about their multiyear project to program software define networks. When he started on this, he thought that networks are just a series of tubes! The reality is very different though, as there are numerous intermediate boxes (firewalls, routers, wireless auth). The real problem is that each of these intermediate boxes runs specialized, vendor-specific software and are configured independently via some proprietary CLI. They&amp;#8217;re difficult to configure and difficult to statically reason about.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo13-e1380031705305.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1480&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo13-e1380031705305-225x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SDN helps with this by introducing standardized programmable that can deploy in-network features, and a logically centralized controller (a big beefy server) that enables reasoning about whole-network behaviour. SDN is a hot topic right now (lots of commercial startups, 200+ people at HotSDN, generally very busy).&lt;/p&gt;
&lt;p&gt;There are several Openflow controllers out there: Java (Floodlight), Python (Pox), C++ (Nox) and Haskell (Nettle), but Arjun introduces a novel OCaml programmable switch!&lt;/p&gt;
&lt;p&gt;Openflow works via a controller &amp;#8220;faulting&amp;#8221; in new packets that are routed to the controller when unknown packets show up on the wire. The source code consists of a generic Openflow packet parser (its a binary protocol), and a generic packet parser (e.g. TCP/IP) and a routing engine.&lt;/p&gt;
&lt;p&gt;First library: ocaml-packet that deals with deserializing TCP/IP/ARP/ICMP/Ethernet/802.1Q, and only depends on cstruct by Anil et al. (shows an example of a C struct for IPv4), and the nice thing that they get network byte order for free (thanks to Pierre Chambarts ocplib-endian of course).&lt;/p&gt;
&lt;p&gt;ocaml-openflow uses serialization for OpenFlow 1.0 and 1.3, and is based on a (cleaned up) fork of the mirage-openflow library, using ideas from Nettle about to structure the code. OpenFlow 1.3 is less complete currently but is still quite usable.&lt;/p&gt;
&lt;p&gt;The runtime systems for OpenFlow 1.0 and 1.3 listens for TCP connections from switches, and does the OpenFlow handles and keeps connections to switches alive.&lt;/p&gt;
&lt;p&gt;The source code uses Lwt and so exposes the monad to external users, e.g.:&lt;/p&gt;
&lt;pre&gt;type t
val connect : Lwt_unix.file_descr -&amp;gt; t option Lwt.t&lt;/pre&gt;
&lt;p&gt;They have a tutorial for non-OCaml hackers, and found teaching OCaml, Openflow AND Lwt was too much for new users. Therefore they built a new controller called Ox that hides much of the details of Lwt threading. It still uses them internally (Lwt, ocaml-openflow) but is inspired by Ox.&lt;/p&gt;
&lt;p&gt;Therefore they can build simple openflow tutorials using Ox, and advanced controller such as Frenetic can be built directly using the low level libraries. Good for beginners and weathered OCaml hackers alike!&lt;/p&gt;
&lt;p&gt;The problem with the controller seeing every bit of data is that it gets flooded by packets if it doesnt insert rules into the switches itself. Every switch has a &lt;i&gt;flow table&lt;/i&gt; that has priorities, patterns and actions, and tries to take action without bothering the controller. At start of day, the controller does see everything, but eventually flows settle down. The problem they are solving is avoiding having two copies of the program on both the controller and the switch, and figuring out how to deal with race conditions across the two. The simple, logical structure of the OCaml program gets torn apart if they try to write these two parallel logic rules by hand.&lt;/p&gt;
&lt;p&gt;They deal with this in the Frenetic network controller. This is a DSL for programming OpenFlow networks, and it has boolean predicates, several policy composition operations and compiles to OF flow rules. It implements ideas from several papers (ICFP/POPL/SIGCOMM/PLDI) and is fully open source on GitHub. (frenetic-lang/frenetic).&lt;/p&gt;
&lt;p&gt;They made a transition from Haskell to OCaml for a few reasons. They specified several parts of the Core compiler and runtime in Coq, and found Haskell/Coq extraction very painful (specifically, they had to abandon Coq functors, which had helped them discover key algebraic properties for their work on Kleene algebras). They found it easier for their collaborators to use OCaml than Haskell in general too.&lt;/p&gt;
&lt;p&gt;Lwt programming is mind boggling for beginners although the syntax extension does help, and the lack of multicore is a future problem as the controller needs scale up. Overall, they find that hacks at any layer are possible now and lots of projects have spun up!&lt;/p&gt;
&lt;p&gt;Q: multicore is a common criticism, but could you give an example of how you would actually solve this is you had shared memory vs a fork model?&lt;br /&gt;
A: There are several networking algorithms in the literature, and its a barrier for consumers. Nate notes that they could write one by hand but there&amp;#8217;s a time issue there and would rather have it automagically.&lt;/p&gt;
&lt;h2&gt;PHP Program analysis at Facebook&lt;/h2&gt;
&lt;p&gt;Pffff is all about deadcode removal, test coverage, checking for undefined function and use of undeclared variables, and syntactical grep rules. They also do taint analysis via abstract interpretation, type driven flow control and eventually (via Monoidics) a separation logic model (they use OCaml too).&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo11-e1380048991412.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1478&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo11-e1380048991412-225x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This talk is about static analysis of a huge codebase (5m lines+ of PHP code is scary!). Since he had a lot of big monitors, he built the tools to do analysis over huge codebases. He demonstrates this on the OCaml compiler itself &lt;i&gt;(camlp4 is huge! boo!!! -anil)&lt;/i&gt;. They can also zoom in in realtime to each box and eventually see the content of the file itself!&lt;/p&gt;
&lt;p&gt;The goal is NOT to build an editor, but to analyse and explore large code bases. It opens and editor if required any time. The idea is to transform semantic program analysis into a visual formt that&amp;#8217;s more easily digestible. Just like in Google Maps where you see the big important roads and only the details when you zoom in. He uses this tool all day on his own codebase too, and gradually realised that when you want to learn a new codebase, you want to start to learn the software architecture first, and then want to figure out the dependency graph before seeing details.&lt;/p&gt;
&lt;p&gt;He then shows an interactive grid map that explains the dependencies of whole subdirectories of the OCaml compiler, and drill down to understand what they&amp;#8217;re for.&lt;/p&gt;
&lt;p&gt;Audience q: did you consider a flare graph? a: others have done edge graphs and graphviz etc, and none of these scale to quite the heights that this particular grid done. The ordering of the grid is also the transitive order of dependencies, so it starts with the list of simple dependencies (stdlib) and ends with the toplevel (depends on everything). You can spot for example the OCaml dev rule that things in stdlib are only used by the compiler.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo14-e1380031776990.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1481&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo14-e1380031776990-225x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;With good software, the top right of the grid is full, which is forbidden by OCaml (no cyclic module deps). With other software, the situation is far worse (audience laughter).&lt;/p&gt;
&lt;p&gt;There are many other tools (CodeQuery, stags, sgrep/spatch and scheck).  There are plugins for PHP, OCaml (using the cmt options) and Java (using Joust), C/C++ (using clang) getting all the semantic information from varied source code.  There is a plan to move it to the web (from a GTK interface) by using Ocsigen.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Conclusion: CodeMap is a scalable semantic source code vis/searcher for huge codebases, and codeGraph visualizes dependencies.   Future work is to minimize backward deps.&lt;/p&gt;
&lt;p&gt;All on Github at github.com/facebook/pfff.git&lt;/p&gt;
&lt;p&gt;Q: can you insert other metadata such as Linux perf output?&lt;/p&gt;
&lt;p&gt;A: yes! (I think)&lt;/p&gt;
&lt;h2&gt;Extension points: an alternative to camlp4&lt;/h2&gt;
&lt;p&gt;Leo White talking about alternatives to camlp4. Why? Camlp4 is very complex and it comes due to its support for an extensible grammar. Did a wg-camlp4 working group to figure out how to evolve common uses towards a more easily parsed standard, to reduce the day-to-day dependency on camlp4. After 400 emails, a consensum emerged.&lt;/p&gt;
&lt;p&gt;sexplib as an example: the old version was&lt;/p&gt;
&lt;pre&gt;type t = {
  float: int default(42);
  bar: float;
} with sexp&lt;/pre&gt;
&lt;p&gt;The annotated version is:&lt;/p&gt;
&lt;pre&gt;type t = {
  foo: int; [@default 42]
  bar: float
} [@@sexp]&lt;/pre&gt;
&lt;p&gt;This has annotation data that is passed straight through to a transformer, with no extensions to the grammar. Thus the sexplib transformer can understand with @default 42 means, and editors can easily hide or fold annotations without having to understand their details precisely.&lt;/p&gt;
&lt;p&gt;The compiler ignores any AST extension fragments that remain after all the transformers are done.&lt;/p&gt;
&lt;p&gt;sedlex&lt;/p&gt;
&lt;pre&gt;[%lexer
  match foo with
  (Range ('a','z') | Range(1000,1500)), 65 -&amp;gt; Foo
  | Star (Range('a','z')) -&amp;gt; Bar
]&lt;/pre&gt;
&lt;p&gt;These are genuine AST nodes and so if these aren&amp;#8217;t handled by the transformer, an error will result. Another example is&lt;/p&gt;
&lt;p&gt;properly foreign syntax, via COW (Caml on the Web)&lt;/p&gt;
&lt;pre&gt;let world = &quot;world&quot; in
let html =  [%html {|&amp;lt;h1&amp;gt;Hello $str:world$!&amp;lt;/h1&amp;gt;
|}]&lt;/pre&gt;
&lt;p&gt;There&amp;#8217;s also a shortcut convention for the syntax, such as:&lt;/p&gt;
&lt;pre&gt;match%lexer foo with
 {|&lt;/pre&gt;
&lt;p&gt;There&amp;#8217;s a shorthand form to avoid have lots of brackets due to deeply nested lets.&lt;/p&gt;
&lt;pre&gt;[%lwt let x = f () in
[%lwt let y = g () in&lt;/pre&gt;
&lt;p&gt;These have all been implemented by Alain Frisch and merged onto trunk (in OCaml 4.02.0dev). Thoughts and feedback are very welcome on the wg-camlp4 list&lt;/p&gt;
&lt;p&gt;Q: how does this affect the quality of error messages?&lt;br /&gt;
A: Leo -- do you mean error messages from the extension itself?&lt;br /&gt;
Q: what if there is an error in the extension?&lt;br /&gt;
A: The 42 that was in the default has an AST fragment and so the transformer will transplant the location. A sensible transformer will therefore be nonlossy.&lt;/p&gt;
&lt;p&gt;Q: can you chain transforms?&lt;br /&gt;
A: yes, thats why we are going with an AST fragment rather than a string, so chaining is easier. If youve got some macro expansion transformer and you want to use it with the sedlex example, they are executed in the other they are given on the command line. The next transformer will just see the resulting AST fragment, and therefore should compose between than camlp4 extensions have in the past.&lt;/p&gt;
&lt;p&gt;Q: do you have ideas about hygiene as Scheme does?&lt;br /&gt;
A: Not particularly in this case, although Leo has some ideas for future systems.&lt;/p&gt;
&lt;p&gt;Q: Ashish Agarwal -- do existing extensions need to be reimplemented&lt;br /&gt;
A: Good thing about all these existing extensions is that they have an existing parser, so you can take your existing implementation in camlp4 and mechanically translate into an extension_points version!&lt;/p&gt;
&lt;p&gt;Q: Yaron: is anyone thinking about good libraries (hygiene etc)&lt;br /&gt;
A: Alain Frisch has merged in ppxtools into OPAM stable (that depends on 4.02.0+)&lt;/p&gt;
&lt;p&gt;Q: Will this improve performance over camlp4&lt;br /&gt;
A: Parsing is an expensive process and this is still doing marshalling. The cost is often the case that we are shelling out to this other process, so we still need to look into improving performance in other ways.&lt;/p&gt;
&lt;h2&gt;GPGPU programming with SPOC&lt;/h2&gt;
&lt;p&gt;M Bourgoin presents his PhD work on SPOC.&lt;/p&gt;
&lt;p&gt;GPGPU is odd hardware: several mutiprocessors, dedicated memory, connected via PCI-E and transferred between a GPU and host using DMA. Currently hardware has 300-2000 cores vs 4-16 CPU cores (wow). However this demands a very specific progamming model to take advantage of all this hardware.&lt;/p&gt;
&lt;p&gt;Shows an example of a vector addition in openCL&lt;/p&gt;
&lt;pre&gt;__kernel vac_add(global const double *c, global const double *a, global double *b, int N)
int nIndex = get_global_id(0);
if (nIndex &amp;gt;= N)
  return;
c[nIndex] = a[nIndex] + b[nIndex]&lt;/pre&gt;
&lt;p&gt;To actually use this though, you need a massive program to set up the kernel and execute it. It does the transforms, initialization, scheduling and so forth.&lt;/p&gt;
&lt;p&gt;OCaml and GPGPU complement each other, since we have sequential high-level OCaml and highly parallel and low-level GPGPU. So the idea with SPOC is to use OCaml to develop high level abstractions in the GPGPU and program it from OCaml.&lt;/p&gt;
&lt;p&gt;SPOC is a stream processing engine in OCaml that emits Cuda but lets it be more hardware independent.&lt;/p&gt;
&lt;pre&gt;let dev = Devices.init ()
let n = 100000
let v1 = Vector.create Vector.float64 in
let v2 = Vector.create Vector.float64 in
let v3 = Vector.create Vector.float64 in

let k = vector_add (v1,v2,v3,n)
let block = {blockX = 1024; blockY=1; blockZ=1}
let grid={gridx=(n+1024-1)/1024; gridY=1; gridZ=1}

let main()=
random_fill v1;
random_fill v2;
Kernel.run k  (block,grid) dev.(0);
#printf of result&lt;/pre&gt;
&lt;p&gt;SPOC takes care of transferring the kernel to the GPU and back and handling the scheduling and exchange of data. Vectors are very similar to Bigarrays in that they are external memory.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo15-e1380048240290.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1493&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo15-e1380048240290-224x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We want: simple to express, predictable performance and extensible libraries, and for current high performance libraries to be usable more safely.&lt;/p&gt;
&lt;p&gt;Two solutions: interop with Cuda/OpenCL kernel (better perf and more compatible but less safe). There is also a DSL in OCaml called Sarek, which talk focusses on.&lt;/p&gt;
&lt;p&gt;Sarek vector addition has an ML like syntax, and the language features monomorphic, imperative, toplevel and statically typed checked (with type inference). Its statically compiled to OCaml code and dynamic compilation to Cuda and OpenCL.&lt;/p&gt;
&lt;p&gt;SPOC+Sarek achieves 80% of hand-tuned Fortran performance and SPOC+external kernels is on par with Fortran (93%). It&amp;#8217;s type safe, 30% code reduction, memory managed by the GC and there are fewer memory transfers. This is ready for the real world and has great performance! Available on OPAM.&lt;/p&gt;
&lt;p&gt;Great performance, portable, great for GPU and for multicore CPU and nice playground for future abstractions.&lt;br /&gt;
Who can benefit?&lt;/p&gt;
&lt;p&gt;OCaml programmers -&amp;gt; better performance&lt;br /&gt;
HPC programmers -&amp;gt; much more flexible and extensible than current state of the art.&lt;/p&gt;
&lt;p&gt;Future work: Sarek needs custom types, function decls, recursions, exceptions, and to build parallel skeletons using SPOC and Sarek.&lt;/p&gt;
&lt;p&gt;Why not use Sarek for multicore? Well, here&amp;#8217;s the results!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ParMap: data parallel and similar to OCaml mapfold&lt;/li&gt;
&lt;li&gt;OC4MC: posix threads, compatible with current OCaml code&lt;/li&gt;
&lt;li&gt;SPOC : GPGPU kernels on a CPU, mainly data parallel and needs OpenCL.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Simple program to calculate power series and matrix multiplication.&lt;/p&gt;
&lt;p&gt;Power: OCaml 11s14, Parmap 3s30 SPOC &amp;lt;1s&lt;br /&gt;
Matmul: OCaml 85s OC4MC 28s and SPOC 6.2s&lt;/p&gt;
&lt;p&gt;Significant improvements using SPOC &amp;#8212; 11x for power series and 12x for SPOC. Running on a quad core intel i7.&lt;/p&gt;
&lt;p&gt;SPOC is available via OPAM and compatible with x86_64 on Linux and MacOS X, and speaker would love feedback.&lt;/p&gt;
&lt;p&gt;Q: Anil &amp;#8211; how hard is OpenCL to install&lt;br /&gt;
A: easy if you know your hardware model and to the vendor website. Harder with multiple GPUs though.&lt;/p&gt;
&lt;p&gt;A: if you want to target CPUs, you need to target OpenCL and not CUDA.&lt;/p&gt;
&lt;h2&gt;High level performance optimisations for OCaml&lt;/h2&gt;
&lt;p&gt;Pierre Chambart at OCamlPro (funded by Jane Street). OCaml is fast, but not an optimizing compiler (it has predictable performance, good generated code, but what can we do to make it go faster?).&lt;/p&gt;
&lt;p&gt;A small modification to high level code shouldnt influence the low level bits.&lt;/p&gt;
&lt;pre&gt;let f x = 
  let cmp = x &amp;gt; 3 in
  if cmp then A else B

let g x =
  if x &amp;gt; 3 then A else B&lt;/pre&gt;
&lt;p&gt;The second bit of code is faster than the first here since &amp;#8216;g&amp;#8217; is spotted by the compiler peephole optimizer.&lt;/p&gt;
&lt;pre&gt;let g x = 
  let f v = x + v in
  f 3&lt;/pre&gt;
&lt;p&gt;Abstract code should be compiled less abstractly. Above, we want to inline f, but a closure is still allocated per call unnecessarily. But we also dont want the compiler to be too smart and lose predictability!&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo16-e1380048580650.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1496&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo16-e1380048580650-225x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Currently compiler pipeline has a parsetree &amp;#8211; typed tree &amp;#8211; lambda (untyped) &amp;#8211; clambda (lambda+closures) &amp;#8211; cmm (simple C like) and then mach (instruction graph similar to llvm) and then lin (assembly like).&lt;/p&gt;
&lt;p&gt;Details: typed tree to lambda (construct elimination) &amp;#8211; lambda (high level simplication such as reference elimination and pattern matching generation) &amp;#8211; lambda to clambda (inlining, constrant propagation and book keeping in an intricate recursive loop) &amp;#8211; clambda to cmm (unboxing, lots of peep hole checks for boxing/unboxing and tagging/untagging) &amp;#8211; cmm to mach (instruction selection and some more peephole) &amp;#8211; mach (allocation fusion, register allocation and scheduling)&lt;/p&gt;
&lt;p&gt;Where do we do high level optimizations then? For example, where do we do inlining (since it allows other transformations to apply). typedtree is too complicate, lambda (want inlining, simpler with closures), clambda (is too difficult to improve, and Pierre did try) and cmm (good for local optimization but not global) and mach is architecture specific.&lt;/p&gt;
&lt;p&gt;They are adding a new intermediate form between lambda and clambda known as flambda. This needs a highlevel view of values, simple manipulations, explicit closures and explicit value dependencies. lambda to flambda introduces closures, and flambda to clambda is mainly book keeping (and preparing cross-module information). The magic for optimization will be in flambda-flambda passes, and not in the flambda to clambda layers.&lt;/p&gt;
&lt;p&gt;Shows several examples of inlining, simplication and dead code elimination and why its significantly easier in the flambda form for simple microexamples. Also shows lambda lifting!&lt;/p&gt;
&lt;p&gt;Change the performance model. Now its WYSIWYG, but we want some sort of understandable compile-time evaluation. For example, consider a map function as a metaprogramming function that you want to execute at compile time without all the intermediate closure allocation.&lt;/p&gt;
&lt;p&gt;Add build_test to your OPAM to make it easier to test the compiler, and Obj-using code is very likely to break if you do certain mutations behind the compiler, or dead code elimination might happen if you use a value behind the compiler&amp;#8217;s back.&lt;/p&gt;
&lt;p&gt;Q: SimonPJ: why is it easier to do closure conversion first, as it&amp;#8217;s a lot easier in GHC to do the opposite. There are now two ways to get a value in scope doing it the other way.&lt;br /&gt;
A: In Haskell you have everything in your closure, since you get the information from the closure.&lt;br /&gt;
Q: Think of lambda calculus with let&lt;br /&gt;
A: We do flow analysis to get around this!&lt;br /&gt;
Q: This is quite complex. Is it whole program analysis?&lt;br /&gt;
A: Restricted to a single compilation unit, and a few other cases, not cross-module yet.&lt;/p&gt;
&lt;p&gt;Q: Yoann: if the prediction is &amp;#8220;its always faster&amp;#8221; then why do you care about predictability?&lt;/p&gt;
&lt;h2&gt;Replacing the format string hack with GADTs&lt;/h2&gt;
&lt;p&gt;Benoit Vaugon talks about how to improve the typing of Format strings in OCaml by using GADT encodings. He stats with showing basic examples of the Printf module, and advanced examples that include the &amp;#8220;%a&amp;#8221; callback, date scanning and hex dumping.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo17-e1380051856191.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1508&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo17-e1380051856191-300x225.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The OCaml type checker has an inferred type that encodes the details of the format string in a &amp;#8220;format6&amp;#8243; type that has lots of type parameters that describe the format string contents.&lt;br /&gt;
During type checking, the literal string is parsed and there is manual inference of the format6 type parameters. At runtime, the format strings are represented by the string from the source code.&lt;/p&gt;
&lt;p&gt;During printing functions, it parses the format and count parameters and accumulates parameters. It then extracts and patches subformats, and finally calls the C printf function. Scanning is more complex but broadly similar.&lt;/p&gt;
&lt;p&gt;There are quite a few problems with this. There are 5 (!) format string parsers (two in Printf, two in Scanf, one in the type checker) and there are lots of little incompatibilities as a result. For example&lt;/p&gt;
&lt;pre&gt;Printf.printf &quot;%1.1s&quot; &quot;hello&quot;&lt;/pre&gt;
&lt;p&gt;Results in Invalid_argument exception despite the static type checking, with a useless error message.&lt;/p&gt;
&lt;p&gt;There is a weakness in the type checker too, for example&lt;/p&gt;
&lt;pre&gt;Printf.sprintf &quot;%s.+f&quot; 3.14&lt;/pre&gt;
&lt;p&gt;results in the format string being printed.&lt;/p&gt;
&lt;p&gt;You can also segfault from there, such as&lt;/p&gt;
&lt;pre&gt;Format.printf &quot;@%d%s&quot; 42 &quot;hello&quot;&lt;/pre&gt;
&lt;p&gt;will segfault.&lt;/p&gt;
&lt;p&gt;Speed is also a concern, as parsing the format at runtime is slow, and reparsing is required by another slow C printing function. Lots of memory allocation is required.&lt;/p&gt;
&lt;p&gt;The new implementation sorts all this out by using GADTs to represent the formats. The format6 type is now concrete and not magic predefined. Formats now also become statically allowed and not multiply passed around dynamically.&lt;/p&gt;
&lt;p&gt;The new implementation (which he shows) is a fairly epic GADT but quite regular when broken down into pattern clauses and examined with respect to the old implementation.&lt;/p&gt;
&lt;p&gt;Issues: evaluation order changes slightly, as for printing functions the parameters are accumulated before printing. String_of_format is implemented by &amp;#8220;%identity&amp;#8221; and in the new implementation, we need to change the representation (either regenerate the string from the GADT or implement formats by a tuple).&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo18-e1380051839961.jpg&quot;&gt;&lt;img class=&quot;alignright  wp-image-1509&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo18-e1380051839961-225x300.jpg&quot; width=&quot;158&quot; height=&quot;210&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;There&amp;#8217;s now only one format parser (down from 4-5) for the standard library and OCaml type checker&lt;/p&gt;
&lt;pre&gt;type ('b,'c,'e,'f) fmt_ebb = Fmt_EBB:
 ('a,'b,'c,'d,'e,'f) CamlinternalFormatBasics.fmt -&amp;gt;
 ('b,'c,'e,'f) fmt_ebb
val fmt_ebb_of_string : string -&amp;gt; ('b,'c,'e,'f) fmt_ebb
val type_format: ('x,'b,'c,'t,'u,'v) format6 -&amp;gt;
   ('a,'b,'c,'d,'e,'f) fmtty -&amp;gt; ('a,'b,'c,'d,'e,'f) format6&lt;/pre&gt;
&lt;p&gt;(this looks verbose but isnt really exposed outside of the compiler.&lt;/p&gt;
&lt;p&gt;Another issue is the &amp;#8220;%(..%r..%)&amp;#8221; construction, since we need to include a proof term of the number of &amp;#8220;%r&amp;#8221; occurrences. The encoding for this is quite complex.&lt;/p&gt;
&lt;p&gt;Performance of the new system is significantly better across the board. A hello world goes from (230ns to 55ns) timing and (732 to 24 bytes allocated) for example.&lt;/p&gt;
&lt;p&gt;Q: Oleg did it already in Haskell &lt;i&gt;(ha ha &amp;#8212; editor)&lt;/i&gt;. He notes that six parameters arent needed, as the GADT is the interpreter over the paramters.&lt;br /&gt;
A: yes can remove them if we split the Printf and Scanf format, and there is also a format4 which removes several parameters. We also have a problem with error messages since all the type parameters make things really complicated.&lt;br /&gt;
Q: Oleg: the work of interpreting the stream is pushed into the GADT, but if you write an interpreter over the GADT then we have simpler external types.&lt;br /&gt;
&amp;#8230;discussion moves into offline discussion.&lt;/p&gt;
&lt;h2&gt;Dynamic types in OCaml&lt;/h2&gt;
&lt;p&gt;Gregoire Henry wants to do dynamic types in OCaml.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo19-e1380052996312.jpg&quot;&gt;&lt;img class=&quot;alignright size-thumbnail wp-image-1515&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo19-e1380052996312-150x150.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Structural type introspection: generic I/O primitives, type-safe (unlike Marshal) and typed (not written in Camlp4) &amp;#8212; these are polytypic functions.&lt;/li&gt;
&lt;li&gt;Normal type introspection, for dynamic values (a k/v store or a DSL with dynamic typing), or extensible polytypic functions for abstract types.&lt;/li&gt;
&lt;li&gt;This would also give us a common type representation for (e.g.) Eliom services that will be converted to Javascript, or for FFI libraries, and to let the debugger explore the heap with exact typing information.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Probably isnt a single representation that fits all these use cases: We need to preserve abstraction when desired, but also to break abstraction when desired (e.g. by the debugger or a generic printer, but not by accident!), and it shouldn&amp;#8217;t impose a big performance hit.&lt;/p&gt;
&lt;p&gt;Gregoire gives a description of a polytypic printing function&lt;/p&gt;
&lt;pre&gt;let rec print (type t) (ty: t ty) (v:t) =
  match head ty with
  |Int -&amp;gt; print_int v
  | String -&amp;gt; print_string v
  | List ty -&amp;gt; print_list (print ty) v
  | Sum desc -&amp;gt;
  let (name, args) = sum_get desc v in
  print_string name 
  ...&lt;/pre&gt;
&lt;p&gt;We define a predefined type &amp;#8220;t ty&amp;#8221; and a syntax for type expressions &amp;#8220;(type val t) of type &amp;#8220;t ty&amp;#8221;. We then introduce implicit type arguments which are optional arguments instantiated at call-site with the dynamic representation of the expected type.&lt;/p&gt;
&lt;pre&gt;val print : ?t:(typ val 'a) -&amp;gt; 'a -&amp;gt; string
let print ?(type val t) (v:t) = ...

type t = R of int * int | ...
let x = R (1,2)
let () = print x (* implicit arg is (type val t) *)&lt;/pre&gt;
&lt;p&gt;This is experimental syntax, but is shows how we can keep the representation abstract but the printer can still operate over it since the implicit argument passes the printer around.&lt;/p&gt;
&lt;p&gt;The main problem is now how we mix polytypic function and abstraction, without always printing &amp;#8220;abstract&amp;#8221; instead of the real underlying structure. One solution is an extensible polytypic function.&lt;/p&gt;
&lt;pre&gt;module M: sig
 type t
 val x: t
end = struct
  type t = R of int * int
  let x = R(22,7) let () = register_printer (external type val t) (fun x -&amp;gt; ... )

end
let () = print x&lt;/pre&gt;
&lt;p&gt;We register a printer internally in the module, without exposing its internal type externally, but still let it be printed. The internal and external types are different though. We do need to figure out a canonical name for types defined outside the current compilation unit (its absolute path).&lt;/p&gt;
&lt;p&gt;By default though, abstraction should consistently introduce new nominal types, but we&amp;#8217;re not sure how to reference all the of the external names of a given type within its initial compilation unit (open problem). A pragmatic approach to solving this is the manual or semi-automatic creation of runtime &amp;#8220;type names&amp;#8221;.&lt;/p&gt;
&lt;p&gt;In conclusion, they have a GADT for structural introspection and a RTT representation with global names.  There is also a type-constructor index association table.  Implicit type arguments (lightweight syntax for calling polytypic function, and explicit type parameters for polymorphic functions).&lt;/p&gt;
&lt;p&gt;Q: what&amp;#8217;s the gain of putting this into the compiler?&lt;/p&gt;
&lt;p&gt;A: you may miss language corners, such as firstclass modules or functors, as your &amp;#8220;userspace&amp;#8221; OCaml code has to pass a type witness into a functor or firstclass module.  Compiler support makes this passing much easier.  The other big benefit is clear error messages from this compiler integration in the long term.  It&amp;#8217;s not currently easy for beginners, and this is very important to get right if this becomes a supported feature.&lt;/p&gt;
&lt;h2&gt;On variation, injectivity and abstraction&lt;/h2&gt;
&lt;p&gt;Jacques Garrigue speaks about an interesting bug in the type checker that needs some language changes. There was PR#5985 which was a serious type checker bug that lost injectivity.&lt;/p&gt;
&lt;pre&gt;module F(S: sig type 'a s end) = struct
  include S
  type _ t = T : 'a -&amp;gt; 'a s t
end
module M = F (struct type 'a s = int end)
let M.T x = M.T 3 in x
- : 'a = &amp;lt;poly&amp;gt; &lt;i&gt;the type is lost!&lt;/i&gt;&lt;/pre&gt;
&lt;p&gt;After expanding &amp;#8220;s&amp;#8221;, the definition of &amp;#8220;M.t&amp;#8221; is actually &amp;#8220;type _t = T : &amp;#8216;a -&amp;gt; int t&amp;#8221; but &amp;#8220;&amp;#8216;a&amp;#8221; is not marked as an existential.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo20-e1380054255495.jpg&quot;&gt;&lt;img class=&quot;alignright size-thumbnail wp-image-1521&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo20-e1380054255495-150x150.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In order to protect against this unsoundness, all variables in type declarations must be bound, either by appearing inside the type parameters or be existentially bound (i.e. only present in GADTs). Inside type parameters, these variables must be &lt;b&gt;injective&lt;/b&gt;.&lt;/p&gt;
&lt;p&gt;OCaml doesnt do injectivity directly, since it relies of variance inference (since we have subtyping). The variance of a parameter is either &lt;i&gt;explicit&lt;/i&gt; for abstract and private types or constrained parameters, or its &lt;i&gt;inferred&lt;/i&gt; from its occurrences otherwise.&lt;/p&gt;
&lt;p&gt;Constrained type parameters have been present since the very start.&lt;/p&gt;
&lt;pre&gt;type 'a t = T of 'b constraint 'a = 'b list&lt;/pre&gt;
&lt;p&gt;Rules for checking variance in this case become much more complicated, since constrained parameters variance must now be &lt;b&gt;explicit&lt;/b&gt; The variance of type variables inside constrained parameters must also be weaker or equal the version inside the body of the definition.&lt;/p&gt;
&lt;pre&gt;type +'a t = T of 'b constraint 'a = 'b list (* 'b covariant *)
type 'a r = 'a -&amp;gt; int                        (* contravariant *)
type +'a t = T of 'b constraint 'a = 'b r    (* Fails *)
(* 'b is contravariant in parameters but covariant inside *)&lt;/pre&gt;
&lt;p&gt;In OCaml though, the variance of a parameter is allowed to be weakened through abstraction.&lt;/p&gt;
&lt;pre&gt;module M : sig
  type +'a u 
end = struct 
  type 'a u = int
end&lt;/pre&gt;
&lt;p&gt;This is correct for the types, but becomes incorrect when used for &lt;i&gt;type parameters&lt;/i&gt;.&lt;/p&gt;
&lt;pre&gt;module F(X: sig type 'a r end) = struct
  type +'a t = T ob 'b constraint 'a = 'b X.r
end
module N = F (struct type 'a r = 'a -&amp;gt; int end)&lt;/pre&gt;
&lt;p&gt;Even when we assume that r is invariant, &amp;#8216;b is inferred as invariant from the parameter of t, which overrides the covariance of the body. Meanwhile in the module N, the variance is now wrong.&lt;/p&gt;
&lt;p&gt;How do we fix this? We need to refine the definition of variance, as traditional variance subumption defines a lower bound on the variance, but we need to add some upper bound information too, to be sure that parameters cannot have a strong variance.&lt;/p&gt;
&lt;p&gt;&lt;i&gt;(technical explanation of how to compose variances omitted here)&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;In OCaml 4.01, full variance inference is done using 7 flags (the last is a special case required for principality). Some uses will no longer type check so programs may be rejected for safety.&lt;/p&gt;
&lt;p&gt;In the future, Jeremy Yallop, Leo White and Jacques would like to add injectivity annotations for abstract types.&lt;/p&gt;
&lt;pre&gt;type #'a s
type _ t = T : 'a -&amp;gt; 'a s t&lt;/pre&gt;
&lt;p&gt;Add new types for isomorphic abbreviations, as Haskell does&lt;/p&gt;
&lt;pre&gt;module M : sig type #'a t val f : int -&amp;gt; ['pos] t end = struct
  type 'a t = new int
  let f x = (abs x : int :&amp;gt; 'a t)
end&lt;/pre&gt;
&lt;p&gt;This is similar to private, but subtyping will work in both directions &amp;#8212; this is useful for efficiency, encoding runtime types and allows coercions to be delayed until the signature rather than in the both (in the example above, the coercion in &amp;#8220;f&amp;#8221; could be omitted) due to the signature.&lt;/p&gt;
&lt;p&gt;Another problem is that one cannot prove the uniqueness of abstract types, and we dont know whether an abstract type is contractive (so even if you use rectypes, the following functor can never be defined)&lt;/p&gt;
&lt;pre&gt;module Fixpoint (M: sig type 'a t end) = struct
  type fix = fix M.t 
end
Error: the type abbreviation fix is cyclic&lt;/pre&gt;
&lt;p&gt;One also never knows whether an abstract type may be a float, so the float array optimization may be mismatched.&lt;/p&gt;
&lt;h2&gt;OCamlot: lots of OCaml testing!&lt;/h2&gt;
&lt;p&gt;(will post David&amp;#8217;s slides on the OCaml Labs website since it&amp;#8217;s one of our talks. Will edit this post when that happens).&lt;/p&gt;
&lt;h2&gt;Merlin: editor support for OCaml&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo21-e1380057773342.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1530&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo21-e1380057773342-225x300.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;https://github.com/def-lkb/merlin&quot;&gt;Merlin&lt;/a&gt; is a sophisticated editor assistant for OCaml that provides autocompletion in vim and emacs. They leap straight into an interactive demo that&amp;#8217;s awesome: autocompletion, module introspection when writing a functor, and so on.&lt;/p&gt;
&lt;p&gt;Unlike other tools, this doesn&amp;#8217;t rely on a CMT file, so code doesn&amp;#8217;t need to compile (except for source browsing). Your project can have type errors when using Merlin!&lt;/p&gt;
&lt;p&gt;It integrates with the ecosystem and has direct support for Findlib. There is no direct support for camlp4 however, with specific support for some extensions. If you want a new shiny extension then talk directly to them&lt;/p&gt;
&lt;p&gt;There is build system support for running either omake or Jenga in polling mode (for iterative recompilation). Omake rules can inform Merlin to get a consistent state of the project!&lt;/p&gt;
&lt;p&gt;A typical session: Parsing is done in two stages and the OCaml parser has been modified to be much more resilient to errors. The usual typing rules are applied, but passed onto a more &amp;#8220;relaxed&amp;#8221; typers in case of errors to give some support for incremental parsing.&lt;/p&gt;
&lt;p&gt;Coming soon is documentation (ha!) as well as retrieval for ocamldoc comments to further augment hints, as well as even more error recovery heuristics. Some of the patches will also be submitted upstream to improve error handling (by accumulating them instead of printing them directly).&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s available on OPAM under an MIT license via &amp;#8220;opam install merlin&amp;#8221; and thanks to Jane Street for letting them work on it during an internship there, and all the bug reporters!&lt;/p&gt;
&lt;p&gt;Q: Have you considered running Merlin on a remote system and speak the same JSON protocol?&lt;br /&gt;
A: They haven&amp;#8217;t, but it really shouldn&amp;#8217;t be a problem.&lt;/p&gt;
&lt;p&gt;Q: Julien V: do we have to build first?&lt;br /&gt;
A: No you dont have to build first&lt;br /&gt;
Q: What happens when you change branches in a project&lt;br /&gt;
A: For project-wide information you need to compile and rebuild.&lt;/p&gt;
&lt;p&gt;Q: in the second pass of type checking, what does &amp;#8220;relaxed&amp;#8221; mean&lt;br /&gt;
A: When typing fails for some branch of the AST, in the simple case we introduce a fresh type variable and attempt to do unification with the result of this. This will never be sound, but lets it make progress and give SOME feedback to the user.&lt;/p&gt;
&lt;p&gt;Q: is this a new type checker?&lt;br /&gt;
A: No its the original type checker with augmented error handling paths to do more unification.&lt;/p&gt;
&lt;p&gt;Q: is the relaxed checking really worthwhile? It wasnt a lot of use in gcc since you get a lot of followon errors that are meaningless.&lt;br /&gt;
A: lots of discussion, opinions split, it can be disabled!&lt;/p&gt;
&lt;h2&gt;Understanding memory behaviour of programs&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo22-e1380058304144.jpg&quot;&gt;&lt;img class=&quot;alignright size-thumbnail wp-image-1533&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo22-e1380058304144-150x150.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;
Cagdas B doing a PhD on memory profiling. He wants to study the behaviour of OCaml programs and work on decreasing memory footprint and generally reduce GC pressure on real OCaml programs.&lt;/p&gt;
&lt;p&gt;Shows Why3 graph (see photograph) and they&amp;#8217;re running nice finegrained analysis over it on real world analyses. How do they generate these graphs?&lt;/p&gt;
&lt;pre&gt;$ opam switch 4.00.1+ocp-memprof
$ opam install why3
$ OCAMLRUNPARAM=m why3replayer.opt -C why3.conf p9_16&lt;/pre&gt;
&lt;p&gt;Patched compiler and then the OCAMLRUNPARAM will generate a lot of sampled snapshots of the OCaml heap. There&amp;#8217;s no need to change the code or the compilation options. Then install analysis tools&lt;/p&gt;
&lt;pre&gt;$ opam install ocp-memprof
$ ocp-memprof -loc -sizes PID&lt;/pre&gt;
&lt;p&gt;The final step analyses all the snapshots. But what is a snapshot? It&amp;#8217;s a compressed version of the OCaml heap, with location ids, a graph with pointers, and has saved globals (toplevel modules). We obtain the snapshots by computing a linear scan of all the heap values.&lt;/p&gt;
&lt;p&gt;The OCAMLRUNPARAM=m forces the program to generate a snapshot after every major GC, or request the program to generate a snapshot via a HUP signal, or via a new &amp;#8220;dump_heap&amp;#8221; function that&amp;#8217;s been added to the GC module.&lt;/p&gt;
&lt;p&gt;It works by reserving some space inside the standard OCaml value block, and so there is minimal runtime performance impact except when dumping out snapshots after a GC. There&amp;#8217;s no space overhead since the header size isnt changed. However, it&amp;#8217;s only available on 64-bit platforms and reduces block size to 64GB. Ran experiment with OPAM and location identifiers are limited.&lt;/p&gt;
&lt;p&gt;There&amp;#8217;s one tool based on the snapshot identifiers and the &amp;#8220;memprof&amp;#8221; tool gets all identifiers from the heap and the corresponding location, and then looks up the right types from a specific location using cmt files (the typed AST).&lt;/p&gt;
&lt;p&gt;Plan for this work is to improve the current framework (aggregate information by type and location) and to recover more types, and build more tools around it!&lt;/p&gt;
&lt;p&gt;Q: Roshan: one common usecase is when grabbing locations, its boring to see Array.create and it would be nice to see a backtrace of the execution to see &lt;i&gt;where&lt;/i&gt; the allocation happened.&lt;br /&gt;
A: this is a problem indeed (discussion about the ongoing Mark Shinwell patches too, and previous talk about backtrace analysis from last years workshop).&lt;/p&gt;
&lt;h2&gt;Benchmarking in Core&lt;/h2&gt;
&lt;p&gt;Roshan James about microbenchmarking in JS Core. Precise measurementis essential for performance critical code. We want to measure the execution cost of functions that are relatively cheap. Functions with a short execution time that run millions of times in a tight loop.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo23-e1380059673542.jpg&quot;&gt;&lt;img class=&quot;alignright size-thumbnail wp-image-1538&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo23-e1380059673542-150x150.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The essence of benchmarking is to run a time loop (like Time.now) a lot of times. We need to figure out how to compute a batch size to account for the time it takes to run the actual timing measurement. Similar to Criterion for Haskell, where they loop Time.now to figure out how long it takes to compute the time itself, and then run the benchmark function, and compute a full estimate. This works ok, but it requires density plots to let you visualise the form of the error (bimodal, or something else, for example).&lt;/p&gt;
&lt;p&gt;There is a lot of noise in microbenchmarking, such as delayed costs due to GC, and variance in execution times is affected by batch sizes. So if we vary the batch size, the variance changes quite a bit since the GC is running in different intervals during the batches. The GC noise has a periodicity though!&lt;/p&gt;
&lt;p&gt;They treat microbenchmarking as a linear regression, and then fit execution time to a batch size. They vary the batch size geometrically to get a better linear fit (shows a very linear graph). Theres now no need to estimate the clock and other constant errors, since they are accounted for by the y-intercept which shows the constant costs.&lt;/p&gt;
&lt;p&gt;Other costs can also be predicted in the same way, such as estimate memory allocations and promotions using batch size too. This also allows measuring a goodness of fit by using R2 and bootstrapping techniques.&lt;/p&gt;
&lt;p&gt;Example use of Core_bech is really easy:just&lt;/p&gt;
&lt;pre&gt;open Core.Std
open Core_bench.Std
let t1 = Bench.Test.create ~name:&quot;id&quot; (fun () -&amp;gt; ())&lt;/pre&gt;
&lt;p&gt;Is the identity run for example, and just put something more complex in there. Output is an Ascii_table with lots of columns showing interesting results.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo24-e1380059880672.jpg&quot;&gt;&lt;img class=&quot;alignright size-thumbnail wp-image-1539&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo24-e1380059880672-150x150.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Some functions have a strange execution time, and the observation isnt a great fit. Between runs, they also directly query the GC and directly query how many times some things have happened (minor collections and so on), and include these along with the batch size in the predictor. With multiple predictors, they are really close to the observed results indeed.&lt;/p&gt;
&lt;p&gt;(lots of interesting maths about how they perform runtime cost decomposition)&lt;/p&gt;
&lt;p&gt;Its available via &amp;#8220;opam install core_bench&amp;#8221; and they want to expose more predictors by measuring the effect of live words on performance, and counters for major collection work per minor gc. Accuracy of results is interesting as least-squares is susceptible to outliers so they can incorporate the knowledge that the measurement is heavy-tailed.&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-24T21:58:59+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://amirchaudhry.com/ocamlorg-request-for-feedback">
	<title>Amir Chaudhry: Feedback requested on the OCaml.org redesign</title>
	<link>http://amirchaudhry.com/ocamlorg-request-for-feedback</link>
	<content:encoded>&lt;p&gt;There is a work-in-progress site at &lt;a href=&quot;http://ocaml-redesign.github.io&quot;&gt;ocaml-redesign.github.io&lt;/a&gt;, where we&amp;#8217;ve been developing both the tools and design for the new ocaml.org pages. This allows us to test our tools and fix issues before we consider merging changes upstream.&lt;/p&gt;

&lt;p&gt;There is a more detailed post coming about all the design work to date and the workflow we&amp;#8217;re using, but in the meantime, feedback on the following areas would be most welcome. Please leave feedback in the form of issues on the &lt;a href=&quot;https://github.com/ocamllabs/sandbox-ocaml.org/issues&quot;&gt;ocaml.org sandbox repo&lt;/a&gt;. You can also raise points on the &lt;a href=&quot;http://lists.ocaml.org/listinfo/infrastructure&quot;&gt;infrastructure mailing list&lt;/a&gt;.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;OCaml Logo&lt;/strong&gt; - There was some feedback on the last iteration of the logo, especially regarding the font, so there are now several options to consider. Please look at the images on the &lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Draft-OCaml-Logos&quot;&gt;ocaml.org GitHub wiki&lt;/a&gt; and then leave your feedback on &lt;a href=&quot;https://github.com/ocamllabs/sandbox-ocaml.org/issues/16&quot;&gt;issue #16 on the sandbox repo&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Site design&lt;/strong&gt; - Please do give feedback on the design and any glitches you notice. Text on each of the new landing pages is still an initial draft so comments and improvements there are also welcome (specifically: Home Page, Learn, Documentation, Platform, Community). There are already a few &lt;a href=&quot;https://github.com/ocamllabs/sandbox-ocaml.org/issues&quot;&gt;known issues&lt;/a&gt;, so do add your comments to those threads first.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded>
	<dc:date>2013-09-24T14:00:00+00:00</dc:date>
</item>
<item rdf:about="http://www.syslog.cl.cam.ac.uk/?p=1347">
	<title>SRG Syslog: Liveblogging CUFP 2013</title>
	<link>http://www.syslog.cl.cam.ac.uk/2013/09/22/liveblogging-cufp-2013/</link>
	<content:encoded>&lt;p class=&quot;lead&quot;&gt;I&amp;#8217;m here at the &lt;a title=&quot;CUFP 2013&quot; href=&quot;http://cufp.org/conference/schedule&quot;&gt;Commercial Users of Functional Programming&lt;/a&gt; workshop at &lt;a href=&quot;http://icfpconference.org/icfp2013/&quot;&gt;ICFP 2013&lt;/a&gt;) with Heidi Howard, David Sheets and Leo White.&lt;/p&gt;
&lt;img class=&quot;size-medium wp-image-1410 alignright&quot; alt=&quot;marius1&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/marius1-300x292.jpg&quot; width=&quot;150&quot; /&gt;
&lt;p&gt;Marius Eriksen and Michael Sperber are co-chairing this year. Functional programming is a hot topic these days, and this year&amp;#8217;s program reflects the maturing nature of the program. Record number of submissions, and we could easily have made this a multi-day program.  Videos will be available online after the event.&lt;/p&gt;
&lt;p&gt;Keynote is from &lt;a href=&quot;http://www.davethomas.net&quot;&gt;Dave Thomas&lt;/a&gt; on what we can learn from the &amp;#8220;language wars of the past&amp;#8221;.  His talk will cover the business, social and technical ends of building Smalltalk and his &amp;#8220;objaholic&amp;#8221; experiences with pushing language technology into businesses, where they never had any intention of changing in this regard.  This worked over the years because it made a material difference to these businesses.  Dave still uses the &lt;a href=&quot;http://en.wikipedia.org/wiki/K_(programming_language)&quot;&gt;K&lt;/a&gt; programming a lot at work.&lt;/p&gt;
&lt;p&gt;&lt;span id=&quot;more-1347&quot;&gt;&lt;/span&gt;&lt;/p&gt;
&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/clark1.jpg&quot;&gt;&lt;img class=&quot;size-medium wp-image-1409 alignright&quot; alt=&quot;clark1&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/clark1-300x294.jpg&quot; width=&quot;150&quot; /&gt;&lt;/a&gt;
&lt;p&gt;Dave is responsible for the Eclipse IDE and the IBM Java virtual machines, and has delivered software on everything from mainframes to wristwatches.&lt;/p&gt;
&lt;p&gt;Rush in the 70s with Symbolics and the amazingly cool hardware, followed by the rush to logic programming that led to his grants disappearing. Midway through the 80s, they discovered we wouldnt get parallelism for free with all this magic. After that came the era of machine learning and knowledge ontology crusades, but they are very specialised bits of tech. There remain sectors where ontologies are useful. Nowadays its the multicore crusades, and FP is emerging as useful.&lt;/p&gt;
&lt;p&gt;Every road leads to some form of FP, because the principles underlying it apply. Dave does vector programming, Haskell does this with array transformation.&lt;/p&gt;
&lt;p&gt;Dave was talking to Simon PJ outside and claimed that &amp;#8220;FP has won!&amp;#8221;, at which point Simon replied &amp;#8220;really?&amp;#8221; (laughter). OO techniques can also lead to a lot of tangled code: witness the evolution of Smalltalk to the current generation of languages.&lt;/p&gt;
&lt;p&gt;FP technical challenges: what happens when you have a lot of functions, and a group of consenting adults are doing it together. This is called software engineering, or at worst, IT!&lt;/p&gt;
&lt;p&gt;Lots of good work in the community on approaching large scale programming. Scala is a bit too complex for Dave (and audience rumbles in agreement or disagreement?). Java and JNI should just die. Erlang and actors are successful to decouple software. But do we really need to hide all our queues, and do we really need to hide our queues? Static analysis of queues are desired.&lt;/p&gt;
&lt;p&gt;Want to go fast? Computers like rectangles, all the way down! Array operations and vector processing is the way to go in the long-term.&lt;/p&gt;
&lt;p&gt;To go to industry, we need end-to-end toolchains. If you use MS Project, then you probably shouldn&amp;#8217;t introduce any new tools.&lt;/p&gt;
&lt;p&gt;The first commercial customer for Smalltalk in the 1980s was Techtronix, who wanted to embed reusable tech in their oscilloscopes. If you&amp;#8217;re building a serious product like this, it needed language interop between C++ (the logic sensor) and the Smalltalk. Respect the language cultures among components (anyone remember s-records?). ROM had to be replaced with Flash because noone can write code that doesn&amp;#8217;t need upgrading (groans from the audience).&lt;/p&gt;
&lt;p&gt;With the right tools, programmers will be able to go as quickly as Smalltalk, or at worse Java. We need the work of Simon [PJ] and colleagues on Haskell. Scala is so complex will become the Java (which is the Cobol of tomorrow).&lt;/p&gt;
&lt;p&gt;When shipping products, you need to track all the versions of language components in the toolchain. Too many FP toolchains are monolithic and make it hard to track components in the field. JVMs are so slow because they don&amp;#8217;t have a good sharing model (DLLs).&lt;/p&gt;
&lt;p&gt;What Dave would like is version-to-version transformation in languages. Y2K was a problem not because IBM hadn&amp;#8217;t fixed it in their OS, but because customers had modified their local installations and were pinned 6-10 versions behind! The same will happen for existing FPs that fragment into multiple implementations, so will they descend into multiple version hell or will standards emerge from the community?&lt;/p&gt;
&lt;p&gt;Also, lets not leave the data behind. Can we alias data from existing legacy sources into our new languages, and not aim for the perfect representations? Most of our programs are dealing with problems with existing data, not code.&lt;/p&gt;
&lt;p&gt;Onto deployment issues. Erlang works very well for the problem domain that it&amp;#8217;s designed for, but more complex domains exist like OSGI. Hot codeswap and live updates are often viewed as &amp;#8220;boring problems&amp;#8221; but are vital to real world deployments. Space usage must be paid attention to: how long can a given JVM stay up without leaking? Serialization is important to persist data across versions. If we&amp;#8217;re going to use &amp;#8220;esoteric control structures&amp;#8221; like CallCC, tailcalls or tags, the JVM isn&amp;#8217;t going to get us there.&lt;/p&gt;
&lt;p&gt;These days, if you can&amp;#8217;t stay in your local cache, you will lose several orders of magnitude performance&amp;#8230; you&amp;#8217;ll need directly connected CPU (or SSD!) memory, and static initalization, and language interop (eagerly vs laziness). Functional data structures and immutable collections are still immature, but need more work to convince doubting Thomas&amp;#8217; about their scalability in real applications.&lt;/p&gt;
&lt;p&gt;Hardware support for these are important. Intel Haswell has hardware transaction support (hence can be used by Azul JVMs etc) but we need more for functional langauge performance. There have been $2bn put into speeding up the JVM to make it as fast as C++. Google has a technology called Pinnacle which uses software write barriers that use VMs that execute directly, with a register model and not a stack model (which is easy to put together but hard to make fast). The new generation of language VMs will support direct execution and support modern functional programming languages.&lt;/p&gt;
&lt;p&gt;&amp;#8220;We all love types&amp;#8221; &amp;#8212; Dave on objects, but not variables (&amp;#8220;its easy to be cooperative with that definition!&amp;#8221;). Pluggable types by Gilad are really cute, because they move us towards a world where particular features (Dave likes behavioural types) can be woven in. Perhaps can be done in a dependently typed world. Another good candidate are approximate types and dimensional types. When all these are put together though, it all needs to fit together with sound compositional semantics.&lt;/p&gt;
&lt;p&gt;When using an interesting PL, Dave wants warnings to be emitted when the compiler makes space/time tradeoffs so that the programmer can decide between elegance and performance (also mentioned that Haskell programmers do this for .&lt;/p&gt;
&lt;p&gt;How does language evolution work? Arthur Whitney maintains K, and he ensures that every version of K is incompatible with the previous one. This is a blessing (!) since it avoids a kitchen sink language and ensures a high quality set of libraries. Quite often there&amp;#8217;s a tussle between languages and libraries because there&amp;#8217;s not enough coevolution. For example, are closures in Java really useful for the tradeoff in the complexity of the VM? Perhaps we should be looking towards a collection of small correct languages instead of a few partly right and largely wrong languages such as Ada or Java (the Java hate is strong here &amp;#8212; editor).&lt;/p&gt;
&lt;p&gt;Those of us that have programmed in vector languages (going back to APL) are largely write once read once languages because the code is so hard to read. One trick Dave does with K is to annotate comments inside expressions and use cold-folding without a point-free style to understand vector codeflow better. Also seeing the environment and current name bindings is extremely useful for teaching new languages.&lt;/p&gt;
&lt;p&gt;The real problem is: comprehensions, folds, monads &amp;#8212; WTF? Yet to see anyone from the monad community give a talk to understand monads. It&amp;#8217;s typically &amp;#8220;you dont need monads&amp;#8221; and then the word is used multiple times in the talk. If it&amp;#8217;s not important, why mention it so often? Quite often, the FP experience makes normal programmers feel stupid because they don&amp;#8217;t break through this terminology barrier. We as a community need to help people break through the barrier of not being formally trained in mathematics for whatever reason (&amp;#8220;category theory for breakfast?&amp;#8221;) and *be productive* in FPs.&lt;/p&gt;
&lt;p&gt;Smalltalk was like this in the early days. People see a blank window and aren&amp;#8217;t sure what to do next. Objects irritated people when they came out, but FP scares people. This is a danger as we go through and wow people with what we can do, but make it look like magic. People change their habits are different rates and we need to understand that. With Haskell, it was odd that he had to get the program &amp;#8220;right&amp;#8221; (or right/wrong) before it work, as opposed to not working.&lt;/p&gt;
&lt;p&gt;Bill Buxton (UI researcher friend) pointed out that people can&amp;#8217;t much get beyond programming a VCR. 4GLs were pretty much their limit. Dave&amp;#8217;s done a lot of work on evangelizing Smalltalk, but feels it was still too hard. People just didn&amp;#8217;t understand how to separate behavior, as the best practices on how to build objects were foreign to most of them. This all settled on some mix of SQL and some glue code, which doesn&amp;#8217;t require learning a lot of new technologies.&lt;/p&gt;
&lt;p&gt;Given there are many different types of programmers, do they all really need the full power of FP? Some subset of features is more useful, with one way to do things that doesn&amp;#8217;t change from release to release. For example, a simple dictionary keeps changing from Hashmap to concurrent Hashmap to something else, but ultimately is still a dictionary. How do we separate the reasoning over performance and structure and not scare people with both at the same time. Knuth started doing this decades ago with literate code, and we *still* dont have a decent way of writing documentation and code in the same place.&lt;/p&gt;
&lt;p&gt;We are still missing a pure FP book that is built in the same style and comprehension as &lt;a href=&quot;http://mitpress.mit.edu/sicp/&quot;&gt;SICP&lt;/a&gt;. We need thinks that you look the code and represent things more densely (for example, why don&amp;#8217;t we use Unicode in the same style as APL symbols to increase the succinctness?). They are working on J programs that move glyphs around on the iPad as an example of this 4GL density.&lt;/p&gt;
&lt;p&gt;We need to take all these ideas and *talk more* about metaphors in FP. Where&amp;#8217;s the &amp;#8220;Scala, F#, Clojure, the good parts&amp;#8221; and a frank exposition about the antipatterns? Don&amp;#8217;t lie about where the dragons are, but colour code them appropriately to not surprise programmers.&lt;/p&gt;
&lt;p&gt;We need to understand how to design with types. In the vector languages, this is called &amp;#8220;shape shifting&amp;#8221; as they don&amp;#8217;t have types, but similar concept. It&amp;#8217;s also hard to get the community people to talk about shape shifting, and as a result the art is being lost in the new generation of languages. For FP, can the Yodas in the audience help their audience to &amp;#8220;trust the types&amp;#8221; ?&lt;/p&gt;
&lt;p&gt;Q: In the top 20 languages, every language has a free-or-open-source runtime. This will make a huge difference as it lets people experiment.&lt;/p&gt;
&lt;p&gt;A: It&amp;#8217;s not been a barrier in experimentation for Dave, but it has been a barrier for commercial use. Dave would not attribute a particular significance to open source as it&amp;#8217;s never been a real problem for him (using trial versions and so forth). Open source is a mixed sword, as it tends to product impoverished language teams that don&amp;#8217;t have enough resources to move forward. The really good virtual machine implementors are commercially polished (c.f. the $2bn behind the JVM performance from earlier). Clojure is a great example where they appealed to the community to pay on their own behalf to donate for a production version. To build a serious production PL, you need a lot of government research money or a major commercial sponsor.&lt;/p&gt;
&lt;p&gt;Q: Marius asks about mobile and embedded and why FP hasn&amp;#8217;t cracked it.&lt;/p&gt;
&lt;p&gt;A: they are often late to the game, and it&amp;#8217;s often not easy to target the runtimes with a high performance runtime. You have to be willing to understand the interface.&lt;/p&gt;
&lt;p&gt;Q: Phil Walder says the scariest thing is that if you become a success, then Smalltalk takes the form of C++&lt;/p&gt;
&lt;p&gt;A: (or Java!). Being able to maintain the independence of the language creators vs a major player is crucial to conceptual integrity. (Phil) Tools that will migrate between version X and Y and a sustainable ecosystem. It&amp;#8217;s important to ensure that the creators get paid to maintain &amp;#8212; even the JVM only has 10-20 people in the core team and a vast ecosystem.&lt;/p&gt;
&lt;h3&gt;OCaml at Facebook via the Hack language&lt;/h3&gt;
&lt;p&gt;Julien Verlauget is talking about how Facebook is adopting OCaml.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/1148380_10151682552766094_1789859397_n.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1458&quot; alt=&quot;1148380_10151682552766094_1789859397_n&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/1148380_10151682552766094_1789859397_n-300x225.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Why PHP is good: fast installation times, lots of libraries, easy to learn, and scales in a parallel way (multiple instances).&lt;/p&gt;
&lt;p&gt;However, Facebook doesn&amp;#8217;t care about any of these features. What Facebook wants is a fast feedback loop between writing code and having it appear on screen. There&amp;#8217;s no good way to write a unit test for an experience, and instead a fast feedback loop between code and a live site is how people still work at Facebook today.&lt;/p&gt;
&lt;p&gt;Performance at the scale of Facebook really matters. 1% can be a huge bump, but PHP is really hard to optimize due to all the dynamic features in the language. Aside from runtime performance, the other concern is development time for engineers, who need to avoid security problems and general bugs in an incredibly large codebase.&lt;/p&gt;
&lt;p&gt;The first attempt at this was to scale the runtime via HipHop. The first attempt was to compile PHP into an interpreter (via sandboxes) and then compile production code to C++. Unfortunately this lead to a huge divergence in performance characteristics between the interpreter and compiled code which led to confusion in production.&lt;/p&gt;
&lt;p&gt;The current one is HHVM which is a combined model via JIT runtime that patches code at runtime and helps merge these models.&lt;/p&gt;
&lt;p&gt;HHVM is still a PHP platform, and a new model called Hack provides a *new programming language* that targets HHVM (which is essentially a PHP runtime).&lt;/p&gt;
&lt;p&gt;Hack is a &lt;b&gt;statically typed language for HHVM&lt;/b&gt;. It&amp;#8217;s compatible with PHP and interoperates with no overhead and has the same runtime representation as PHP. It has evolved from PHP, and so if you know PHP, you know Hack. It&amp;#8217;s designed for &lt;i&gt;incremental adoption&lt;/i&gt; via introducing gradual typing (c.f. keynote talk about not scaring programmers not used to types).&lt;/p&gt;
&lt;pre&gt;function foo(): void {
  $x = 'hello';
  return $x;
}&lt;/pre&gt;
&lt;p&gt;This returns a readable error message in the style of a statically typed language, since the inference algorithm keeps a witness about every value&amp;#8217;s type and shows counter examples.&lt;/p&gt;
&lt;p&gt;The Hack type system must be annotated with class members, function parameters and return types. Everything else is inferred to minimize programmer burden.&lt;/p&gt;
&lt;p&gt;Hack types include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nullable such as
&lt;pre&gt;?int&lt;/pre&gt;
&lt;p&gt;mainly because of the huge code base that had no pattern matching, so null propagation is important&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;Tuples&lt;/li&gt;
&lt;li&gt;Closures&lt;/li&gt;
&lt;li&gt;Collections such as
&lt;pre&gt;Vector&amp;lt;int&amp;gt;&lt;/pre&gt;
&lt;p&gt;that have generics too&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;Constraints&lt;/li&gt;
&lt;li&gt;Type Aliasing&lt;/li&gt;
&lt;li&gt;Extensible Records&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Demo of a simple mailbox demo follows. HH has a command line mode that lets you syntax highlight which parts of the source code are dynamically checked, by outputing the code with red if it&amp;#8217;s potentially unsafe. Awesome!&lt;/p&gt;
&lt;pre&gt;class Mailbox {
  private $data;
  public function send($data) {
    $this-&amp;gt;data = $data
  }
  public function fetch() {
    return $this-&amp;gt;data;
  }
}&lt;/pre&gt;
&lt;p&gt;(very PHP like but now he annotates it with specific types)&lt;/p&gt;
&lt;pre&gt;class Mailbox {
  private string $data;
  public function send($data) : void {
    $this-&amp;gt;data = $data
  }
  public function fetch() : string {
    return $this-&amp;gt;data;
  }
}&lt;/pre&gt;
&lt;p&gt;As a programmer, I now want to know if this has all been statically checked (since the previous checking mode showed several red sections which were potentially unsafe). He runs the compiler with a strict mode that rejects the source if there is any unsafe bits.&lt;/p&gt;
&lt;p&gt;He then demonstrates how to propagate null types through the code, and then introduces several subtle errors that are all caught.&lt;/p&gt;
&lt;p&gt;An audience members asks what happens if you send both an int and a string to a mailbox, and Julien demonstrates a &amp;#8220;mixed&amp;#8221; type that covers both (is this some sort of row polymorphism? &amp;#8212; editor).&lt;/p&gt;
&lt;p&gt;The response time of the type checker is close to instantaneous (for the developer loop). Even with a thousand files, the type checkers gets back in a second or less with an error message.&lt;/p&gt;
&lt;p&gt;To get the tooling right, Hack uses js_of_ocaml to compile &lt;i&gt;the entire OCaml type checker&lt;/i&gt; to Javascript and then run in a complete web-based IDE (demonstrates a full cloud9-like IDE they use internally at FB). To work at scale, they created a server that runs persistently in the background and type checks all the files and responds from a memory cache.&lt;/p&gt;
&lt;p&gt;At scale, the the autocomplete requires very lowlatency in the webbased editor, and users also use version control (e.g. switching between branches). The server also has to use a reasonable amount of RAM and have a reasonable initalization time. Fundamentally it has to be stable as developers have to depend on their tools.&lt;/p&gt;
&lt;p&gt;A vast amount of code is written in OCaml for the tools. Good choice because it is ideal for symbolic computation, excellent performance and can be compiled to Javascript. Good C interop is really good. The main challenge is the lack of multicore, although Facebook works around it with their multiprocess architecture.&lt;/p&gt;
&lt;p&gt;Architecture: the master process has multiple processes which uses shared memory to avoid having to go through the master. The underlying buffers are lock free (similar to our Xen shared memory ring! &amp;#8212; editor).&lt;/p&gt;
&lt;p&gt;Advice on OCaml at scale:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IPC &amp;#8212; use lockfree structures and think about sockets/pipes instead of just TCP&lt;/li&gt;
&lt;li&gt;GC small heap and shared memory is compacted by master&lt;/li&gt;
&lt;li&gt;OCaml makes you think hard about shared objects, which is a good thing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Q: is it open source??&lt;br /&gt;
A: soon, this is the first time Facebook has talked about it publically.&lt;/p&gt;
&lt;h2&gt;OpenX and Erlang ads&lt;/h2&gt;
&lt;p&gt;What is OpenX: (i) An opensource PHP ad server (ii) OpenX is a global company with an ad service featuring a big ad exchange written in Erlang. This talk is about the transition from PHP to Erlang.&lt;/p&gt;
&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo-1.jpg&quot;&gt;&lt;img class=&quot;size-medium wp-image-1401 alignright&quot; alt=&quot;photo 1&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo-1-300x300.jpg&quot; /&gt;&lt;/a&gt;
&lt;p&gt;1998-2007. it was a conventional PHP management system and MySQL. The company started using it as an EC2-based SaaS ad server and serving up clients successfully.&lt;/p&gt;
&lt;p&gt;In 2008, they wanted to mix in an ad exchange, to add liquidity to marketplaces that have empty ads. At the same time, they moved offices to Pasadena and looked at new tech. Switched to Hadoop (Java) and Postgres (for some reason). Poor technical choices were made, such as writing to the database for every request (sometimes multiple times!).&lt;/p&gt;
&lt;p&gt;In 2009 as the customers increased, there was a big push to scaling things up for performance (this is when the speaker joined the company). Switched Postgres to Cassandra to move from a relational database to a more NoSQL approach that had the appropriate consistency properties. At this time, the architecture was also decomposed to give them headroom to scale for a while, particularly by adding HTTP load balancers and so on.&lt;/p&gt;
&lt;p&gt;They wanted to add even more low latency stuff, such as spot bids for immediate bids on empty slots. Anthony decides that the model was a good fit for Erlang, since one request needed to fan out to multiple backend services with a soft-realtime limit to return a response to the user. It took a few months to prototype an Erlang based solution which worked very well.&lt;/p&gt;
&lt;p&gt;After this first experience with Erlang and evangelising it, and pointing it out to his coworkers, they came up with another good problem: analyzing the frequency of how often someone looks at an ad. This required a new database that would hold bespoke data efficiently, and also integrated Riak from Basho to interface with the database to run the query engine. This now holds on the order of billions of keys.&lt;/p&gt;
&lt;p&gt;In 2007, they ran into problems with Cassandra due to making an incompatible upgrade which would have required OpenX to shut down their business to upgrade, which was unacceptable. Since they had a good experience with Riak core, they developed a new system to move away from Cassandra and add more Erlang for management stack.&lt;/p&gt;
&lt;p&gt;In 2011, they decided to split their UI layer into a more Web 2.0-like UI API. The API continues to be implemented in PHP (with a Javascript UI clientside), but the Erlang evolution continued with a gateway service and marketplace service that are both pure Erlang. The basic problem is ad selection, and the logic for this is written as a DSL implemented in both Erlang and Java to enable code reuse across the tools.&lt;/p&gt;
&lt;p&gt;However, Cassandra was still sticking around, and they wanted to move away from it. They implemented a data service layer to abstract away from the database. From the early days, they made a bad (but fast) choice to have clients directly call Cassandra via Thrift, as it was easy. They moved away to a more abstract model to get away from Thrift, and so could change clients. The new system could call both Cassandra and Riak to help evolve with both services running simultaneously and provide a &lt;i&gt;seamless migration path&lt;/i&gt; to the new service (in stark contrast to the Cassandra upgrade story from earlier).&lt;/p&gt;
&lt;p&gt;They also decided that the PHP use for the API was a bad idea, and so switched to Python. They engaged Erlang Solutions to write them an API router since their core team was busy (an example of external consultants coming in and being useful &amp;#8212; editor). The current system involved RabbitMQ coordination, and Riak&amp;#8217;s replication logic to move out to the colos for publication.&lt;/p&gt;
&lt;p&gt;Currently they have 14-15 services in Erlang 7-8 in Java, and a blend of Python/PHP.&lt;/p&gt;
&lt;p&gt;How did a PHP shop end up with so much Erlang? Well, they laid off all the PHP developers when they moved offices (lots of audience laughter).&lt;/p&gt;
&lt;p&gt;More seriously, the architectural choices are important:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cloud based (generic hardware, automated bootstrap, deployment, package oriented development and fault tolerance).&lt;/li&gt;
&lt;li&gt;Service based (loosely coupled, single purpose components, pools of components, polyglot so multiple languages/&lt;/li&gt;
&lt;li&gt;Cross language tools: Thrift (RPC between components), protobuf (RTB and Riak) and &lt;a href=&quot;http://www.lwes.org&quot;&gt;Lwes&lt;/a&gt; (logging and monitoring) which was open sourced by Yahoo after being originally written at Goto.com. A system called Framework that provides templates for code layout, builds RPMs/debs and integrates with autotools. It enforces versioning and reproducibility across languages.&lt;/li&gt;
&lt;li&gt;Finally, evangelism is really important. If possible fix the game via architectural choices to set the scene for change. Find a project to showcase the technology, and be responsible for the project&amp;#8217;s success. Make sure to share work, and remember that tools are &lt;i&gt;really important&lt;/i&gt; to make it easy for others to use.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Really important is figuring out build toolchain &amp;#8212; it can be so arcane. They did spend time on integrating with Erlang (erlrc inegrates with packaging system, erlstart to manage lifecycle, erlnode for ?).&lt;/p&gt;
&lt;p&gt;Hiring: train people rather than trying to hire knowledgeable. Operations have unfamiliar systems to manage, and developers have new concepts and patterns.&lt;/p&gt;
&lt;p&gt;How did Erlang help OpenX developers? The language fit the service model very well. The let-it-crash philosphy and supervision trees led to fewer real service outages.&lt;/p&gt;
&lt;p&gt;OpenX is doing really well as a business, too: 250+ billion monthly transactions, 12+ billion daily bids, thousands of machines in 5 colos, 300 employees and $150m+ revenue in 2012.&lt;/p&gt;
&lt;p&gt;Q: Marius: with a service based solution, how do you library them up?&lt;br /&gt;
A: Their services aren&amp;#8217;t hugely fine grained and so usually a module or two (not a lot of state)&lt;/p&gt;
&lt;p&gt;Q: Anil: is framework usable from languages? RPM integration seems killer&lt;br /&gt;
A: It&amp;#8217;s still esoteric and internals not docced, but would welcome a chat!&lt;/p&gt;
&lt;h3&gt;BAE systems on Redesigning the Computer for Security&lt;/h3&gt;
&lt;p&gt;Tom Hawkins speaking on DARPA funded project.&lt;/p&gt;
&lt;p&gt;SAFE is a codesign of:&lt;br /&gt;
a new application langauge (breezE)&lt;br /&gt;
a new systems programming language (Tempest)&lt;br /&gt;
A new OS&lt;br /&gt;
A new processor&lt;br /&gt;
and security at every level for defense in depth.&lt;/p&gt;
&lt;p&gt;Emphasising hardware enforced security since dynamic checking is too much overhead in software, for example for fine-grained information flow control. Hardware IFC handles the most general attack model (scripting down to machine code injection).&lt;/p&gt;
&lt;p&gt;Hardware overview: every word of data contains a tuple of (group 5 bits, tag 59 bits and payload 64 bit). The Atomic Group Unit checks atom typs (e.g. instructions, data pointers and streams). The Fat Pointer Unit (confusingly, FPU) checks pointer operations, and tag management unit (TMU).&lt;/p&gt;
&lt;p&gt;The label model can be used for efficient hardware typing, and more recently they are using labels for Control Flow Integrity (e.g. to prevent return oriented attacks). Register file is 32 elements deep, memory is accessed through load/store, and every bit of data in the system is a well-formed atom (and so has tag/groups associated with it).&lt;/p&gt;
&lt;p&gt;FPU deals with buffer range checks (e.g. underflow or overflows for a buffer).&lt;/p&gt;
&lt;p&gt;The TMU is where the magic is. It combines all the operations from the various operations being worked on (instructions, memory) and the TMU acts as a &amp;#8220;database&amp;#8221; checking that the operation is consistent with local policy, and the machine can continue execution or raise a security exception.&lt;/p&gt;
&lt;p&gt;At day 1, they had an outline for an ISA but nothing else. TIARA project was a baseline (Howie Shrobe, Andrw DeHon, Tom Knight) and they had no languages, no hardware and no toolchain.&lt;/p&gt;
&lt;p&gt;They started by sketching out an assembly language and then building an ISA simulator. They simulated simple assembly programs, and HW researchers started coding in Bluespec (a Haskell-like FP that Lennart keynoted about at CUFP 2011 in Japan).&lt;/p&gt;
&lt;p&gt;The PL researchers started designing Breeze. Plan was to &amp;#8220;steal&amp;#8221; Andrew Meyers work on JIF, and &amp;#8220;Breeze should be done in a couple of months&amp;#8221;!. It didn&amp;#8217;t quite work out that short (laughter).&lt;/p&gt;
&lt;p&gt;SAFE assembly is as low level as expected, but it adds some new properties:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;frames manage fat pointer bounds&lt;/li&gt;
&lt;li&gt;Atomic group declarations on data mark critical sections&lt;/li&gt;
&lt;li&gt;Tags on data can be marked (e.g. bootloader private)&lt;/li&gt;
&lt;li&gt;Secure closures is code/data with the authority to run code over the data (they call it gates)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Assembly is tedious and so they started with macros. The Breeze interpreter is now running and there was pressure to start building the compiler. The OS guys wanted a language to build the higher level components.&lt;/p&gt;
&lt;p&gt;Solution: a SAFE assembly DSL embedded in Haskell that uses Haskell as the macro language and becomes the library for the future Breeze compiler.&lt;/p&gt;
&lt;p&gt;Breeze Language: version 7 &amp;#8212; just the datatypes for Booleans was hard and took 4-5 weeks (&amp;#8220;this IFC stuff is kind of tricky&amp;#8221;). The convenience and modularity of lexical authority passing and one-principal per module is extremely inconvenient!&lt;/p&gt;
&lt;p&gt;SAFE Assembly in Haskell looks like a typical EDSL. A monad captures program descriptions, and macros set up data tags and also for better control flow (such as a while loop or ifelse conditionals in the asssembly).&lt;/p&gt;
&lt;p&gt;At Year 1.5, the EDSL is still assembly language, no matter how many macros there are. Manual register allocation, calling conventions and data structures. Meanwhile the Breeze compiler was inching off the ground, but there is an awkward transition from high level CPS IR to assembly. There needs to be an intermediate form somewhere. However, the SAFE EDSL in Haskell works great in the compiler backend plugged in seamlessly with the Breeze code generator, which was nice.&lt;/p&gt;
&lt;p&gt;Breeze Language is now on Version 12 and continues to answer questions. &amp;#8220;What do we do on an access violation?&amp;#8221;. Simply stopping the machine isn&amp;#8217;t enough, since &amp;#8220;What if I maliciously send you data that you can&amp;#8217;t access?&amp;#8221;. &amp;#8220;Simple I&amp;#8217;ll just check the label before I attempt to read it?&amp;#8221;. &amp;#8220;But what if the label itself is private?&amp;#8221;. This was the big &amp;#8220;aha&amp;#8221; moment in IFC, since private labels end up being a poison pill in IFC.&lt;/p&gt;
&lt;p&gt;At Year 2.0, the Breeze compiler is going through a major overhaul since it needs improvements (the middle IR is improved but not enough). They temporarily shelve the compiler and they realize it wont come to the rescue of the OS. They really needed a higher low-level language than just assembly.&lt;/p&gt;
&lt;p&gt;Breeze language v23 has a solution to poison pills: make all labels public! To label data you must specify the label in advance (brackets), but public labels are not compatible with lexical authority passing so they had to relax their original vision a little.&lt;/p&gt;
&lt;p&gt;Year 2.5: Tempest is started as the systems PL for SAFE. Imperative with register allocation and optimizations and control of assembly with inlining and user specified calling conventions. It uses the SAFE EDSL to generate assembly (that was a successful DSL) and nicely fills the Breeze IR gap in the compiler for when that is resurrected.&lt;/p&gt;
&lt;p&gt;Breeze language 34: delayed exceptions with not-a-value values (Nav).&lt;/p&gt;
&lt;p&gt;The Tempest EDSL with inline assembly has a SAFE assembly sublanguage. The SAFE flow isnow the Breeze, Templest and Safe Assembly layers, with EDSLs of each gluing the compiler pipeline together. There is a SAFE ISA simulator and debugger, along with a Bluespec simulator to save on the FPGA debugging cycles. The TMU is an elaborate piece of hardware (an exotic CAM and cache structure) that a lot of the effort has gone into.&lt;/p&gt;
&lt;p&gt;Lessons learnt:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;designing a higher order IFC language is &lt;i&gt;very hard&lt;/i&gt; even with some of the most brilliant PL researchers in the world. Optimal number of researchers is 2-7 rather than any more :) Ben Pierce and Greg Morrisett arguing over very hard problems was a lot of fun in a hard problem space.&lt;/li&gt;
&lt;li&gt;Day 1 should have started with Tempest, not assembly. Hard to be productive with assembly code, and tempest is the right level of runtime/processor codesign. Level of indirection provides insulation from a changing ISA.&lt;/li&gt;
&lt;li&gt;EDSLs are great for bootstrapping a language and make excellent backend libraries. However, engineers must be comfortable with the host language and not all the engineers were comfortable with Haskell when they started. EDSLs are hard to debug (line number information apparently hard to get out of error messages vs a concrete syntax).&lt;/li&gt;
&lt;li&gt;Concrete syntax is more relevnt for some languages than others (e.g. Tempest vs SAFE assembly). The best transition point to a concrete syntax is after developer pressure for modular programming. Once language has modularity, then the switch can be made without disruption.&lt;/li&gt;
&lt;li&gt;Would a DSL have helped hardware design? Forever debugging ISS and FPGA instead of raw Bluespec. A DSL describing ISA semantics would have kept is synchronized by generating Bluespec, ISS and SAFE EDSL and Coq documentation.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This has been a huge project spanning a vast number of layers. It has produces a large number of interesting &lt;a href=&quot;http://www.crash-safe.org/papers&quot;&gt;papers&lt;/a&gt; including one at ICFP this week on testing non-interference quickly by using QuickCheck to generate programs that don&amp;#8217;t violate non-interference properties.&lt;/p&gt;
&lt;h2&gt;FRP at Netflix by Jafar Hussain&lt;/h2&gt;
&lt;p&gt;Netflix used to have tight coupling between the middle tier and the UI teams. One-sized fits all messages and led to inefficient call patterns.&lt;/p&gt;
&lt;p&gt;The plan was to decouple this by giving UI developers the ability to decouple components (or &amp;#8220;force!&amp;#8221;).&lt;/p&gt;
&lt;p&gt;Two developer personas at Netflix: Cloud and UI people. Netflix deals with a third of all US broadband traffic, so they need to think at scale but also to run on really tiny cheap devices that eke out all performance. How do they turn UI developers into effective cloud developers who think at scale?&lt;/p&gt;
&lt;p&gt;Gave them UI comforts: Groovy, OO API and a Reactive API. Most UI developers (or indeed any developers) can&amp;#8217;t be trusted with locks. This means that reactive programming isn&amp;#8217;t enough, which leads to &amp;#8220;how do we make parallel programs safe for developers&amp;#8221;&lt;/p&gt;
&lt;p&gt;Enter Erik Meijer, the legend himself! He asked &amp;#8220;Whats the difference between a database query and a mouse drag event?&amp;#8221;. Database would use functional code and a mouse drag might be imperative. Erik points out that they are both collections.&lt;/p&gt;
&lt;p&gt;New JS closure syntax in ES6 is fantastic to make them easier to use. If you imagine a query for well-rated movies, then you need to map over video lists. He then shows a mouse drag event, but points out that the structure of the code is very simpler. Instead of a &amp;#8220;filter&amp;#8221; operator, he uses &amp;#8220;takeUntil&amp;#8221; which stops the operation after some predicate has been satisfied.&lt;/p&gt;
&lt;p&gt;The iterator pattern is similar to the observer, except for the bidirectional signalling. Iterators can throw next/hasNext/Throwable, but Observers dont have a similar completion semantic. What happens when we add these to the Observer? We end up with &amp;#8220;onNext&amp;#8221; and &amp;#8220;onCompleted&amp;#8221; and &amp;#8220;onError&amp;#8221;, so now the Observer has comparable semantics to Iterator, so the only thing that changes is the direction of the errors.&lt;/p&gt;
&lt;p&gt;Some platforms also have an Iterable. There is now also an Observable to which you can pass an Observer, in the same vein as passing an iterator to a Java Iterable. We also add a Disposable to both, so that when the IO stream has terminated, it can be stopped immediately without having to junk the rest of the data.&lt;/p&gt;
&lt;p&gt;Erik and his team at MSR demonstrated that these patterns are dual, so that Iterable and Observable are dual! These are the Reactive Extensions libraries that is a combinator library for the Observable type. It&amp;#8217;s open source and has been ported to a number of other languages than C# (including Java).&lt;/p&gt;
&lt;p&gt;Observable Monad is a Vector version of the Continuation monad. Null propagation semantics of the Maybe monad and Error propgation semantics of the Either monad. Produced and consumed with side-efects and acts as a fault line between pure and impure code. It can be composed functionally and cancellation semantics are clean. It can be synchronous or asynchronous which is a common mistake (to assume that Iterable is async &amp;#8212; either can also be sync simply by calling the functions immediately).&lt;/p&gt;
&lt;p&gt;If you Map over Observable, then&lt;/p&gt;
&lt;pre&gt;(rapid transcript)
var map = (observable, func) =&amp;gt;
  { forEach: observer =&amp;gt; 
    {
    var subscription =
     observable.forEach
       onNext : item =&amp;gt; oserver.onNext(func(item))
       onError : error =&amp;gt; observer.onError (error)
       onCompleted () =&amp;gt; observer.onCompleted()&lt;/pre&gt;
&lt;p&gt;We can use this to come up with a single reactive type for cloud and UI developers! Jafar demonstrates example of social notifications in the middle tier, but using Observable to filter notifications from a composition of the socialService and messageService. Both underlying services are returning observables, and are non-blocking and completely parallel. Both can execute synchronously or asynchronously and decide which knobs to turn for their particular scheduling needs. The programmer doesn&amp;#8217;t need to care about the details.&lt;/p&gt;
&lt;p&gt;Another example is search autocomplete, which is surprisingly hard. Need to decide how often to send requests (throttle them to be not per-key) and also deal with concurrent responses from keypresses coming in out of order.&lt;/p&gt;
&lt;pre&gt;var res = 
  keyPresses.throttle(20).flatMap(
    search =&amp;gt; 
      getSearchResults(search).takeUntil(keypresses));

res.forEach(resultSet =&amp;gt; listBox.setItems(resultSet)&lt;/pre&gt;
&lt;p&gt;This code fragment does all this composably and handles all that logic. It&amp;#8217;s throttled, ordered correctly and terminates until the keypresses stop (with respect to the throttling policy.&lt;/p&gt;
&lt;p&gt;The full tier is a UI (huge amount of mutable state), dropping in to a distributed functional style, and heading into the data tier. Recall this is at huge scale.&lt;/p&gt;
&lt;p&gt;Wins: Rx is open sourced from MS and ported to Java (Observable) and generally better tooled now.&lt;br /&gt;
Evangelism comes up again since you can&amp;#8217;t assume the best technical solution will win. Practice public speaking and focussing on soft skills! Speaker got better in a short amount of time at distilling the essence of the benefits, and explaining to the target audience why something matters (e.g. to a UI developer vs a cloud developer as he explained earlier).&lt;/p&gt;
&lt;p&gt;Challenges: Training/Hiring. Netflix didn&amp;#8217;t fire all their UI developers as the previous speaker did (audience laughter). Instead, they leveraged their skills at eking out mobile performance, and taught them alternatives: functional programming, vector programming and reactive programming. Be available to help out people (developers work weird hours!) and interactive training exercises really help too. Also help them understand &lt;i&gt;when&lt;/i&gt; to apply each technqique for a particular programming task.&lt;/p&gt;
&lt;p&gt;Some of the Javascript programmers had some intuition for these techniques from things like Promises. It wasn&amp;#8217;t quite the right answer, as sometimes you need vector versions for performance instead (since it degenerates to a scalar version by passing a vector of size 1). Netflix dont bother teaching scalar, only vector.&lt;/p&gt;
&lt;p&gt;Although the programmers are used to mapreduce, the embedded version of this is a lot harder for them to grasp &amp;#8212; it&amp;#8217;s just a programming style and not just magic in Hadoop. Hiring process adapts to spot the competent functional programmer.&lt;/p&gt;
&lt;p&gt;bind/flatMap/concatMap/mapcat/mapMany are all monadic versions with subtle semantics and so they use interactive training exercises to train developers in their runtime semantics.&lt;/p&gt;
&lt;p&gt;Challenges: performance needs some chunking for lowend devices (vector a manually chunked scalar monad) and is best applied to less chatty event streams. It worked for search on lowend devices since it takes so damn long to type anything in, so a less chatty UI stream (audience laughter). &amp;#8220;We are screwed if the hardware UIs improve&amp;#8221;.&lt;/p&gt;
&lt;p&gt;Type-unsafe flatMap is easier to understand but needs to be used carefully, but is useful on lowend deviecs.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://github.com/Reactive-Extensions/RxJS&quot;&gt;http://github.com/Reactive-Extensions/RxJS&lt;/a&gt; has all the source, so give it a try!&lt;/p&gt;
&lt;p&gt;Q: How do Databinding in Rx?&lt;br /&gt;
A: No templates, but many other tiers before the view layer are bound together. We introduce an Observable with both pure and impure code (an Observable type with a value property). However they learnt how to do this directly since Observable&amp;#8217;s lazy default is the wrong for data binding. Implementing a different type that is strict and publishes the result directly.&lt;/p&gt;
&lt;h3&gt;Medical Device Automation using message passing concurrency in Scheme&lt;/h3&gt;
&lt;p&gt;What does a molecular diagnostic device do and what does Scheme have to do with all this?&lt;/p&gt;
&lt;p&gt;Detects the presence of specific strands of DNA/RNA in sample and then does necleic acid extractions and purification. Sample are excited using lasers as they undergo PCR which results in spectrographs.&lt;br /&gt;
Device contains 19 boards with temp, motor control with many parts that move simultaneously at very high precisions. (author shows demos of the motors running and playing music from the system!)&lt;/p&gt;
&lt;p&gt;Client is written in C# and WPF and is thin/stateless. Sever is written in Scheme and Erlang with OTP embedded. Supervision structure to isolate hardware failures. A DSL provides the glue logic.&lt;/p&gt;
&lt;p&gt;Scheme is exceptionally clear and simple syntax, and they love the hygeinic syntactic abstractions for their DSL and the first-class functions and continuations are key. Arbitrary precision arithmetic is important for result calculations.&lt;/p&gt;
&lt;p&gt;The Erlang embedding in Scheme is how they interop. They embed records by referring to structured data by field name instead of field index. This allows for copying a record and changing particular fields.&lt;/p&gt;
&lt;p&gt;There&amp;#8217;s no pattern matching built into Scheme and enables matching on all the usual datatypes (strings, lists, vectors and records). It also allows matching the value against a local variable and/or binding values to local variables in the pattern itself, which is new in Scheme (but quite ML-like? &amp;#8212; editor)&lt;/p&gt;
&lt;p&gt;Processes are on-shot continuations with software timer interrupts. The Gen-server patterns provide a functional way of serializing messages and mutating state. The init/handle-call/handle-cast/handle-info and terminate are all encoded, and so it&amp;#8217;s all done except code-change (the FDA wouldnt appreciate code changing on the fly!)&lt;/p&gt;
&lt;p&gt;The event manager is responsible for event logging and subscriptions, and supervisors monitor processes and execute a restart or clean shutdown semantic (with enough logging for a field debug cycle).&lt;/p&gt;
&lt;p&gt;How it works in the instrument server: &amp;#8220;let is crash&amp;#8221; throughout and a notable lack of defensive programming due to the actor model. They manage some big hardware which fails all the time and this architecture directly addresses that reality.&lt;/p&gt;
&lt;p&gt;Easy assay is executed via a DSL which defines the pipeline in a &lt;i&gt;confirm mode&lt;/i&gt; to estimate running time, suggest missing resources and warn about a lack of timeslots. Once satisfied this is all taken care of, the queuing is done via a Tetris-style binpacking heuristic. Each action has its own process for fault tolerance. The DSL exposes an option to ignore action failures which is important for test runs and debugging (also during hardware development).&lt;/p&gt;
&lt;p&gt;Some examples of device failures are very bad: &lt;b&gt;Therac 25&lt;/b&gt; was a RTOS that gave people fatal radiation doses. It was tracked down to bad use of mutable state and integer overflow (taken care of in their system with FP and arbitrary precision math). &lt;b&gt;Ariane 5&lt;/b&gt; was due to interger overflow due to conversion precision, which also doesn&amp;#8217;t happen in their Scheme system which has non-lossy conversion. And finally the space shuttle simulator crashed due to memory unsafety (a restart was unclean), which cannot happen in Scheme. The supervision hierarchy in Erlang/Scheme can handle crashes with a stable strategy at any layer.&lt;/p&gt;
&lt;p&gt;Why a DSL? The assay developers need to write their own recipes such as &amp;#8220;which recipes for this instrument, and in which order?&amp;#8221;. The scientists shouldn&amp;#8217;t need software engineers to help them work, so the DSL sorts that out. Mechanical engineers need to check reliability and timing/variability on the hardware, which they can do by configuring DSL parameters.&lt;/p&gt;
&lt;p&gt;There are a few bits to the DSL: an extraction/purification language (tip loading, pipetting, moving magnets) and the protocol language (aspirating, dispensing, etc) and finally the motor language.&lt;/p&gt;
&lt;p&gt;Shows an example of the PCR language, which is a complex recipe involving baking, thermal cycling in loops. The DSL follows the logic flow of the English language version of the recipe very closely (with more brackets).&lt;/p&gt;
&lt;p&gt;Wrote a web server that supports HTTP requests and JSON/jQuery and an sexpression-based HTML code generator. Can render pages with Scheme logic and render to webbrowsers. Use by engineers for debugging and prototyping without having to touch the real UI, and non-engineers use it to map data sources from instruments into JSON (which can be fed into validation tools, for example to send to the FDA for regulation).&lt;/p&gt;
&lt;p&gt;Lessons learnt:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Message passing is great but not a silver bullet. Gen servers can deadlock between each other despite being deadlock free internally. Timeouts in genservers and supervisor logging makes this possible to catch at a higher level, which is crucial!&lt;/li&gt;
&lt;li&gt;Not much on the web about a design pattern for the supervisor structure, so they had to pioneer it (didnt really want to pioneer it though)&lt;/li&gt;
&lt;li&gt;Automated unit test frameworks also built by them by hand&lt;/li&gt;
&lt;li&gt;Hiring remains hard into this unique environment.&lt;/li&gt;
&lt;li&gt;Existing quality metrics like bug density are problematic, since Scheme is terse and so looks artificially worse than more verbose languages!&lt;/li&gt;
&lt;li&gt;FDA has more scrutiny into this system since this is different from the usual C/C++/C# codebases and also the large number of open source tools such as Sqlite/Emacs/git. Unique to this regulated problem space of course.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Message passing concurrency makes reasoning about semantics of concurrent process easier, ass well as debugging problems via fault isolation. Let-it-crash leads to shorter, less defensive code with fewer branch points and test cases. Strong typing and runtime checks provide cognizant failure instead of silent corruption (crucial to avoid in this medical space).&lt;/p&gt;
&lt;p&gt;Mixing languages has been nice, since they can pick the good bits of Scheme (macros, arbitrary precision math) and Erlang (OTP). DSLs provide the glue here, and rapid prototyping for non-expert software developers.&lt;/p&gt;
&lt;h2&gt;Gilt and Scala microengines&lt;/h2&gt;
&lt;p&gt;Clothing group, and they need to customize the website with per-user targetting. The customer facing stuff is the tip of the iceberg with a bunch of backoffice features that need to be plumbed through. The traffic patterns are all about flash traffic that spike massively during sales, and if they go down in these times they lose lots of money.&lt;/p&gt;
&lt;p&gt;Gilt is about six years old, and it was built as a Rails app in the beginning that was quite large. It had unclear ownership, complex dependencies, lengthy test cycles, and unexpected performance impacts from small changes. Rails encourages to &amp;#8220;throw everything into one directory &amp;#8212; a thousands models in one directory&amp;#8221; which is really unscalable as the number of engineers grew. Some bad production issues came out of this problem.&lt;/p&gt;
&lt;p&gt;Then they started to transition to microservices by transitioning a few core critical pieces into microserviecs such as inventory management. The number of services grew to over 300 services in just 4 years (each HTTP microprotocols), all built using Scala. They developed an architecture to support this sort of growth of microservices.&lt;/p&gt;
&lt;p&gt;Cornerstones of infrastructure (goal==cool stuff for customers!)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;b&gt;Build system:&lt;/b&gt; SBT is a &amp;#8220;simple build tool&amp;#8221; which then turned into &amp;#8220;Scala build tool&amp;#8221; due to its complex mental model. Configuring everything correctly can be tricky if you have a number of dependencies. Gilt wanted to abstract developers from this so they could focus on writing appliction code. They solved it via a large SBT plugin that takes care of dependency management that provides a standardized configuration for everything.&lt;br /&gt;
A complete build specification is shown which is very succinct: it just has a combinator for adding dependencies. Behind the scenes, the plugin provides a huge amount of support (testing, rpms, dependency, continuous builds, and many more)&lt;/li&gt;
&lt;li&gt;&lt;b&gt;Configuration&lt;/b&gt; is handled by a Zookeeper cluster and can be overridden with local files or system properties. It&amp;#8217;s mapped into strongly-typed classes in Scala and validated via Hibernate so that configuration must match up with service expectations.&lt;/li&gt;
&lt;li&gt;&lt;b&gt;Testing&lt;/b&gt; is the most challenging part of a microservice architecture. Functional tests are the gold standard, but hard for developers to run 300 services on their local laptops. Unit tests can run locally, but there&amp;#8217;s no mocking service for these (and overmocking results in useless testing that in non representative). They use the Cake pattern for dependency injection, which enables type-safe and scalable composition. It uses Scala&amp;#8217;s self-types and multiple trait inheritance. Things like object repositories or configuration providers can be expressed in this way. The pattern lets them mixin different sources and weave in real/mocked sources.&lt;b&gt;UI Testing&lt;/b&gt; is handled via Selenium and is built on ScalaTest. Automated browser testing with reusable components works well, and leverages Scala&amp;#8217;s type system well to reject invalid tests/code/configuration.&lt;/li&gt;
&lt;li&gt;Continuous Delivery lets them deliver 20 to 30 service versions every day using the aforementioned structures&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Some cool stuff: on their website, there are badges on their website showing inventory for each item. The inventory badges update in realtime as you look at the page, which really motivates people to buy as they spot inventory dropping down. Shoppers get excited and feel like they&amp;#8217;re in a Black Friday sale and are engaged in the shopping activity! Building this stuff was quite easy to do using event-driven Play application and Akka actors.&lt;/p&gt;
&lt;p&gt;They build on this for &amp;#8220;freefall sales&amp;#8221;. Essentially a Dutch auction and is also web sockets and Play based. It initiates a sale that lasts for a fixed time with the price dropping regularly. The highlight is a $16000 purse that leads to audience laughter.&lt;/p&gt;
&lt;p&gt;Q: how to deal with production side of microservices such as service discovery or log aggregation?&lt;br /&gt;
A: no service discovery as Zookeeper tracks where everything is (which ports something is on). Log aggregation isnt great at the moment, so they&amp;#8217;re working on centralized collection atm.&lt;/p&gt;
&lt;p&gt;Q: what&amp;#8217;s the greatest win of FP here? Is type safety really important or something like that?&lt;br /&gt;
A: in the context of the company development and the technical stack, one nice thing about Scala is that it combines the &amp;#8220;good parts&amp;#8221; of Ruby (concise, expressive) with type safety and performance (as they had in Java). Scala provided a balance between Java and Ruby by giving them type safety, performance and conciseness, which is a big win in terms of expressivity and reuse of components.&lt;/p&gt;
&lt;p&gt;Q: how do you handle versioning of microservices?&lt;br /&gt;
A: each service maintains back compat in its API until they ensure all their clients are upgraded. The URI path has the version number, so service providers bump the version number for new clients and keep the old version working. They then migrate all the clients of the service as quickly as is practical.&lt;/p&gt;
&lt;h2&gt;PalletOpts and infrastructure automation&lt;/h2&gt;
&lt;p&gt;(I missed a lot of this talk due to a lunch chat spilling over. I&amp;#8217;ll fill it in later &amp;#8211;editor)&lt;/p&gt;
&lt;p&gt;A Clojure DSL that runs shell scripts and handles very complex infrastructure automation.&lt;/p&gt;
&lt;p&gt;Q: Yaron: How do you handle error propagation through scripts (the equiv of set -e in sh)&lt;br /&gt;
A: Each combinator propagates errors and there are different run strategies that handle errors differently depending on needs.&lt;/p&gt;
&lt;h2&gt;Streaming data at Twitter with Summingbird&lt;/h2&gt;
&lt;p&gt;Speaker is &lt;a href=&quot;http://twitter.com/sritchie&quot;&gt;@sritchie&lt;/a&gt; (&lt;a href=&quot;https://speakerdeck.com/sritchie/summingbird-at-cufp&quot;&gt;his slides&lt;/a&gt;). &lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo-3.jpg&quot;&gt;&lt;img class=&quot;size-medium wp-image-1399 alignright&quot; alt=&quot;photo 3&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo-3-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Summingbird is how to do streaming Map Reduce at the scale they have at Twitter (scale is &amp;#8220;staggering&amp;#8221;). It has been open sourced since Sep 3rd and a bunch of internal systems at Twitter run on it. Mainly three people: @posco @sritchie and Ashu &amp;#8212; small teams.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Vision&lt;/b&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;b&gt;&amp;#8220;Write your logic once&amp;#8221;&lt;/b&gt;: Twitter has a number of 1000+ host Hadoop clusters and a lot of their data is done via k/v processing with Hadoop. Going streaming had to be done evolutionary by letting it be done either on Hadoop or on some new streaming service. Programmers experimenting with data shouldn&amp;#8217;t have to make systems decisions early on in the process. Twitters scale: 200m+ active users, 500M tweets/day and scale is pervasive.&lt;/li&gt;
&lt;li&gt;&lt;b&gt;Solve systems problems once&lt;/b&gt; so that systems that are scaling stay fixed.&lt;/li&gt;
&lt;li&gt;&lt;b&gt;Make non-trivial realtime compute as accessible as Scalding&lt;/b&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This leads onto Summingbird: a declarative map/reduce streaming DSL. It&amp;#8217;s a realtime platform that runs on Storm, and a batch platform that runs on Hadoop. The datastructures that come out of the DSL can be run on either platform (so you can choose between batch/streaming very late in the process).&lt;/p&gt;
&lt;p&gt;One of the big concepts that Summingbird embraces is the idea of &amp;#8220;associative plus&amp;#8221; operations &amp;#8212; the monoid.&lt;br /&gt;
The 4 S&amp;#8217; of Summingbird (&amp;#8220;you know you&amp;#8217;re onto something when they all have something in common!&amp;#8221;):&lt;/p&gt;
&lt;pre&gt;Source[+T]
Store[-K,V]
Sink[-T]
Service[-K,+V]&lt;/pre&gt;
&lt;p&gt;Source is where data comes from, Store is a k/v store that is being aggregated into. Sink is a dump as processing items, and Service permits k/v lookups during a job.&lt;/p&gt;
&lt;p&gt;Store: what values are allowed? What constraints can we place on a MR job such that any valid value can make progress.&lt;/p&gt;
&lt;pre&gt;trait Monoid[V] {
  def zero: V
  def plus(l:V, r:V):V
}&lt;/pre&gt;
&lt;p&gt;&amp;#8220;less scary than a monad!&amp;#8221;. If you can take any two values and smash them together, you have a monoid &amp;#8212; e.g. integers. Also Sets have a monoid (concat) and lists (concat) and maps (recursively pull in the monoid on the value). Others include: HyperLogLog, CMS, ExponentialMA, BloomFilter, Moments,MinHash,Topk. All you need to do is find a datastructure with a monoid and you can use Summingbird. There is an open source library called Algebird (birds birds birds!).&lt;/p&gt;
&lt;p&gt;It took some convincing (the words like &amp;#8220;monoid&amp;#8221; still scared people at Twitter, sadly).&lt;/p&gt;
&lt;p&gt;Monoids are amazing due to Associativity. If you know that the values you are reducing are associative, then it&amp;#8217;s easy to parallelise since they can be built &amp;#8220;in any order&amp;#8221;.&lt;/p&gt;
&lt;p&gt;Even though realtime is important at Twitter, noones wanted to dip in due to the difficulty of getting started. Summingbird can pull in data from an existing static Hadoop cluster and then union it with a realtime feed. If you give the logic to Summingbird, it will run the logic on Hadoop (consuming discrete batches of data) and the client will keep track of how far it&amp;#8217;s gone. The realtime comes from partial aggregations over fixed time buckets, and is merged together in the client using the monoid to aggregate them together to look like a proper realtime feed.&lt;/p&gt;
&lt;p&gt;One cool feature: when you visit a tweet, you want the reverse feed of things that have embedded the tweet. The MR graph for this comes from: when you see an impression, find the key of the tweet and emit a tuple of the tweetid and Map[URL,Long]. Since Maps have a monoid, this can be run in parallel, and it will contain a list of who has viewed it and from where. The Map has a Long since popular tweets can be embedded in millions of websites and so they use an &amp;#8220;accountment sketch&amp;#8221; which is an approximate data structure to deal with scale there. The Summingbird layer which the speaker shows on stage filters events, and generates KV pairs and emits events.&lt;/p&gt;
&lt;p&gt;Twitter advertising is also built on Summingbird. Various campaigns can be built by building a backend using a Monoid that expresses the needs, and then the majority of the work is on the UI work in the frontend (where it should be &amp;#8212; remember, solve systems problems once is part of the vision).&lt;/p&gt;
&lt;p&gt;Future plans:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Akka, Spark, Tez platforms&lt;/li&gt;
&lt;li&gt;Pluggable graph optimizations since various planners do improved filter push&lt;/li&gt;
&lt;li&gt;Metadata publishing with HCatalog &amp;#8212; in OSS, this means better tooling for EC2 and other cloud platforms.&lt;/li&gt;
&lt;li&gt;And of course, more tutorials&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All work happens on Github so contributors are welcome.&lt;/p&gt;
&lt;p&gt;Summingbird is working well for the majority of realtime apps at Twitter. It&amp;#8217;s all about the Monoid! Data scientists who arent familiar with systems can deploy realtime systems, and 90%+ of the code is reused across the realtime and batch systems.&lt;/p&gt;
&lt;p&gt;Q: Did Hadoop need any changes to cope with the interfacing with Summingbird.&lt;br /&gt;
A: Scalding (written at Twitter) handles much of the interfacing with Hadoop. Hadoop is really the classical k/v store now. Real problem is figuring out which operations can work on both the batch and realtime and only admitting realtime.&lt;/p&gt;
&lt;p&gt;Q: Yaron: associativity is one nice thing about Monoid, but what about commutativity is also important. Are there examples of non-commutative datastructures&lt;br /&gt;
A: Good examples. It should be baked into the algebra (non-commutativity). This helps with data skew in particular. An important non-commutative application is Twitter itself! When you want to build the List monoid, the key is userid,time and the value is the list of tweets over that timeline (so ordering matters here). It&amp;#8217;s not good to get a non-deterministic order when building up these lists in parallel, so that&amp;#8217;s a good example of when associativity and commutativity are both important.&lt;/p&gt;
&lt;h2&gt;Functional Probabilistic Programming&lt;/h2&gt;
&lt;p&gt;Avi from Charles River, introducing the Figaro language.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Problem&lt;/b&gt;: Suppose you have some information (&amp;#8220;suppose Brian ate pizza last night&amp;#8221;) and you want to answer some questions based on this (&amp;#8220;is Brian a student or a programmer?&amp;#8221;) and keep track of the uncertainty in the answers.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Solution&lt;/b&gt;: Create a joint probability distribution over the variables, assert the evidence and use probabilistic inference to get the answer back.&lt;/p&gt;
&lt;p&gt;One common way to do this generative models. Probabilistic models in which variables are generated in order. Later values can depend on previous variables with a binding. This is a v popular approach with several implementations available over the years.&lt;/p&gt;
&lt;p&gt;Developing a new model requires figuring out a representation, an inference algorithm and a learning algorithm. All of these are significant challenges with each of them still being considered paper-worthy.&lt;/p&gt;
&lt;p&gt;The dominant paradigm is functional probabilistic programming. An expression describes a computation that produces a value.&lt;/p&gt;
&lt;pre&gt;let student = true in
let programmer = student in
let pizza = student &amp;amp;&amp;amp; programer in 
(student, programmer, pizza)

let student = flip 0.7 in
let programmer = if student flip(0.2) else flip(0.1) in
let pizza = if student &amp;amp;&amp;amp; programmer flip(0.9) else flip(0.3)
(student, programmer, pizza)&lt;/pre&gt;
&lt;p&gt;How are we supposed to understand this kind of program. Sampling semantics: run this program many times, each with a sample outcome. In each run, each outcome has some probability of being generated. The program defines a probability distribution over all the outcomes.&lt;/p&gt;
&lt;p&gt;This is a powerful approach since we are taking a Turing powerful language and probabilistic primitives are added, and this naturally expresses a wide range of models.&lt;/p&gt;
&lt;p&gt;Structured variable elimination, Markov chain Monte Carlo, importance sampling and so forth can all be built using functional probabilistic programming. PPLs aim to &amp;#8220;democratize&amp;#8221; model building &amp;#8212; one shouldn&amp;#8217;t need extensive training in ML or AI to build such models, or use them effectively.&lt;/p&gt;
&lt;p&gt;IBAL (2000-2007) is the first practical PPL, implemented in OCaml but not embedded in OCaml. Exact inference using structured variable elimination and later had intelligence important sampling. However, it was hard to integrate it with applications and data (in IBAL the data had to be hardcoded into the data, which wasnt practical). It also lacked continuous variables. Therefore the speaker built Figaro to work around the limitations.&lt;/p&gt;
&lt;p&gt;Figaro (2009-present) is a EDSL in Scala and allows distributions over any data type. It has a highly expressive constraint system that allows it to express non-generative models. There is an extensible library of inference algorithms that contains many of the popular probabilistic inference algorithms (eg. variable elimination).&lt;/p&gt;
&lt;p&gt;The goals of Figaro are to implement a PPL in a widely used library: Scala is the interop language as Java compat is a prime goal. Figaro provides various good abstractions such as OO that come out of Scala (not sure, he skipped slide rapidly here? &amp;#8212; editor)&lt;/p&gt;
&lt;p&gt;Figaro has an &lt;code&gt;Element[T]&lt;/code&gt; which is a class of probablistic models over type T. Atomic elements (Constant,Flip, Uniform, Geometric) are combined with compound elements &lt;code&gt;(If (Flip(0.9), Constant(0.5)...)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Under the hood, there is a probability monad to track the state. The Constant is the monadic unit and Chain(T,U) implements the monadic bind. Apply(T,U) implements monadic fmap. Most elements in Figaro are implemented using this monad.&lt;/p&gt;
&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo-4.jpg&quot;&gt;&lt;img class=&quot;size-medium wp-image-1400 alignright&quot; alt=&quot;photo 4&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo-4-300x300.jpg&quot; /&gt;&lt;/a&gt;
&lt;p&gt;Example 1: Probabilistic walk over a graph. In Figaro, we start by defining datastructures over the webpage graph (Edge, Node, Graph) and then we define some parameters of the random walk.&lt;/p&gt;
&lt;p&gt;Example 2: Friends and smokers. Create a person with a smokes variable. Friends are three times as likely to have the same smoking habit than different, so this is a constraint variable. Finally this is applied to all pairs of friends by adding constraints to the pairs. This is then instantiated in a particular situation by building a set of people (alice, bob, clara) and running the inference algorithm (VariableElimination) to calculate the probability that Clara smokes.&lt;/p&gt;
&lt;p&gt;Example 3: Hierarchical reasoning. We observe an object (say a vehicle on a road, or a person, or something) and we want to know what type of object it is. We have some observations about this object (its size, color or shape) and we want to know if its something we should be interested in. It&amp;#8217;s very natural to think of these objects via an inheritance hierarchy. In Figaro, every element has a name and belongs to an element collection. A reference is a sequence of names (such as vehicle size). Starting with an element collection, we can get to the vehicle associated with an element (go through through the sequence of nested element collections). However, there may be uncertainty in the identity of a reference (e.g. you dont know what vehicle1 is). Figaro resolve the element to the actual element.&lt;/p&gt;
&lt;p&gt;Obtaining Figaro is free and open source (cra.com/figaro) but v2 is on GitHub (like everything else today, it seems).&lt;/p&gt;
&lt;p&gt;Q: What are the limitations of Figaro, such as non-terminating Bernoulli tasks and what constraints cant be encoded?&lt;br /&gt;
A: Anything you can express can be put in constraints since any code can go in there. It&amp;#8217;s very easy to express something that you cant compute. Figaro is working on helping the programmer that can be computed over, such as via rejection sampling or simply rejecting the bad constraint.&lt;/p&gt;
&lt;p&gt;Q: Similar to Norman Ramsey&amp;#8217;s work (such as Church), whats the relationship&lt;br /&gt;
A: The languages fall into categories: their own languages and embedded libraries. The latter is Figaro and Infer.NET and Factory. INFER.NET is limited in expressivity and so can be compiled into a factor graph so is very efficient. Similarly Factory is lowlevel and compiles to factor graph. Lots to discuss here.&lt;/p&gt;
&lt;h2&gt;Haskell and FPComplete&lt;/h2&gt;
&lt;p&gt;Company exists to fix Haskell development tools. All the tools are cloud-based and run in a web browser. Content can be browsed anonymously. This talk will not have the Monad word in it!&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo4.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1425&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo4-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;There exists a feature to create tutorials and embed code within those tutorials.&lt;/p&gt;
&lt;p&gt;Latest product (being announced today) is a Haskell IDE that is a web based tool which requires no setup and no download. It has a number of cool features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Errors are displayed immediately as it compiled as you type&lt;/li&gt;
&lt;li&gt;Git based so full version control&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Company goals: increase Haskell adoption and make it more accessible. Offer commercial grade tools and support and simplify Haskell development. Also to support the Haskell community and leverage the community to improve FP Complete&amp;#8217;s own products.&lt;/p&gt;
&lt;p&gt;The FP Haskell Center (released in Sep 2013) has:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a web front end (no setup,access to help and integrated with Haskell)&lt;/li&gt;
&lt;li&gt;Haskell backend has project management, developer feedback with errors, build system and a cloud based execution and deployment platform. The cloud allows for faster product evolution!&lt;/li&gt;
&lt;li&gt;Soon to have a personal version and version that will work behind firewalls etc.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It is all implemented in a Haskell web framework like Yesod. Lots of library support via conduits, and the UI uses Javascript (via Fay). All the heavy lifting is done in the backend and not via Javascript. Very few issues surfaced using Yesod and no major modifications were required to build their product.&lt;/p&gt;
&lt;p&gt;Challenges were outside the scope of Haskell usually, but Haskell was used to fix them.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Javascript coding was significant in the frontend&lt;/li&gt;
&lt;li&gt;Stable set of libraries are important&lt;/li&gt;
&lt;li&gt;Compiler integration (feedback and errors) must be available as a library to let the IDE spot identifier location problems&lt;/li&gt;
&lt;li&gt;Uses LXC containers to created isolation containers &amp;#8212; ephemeral storage and containers can run on either shared or dedicated systems.&lt;/li&gt;
&lt;li&gt;IDE uses isolation git state to separate users from each other. When projects are created, there is a visual representation of projects (in git repositories each, in S3) and each repo is accessed via Gitlib-2. Interesting is that this offers multiple backends for git access: Git C library, GitHub C library, IDE local repo in S3 or others in the future.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For building projects, code is being precompiled continuously in the backend and so bytecode can generated quickly and run within the IDE. Bytecode runs in the GHC frontend container and exceptions dont break the IDE. Keter and Chef provide deployment assistance to get it into a shared application server or container, and FP Complete offers this deployment as part of their product.&lt;/p&gt;
&lt;p&gt;Billing Processor provides SOAP APIs. Added SOAP Haskell libraries to Haskell via C++ bindings.&lt;/p&gt;
&lt;h2&gt;Mobile gaming from Japan&lt;/h2&gt;
&lt;p&gt;They normally built mobile games using Ruby, PHP, etc, but have switched to FP in recent years for reliability, high performance and productivity. However, they&amp;#8217;ve suffered from memory leak (blaming Haskell&amp;#8217;s laziness, to audience laughter), and some data loss and performance degradation.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo3.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1424&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo3-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Gree is one of the largest mobile games platforms, with 37 million users and 2000 games as of June 2013. They develop social games and a platform for 3rd party games. They also do social media and advertising and licensing, and also venture capital.&lt;/p&gt;
&lt;p&gt;Employees are 2582 with a significant number of engineers (cant disclose exact numbers). On client side, it&amp;#8217;s normally Java, ObjC, Javascript and Unity/C#. Server side is usually PHP, MySQL and Flare (a KV store written in C++ developed internally at Gree). They started a Haskell project in Jun 2012 and they have 6 Scala and 4 Haskell engineers.&lt;/p&gt;
&lt;p&gt;They developed a KVS management system using Haskell, to setup and destroy KVS nodes in response to hardware faults and sudden access spikes. It&amp;#8217;s used in a large social game application. Another example is an image storage gateway, which converts WebDAV to memcached/S3 for the SNS photo uploader to store images. It uses Warp and http-conduit to do this conversion.&lt;/p&gt;
&lt;p&gt;Some pitfalls they faced with Haskell:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Memory leaks via lazy evaluation: frontend server keeps a list of active thread ids in a TVar for monitoring. When deleting from the thread list, the function didnt reduce the function to a normal form and so held onto a reference. This led to a serious memory leak that took the service down. It was fixed easily by evaluating to the normalform and forcing sequentialisation. They felt it is too easy to mix up TVar/MVar writes with other IO operations (which do reduce to normal form and avoid the leak). There is much confusion over the strict/lazy alternatives for non-IO functions&lt;/li&gt;
&lt;li&gt;Race conditions: Data put in a queue is very rarely lost. The reason is that the timeout functions can be used only once safely with an IO function. (details omitted)&lt;/li&gt;
&lt;li&gt;Performance degradation: from forking a lot of threads to do monitoring. This was easy to fix but happens often since Haskell libraries are developed actively and the implications of changes are not always obvious.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;How to fix all this? Better &lt;b&gt;testing&lt;/b&gt; to start with. Haskell has a great QuickCheck framework and they developed HUnit. This lets services be started in the setup (in their example, memcached using a spare port), and then run services against it and make sure its torn down in a timely fashion. They used this to extensively test their KVS system and Flare (written in C++). Over 150 system tests and a control server with 5000+ assertions, so this is a big scale test.&lt;/p&gt;
&lt;p&gt;Next up is documentation in Haskell. A problem report describes details of the problem and linked from a bug tracker. The timeline, workaround, impact and details caused must all be captured and are mixed up with a number of other reports, so none of the Haskell people read it. They collected up the aggregation and summarised it for other Haskell products. Despite this, other Haskell programmers still dont read it (audience laughter). To sort this out, they do automated checking using hlint. They customize hlint to &amp;#8220;grep&amp;#8221; for their particular pitfall, and then check for Emacs. hlint isnt quite good enough for a lot of their pitfalls though, such as the timeout issue from earlier, so they had some workarounds to deal with this. The good thing is that hlint is integrated into their text editor. Not all pitfalls can be caught by hlint: high level design issues will remain problematic.&lt;/p&gt;
&lt;p&gt;Education is also important. They have a brown bag (lunch? &amp;#8212; editor) FP meeting where they &amp;#8220;Make GREE a better place through the power of FP&amp;#8221;. They cover both Scala and Haskell topics. They also run an education program for new graduates, and they have a Haskell code puzzle series from Project Euler to help the new graduates.&lt;/p&gt;
&lt;p&gt;They conclude that they love FP and they develop some key components of our service using FP. But there are many pitfalls, and they are developing tools to assist them sort them out.&lt;/p&gt;
&lt;h2&gt;Haskell for distributed systems&lt;/h2&gt;
&lt;p&gt;Jeff Epstein (formerly a masters student in the Cambridge SRG, so it&amp;#8217;s good to see him again!) talks about their new distributed system that they are building in Haskell. His company is also available for hiring!&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo5.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1428&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo5-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HA middleware manages networked clusters, aiming for exabyte-scale clusters. It&amp;#8217;s architected by Mathieu Boespflug and Peter Braam (who has spoken about their FPGA work &lt;a href=&quot;http://cufp.org/videos/parallel-scientific-awesome-haskell-fpga-compiler&quot;&gt;at past CUFPs&lt;/a&gt;). It manages 10000+ nodes and creates consensus in the cluster about the location of active services. It can handle events due to failures, recovery time should be approx. 5 seconds.&lt;/p&gt;
&lt;p&gt;Zookeeper didn&amp;#8217;t scale &lt;i&gt;(audience interruption: why didnt Zookeeper scale? Jeff says he doesn&amp;#8217;t know and should chat offline, audience member notes that they maintain Zookeeper and wants to know more)&lt;/i&gt;.&lt;/p&gt;
&lt;p&gt;Events are sent by nodes and aggregated at a proxy node, and enqueued at an HA station. Events are processed by the hA coordinator and updates a node state graph (which is also replicated &amp;#8212; everything is replicated and is a key theme in the talk). The HA coordinator is the decision maker which decides what to do on failure. Its main action is updating the node state graph to reflect the new strategy after failure.&lt;/p&gt;
&lt;p&gt;Key components are: Haskell, Cloud Haskell and Paxos.&lt;/p&gt;
&lt;p&gt;How we used Haskell:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Functional Data structures result in a purely functional graph and replicated (impurely) between cluster managers. Most of the feels imperative though, which was important.&lt;/li&gt;
&lt;li&gt;Refactoring being easier was important due to strong typing.&lt;/li&gt;
&lt;li&gt;Laziness was yet again a problem causer in IO due to space leaks in low-level networking code. He notes that distribution is a natural barrier to laziness, since the act of serializing a message forces its evaluation. He also notes that processes much behave the same between processes on the same host as between hosts, and so even local communication must be forced.&lt;i&gt;Phil Walder interjects to ask &amp;#8220;why did you use Haskell? It&amp;#8217;s a bad fit! Jeff replies that &amp;#8220;we like Haskell&amp;#8221;&lt;/i&gt; and introduces Cloud Haskell, the topic of his MPhil thesis.Cloud Haskell is a library for distributed concurrency in Haskell and provides an actor-style message-passing interface, similarly to Erlang. It provides a &amp;#8220;typed erlang&amp;#8221;.Cloud Haskell is a good fit for this project in terms of interacting communicating components. Refactoring is easy, and this isn&amp;#8217;t a &amp;#8220;big data&amp;#8221; project in the sense of data size. There is a huge amount of communication messages though.CH has a pluggable transport layer such as TCP, but also for different underlying networks (they built Infiniband). However, CH requires ordered delivery of packets and this was a poor fit (they want out of order delivery, which could be built with UDP, but CH requires an ordering for some reason). Space leaks are a real problem in this layer.Cluster bringup is tough for CH, since nodes need to find each other at start of day, and there some hacks in there to work around a morning storm of messages.&lt;i&gt;(Interjection from audience: why not use Erlang? Jeff: performance wasnt up to par, and static types are important for them). Possibly the native code / bytecode erlang might be useful but speaker wasn&amp;#8217;t sure if it would work.&lt;/i&gt;
&lt;p&gt;Paxos: is all about making systems agree (well-known proven algorithm for consensus). They implemented this as a general purpose library on top of CH. The algorithm is a good match for the programming model, with the client, acceptor, proposer learning and leader all built as CH processes. It ended up being a small readable implementation (1.5kLOC) that closely matched the pseudocode in the original Paxos paper (made them feel better about correctness). It&amp;#8217;s used for synchronizing the state graph and for the distributed message queue.&lt;/p&gt;
&lt;p&gt;Challenges: Paxos is hard and untyped messages in CH make it worse. Getting reasonable performance from it also requires the modified variants. Liveness also is tricky to avoid overapproximations to prevent nodes being fenced out of the consensus unnecessarily. Multipaxos is something that solves some of this, and they&amp;#8217;re working on more specific stuff also.&lt;/p&gt;
&lt;p&gt;Debugging: The CH programming model makes it tractable to debug a distributed application on a single machine. Nevertheless, distributed code is still parallel and involves race conditions and mixing messages. They would like a distributed &lt;a href=&quot;http://www.haskell.org/haskellwiki/ThreadScope&quot;&gt;ThreadScope&lt;/a&gt; but instead mainly used oldskool logging.&lt;/p&gt;
&lt;p&gt;They did build a deterministic CH thread scheduler to replace CH&amp;#8217;s core message handling primitives, and they also used PROMELA&lt;/p&gt;
&lt;p&gt;Q: how much is open source or will be?&lt;br /&gt;
A: none as far as speaker knows&lt;/p&gt;
&lt;p&gt;Q: Marius: how are non-deterministic sources composed with the deterministic scheduler?&lt;br /&gt;
A: deterministic scheduler is for testing only, so timeouts also so deterministic.&lt;/p&gt;
&lt;h2&gt;IQ: Functional Reporting&lt;/h2&gt;
&lt;p&gt;Speaker is Edward Kmett on how they got FP in the door at S&amp;amp;P Capital in the door, their extensions to Haskell and generally how they&amp;#8217;re working on opensourcing their tech. SAP is huge and have a number of products (S&amp;amp;P Capital IQ Platform, ClariFI, AlphaWorks, Compustat).&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo6.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1434&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo6-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Getting FP in the door:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Monoids (introduced as with the Summingbird talk, for easy parallelisation)&lt;/li&gt;
&lt;li&gt;Reducers are another really powerful abstraction which can take a container full of values and give you back a structure, and it has a comonadic structure that lets you (e.g.) pass it many containers full of structures and generally compose things nicely. Reduction can also be done simultaneously across monoidal structures and essentially &amp;#8220;we dont see the wiring hanging out of our code any more&amp;#8221;.&lt;/li&gt;
&lt;li&gt;Performance attribution: This is a model that breaks down the reasons why you make money (what did you do that was significant). The old and busted model (implemented in Java, full dataset in memory, hard to extend) was horrible, and the new hotness is implemented in Scala, runs in constant space, is really fast and results are flattened elegantly via combinators to a database backend. In other words: better, but some details are glossed over (multipass algorithms, iteratees, caching layers, and handling missing data) &amp;#8212; but all this was sorted out and really sold Scala to the bigger company as a real asset.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;They developed Ermine, which is Haskell with Row Types. It&amp;#8217;s not quite Haskell, but it&amp;#8217;s main feature is that it&amp;#8217;s not Scala either (audience laughter). Writing functional programs in Scala is quite painful (e.g. not blowing stack with monads requires trampolining everything and is labour intensive just to get by day to day). They wrote Ermine in both Scala and Haskell with a portable Core that can run on the JVM.&lt;/p&gt;
&lt;p&gt;Ermine has a strong type system, with novel row types and polymorphic and constraint kinds (&amp;#8220;they were just coming into GHC at the time and I wanted to understand them&amp;#8221;) and Rank-N types via a derivative of HMF. It fit their domain requirements really wel, and has builtin database support, can be exposed to end users, a structured code editor that can only generate type-safe code as you&amp;#8217;re defining, and full control over error messages.&lt;/p&gt;
&lt;p&gt;Row types are a powerful way of describing the presence of a particular field. Its modelled via has, lacks and/or subsumes constraints. This is easily checked, but now inference flows unidirectionally through a join.&lt;br /&gt;
In Ermine, they have existentials in their constraint types &lt;i&gt;(technical explanation follows, not shown here &amp;#8211;editor)&lt;/i&gt;.&lt;/p&gt;
&lt;p&gt;Their reporting layer has one declarative specification to do all the relational algebra specifications they want, and push it into specific backends (SQL Server, etc) and ensure they run their queries as close to the data as possible. They can also create extensive HTML reports that render pretty consistently across different target platforms. Their example of Ermine was written by a functional programmer that had done no functional programming previously, which required a little hand holding to work through some of the more obscure type errors, but generally it worked ok.&lt;/p&gt;
&lt;p&gt;All the code is being stuck onto Hackage/Github etc.&lt;/p&gt;
&lt;p&gt;Q: has it been rolled out to a lot of users?&lt;br /&gt;
A: being used on the main S&amp;amp;P website. One big client facing page for users. The next gen stuff is using Ermine more widely. The desktop app coming soon has Ermine and will be used by a huge number of users. Trend is to use it in an increasing number of their products.&lt;/p&gt;
&lt;h2&gt;Enterprise scheduling with Haskell at skedge.me&lt;/h2&gt;
&lt;p&gt;They have a cloud-based scheduling platform that takes care of complex enterprise scheduling. It has a branded customer experience (like Google Apps does), a flexible workflow and deep integration with backend systems and in-store workflow (e.g. on iPads).&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo7.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1445&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo7-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Example is Sephora who do makeup, and their appointment system is integrated via skedge.me that is embedded in an iFrame that looks like a seamless part of their site so that endusers cant tell the difference.&lt;/p&gt;
&lt;p&gt;When speaker started at skedge.me, there was a lot of fire fighting. It was 43k lines of Groovy on Grails, and several major intractable bugs were affecting the business: timezones, double bookings, recurring events not firing and notifications being delayed. Performance was an issue, as things that were interactive were sometime taking minutes to load. There was also a lot of inflexibility &amp;#8212; hilariously, they had to sometimes ask clients to change their business model to fit with the skedge.me model.&lt;/p&gt;
&lt;p&gt;After some careful though, they decided they had to rewrite skedge.me to cope with growth and better service. The author had done Haskell before, but not specifically was with building a website using it.&lt;/p&gt;
&lt;p&gt;Haskell had the perfect model for fixing their scaling problems. At the lowest level, they built a RawDB on top of the IO monad that did everything necessary to maintain ACID guarantees during transactions. An example is that once an effect gets committed (e.g. an email gets sent confirming an appointment and then is cancelled, which happened on their old racy platform). This RawDB layer gives them stronger consistency guarantees with tracked effects and automatic retries on temporary failure.&lt;/p&gt;
&lt;p&gt;On top of the RawDB, they build a DB monad which provides a higher level than SQL via algebraic data types, caching and data validation. They then layer a security monad on top of the DB monad to guarantee that all accesses have been checked. Finally there is a business logic layer to enforce local policy and customise per customer (which was a real problem in the past).&lt;/p&gt;
&lt;p&gt;Security is complex due to all the customization, and they needed roles by client (owner, staff, customer) but also because clients can customise their &lt;i&gt;verbs&lt;/i&gt; that only make sense within the component (Appointments can be joined, rescheduled, or notifications can be sent, edit cancelled). Haskell lets all this fit within a multiparameter type class, instead of doing OO-style inheritance that will rapidly get out of control. They map customisations from the customer onto a more standard schema that they can manipulate generically on a component-by-component basis, and it&amp;#8217;s all statically checked and generally easy to read (important for security critical code).&lt;/p&gt;
&lt;p&gt;Haskell &amp;#8220;lets them build code for the long run&amp;#8221;. Sometimes though, you need to write code quickly and not care about longevity. This was the case for the importer, which is a quick-and-dirty hack to get code into their system. It has a limited set of inputs, the &amp;#8220;end user&amp;#8221; is the developer, and it&amp;#8217;s thrown away once the job&amp;#8217;s done. (shows epic type). Often when people need to do this sort of thing, they resort to bash or dynamically typed systems. In this case, even for this &amp;#8220;quick hack&amp;#8221;, they couldnt have achieved what they did &amp;#8220;as badly as they did, without the help of the type system&amp;#8221;. Generally very positive!&lt;/p&gt;
&lt;p&gt;Libraries help them not have to write code. Haskell is generally lower in terms of package count, but their *use* of Hackage libraries has been a lot higher than Javascript. They use 9 Javascript libraries, and 71 unique Hackage libraries (+87 dependencies). Its a lot harder to find a quality library that works in the dynamically typed land. Only one of their Haskell libraries had to be replaced due to bugs. This is because Hackage is well-organized, and it&amp;#8217;s easier to vet a library since the purely functional ones are less risky (fewer sideeffects through other code). In contrast, Javascript libraries can sideeffect (e.g. on the DOM) very late in the QA process. So: fewer Haskell libraries, but the number of useful libraries seems to be higher.&lt;/p&gt;
&lt;p&gt;Problems: cyclic module dependencies with hs-boot files are unwieldy, so avoid them. Scalability with 4+cores was limited, but they havent tested GHC 7.8 (which apparently fixes a lot of this). Idle GC can cause issues with long pauses, so disable this feature &amp;#8212; it depends on your workload but it was ok for their server based workload.&lt;/p&gt;
&lt;p&gt;Debugging production problems without stack traces is really hard, so consider using profiling mode for all libraries.&lt;/p&gt;
&lt;p&gt;Bottom line: 8200 lines of Haskell from 40k+ lines of Groovy. No recurring bugs and very good performance and flexibility for customer needs. Used daily by thousands of people. Check out the &lt;a href=&quot;http://skedge.me&quot;&gt;website&lt;/a&gt;!.&lt;/p&gt;
&lt;p&gt;Q: what about testing (QuickCheck?)&lt;br /&gt;
A: they&amp;#8217;ve done some QuickCheck on critical components (such as an map from times to events). Overall though, just putting Haskell together in the most obvious way led to improvements over their previous platform. Their QA guys are now writing unit tests in Haskell (because their Selenium bindings were harder).&lt;/p&gt;
&lt;h2&gt;Integration of Mathematica with MapReduce&lt;/h2&gt;
&lt;p&gt;From Paul-Jean Letourneau, a data scientist at Wolfram Research. &lt;i&gt;Started with a show of hands: most of the audience has used Mathematica and had heard of Wolfram.&lt;a href=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo8.jpg&quot;&gt;&lt;img class=&quot;alignright size-medium wp-image-1450&quot; alt=&quot;photo&quot; src=&quot;http://www.syslog.cl.cam.ac.uk/wp-content/uploads/2013/09/photo8-300x300.jpg&quot; /&gt;&lt;/a&gt;&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;The speaker has been responsible for a lot of the personal analytics posts on the Wolfram blog (the email analysis, genomics and several others). The theme of all his projects has been to work on large data. Mathematica has always kept its data oncore, which is a problem with very large data sets, and so this talk is about how they migrate over to a more big-data model to run offcore.&lt;/p&gt;
&lt;p&gt;Fundamental principles of Mathematica: everything is an expression, expressions are transformed until they stop changing, and transformation rules are in the form of patterns. Expressions are data structures (actually m-expressions in Lisp parlance). &lt;i&gt;(full explanation of these in Mathematica demonstrated but omitted here)&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;Expressions in Mathematica are immutable data structures (&amp;#8220;program as data&amp;#8221;) and so expressions can be rebound. Homoiconicity is pervasive as expressions are the data structure, even internally during evaluation (where it&amp;#8217;s represented as a tree).&lt;/p&gt;
&lt;p&gt;&lt;i&gt;&amp;#8220;everything is a one-liner in Mathematica&amp;#8230; for a sufficiently long line&amp;#8221; (Theo Gray).&lt;/i&gt; (audience laughter). He demonstrates some cool oneliners that are Tweetable (&amp;lt;140chars) and demonstrates how to construct an image recursively out of itself (wow).&lt;/p&gt;
&lt;p&gt;He views it as a gateway drug to declarative programming&lt;/p&gt;
&lt;pre&gt;y = 0
For[i=1; i&amp;lt;=10; i++,y+=i^2]; y
385&lt;/pre&gt;
&lt;p&gt;(and then they discover Fold and all the advanced topics such as scoping, evaluation control and the MathLink protocol for IPC).&lt;/p&gt;
&lt;p&gt;HadoopLink is how they link Mathmetica to Hadoop. Example is WordCount, wherein he shows code to do it on a single core first (to test the output), and then an export to HDFS so that Hadoop can see the code. This looks fairly straightforward via a DFSExport command from HadoopLik.&lt;/p&gt;
&lt;p&gt;The Mapper looks something like:&lt;/p&gt;
&lt;pre&gt;Function[{k,v},
  With[{words=ToLowerCase 
    /@ StringSplit [k,RegularExpression[], ...&lt;/pre&gt;
&lt;p&gt;The reduces is similar, as it users an iterator to sum up each of the inputs. It actually communicates to the JVM to ensure that they dont have to load all the values into memory. Running the job is just a special HadoopMapReduceJob along with all the relevant expressions, and it goes ahead and submits it to Hadoop.&lt;/p&gt;
&lt;p&gt;Used this to build a genome search engine using all this. He shows how to prep data using Mitochondrian genomic data. The mapper only knows about a single base in the genome and its position, and the query sequence, how can it possibly align the query sequence with the genome? Algorithm scales with the size of the query, and not the size of the dataset. Hadoop can be used to handle the full dataset so getting local algorithm right in Mathematica can be focussed on rather than the bigger problem.&lt;/p&gt;
&lt;p&gt;Challenges: when this scaled up to search the entire human genome, my Hadoop cluster blows up. Nodes start dying, Nagios alerts, the works! After drilling down on these cryptic errors, the &amp;#8220;garbage collector overhead was exceeded&amp;#8221; which was hard to interpret. The memory consumption on each worker node when running with both Mathematica and the slave is quite high. This is a setting that&amp;#8217;s made on a clusterwide basis and so is problematic to tweak just for this. What he&amp;#8217;d like to do is add job-specific options to run things like heap size.&lt;/p&gt;
&lt;p&gt;Its on GitHub and open source (github.com/shadanan/HadoopLink) so go for it.&lt;/p&gt;
&lt;h2&gt;Announcements&lt;/h2&gt;
&lt;p&gt;Ashish Agarwal is organizing BoFs! On Monday @ 6pm there will be a bioinformatics session with Jeff Hammerbacher with location on the CUFP website.&lt;/p&gt;
&lt;p&gt;On Tuesday there will be a BoF about organizing local events for FP. In the same way that politics is local, this BoF will help you figure out strategies for local events.&lt;/p&gt;
&lt;p&gt;Yaron Minsky announces that 17 organizations have sponsored CUFP this year, which helps students. Industry attention to FP is really amazing to see how FP is moving into the mainstream. Industrial reception at 1830 on Monday downstairs.&lt;/p&gt;
&lt;p&gt;Our thanks to Marius Eriksen and Mike Sperber for an amazing program!&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-23T15:11:09+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://anil.recoil.org/2013/09/20/opam-1-1-beta">
	<title>Anil Madhavapeddy: OPAM 1.1 beta available, with pretty colours</title>
	<link>http://anil.recoil.org/2013/09/20/opam-1-1-beta.html</link>
	<content:encoded>&lt;p&gt;&lt;a href=&quot;http://gazagnaire.org&quot;&gt;Thomas&lt;/a&gt; just announced the availability of the &lt;a href=&quot;http://opam.ocamlpro.com&quot;&gt;OPAM&lt;/a&gt; beta release. This has been a huge amount of work for him and &lt;a href=&quot;http://louis.gesbert.fr/&quot;&gt;Louis&lt;/a&gt;, so I&amp;#8217;m excited to see this release! Aside from general stability, the main highlights for me are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A switch to the &lt;a href=&quot;http://creativecommons.org/publicdomain/zero/1.0/&quot;&gt;CC0&lt;/a&gt; public-domain-like license for the repository, and LGPL2+linking exception for OPAM itself. The &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/issues/955&quot;&gt;cutover to the new license&lt;/a&gt; was the first non-gratuitous use of GitHub&amp;#8217;s fancy issue lists I&amp;#8217;ve seen, too! As part of this, we&amp;#8217;re also beginning a transition over to hosting it at &lt;code&gt;opam.ocaml.org&lt;/code&gt;, to underline our committment to maintaining it as an OCaml community resource.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Much-improved support for package pinning and updates. This is the feature that makes OPAM work well with &lt;a href=&quot;http://openmirage.org&quot;&gt;MirageOS&lt;/a&gt;, since we often need to do development work on a low-level library (such as a &lt;a href=&quot;https://github.com/mirage/ocaml-xen-block-driver&quot;&gt;device driver&lt;/a&gt; and recompile all the reverse dependencies.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Support for post-installation messages (e.g. to display &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/pull/1100&quot;&gt;licensing information&lt;/a&gt; or configuration hints) and better support for the external library management issues I explained in an earlier post about &lt;a href=&quot;http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html&quot;&gt;OCamlot testing&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Better library structuring to let tools like &lt;a href=&quot;http://github.com/OCamlPro/opam2web&quot;&gt;Opam2web&lt;/a&gt; work with the package metadata. For instance, my group&amp;#8217;s &lt;a href=&quot;http://ocaml.io&quot;&gt;OCaml Labs&lt;/a&gt; has a comprehensive list of &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/pkg/index.html&quot;&gt;the software packages that we work on&lt;/a&gt; generated directly from an OPAM remote.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;A growing set of administration tools (via the &lt;code&gt;opam-admin&lt;/code&gt; binary) that run health checks and compute statistics over package repositories. For example, here&amp;#8217;s the result of running &lt;code&gt;opam-admin stats&lt;/code&gt; over the latest package repository to show various growth curves.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table align=&quot;center&quot; width=&quot;90%&quot;&gt;
&lt;tr&gt;
&lt;td width=&quot;30%&quot; class=&quot;bimg&quot;&gt;&lt;a href=&quot;http://anil.recoil.org/images/opam11-beta-contributors.png&quot;&gt;&lt;img border=&quot;0&quot; width=&quot;220&quot; src=&quot;http://anil.recoil.org/images/opam11-beta-contributors.png&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Number of unique contributors to the main OPAM package repository.&lt;/td&gt;
&lt;td width=&quot;30%&quot; class=&quot;bimg&quot;&gt;&lt;a href=&quot;http://anil.recoil.org/images/opam11-beta-packages.png&quot;&gt;&lt;img border=&quot;0&quot; width=&quot;220&quot; src=&quot;http://anil.recoil.org/images/opam11-beta-packages.png&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Total number of unique packages (including multiple versions of the same package).&lt;/td&gt;
&lt;td width=&quot;30%&quot; class=&quot;bimg&quot;&gt;&lt;a href=&quot;http://anil.recoil.org/images/opam11-beta-unique-packages.png&quot;&gt;&lt;img border=&quot;0&quot; width=&quot;220&quot; src=&quot;http://anil.recoil.org/images/opam11-beta-packages.png&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Total packages with multiple versions coalesced so you can see new package growth.&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;Is it a &lt;a href=&quot;http://www.theatlantic.com/technology/archive/2013/05/the-hockey-stick-the-most-controversial-chart-in-science-explained/275753/&quot;&gt;hockey stick&lt;/a&gt; graph? Only time will tell! See Thomas&amp;#8217; &lt;a href=&quot;https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00300.html&quot;&gt;full release announcement&lt;/a&gt; and let us know how you get along with this new release&amp;#8230;&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-19T23:00:00+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=352">
	<title>Heidi Howard: OCaml Monthly Meeting – Live Blog</title>
	<link>http://hh360.user.srcf.net/blog/2013/09/ocaml-monthly-meeting-live-blog/</link>
	<content:encoded>&lt;p&gt;Today&amp;#8217;s OCaml Labs Monthly Meeting is all about practise talks for OCaml2013 so in that spirit, I&amp;#8217;ll practising a bit of live-blogging too.&lt;/p&gt;
&lt;p&gt;13:53 &amp;#8211; Today&amp;#8217;s SRG Meeting is over and its time for some work before the OCaml Labs meeting at 4:00, see you then &amp;#8230;&lt;/p&gt;
&lt;p&gt;16:02 Techincal difficulties delayed the start&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;16:02 Intro from Anil&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;introducing Gabriel Scherer who is visiting us this week and going we are going to Maypole after this meeting. We had a cash prise from ASPLOS after winning the HiPEAC paper award and the money will go towards SRG wine for XMAS party. Signpost paper was accepted to FOCI and a HotNet paper on Trevi was also just accepted&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OCL Website&lt;/strong&gt; &amp;#8211; Too much manual management at the moment, moving to an &lt;a href=&quot;http://planet.ocamlcore.org/&quot;&gt;ocaml planet&lt;/a&gt; feed of blog posts. David has been busy hacking on &lt;a href=&quot;https://github.com/OCamlPro/opam2web&quot;&gt;OPAM2web&lt;/a&gt;, OPAM has 512 packages, Opam2web takes a subset of the OPAM packages and makes the metadata into a minisite, like on OPAM. Doesn&amp;#8217;t require manual updates, like an ATOM feed.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Upcoming events&lt;/strong&gt; &amp;#8211; Tomorrow is the 2nd &lt;a href=&quot;http://www.meetup.com/Makespace/events/138103982/&quot;&gt;compiler hacking event&lt;/a&gt;, at the &lt;a href=&quot;http://makespace.org/&quot;&gt;makespace&lt;/a&gt;. Anil will be talking at QCon on Mirage, Mirage 1.0 release date is October 22nd, so maybe a workshop before. We 3 talks for Ocaml2013 (Platform, OcamlOT and Ctypes) so here we go &amp;#8230;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;16:09 Anil practice talk on OCaml Platform 1.0&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Languages take many difference approaches to platform, but what does platform even mean? As a late mover in this field, we can learn from other languages. A platforms is NOT a group of temporarily motivated hackers to build a replacement standard library. Its hard to adopt a particular approach without a domain specific purpose, there are too many opinions, we need objective way to determine what belongs in the platform, we need a genie community that is sustainable (even if a large party leaves). A platform is a bundle of tools that interoperate, with quantitative metric to judge success, built in agility and supporting developers thought the whole development life cycle. Industrial partners have a range of needs, as each work in different domains.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Tooling&lt;/strong&gt; &amp;#8211; Overview of 5 areas: OPAM from OCamlPro, IDE Tools, OPAM-DOC, OCaml compiler itself and Ocaml.org.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OPAM&lt;/strong&gt; &amp;#8211; 1.1 released today (maybe), over 100 contributors to OPAM,  500+ packages, 1500+ unique versions, external dependency solver using CUDF&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IDE Support&lt;/strong&gt; &amp;#8211; OCaml has many intermediate files. In OCaml 4.0 onwards, we have a binary format of an abstract syntax tree with type annotations called cmt (and cmti for interface files), we can now create external tools to query this like opam-doc. ocp-index and ocp-indent from OCamlPro, and Merlin (I thinks this is EPIC) are also now available&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;opam-doc&lt;/strong&gt; &amp;#8211; Now we have cmt files, we need unified documentation across packages, this is much harder than it sounds as it touches every part of the tool stack. Not all packages can be installed at once due to conflicts. Module inclusion is tough to code in static html. (Need to make a demo) bindoc takes the Typed AST (in cmt) and generates cmd, which include the ocamldoc comments, Opamdoc takes the cmt database for opam and output a single website with your universe of packages.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ocaml.org&lt;/strong&gt; - Demo of ocaml.org at &lt;a href=&quot;http://hh360.user.srcf.net/blog/category/pl/ocaml/feed/ocaml-redesign.github.io/pkg/index.html&quot;&gt;ocaml-redesign.github.io/pkg/index.html&lt;/a&gt;, feedback is welcome says amir&lt;/p&gt;
&lt;p&gt;Now we have the tools, what metrics can we extract to see how well our tools are doing.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Portability&lt;/strong&gt; &amp;#8211; windows compatibility ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Maintainer&lt;/strong&gt; &amp;#8211; is there a place for docs and will people response to issues/comments/emails, where can issues be submitted ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Tests&lt;/strong&gt; &amp;#8211; code coverage, multi variant benchmarking in &lt;a href=&quot;https://ocaml.janestreet.com/ocaml-core/latest/doc/core_bench/index.html&quot;&gt;core-bench&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stability&lt;/strong&gt; &amp;#8211; OPAM support pining, how stable are the interfaces of libraries ?&lt;/p&gt;
&lt;p&gt;opam tracks compiler constraint, statically analyses the build system from logs (OCamlOT)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Agility&lt;/strong&gt; &amp;#8211; Building a platform is EXHAUSTING. We want to ask &amp;#8220;WANT IF&amp;#8221; questions: &lt;a href=&quot;http://gallium.inria.fr/blog/monomorphic_let/&quot;&gt;what if let was monomophic&lt;/a&gt;? what if we removed &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-camlp4/manual002.html&quot;&gt;camlp4&lt;/a&gt;? what is the syntax precedence changes ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Distrusted workflow&lt;/strong&gt; &amp;#8211; build on git, distributing tasks between 3 actors: Author (library writers), OCamlOL workers and maintainers. As we become more stable we move from staging to stable to inclusion in the platform.&lt;/p&gt;
&lt;p&gt;We are building a tussle, we want to launch a game in janurary and let people put standard libraries into the ring, running OCamlOT to discover the winner&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;No clear winner&lt;/strong&gt;: Lwt &amp;#8211; portability, Batteries &amp;#8211; free of syntax extensions, core &amp;#8211; comprehensive.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;16:36  Discussion over the battle of the standard libraries and talk feedback&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;C: talk is a bit long, not sure what to cut..&lt;/p&gt;
&lt;p&gt;C: OPAM was dicussed last year at OCaml2013, we want to update everyone and follow on without overlapping too much&lt;/p&gt;
&lt;p&gt;Q: Haven&amp;#8217;t we already decided on JS&amp;#8217;s core ?&lt;/p&gt;
&lt;p&gt;A: No, we use all of them, i.e. Mirage used lwt extensively&lt;/p&gt;
&lt;p&gt;Q: What if we don&amp;#8217;t want any of the new standard libraries ? maybe I just want to use domain specific libraries from OPAM as and when I need them&lt;/p&gt;
&lt;p&gt;A: We are not forcing the new standard libraries on anyone, but they are useful for beginners, nice to have consistent style, interoperability and few open statements e.g. Open Core.Std&lt;/p&gt;
&lt;p&gt;Q: What if I have already decided which standard library I want to use ?&lt;/p&gt;
&lt;p&gt;A: Again we are not forcing standard libraries on anyone, we are just trying to force effort more directly. OCaml tools will always be standard library agnoctic&lt;/p&gt;
&lt;p&gt;C: the diagram of OCamlOT is confustion&lt;/p&gt;
&lt;p&gt;C: how to not overlap with david talks&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;16:41 Davids talk on OCamlOT&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;State for the open source OCaml community&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Outline:&lt;/strong&gt; what is quality software? what is the user experience? what is feedback loop for package authors? How do we represent the thing underneath this all? utopian future ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Quality:&lt;/strong&gt; Work on every core (ANIL: We want multi-core &lt;img src=&quot;http://hh360.user.srcf.net/blog/wp-includes/images/smilies/icon_razz.gif&quot; alt=&quot;:P&quot; class=&quot;wp-smiley&quot; /&gt;  ), consistent results: work or die nicely with obvious solution, not more &amp;#8220;What have I forgotten?&amp;#8221; questions, it should just tell you. We need addictive actions (not sure what they are), consistency, quality functions&amp;#8230;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Universal concerns:&lt;/strong&gt; compiler hypothesis &amp;#8220;what if&amp;#8221; questions (anil already said this), build system hypotheses &amp;#8220;what strange assumuptions is the buid system making?&amp;#8221;, package manager hypothesis and environmner hypothesis&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Workflow:&lt;/strong&gt; Make a pull request, curator observes the proposal, predict the future, proposes amendments, feedback loop and finally agreement is reached. Core is release weekly for example, we are trying to work like linux kernal patches&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;New workflow:&lt;/strong&gt; promote health of OCaml community, preaching compatibility, &amp;#8220;observe, orient, decide and act&amp;#8221;, Computer assisted curator will help a human, to run the loop faster, human can pose questions to the computer assisted curator e.g  &amp;#8221;will this run on ARM ?&amp;#8221;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Repository Observation:&lt;/strong&gt; github binding with web hooks but we are not tied to github. We merge into the world and we need dependences from each possible users prospective of the world&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Dependency Orientation:&lt;/strong&gt; capabilities with environmental dependances, packages with constriant-based dependencies, repositories with revision dependencies and artifact dependencies. example of the android repo&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Triage Decisions:&lt;/strong&gt; taking plain text error and parsing them into categories such as unsatisfiability (can&amp;#8217;t have these two packages), dependencies (if my dependency is broken, then I am broken), transient (network down), system, metadata, external dependences (you forgot to write a dependency), build errors and a combo of many of the above.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;State Action:&lt;/strong&gt; commit intention, build, error analysis and buid results&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Internet res:&lt;/strong&gt; The agents negotiates over REST API on HTTPS, independent metadata layers (not sure about this) ,everythings an s-exp, branch consistent store explained, like git or &lt;a href=&quot;https://github.com/samoht/irminsule&quot;&gt;Irminsule&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Current state:&lt;/strong&gt; github web hooks, we are conservative so one byte changes and we rebuild everything, basic triage heuristics completed, no amendment are proposed by the system atm, we don&amp;#8217;t commit the outcome but the evidence, simple reactions to results, a website with green and red boxes in the large table&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;History:&lt;/strong&gt; we have found lots of metadata issues&lt;span&gt;, many packages bugs, some tool bugs like a non relocatable&lt;/span&gt;&lt;span&gt; compiler and &lt;/span&gt;ocamlbuild&lt;span&gt; PATH &lt;/span&gt;ignorer&lt;span&gt;, we currently have 30+ &lt;/span&gt;x84-64&lt;span&gt; 30+&lt;/span&gt;x84-32&lt;span&gt;, 8 ARMs , many &lt;/span&gt;Linux&lt;span&gt; distros&lt;/span&gt;&lt;span&gt; , &lt;/span&gt;dead &lt;a href=&quot;http://www.raspberrypi.org/&quot;&gt;Raspberry Pi&lt;/a&gt;, panicking&lt;span&gt; *nix &lt;/span&gt;filesystems&lt;span&gt; and lots of people have set warning as error&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Future:&lt;/strong&gt; opamfu for DAG analysis, schema migration overhead, lower overhead for administrating exotic workers contributed to OCamlOT, we need to authenticate machines using ocaml-sodium, we need more advanced automation, proposed amendments, lets have a dialogue, better website integration, benchmarking your upgrades (how much improves cost), run experiments on whole OPAM universe with differential analysis and VM-based test system, to specific the worker finely.&lt;/p&gt;
&lt;p&gt;What I think quantity is, vision of the future, how its represented underneath and what&amp;#8217;s next,&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;Discussions&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;C: that was 20mins, feedback to David regarding content to be cut,&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;17:23 Ctypes by Jeremy &lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This is a update not a practice talk&lt;/p&gt;
&lt;p&gt;An examples of puts from C, how we can write no C and link in OCaml,&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NEW things in Ctypes:&lt;/strong&gt;&lt;br /&gt;
prettyprinting &amp;#8211; for C types and C values, making it much eaiser to examine values for debuygging&lt;/p&gt;
&lt;p&gt;biarray &amp;#8211; support for lump of C memory&lt;/p&gt;
&lt;p&gt;More type &amp;#8211; nullable string, complex numbers&lt;/p&gt;
&lt;p&gt;String conversions &amp;#8211; much faster&lt;/p&gt;
&lt;p&gt;Memory management issues &amp;#8211; ctypes now gives the programmer more control over lifetime of OCaml passed to C,&lt;/p&gt;
&lt;p&gt;finaliser &amp;#8211; which you can attach to memory&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Future&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;stub generation &amp;#8211; instead of dynamically binding, it will generate stub code to act to the API&lt;/p&gt;
&lt;p&gt;capability-style memory safty &amp;#8211; one rogue pointer in a C library, can cause hell, loading each C library in a seperate address space so i library can only kill itself, you can then even run on C library on a foreign host or on a virtual machine&lt;/p&gt;
&lt;p&gt;static strcut/union layout &amp;#8211; checking layout of structures and unions against the API&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;17:40 Amir demo of ocaml-resdesign.githuib.io/docs/opam,&lt;/span&gt;&lt;/strong&gt; (its look great &lt;img src=&quot;http://hh360.user.srcf.net/blog/wp-includes/images/smilies/icon_smile.gif&quot; alt=&quot;:)&quot; class=&quot;wp-smiley&quot; /&gt; )&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://hh360.user.srcf.net/blog/wp-content/uploads/2013/09/ocaml.png&quot;&gt;&lt;img class=&quot;size-medium wp-image-363 aligncenter&quot; alt=&quot;ocaml&quot; src=&quot;http://hh360.user.srcf.net/blog/wp-content/uploads/2013/09/ocaml-253x300.png&quot; width=&quot;253&quot; height=&quot;300&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-17T12:54:53+00:00</dc:date>
</item>
<item rdf:about="http://ocamllabs.github.com/compiler-hacking/2013/09/17/compiler-hacking-july-2013">
	<title>Compiler Hacking: Inaugural compiler hackers meeting</title>
	<link>http://ocamllabs.github.com/compiler-hacking/2013/09/17/compiler-hacking-july-2013.html</link>
	<content:encoded>&lt;p&gt;&lt;img src=&quot;http://ocamllabs.github.io/compiler-hacking/imgs/2013-09-17.jpg&quot; alt=&quot;Compiler Hacking&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first OCaml Labs compiler hacking session brought together around twenty people from &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/&quot;&gt;OCaml Labs&lt;/a&gt;, the wider &lt;a href=&quot;http://www.cl.cam.ac.uk&quot;&gt;Computer Lab&lt;/a&gt;, and &lt;a href=&quot;http://www.citrix.com/&quot;&gt;various&lt;/a&gt; &lt;a href=&quot;http://www.arm.com/&quot;&gt;companies&lt;/a&gt; around Cambridge for an enjoyable few hours learning about and improving the OCaml compiler toolchain, fuelled by &lt;a href=&quot;http://www.cherryboxpizza.co.uk&quot;&gt;pizza&lt;/a&gt; and home-made ice cream (thanks, &lt;a href=&quot;http://philippewang.info/CL/&quot;&gt;Philippe&lt;/a&gt;!).&lt;/p&gt;

&lt;p&gt;We benefited from the presence of a few &lt;a href=&quot;http://www.x9c.fr/&quot;&gt;experienced&lt;/a&gt; &lt;a href=&quot;http://danmey.org/&quot;&gt;compiler&lt;/a&gt; &lt;a href=&quot;http://lpw25.net/&quot;&gt;hackers&lt;/a&gt;, but for most of us it was the first attempt to modify the OCaml compiler internals.&lt;/p&gt;

&lt;p&gt;The first surprise of the day was the discovery that work on the &lt;a href=&quot;https://github.com/ocamllabs/compiler-hacking/wiki/Things-to-work-on&quot;&gt;list of projects&lt;/a&gt; was underway before we even arrived!  Keen collaborators from The Internet had apparently spotted our triaged bug reports and &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=4323&quot;&gt;submitted&lt;/a&gt; &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=4737&quot;&gt;patches&lt;/a&gt; to Mantis.&lt;/p&gt;

&lt;h3&gt;Standard library and runtime&lt;/h3&gt;

&lt;p&gt;There was an exciting moment early on when it emerged that two teams had been working independently on the same issue!  When &lt;a href=&quot;https://github.com/jonludlam&quot;&gt;Jon Ludlam&lt;/a&gt; and &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/euan.html&quot;&gt;Euan Harris&lt;/a&gt; submitted a patch to add a &lt;code&gt;get_extension&lt;/code&gt; function to the &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml/libref/Filename.html&quot;&gt;&lt;code&gt;Filename&lt;/code&gt;&lt;/a&gt; module they found that they had been pipped to the post by &lt;a href=&quot;https://github.com/mcclurmc/&quot;&gt;Mike McClurg&lt;/a&gt;.  There's still the judging stage to go, though, as the patches wait &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=5807&quot;&gt;on Mantis&lt;/a&gt; for official pronouncement from the Inria team. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://github.com/vbmithr&quot;&gt;Vincent Bernardoff&lt;/a&gt; also spent some time improving the standard library, &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=4919&quot;&gt;fleshing out the interface for translating between OCaml and C error codes&lt;/a&gt;, starting from a patch by Goswin von Brederlow.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/stedolan&quot;&gt;Stephen Dolan&lt;/a&gt; looked at a &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=1956&quot;&gt;long-standing issue&lt;/a&gt; with names exported by the OCaml runtime that can clash with other libraries, and submitted a patch which hides the sole remaining offender for the runtime library.  As he noted in the comments, there are still a &lt;a href=&quot;https://gist.github.com/stedolan/6115403&quot;&gt;couple of hundred&lt;/a&gt; global names without the &lt;code&gt;caml_&lt;/code&gt; prefix in the &lt;code&gt;otherlibs&lt;/code&gt; section of the standard library.&lt;/p&gt;

&lt;h3&gt;Tools&lt;/h3&gt;

&lt;p&gt;There was a little flurry of work on new command-line options for the standard toolchain.&lt;/p&gt;

&lt;p&gt;A &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6102&quot;&gt;Mantis issue&lt;/a&gt; submitted by &lt;a href=&quot;http://gallium.inria.fr/%7Escherer/&quot;&gt;Gabriel Scherer&lt;/a&gt; suggests adding options to stop the compiler at certain stages, to better support tools such as &lt;a href=&quot;http://projects.camlcity.org/projects/findlib.html&quot;&gt;OCamlfind&lt;/a&gt; and to make it easier to debug the compiler itself.  The Ludlam / Harris team looked at this, and submitted a patch which provoked further thoughts from Gabriel.&lt;/p&gt;

&lt;p&gt;Vincent looked at extending &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml/depend.html&quot;&gt;ocamldep&lt;/a&gt; with support for suffixes other than &lt;code&gt;.ml&lt;/code&gt; and &lt;code&gt;.mli&lt;/code&gt;.  Since &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=3725&quot;&gt;the issue&lt;/a&gt; was originally submitted, &lt;code&gt;ocamldep&lt;/code&gt; has acquired &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml/depend.html#sec288&quot;&gt;&lt;code&gt;-ml-synonym&lt;/code&gt; and &lt;code&gt;-mli-synonym&lt;/code&gt; options&lt;/a&gt; that serve this purpose, so Vincent looked at supporting other suffixes in the compiler, and submitted a patch as a &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6110&quot;&gt;new issue&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The OCaml top level has a simple feature for setting up the environment —  when it starts up it looks for the file &lt;code&gt;.ocamlinit&lt;/code&gt;, and executes its contents.  It's sometimes useful to skip this stage and run the top level in a vanilla environment, so &lt;a href=&quot;https://github.com/dsheets&quot;&gt;David Sheets&lt;/a&gt; submitted a &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6071&quot;&gt;patch&lt;/a&gt; that adds a &lt;code&gt;-no-init&lt;/code&gt; option, &lt;a href=&quot;https://github.com/ocaml/ocaml/blob/fadcc73c50b89ca80ecc11131c9a23dbd2c1e67a/Changes#L35&quot;&gt;due for inclusion&lt;/a&gt; in the next release.&lt;/p&gt;

&lt;h3&gt;Error-handling/reporting&lt;/h3&gt;

&lt;p&gt;Error handling issues saw a good deal of activity.  &lt;a href=&quot;http://www.cl.cam.ac.uk/%7Erp452/&quot;&gt;Raphaël Proust&lt;/a&gt; submitted a patch to improve the &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6112&quot;&gt;reporting of error-enabled warnings&lt;/a&gt;; David investigated &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=3582&quot;&gt;handling out-of-range integer literals&lt;/a&gt; and &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=5350&quot;&gt;return-code checking of C functions in the runtime&lt;/a&gt;, leading to some discussions on Mantis.  Stephen submitted a patch to improve the &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6182&quot;&gt;diagnostics for misuses of &lt;code&gt;virtual&lt;/code&gt;&lt;/a&gt;.  &lt;a href=&quot;http://www.cl.cam.ac.uk/%7Egk338/&quot;&gt;Gabriel Kerneis&lt;/a&gt; and Wojciech looked at some &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6109&quot;&gt;typos in ocamlbuild error messages&lt;/a&gt;, and Mike opened an &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6108&quot;&gt;issue to clarify the appropriate use of the &lt;code&gt;compiler-libs&lt;/code&gt; package&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Language&lt;/h3&gt;

&lt;p&gt;The &lt;code&gt;open&lt;/code&gt; operation on modules can make it difficult for readers of a program to see where particular names are introduced, so its use is sometimes discouraged.  The basic feature of making names available without a module prefix is rather useful, though, so various new features (including &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml-4.00/manual021.html#toc77&quot;&gt;local opens&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/ocaml/commit/f51bc04b55fbe22533f1075193dd3b2e52721f15&quot;&gt;warnings for shadowing&lt;/a&gt;, and &lt;a href=&quot;https://github.com/ocaml/ocaml/commit/a3b1c67fffd7de640ee9a0791f1fd0fad965b867&quot;&gt;explicit shadowing&lt;/a&gt;) have been introduced to tame its power. Stephen looked at adding a further feature, making it possible to open modules under a particular signature, so that &lt;code&gt;open M : S&lt;/code&gt; will introduce only those names in &lt;code&gt;M&lt;/code&gt; that are specified with &lt;code&gt;S&lt;/code&gt;.  There's an &lt;a href=&quot;https://github.com/lpw25/ocaml/tree/signatured-open&quot;&gt;initial prototype&lt;/a&gt; already, and we're looking forward to seeing the final results.&lt;/p&gt;

&lt;p&gt;The second language feature of the evening was support for infix operators (such as the List constructor, &lt;code&gt;::&lt;/code&gt;) for user-defined types, a feature that is definitely not in any way motivated by envy of Haskell.  Mike's &lt;a href=&quot;https://github.com/mcclurmc/ocaml/tree/infix-constructors&quot;&gt;prototype implementation&lt;/a&gt; is available, and there's an &lt;a href=&quot;https://github.com/mcclurmc/ocaml/pull/1&quot;&gt;additional patch&lt;/a&gt; that brings it closer to completion.&lt;/p&gt;

&lt;h3&gt;Next session&lt;/h3&gt;

&lt;p&gt;The next session is planned for 6pm on Wednesday 18th September 2013 at
&lt;a href=&quot;http://makespace.org/&quot;&gt;Makespace, Cambridge&lt;/a&gt;.  If you're planning to come along it'd be
helpful if you could add yourself to the &lt;a href=&quot;http://doodle.com/k6y2tiihkrb5vuw4&quot;&gt;Doodle Poll&lt;/a&gt;.  Hope to see
you there!&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-17T11:49:04+00:00</dc:date>
	<dc:creator>OCaml Labs</dc:creator>
</item>
<item rdf:about="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools">
	<title>Anil Madhavapeddy: Camlpdf, the first good command-line PDF tool I've found</title>
	<link>http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools.html</link>
	<content:encoded>&lt;p&gt;The fine folks at O&amp;#8217;Reilly have been proof-reading the &lt;a href=&quot;https://realworldocaml.org&quot;&gt;Real World OCaml&lt;/a&gt; book that I&amp;#8217;ve been working on. My heart leapt with joy when the copyeditor commented that she thought it was very well written, but my joy was short-lived when it turns out that all her comments were safely ensconced as PDF comments. A few hundreds comments that required a response from us, too.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&amp;#8220;No problem! MacOS X Preview can handle these!&amp;#8221;&lt;/em&gt; was of course my first response, but it turns out it&amp;#8217;s totally broken with PDF notes. The first note that you select will appear as the content of all the other subsequent notes. Yaron Minsky then experimented with Adobe Acrobat, which I&amp;#8217;ve sworn never to install again after an unfortunate incident involving the uninstaller a couple of years ago. That turned out to be incredibly slow. I tried a few open-source tools such as &lt;a href=&quot;http://en.wikipedia.org/wiki/Skim_(software)&quot;&gt;Skim&lt;/a&gt; which, while otherwise an excellent bit of software, couldn&amp;#8217;t render these particular annotations.&lt;/p&gt;
&lt;table&gt;
&lt;tr&gt;&lt;td&gt;
&lt;a href=&quot;http://anil.recoil.org/images/anil-jumping-acropolis.jpg&quot;&gt;&lt;img width=&quot;207&quot; src=&quot;http://anil.recoil.org/images/anil-jumping-acropolis-thumb.jpg&quot; /&gt;&lt;/a&gt;
&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td width=&quot;210&quot;&gt;&lt;i&gt;&lt;small&gt;I &lt;a href=&quot;http://www.theguardian.com/media/mind-your-language/2012/jan/29/literally-a-much-misused-word&quot;&gt;literally&lt;/a&gt; jumped off my seat upon discovering cpdf.&lt;/small&gt;&lt;/i&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;Meanwhile, John Whitington just announced the release of the &lt;a href=&quot;http://coherentpdf.com/blog/?p=68&quot;&gt;Coherent PDF&lt;/a&gt; command-line tools. Since these are all written in OCaml (and have been developed over quite a few years now), he also sent in an OPAM &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/pull/977&quot;&gt;pull request&lt;/a&gt; to add it to the database. And most conveniently, this ended up solving my little PDF conundrum in less than an hour of hacking, and has almost cured me of my lifelong fear of dealing with anything in a PDF-like format. Here&amp;#8217;s what I did:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;I installed the tools via &lt;code&gt;opam install cpdf&lt;/code&gt;. This installed the library but not the binary (&lt;a href=&quot;https://github.com/OCamlPro/opam-repository/pull/1100&quot;&gt;swiftly fixed&lt;/a&gt;).&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Reading the license told me that it&amp;#8217;s for non-commercial use only, so I bought a license from the &lt;a href=&quot;http://coherentpdf.com&quot;&gt;Coherent PDF&lt;/a&gt; website (a bargain price, given how much it does!).&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;I ran &lt;code&gt;cpdf -list-annotations&lt;/code&gt; over the PDF, and it dumped out all the comments as a text file to stdout. This wasn&amp;#8217;t quite enough for me, since I needed to match the annotation to a page number. But since John has released it as open-source, I forked the repository and patched the support directly into the command-line tools, and sent a &lt;a href=&quot;https://github.com/johnwhitington/cpdf-source/pull/2&quot;&gt;pull request&lt;/a&gt; back over to John. Since it&amp;#8217;s under a non-standard license, I decided to place my patch in the public domain to make it easier for him to accept it if he chooses.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;My co-authors can just run &lt;code&gt;opam pin cpdf git://github.com/avsm/cpdf-source#annotation-page-numbers&lt;/code&gt; to pin their local copy of CPDF to my forked branch in their own OPAM installations, and easily use my copy until John gets a chance to integrate my changes properly upstream.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Total time including this blog post: 40 minutes. Now, onto fixing the author responses comments for Real World OCaml now. I&amp;#8217;m so happy to have &lt;code&gt;cpdf&lt;/code&gt; as a simple, hackable PDF utility, as it does things like page combining and rotations that have always been a little flaky in other tools for me. It&amp;#8217;s the &lt;a href=&quot;http://johnmacfarlane.net/pandoc/&quot;&gt;Pandoc&lt;/a&gt; of PDFs!&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-15T23:00:00+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=153">
	<title>Heidi Howard: OCaml Development in Vim</title>
	<link>http://hh360.user.srcf.net/blog/2013/09/ocaml-development-in-vim/</link>
	<content:encoded>&lt;p&gt;This is a quick run-through of how I set up my development environment in vim:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Install pathogen.vim&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;&lt;span&gt;mkdir&lt;/span&gt; &lt;span&gt;-p&lt;/span&gt; ~&lt;span&gt;/&lt;/span&gt;.vim&lt;span&gt;/&lt;/span&gt;autoload ~&lt;span&gt;/&lt;/span&gt;.vim&lt;span&gt;/&lt;/span&gt;bundle; \
curl &lt;span&gt;-Sso&lt;/span&gt; ~&lt;span&gt;/&lt;/span&gt;.vim&lt;span&gt;/&lt;/span&gt;autoload&lt;span&gt;/&lt;/span&gt;pathogen.vim \
    https:&lt;span&gt;//&lt;/span&gt;raw.github.com&lt;span&gt;/&lt;/span&gt;tpope&lt;span&gt;/&lt;/span&gt;vim-pathogen&lt;span&gt;/&lt;/span&gt;master&lt;span&gt;/&lt;/span&gt;autoload&lt;span&gt;/&lt;/span&gt;pathogen.vim&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Add the following to ~/.vimrc:&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;vim&quot;&gt;&lt;span&gt;execute&lt;/span&gt; pathogen#infect&lt;span&gt;&amp;#40;&lt;/span&gt;&lt;span&gt;&amp;#41;&lt;/span&gt;
&lt;span&gt;syntax&lt;/span&gt; &lt;span&gt;on&lt;/span&gt;
&lt;span&gt;filetype&lt;/span&gt; &lt;span&gt;plugin&lt;/span&gt; &lt;span&gt;indent&lt;/span&gt; &lt;span&gt;on&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Install Syntastic &lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;&lt;span&gt;cd&lt;/span&gt; ~&lt;span&gt;/&lt;/span&gt;.vim&lt;span&gt;/&lt;/span&gt;bundle
&lt;span&gt;git clone&lt;/span&gt; https:&lt;span&gt;//&lt;/span&gt;github.com&lt;span&gt;/&lt;/span&gt;scrooloose&lt;span&gt;/&lt;/span&gt;syntastic.git&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Then quit vim and used :Helptags to check installs so far have worked.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Install Merlin&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;opam switch 4.01.0dev+trunk
opam update
opam upgrade
opam &lt;span&gt;install&lt;/span&gt; merlin&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Add the following to ~/.vimrc&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;vim&quot;&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt;set&lt;/span&gt; &lt;span&gt;rtp&lt;/span&gt;&lt;span&gt;+&lt;/span&gt;=&lt;span&gt;~/.&lt;/span&gt;opam&lt;span&gt;/&lt;/span&gt;4&lt;span&gt;.&lt;/span&gt;01&lt;span&gt;.&lt;/span&gt;0dev&lt;span&gt;+&lt;/span&gt;trunk&lt;span&gt;/&lt;/span&gt;share&lt;span&gt;/&lt;/span&gt;ocamlmerlin&lt;span&gt;/&lt;/span&gt;vim
&lt;span&gt;:&lt;/span&gt;&lt;span&gt;set&lt;/span&gt; &lt;span&gt;rtp&lt;/span&gt;&lt;span&gt;+&lt;/span&gt;=&lt;span&gt;~/.&lt;/span&gt;opam&lt;span&gt;/&lt;/span&gt;4&lt;span&gt;.&lt;/span&gt;01&lt;span&gt;.&lt;/span&gt;0dev&lt;span&gt;+&lt;/span&gt;trunk&lt;span&gt;/&lt;/span&gt;share&lt;span&gt;/&lt;/span&gt;ocamlmerlin&lt;span&gt;/&lt;/span&gt;vimbufsync
&lt;span&gt;let&lt;/span&gt; g&lt;span&gt;:&lt;/span&gt;syntastic_ocaml_checkers=&lt;span&gt;&amp;#91;&lt;/span&gt;&lt;span&gt;'merlin'&lt;/span&gt;&lt;span&gt;&amp;#93;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;:SyntasticInfo will return a list of syntax checkers available to Syntastic, check that this now includes merlin&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Install OCP Indent&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;opam &lt;span&gt;install&lt;/span&gt; ocp-indent&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Add the following to ~/.vimrc&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;vim&quot;&gt;&lt;span&gt;autocmd&lt;/span&gt; &lt;span&gt;FileType&lt;/span&gt; ocaml source &lt;span&gt;/&lt;/span&gt;home&lt;span&gt;/&lt;/span&gt;heidi&lt;span&gt;-&lt;/span&gt;ann&lt;span&gt;/.&lt;/span&gt;opam&lt;span&gt;/&lt;/span&gt;4&lt;span&gt;.&lt;/span&gt;01&lt;span&gt;.&lt;/span&gt;0dev&lt;span&gt;+&lt;/span&gt;trunk&lt;span&gt;/&lt;/span&gt;share&lt;span&gt;/&lt;/span&gt;typerex&lt;span&gt;/&lt;/span&gt;ocp&lt;span&gt;-&lt;/span&gt;&lt;span&gt;indent&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;ocp&lt;span&gt;-&lt;/span&gt;&lt;span&gt;indent&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;vim&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</content:encoded>
	<dc:date>2013-09-09T07:51:03+00:00</dc:date>
</item>
<item rdf:about="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging">
	<title>Anil Madhavapeddy: OCamlot--exploring the edges of OPAM packages</title>
	<link>http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html</link>
	<content:encoded>&lt;p&gt;The new release of OCaml (4.01.0) was just &lt;a href=&quot;https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html&quot;&gt;announced&lt;/a&gt;! The runup to a major release like this is normally a frantic time to test that your favourite applications don&amp;#8217;t break unexpectedly due to some incompatible language feature. This release cycle has a little different though, as we&amp;#8217;ve been working hard on using the &lt;a href=&quot;http://opam.ocamlpro.com&quot;&gt;OPAM&lt;/a&gt; package database to build an online regression testing infrastructure to mechanize much of this process.&lt;/p&gt;

&lt;p&gt;I wanted to share some of what OCamlot does today, some of the results from about 3 months worth of runs that may help OCaml package maintainers, and finally where we&amp;#8217;re going with future developments. This work has been done in collaboration with &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html&quot;&gt;David Sheets&lt;/a&gt; (who built the OCamlot daemon) and the OPAM team ably led by &lt;a href=&quot;http://gazagnaire.org&quot;&gt;Thomas Gazagnaire&lt;/a&gt; at &lt;a href=&quot;http://ocamlpro.com&quot;&gt;OCamlPro&lt;/a&gt;. We&amp;#8217;ve also had a lot of help from &lt;a href=&quot;https://github.com/diml&quot;&gt;Jeremie Dimino&lt;/a&gt; and &lt;a href=&quot;https://github.com/ysulsky&quot;&gt;Yury Sulsky&lt;/a&gt; from Jane Street and &lt;a href=&quot;http://dave.recoil.org&quot;&gt;Dave Scott&lt;/a&gt; and &lt;a href=&quot;http://jon.recoil.org&quot;&gt;Jon Ludlam&lt;/a&gt; from Citrix acting as guinea pigs for their respective regular releases of the &lt;a href=&quot;https://github.com/janestreet&quot;&gt;Core&lt;/a&gt; and &lt;a href=&quot;https://github.com/xapi-project&quot;&gt;Xen/XAPI&lt;/a&gt; releases to OPAM.&lt;/p&gt;

&lt;h2 id=&quot;towards_a_truely_portable_ocaml&quot;&gt;Towards a truely portable OCaml&lt;/h2&gt;

&lt;p&gt;The upstream OCaml toolchain is built on very UNIX-like principles, with a number of command-line tools that form a build pipeline. This process usually ends with linking the intermediate object files with a &lt;a href=&quot;https://github.com/ocaml/ocaml/tree/trunk/byterun&quot;&gt;runtime library&lt;/a&gt; that provides the garbage collector and other intrinsic OS functions.&lt;/p&gt;

&lt;p&gt;Given these raw compiler tools, it&amp;#8217;s very easy to compile OCaml into all sorts of weird and wonderful architectures. We&amp;#8217;ve seen it run on &lt;a href=&quot;http://www.algo-prog.info/ocaml_for_pic/web/index.php&quot;&gt;8-bit PICs&lt;/a&gt;, several efficient Javascript backends (originally &lt;a href=&quot;http://jaked.github.io/ocamljs/&quot;&gt;ocamljs&lt;/a&gt; and more recently &lt;a href=&quot;http://ocsigen.org/js_of_ocaml&quot;&gt;js_of_ocaml&lt;/a&gt;), and of course my own &lt;a href=&quot;http://openmirage.org&quot;&gt;Mirage&lt;/a&gt; Xen unikernel.&lt;/p&gt;

&lt;p&gt;While the compiler tools themselves are quite portable and work on almost any UNIX-like system, the build system scaffolding around third-party packages is less portable. Some features such as C bindings often contribute to build breakage on some less-used operating systems such as FreeBSD or OpenBSD, as they usually require probing for header file locations or adding custom &lt;code&gt;CFLAGS&lt;/code&gt; before building.&lt;/p&gt;
&lt;table align=&quot;center&quot; width=&quot;90%&quot;&gt;
&lt;tr&gt;
&lt;td width=&quot;30%&quot; class=&quot;bimg&quot;&gt;&lt;a href=&quot;http://anil.recoil.org/images/dreamplug-nest-1.jpg&quot;&gt;&lt;img border=&quot;0&quot; width=&quot;200&quot; src=&quot;http://anil.recoil.org/images/dreamplug-nest-1-thumb.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Every Internet of Things starts with a tangled pile of ARM Dreamplugs.&lt;/td&gt;
&lt;td width=&quot;30%&quot; class=&quot;bimg&quot;&gt;&lt;a href=&quot;http://anil.recoil.org/images/sparc-macppc-openbsd-1.jpg&quot;&gt;&lt;img border=&quot;0&quot; width=&quot;200&quot; src=&quot;http://anil.recoil.org/images/sparc-macppc-openbsd-1-thumb.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;And in our server room, venerable Sparc and PowerPC G4 OpenBSD boxen still live.&lt;/td&gt;
&lt;td width=&quot;30%&quot; class=&quot;bimg&quot;&gt;&lt;a href=&quot;http://anil.recoil.org/images/macppc-desktop-1.jpg&quot;&gt;&lt;img border=&quot;0&quot; width=&quot;200&quot; src=&quot;http://anil.recoil.org/images/macppc-desktop-1-thumb.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Finding older machines is getting tough, but here's &lt;a href=&quot;http://dave.recoil.org&quot;&gt;Dave's&lt;/a&gt; old iMac G5 running Linux.&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;Most OCaml developers use x86-based machines and so foreign architectures also get less day-to-day testing (OCaml has superb support for fast native code compilation on ARM, PowerPC, Sparc32, and we&amp;#8217;re working on MIPS64 here as part of the &lt;a href=&quot;http://www.cl.cam.ac.uk/research/security/ctsrd/cheri.html&quot;&gt;CHERI&lt;/a&gt; project).&lt;/p&gt;

&lt;p&gt;We want to make sure that OCaml and its package ecosystem works just as well in the embedded ecosystem as well as it does on vanilla x86 Linux. This includes running on my Linux iMac G5, my &lt;a href=&quot;https://wiki.freebsd.org/FreeBSD/arm/Raspberry%20Pi&quot;&gt;FreeBSD Raspberry Pi&lt;/a&gt;, my &lt;a href=&quot;http://www.openbsd.org/beagle.html&quot;&gt;OpenBSD Pandaboard&lt;/a&gt;, or even on a bytecode-only architecture like an &lt;a href=&quot;http://www.openbsd.org/sparc64.html&quot;&gt;OpenBSD/Sparc64&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In the longer term, this paves the way to reliable cross-compiled packages for Windows, &lt;a href=&quot;https://github.com/vouillon/ocaml-android&quot;&gt;Android&lt;/a&gt; and &lt;a href=&quot;http://psellos.com/ocaml/compile-to-iphone.html&quot;&gt;iPhone&lt;/a&gt; (all of which have OCaml ports, but aren&amp;#8217;t heavily tested with the full package database). The only practical way to get started on this is by building an automated test infrastructure for OCaml that explores the feature matrix (which eerily for me, happened in the early days of Xen too, via &lt;a href=&quot;http://blogs.citrix.com/2013/08/30/xenserver-automated-testing-and-lab-orchestration-introducing-xenrt/&quot;&gt;XenRT&lt;/a&gt; to stabilize the hypervisor).&lt;/p&gt;

&lt;h3 id=&quot;why_not_jenkins_or_travis&quot;&gt;Why not Jenkins or Travis?&lt;/h3&gt;

&lt;p&gt;When we first started hacking on the OPAM testing infrastructure earlier this year, I maintained a local &lt;a href=&quot;http://jenkins-ci.org&quot;&gt;Jenkins&lt;/a&gt; installation that monitored the repository. While Jenkins is a superb tool for many continuous integration tasks, it fell over badly when trying to use it on the non-x86 and non-Linux (or Windows) operating systems. Jenkins requires a full Java runtime stack to be available on each of the client machines, which was taking up more time to get up and running than a simple OCaml-based client and server that could compile to both portable bytecode or fast native code.&lt;/p&gt;

&lt;p&gt;The other difficulty with OPAM is selecting which packages actually need to be tested, as it has a constraint-based package solver that supports expressive forwards and backwards version restrictions. While basic tests of the latest packages worked with Jenkins, we needed to increasingly customize it to automate interfacing directly with the OPAM libraries and calculating test schedules based on incoming change requests.&lt;/p&gt;

&lt;p&gt;Another factor that ruled out depending on hosted services such as &lt;a href=&quot;https://travis-ci.org&quot;&gt;Travis&lt;/a&gt; is that they tend to support x86-only architectures, whereas we really want to test the full spectrum of CPU variants supported by OCaml. This doesn&amp;#8217;t mean that there&amp;#8217;s no place for Travis of course, and in fact Mike Lin has already &lt;a href=&quot;http://blog.mlin.net/2013/02/testing-ocaml-projects-on-travis-ci.html&quot;&gt;made this work&lt;/a&gt; with OPAM.&lt;/p&gt;

&lt;p&gt;For our full testing needs though, &lt;a href=&quot;https://github.com/ocamllabs/ocamlot&quot;&gt;OCamlot&lt;/a&gt; was born: an OCaml client and server system which coordinates different versions of the compiler, architectures and OPAM versions and records the results for triage and fixing issues.&lt;/p&gt;

&lt;h3 id=&quot;running_ocamlot&quot;&gt;Running OCamlot&lt;/h3&gt;

&lt;p&gt;The latest alpha release of OCamlot is pretty straightforward to run locally, if you are so inclined. First start a server process:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git clone git://github.com/ocamllabs/ocamlot
$ cd ocamlot
$ ./install_deps.sh
$ oasis setup
# (edit lib/config.ml if you need to change ports)
$ make
$ ./_build/lib/ocamlot_cmd.native --help
$ ./_build/lib/ocamlot_cmd.native serve&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The server listens on localhost only by default, and normally an SSL-to-TCP proxy is deployed to listen for external connections (I use &lt;a href=&quot;https://github.com/bumptech/stud&quot;&gt;stud&lt;/a&gt;, which is fast and easy to configure).&lt;/p&gt;

&lt;p&gt;The OCamlot clients require a local compilation of OCaml, and they autodetect their local CPU architecture and operating system. I&amp;#8217;ve put a &lt;a href=&quot;https://gist.github.com/avsm/6393649&quot;&gt;gist script&lt;/a&gt; together that automates this on most Linux and BSD variants. Just customize the top variables (set &lt;code&gt;MAKE&lt;/code&gt; to &lt;code&gt;gmake&lt;/code&gt; under BSD) and set the hostname to your server process.&lt;/p&gt;

&lt;h3 id=&quot;the_results_repository_and_autotriage&quot;&gt;The results repository and auto-triage&lt;/h3&gt;

&lt;p&gt;Once the client is running, the server dispatches tasks from its test matrix, which is calculated from the OPAM package repository. The server maintains a &lt;a href=&quot;https://github.com/ocamlot/ocamlot-state&quot;&gt;results repository&lt;/a&gt;, which is a Git filesystem database that records the build results and logs via an s-expression per task. It also uses &lt;a href=&quot;https://github.com/mirage/ocaml-cohttp&quot;&gt;Cohttp&lt;/a&gt; to serve up the results for a web browser.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s very convenient using Git repositories like this since we can use GitHub (or any other Git host) to coordinate and record results, and restart the server without needing any local state. So convenient, in fact, that Thomas and I have been working on a more formal engine for this called &lt;a href=&quot;https://github.com/samoht/irminsule&quot;&gt;Irminsule&lt;/a&gt; (more on that in a later post, though).&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s almost unheard of to have a full OCamlot run go by without some errors, and so David put together the &lt;code&gt;ocamlot triage&lt;/code&gt; command. This takes the state repository and runs a set of regular expressions over it to classify them into common errors. The full file is &lt;a href=&quot;https://github.com/ocamllabs/ocamlot/blob/master/lib/result.ml&quot;&gt;here&lt;/a&gt;, but an excerpt should give you an idea of what we look for:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;	&lt;span class=&quot;c&quot;&gt;(* ordered minor to severe *)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;analysis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Solver&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solver_error&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Dep&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;analysis&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Transient&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;transient_error&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;System&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;system_error&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Meta&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meta_error&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Ext_dep&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ext_dep_error&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Build&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;build_error&lt;/span&gt;
	  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Multiple&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;analysis&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;list&lt;/span&gt;
	    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sexp&lt;/span&gt;
	
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The errors are ordered by severity to aid in color highlighting. They start with OPAM solver failures and dependency failures (e.g. due to trying to build a package that requires a specific OCaml version that isn&amp;#8217;t available), and move onto missing package dependencies or system libraris.&lt;/p&gt;

&lt;h2 id=&quot;testing_the_run_up_to_ocaml_401&quot;&gt;Testing the run up to OCaml 4.01&lt;/h2&gt;

&lt;p&gt;Of course, running all these tests is useless without taking action on the results. I&amp;#8217;ve been keeping track of them in &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/issues/1029&quot;&gt;issue #1029&lt;/a&gt;. The nice thing about GitHub issues is that when this bug is referenced in commits (even in other repositories) a cross-reference shows up on that webpage and lets everything be tracked nicely.&lt;/p&gt;

&lt;p&gt;So what were the most common failures in the runup to 4.01, and what should you avoid when writing your own code?&lt;/p&gt;

&lt;h3 id=&quot;different_standard_library_module_signatures&quot;&gt;Different standard library module signatures&lt;/h3&gt;

&lt;p&gt;There have been a few changes to some of the functor signatures in the standard library, such as adding a &lt;code&gt;find&lt;/code&gt; function to Set (&lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=5864&quot;&gt;mantis #5864&lt;/a&gt;). A third-party library that tries to match the functor signature will fail to compile with a type error, such as this one below for &lt;a href=&quot;http://anil.recoil.org/feeds/atom-ocaml.xml&quot;&gt;zipperposition.0.2&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Error: The implementation src/ptset.ml
       does not match the interface src/ptset.cmi:
       ...
       In module Big:
       The field `find' is required but not provided&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The relevant code in &lt;code&gt;zipperposition&lt;/code&gt; makes it clear what the problem is:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;	&lt;span class=&quot;c&quot;&gt;(* Big-endian Patricia trees *)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Big&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sig&lt;/span&gt;
	  &lt;span class=&quot;k&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
	  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;intersect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
	
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This particular bug was &lt;a href=&quot;https://github.com/c-cube/zipperposition/issues/1&quot;&gt;reported upstream&lt;/a&gt;, and the fix requires implementing the &lt;code&gt;find&lt;/code&gt; function for the Patricia-tree-based &lt;code&gt;Set&lt;/code&gt;. Since the OPAM package will always be broken on OCaml 4.01, it was marked with a &lt;a href=&quot;https://github.com/ocamlpro/opam-repository/commit/e45530205987f67d4316a958446d3dcc954b19ec&quot;&gt;compiler version constraint&lt;/a&gt; to prevent it being selected for installation under that compiler. When a new version with the fix is uploaded to OPAM, it will always be selected in preference to this broken one.&lt;/p&gt;

&lt;p&gt;One other 4.01 change that temporarily broke most of the bigger networking libraries such as &lt;a href=&quot;https://github.com/janestreet/core&quot;&gt;Core&lt;/a&gt;, &lt;a href=&quot;https://ocsigen.org/lwt&quot;&gt;Lwt&lt;/a&gt; and &lt;a href=&quot;http://batteries.forge.ocamlcore.org&quot;&gt;Batteries&lt;/a&gt; was the addition of the &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=5568&quot;&gt;close-on-exec&lt;/a&gt; flag to the &lt;code&gt;Unix&lt;/code&gt; module. This change only affects upstream packages that redefine the UNIX module for their own purposes (such as adding an asynchronous I/O monad as Lwt does), hence it affects the standard library replacement packages.&lt;/p&gt;

&lt;p&gt;The fix here was to locally add patches into the relevant OPAM packages to immediately unbreak things when the fix when into the 4.01 branch of the compiler, and notify upstream maintainers to release new versions of their projects. There&amp;#8217;s a subtle problem here: when a patch such as this goes into an unreleased branch of the compiler (such as &lt;code&gt;4.01.0dev&lt;/code&gt;), it&amp;#8217;s hard to reliably detect if the user has got the very latest version of the compiler or not. If you do have problems like this in the future, try recompiling via &lt;code&gt;opam switch reinstall &amp;lt;version&amp;gt;&lt;/code&gt; to the latest branch.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s very useful to be able to drop in bleeding-edge compiler tools into the OPAM repository using compiler constraints like this. For an example, see Alain Frisch&amp;#8217;s &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/blob/master/packages/ppx_tools.0.1/opam&quot;&gt;ppx_tools&lt;/a&gt;, that require the very latest 4.02dev trunk release to compile his new extension-points feature.&lt;/p&gt;

&lt;h3 id=&quot;multiple_object_definitions&quot;&gt;Multiple object definitions&lt;/h3&gt;

&lt;p&gt;OCaml 4.01 also restricts multiple method definitions with the same name in the same object. This leaves only inheritance as the way to override method names, but some packages such as OCamlnet and Mlorg had minor uses of the old mechanism.&lt;/p&gt;

&lt;p&gt;You can see this by using &lt;code&gt;opam switch&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ opam switch 4.00.1
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
- : &amp;lt; x : int &amp;gt; = &amp;lt;obj&amp;gt;
$ opam switch 4.01.0
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
Error: The method `x' has multiple definitions in this object&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;new_warnings_and_the_dreaded_warningsaserrors&quot;&gt;New warnings, and the dreaded warnings-as-errors&lt;/h3&gt;

&lt;p&gt;After a decade of being deprecated, the &lt;code&gt;(or)&lt;/code&gt; and &lt;code&gt;(&amp;amp;)&lt;/code&gt; operators finally had a warning turned on by default.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ocaml
# true or false;;
Warning 3: deprecated feature: operator (or); you should use (||) instead
- : bool = true&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This wouldn&amp;#8217;t normally be so bad, except that a surprising number of released packages also turn warnings into fatal errors (by using the &lt;code&gt;-w @&lt;/code&gt; flags explained in the &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml/comp.html&quot;&gt;manual&lt;/a&gt;). Warnings-as-errors is extremely useful when &lt;em&gt;developing&lt;/em&gt; code but is rather harmful in released code, since a future compiler can choose to emit new warnings that aren&amp;#8217;t necessarily fatal bugs.&lt;/p&gt;

&lt;p&gt;Packages that failed like this include ocamlgraph, spotlib, quickcheck, OPA, Lablgtk-extras and many more. Please do make an effort to not leave this option turned on in your packages, or else it makes life more difficult for testing your code on bleeding edge versions of the compiler in the future.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s worth noting here that OCaml 4.01 has introduced a fair number of new and very useful warnings across a number of areas, mainly to do with detecting unexpected ambiguation or shadowing of values. I&amp;#8217;ll cover more on these in a future post about the new 4.01 goodies.&lt;/p&gt;

&lt;h3 id=&quot;external_system_dependencies&quot;&gt;External system dependencies&lt;/h3&gt;

&lt;p&gt;While there any many packages in OPAM that are pure OCaml, there are also a substantial number that require other system tools to be installed. The Lablgtk GUI library obviously requires the C &lt;code&gt;gtk&lt;/code&gt; library to be installed.&lt;/p&gt;

&lt;p&gt;Determining if these libraries are installed on a particular OS is well beyond the scope of OPAM, as there are almost as many package managers as there are operating systems. However, it&amp;#8217;s important for automated testing and user-friendly error messages to have some notion of detecting if the environment is ready for the OCaml package or not.&lt;/p&gt;

&lt;p&gt;We&amp;#8217;re solving this by using a &lt;code&gt;depexts&lt;/code&gt; field in OPAM that consists of a set of tags that identify OS-specific packages that need to be present. A separate script can query these tags from OPAM and do the OS-specific tests or installation.&lt;/p&gt;

&lt;p&gt;For example, here&amp;#8217;s the &lt;code&gt;sqlite3-ocaml&lt;/code&gt; OPAM description:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;opam-version: &amp;quot;1&amp;quot;
maintainer: &amp;quot;markus.mottl@gmail.com&amp;quot;
build: [
  [&amp;quot;ocaml&amp;quot; &amp;quot;setup.ml&amp;quot; &amp;quot;-configure&amp;quot;]
  [&amp;quot;ocaml&amp;quot; &amp;quot;setup.ml&amp;quot; &amp;quot;-build&amp;quot;]
  [&amp;quot;ocaml&amp;quot; &amp;quot;setup.ml&amp;quot; &amp;quot;-install&amp;quot;]
]
remove: [ [&amp;quot;ocamlfind&amp;quot; &amp;quot;remove&amp;quot; &amp;quot;sqlite3&amp;quot;] ]
depends: [&amp;quot;ocamlfind&amp;quot;]
depexts: [
  [ [&amp;quot;debian&amp;quot;  ] [ &amp;quot;libsqlite3-dev&amp;quot;]    ]
  [ [&amp;quot;freebsd&amp;quot; ] [ &amp;quot;database/sqlite3&amp;quot;]  ]
  [ [&amp;quot;openbsd&amp;quot; ] [ &amp;quot;database/sqlite3&amp;quot;]  ]
]&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;depexts&lt;/code&gt; field here lists APT package for Debian, and the ports tree locations for FreeBSD and OpenBSD. It could also list more specialised tags for particular versions of an OS. You can query this from OPAM as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ opam install -e debian sqlite3-ocaml
libsqlite3-dev
$ opam install -e openbsd sqlite3-ocaml
database/sqlite3&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;OCamlot therefore needs to query the &lt;code&gt;depexts&lt;/code&gt; field from the package and run the right &lt;code&gt;apt&lt;/code&gt; or &lt;code&gt;pkg_add&lt;/code&gt; commands. I&amp;#8217;ll write about this in more detail when it&amp;#8217;s fully baked, as we&amp;#8217;ve modified the semantics of the tag querying between OPAM 1.0 and OPAM 1.1 to make it easier to use in OCamlot.&lt;/p&gt;

&lt;h3 id=&quot;portable_shell_scripts&quot;&gt;Portable shell scripts&lt;/h3&gt;

&lt;p&gt;Once we&amp;#8217;ve gotten past the hurdle of the compiler version causing failures, there is the small matter of testing non-Linux operating systems, as well as non-x86 CPU architectures. The &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/issues/1029&quot;&gt;#1029 overview&lt;/a&gt; lists many of these failures under the Portability section.&lt;/p&gt;
&lt;a href=&quot;http://www.openbsd.org&quot;&gt;&lt;img src=&quot;http://anil.recoil.org/images/ppuf200X181.gif&quot; /&gt;&lt;/a&gt;
&lt;p&gt;Damien Doligez made some excellent points about how to write &lt;a href=&quot;http://gallium.inria.fr/blog/portable-conditionals-in-makefiles/&quot;&gt;portable Makefiles&lt;/a&gt; that works across both GNU and BSD makes. This is why the carefully crafted OCaml Makefiles do not require GNU make to be installed when compiling on FreeBSD or OpenBSD (MacOS X gave up the fight a long time ago and installs GNU make as its default &lt;code&gt;make&lt;/code&gt; command).&lt;/p&gt;

&lt;p&gt;OPAM tries to help out BSD by providing a &lt;code&gt;make&lt;/code&gt; macro in &lt;code&gt;opam&lt;/code&gt; files that is substituted with either &lt;code&gt;&amp;quot;make&amp;quot;&lt;/code&gt; (by default) or &lt;code&gt;&amp;quot;gmake&amp;quot;&lt;/code&gt; (for BSD). While this works for for the toplevel invocation of the Makefile, it fails if the Makefile recursively invokes further targets without using the &lt;code&gt;$(MAKE)&lt;/code&gt; variable instead of directly calling the command. Patching these sorts of things is easy but tedious: see the &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/blob/master/packages/facile.1.1/files/bsdmake.patch&quot;&gt;patchfile&lt;/a&gt; for the Facile constraint programming library for an example.&lt;/p&gt;

&lt;p&gt;The real problem here, of course, is that package maintainers cannot be reasonably expected to test their code on systems that they don&amp;#8217;t normally use&amp;#8211;if we demanded perfect portability to be present in the main OPAM repository, we would&amp;#8217;t get any submissions!&lt;/p&gt;

&lt;p&gt;OCamlot automates this nicely though, by finding lots of portability bugs automatically, and maintainers are by-and-large very responsive when we report the problem upstream.&lt;/p&gt;

&lt;h2 id=&quot;the_emerging_distributed_workflow&quot;&gt;The emerging distributed workflow&lt;/h2&gt;

&lt;p&gt;The big drawback to OCamlot in its current form is the amount of triage effort it puts on the OPAM maintainers. The package database has now exceeded 500 packages in just a short few months, and has over 1500 unique versions that all need build testing and more accurate constraints. The wider community has been &lt;em&gt;really&lt;/em&gt; keen to participate in helping with triage (just look at all the other people that leapt in on &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/issues/1029&quot;&gt;bug #1029&lt;/a&gt;), so its our immediate priority to make OCamlot more transparent for people that want to use it to improve their own packages, and in the future also use it to test various hypotheses about all the available open-source OCaml code (see Jacques&amp;#8217; experiment with &lt;a href=&quot;http://gallium.inria.fr/blog/monomorphic_let/&quot;&gt;monomorphic let&lt;/a&gt; as an example of something that can benefit from wider automated compilation).&lt;/p&gt;

&lt;p&gt;I&amp;#8217;ll talk more about how we&amp;#8217;re solving this in my upcoming &lt;a href=&quot;http://ocaml.org/meetings/ocaml/2013/&quot;&gt;OCaml 2013 Workshop&lt;/a&gt; talk about the Platform. I don&amp;#8217;t want spoil it too much, but it involves a lovely distributed Git workflow, an enhanced &lt;a href=&quot;https://github.com/OCamlPro/opam2web&quot;&gt;opam2web&lt;/a&gt;, and a brand new metadata overlay system for OPAM that lets us enhance the package database with extra information such as statistics, portability and test results, but without polluting the main Git repository with all this extra non-essential data.&lt;/p&gt;

&lt;p&gt;If you&amp;#8217;re really curious to know right now, then you can see the outline of the new system at Amir&amp;#8217;s &lt;a href=&quot;http://amirchaudhry.com/wireframe-demos-for-ocamlorg/&quot;&gt;new ocaml.org wireframes&lt;/a&gt; blog post, where Part III contains the continuous integration workflow. A lot of infrastructure work has gone into building all of this over the summer, and now it&amp;#8217;s all starting to be deployed in a very satisfying way&amp;#8230;&lt;/p&gt;</content:encoded>
	<dc:date>2013-09-08T23:00:00+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=25">
	<title>Heidi Howard: ICFP, CUFP &amp; OCaml2013</title>
	<link>http://hh360.user.srcf.net/blog/2013/08/icfp-cufp-ocaml2013/</link>
	<content:encoded>&lt;p&gt;I&amp;#8217;m busy planning my first trip across the Atlantic to attend ICFP, CUFP and OCaml 2013. Today, I&amp;#8217;ve been given the duty of &amp;#8220;live blogging&amp;#8221; the event, over at the &lt;a title=&quot;syslog&quot; href=&quot;http://www.syslog.cl.cam.ac.uk/&quot;&gt;syslog&lt;/a&gt;, the Cambridge Systems Research Group blog.&lt;/p&gt;
&lt;p&gt;My other job for the event is to improve the documentation for &lt;a href=&quot;http://janestreet.github.io/guide-async.html&quot;&gt;Janestreet&amp;#8217;s Async&lt;/a&gt; library. if anyone else is keen, I would love to organise a doc-a-thon to populate the .mli files&lt;/p&gt;</content:encoded>
	<dc:date>2013-08-28T20:05:23+00:00</dc:date>
</item>
<item rdf:about="http://openmirage.org/blog/introducing-vchan">
	<title>MirageOS: Introducing vchan</title>
	<link>http://openmirage.org/blog/introducing-vchan</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;&lt;b&gt;In Theory&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Unless you are familiar with Xen's source code, there is little chance that you've ever heard of the &lt;b&gt;vchan&lt;/b&gt; library or protocol. Documentation about it is very scarce: a description can be found on vchan's &lt;a href=&quot;http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=xen/include/public/io/libxenvchan.h;hb=HEAD&quot;&gt;public header file&lt;/a&gt;, that I quote here for convenience:&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;Originally borrowed from the &lt;a href=&quot;http://www.qubes-os.org&quot;&gt;Qubes OS Project&lt;/a&gt;, this code (i.e. libvchan) has been substantially rewritten [...] This is a library for inter-domain communication.  A standard Xen ring buffer is used, with a datagram-based interface built on top.  The grant reference and event channels are shared in XenStore under a user-specified path.&lt;/p&gt; &lt;/blockquote&gt;&lt;p&gt;This protocol uses shared memory for inter-domain communication, i.e. between two VMs residing in the same Xen host, and uses Xen's mechanisms -- more specifically, &lt;a href=&quot;http://www.informit.com/articles/article.aspx?p=1160234&amp;seqNum=3&quot;&gt;ring buffers&lt;/a&gt; and &lt;a href=&quot;http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=tools/libxc/xenctrl.h;h=f2cebafc9ddd4815ffc73fcf9e0d292b1d4c91ff;hb=HEAD#l934&quot;&gt;event channels&lt;/a&gt; -- in order to achieve its aims. &lt;b&gt;Datagram-based interface&lt;/b&gt; simply means that the &lt;a href=&quot;http://xenbits.xen.org/gitweb/?p=xen.git;a=blob;f=tools/libvchan/libxenvchan.h;h=6365d36a06f8c8f56454724cefc4c2f1d39beba2;hb=HEAD&quot;&gt;interface&lt;/a&gt; resembles UDP, although there is support for stream based communication (like TCP) as well.&lt;/p&gt;&lt;p&gt;Over the last two months or so, I worked on a &lt;a href=&quot;http://github.com/mirage/ocaml-vchan&quot;&gt;pure OCaml implementation&lt;/a&gt; of this library, meaning that Mirage-based unikernels can now take full advantage of &lt;b&gt;vchan&lt;/b&gt; to communicate with neighboring VMs! If your endpoint -- a Linux VM or another unikernel -- is on the same host, it is much faster and more efficient to use vchan rather than the network stack (although unfortunately, it is currently incompatible with existing programs written against the &lt;code&gt;socket&lt;/code&gt; library under UNIX or the &lt;code&gt;Flow&lt;/code&gt; module of Mirage, although this will improve). It also provides a higher level of security compared to network sockets as messages will never leave the host's shared memory.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Building the vchan echo domain&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Provided that you have a Xen-enabled machine, do the following from dom0:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;opam install mirari mirage-xen mirage vchan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This will install the library and its dependencies. &lt;code&gt;mirari&lt;/code&gt; is necessary to build the &lt;b&gt;echo unikernel&lt;/b&gt;:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;git clone git&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt;//github.com/mirage/ocaml-vchan
cd test
mirari configure --xen --no-install
mirari build --xen
sudo mirari run --xen
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This will boot a &lt;code&gt;vchan echo domain&lt;/code&gt; for dom0, with connection parameters stored in xenstore at &lt;code&gt;/local/domain/&amp;lt;domid&amp;gt;/data/vchan&lt;/code&gt;, where &lt;code&gt;&amp;lt;domid&amp;gt;&lt;/code&gt; is the domain id of the vchan echo domain. The echo domain is simply an unikernel hosting a vchan server accepting connections from dom0, and echo'ing everything that is sent to it.&lt;/p&gt;&lt;p&gt;The command &lt;code&gt;xl list&lt;/code&gt; will give you the domain id of the echo server.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Building the vchan CLI from Xen's sources&lt;/b&gt;&lt;/p&gt;&lt;p&gt;You can try it using a vchan client that can be found in Xen's sources at &lt;code&gt;tools/libvchan&lt;/code&gt;: Just type &lt;code&gt;make&lt;/code&gt; in this directory. It will compile the executable &lt;code&gt;vchan-node2&lt;/code&gt; that you can use to connect to our freshly created echo domain:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;./vchan-node2 client &lt;span class=&quot;keyword2&quot;&gt;&amp;lt;&lt;/span&gt;domid&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt;/local/domain/&lt;span class=&quot;keyword2&quot;&gt;&amp;lt;&lt;/span&gt;domid&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt;/data/vchan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If everything goes well, what you type in there will be echoed.&lt;/p&gt;&lt;p&gt;You can obtain the full API documentation for &lt;b&gt;ocaml-vchan&lt;/b&gt; by doing a &lt;code&gt;cd ocaml-vchan &amp;amp;&amp;amp; make doc&lt;/code&gt;. If you are doing network programming under UNIX, vchan's interface will not surprise you. If you are already using vchan for a C project, you will see that the OCaml API is nearly identical to what you are used to.&lt;/p&gt;&lt;p&gt;Please let us know if you use or plan to use this library in any way! If you need tremedous speed or more security, this might fit your needs.&lt;/p&gt; 
   &lt;/div&gt;</content:encoded>
	<dc:date>2013-08-23T17:43:00+00:00</dc:date>
	<dc:creator>Vincent Bernardoff</dc:creator>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=86">
	<title>Heidi Howard: Real World OCaml beta3 release</title>
	<link>http://hh360.user.srcf.net/blog/2013/08/real-world-ocaml-beta3-release/</link>
	<content:encoded>&lt;p&gt;Beta3 of RWO is now available: &lt;a href=&quot;https://realworldocaml.org/&quot;&gt;https://realworldocaml.org/&lt;/a&gt; and anil (one of the co-authors) comments on the release &lt;a href=&quot;http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html&quot;&gt;http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;wp-caption aligncenter&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://realworldocaml.org/media/img/oreilly-cover.gif&quot; width=&quot;180&quot; height=&quot;236&quot; /&gt;&lt;p class=&quot;wp-caption-text&quot;&gt;Cover of RWO&lt;/p&gt;&lt;/div&gt;</content:encoded>
	<dc:date>2013-08-19T10:39:34+00:00</dc:date>
</item>
<item rdf:about="http://openmirage.org/blog/oscon13-trip-report">
	<title>MirageOS: Mirage travels to OSCON'13: a trip report</title>
	<link>http://openmirage.org/blog/oscon13-trip-report</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;Now that Mirage OS is rapidly converging on a &lt;a href=&quot;http://github.com/avsm/mirage/issues/102&quot;&gt;Developer Preview Release 1&lt;/a&gt;, we took it for a first public outing at &lt;a href=&quot;http://www.oscon.com/oscon2013/&quot;&gt;OSCON'13&lt;/a&gt;, the O'Reilly Open Source Conference. OSCON is in its 15th year now, and is a meeting place for developers, business people and investors. It was a great opportunity to show MirageOS off to some of the movers and shakers in the OSS world.&lt;/p&gt;&lt;p&gt;Partly because MirageOS is about synthesising extremely specialised guest kernels from high-level code, and partly because both Anil and I are constitutionally incapable of taking the easy way out, we self-hosted the slide deck on Mirage: after some last-minute hacking -- on content not Mirage I should add! -- we built a self-contained microkernel of the talk.&lt;/p&gt;&lt;p&gt;This was what you might call a &quot;full stack&quot; presentation: the custom microkernel (flawlessly!) ran a type-safe &lt;a href=&quot;https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml&quot;&gt;network device driver&lt;/a&gt;, OCaml &lt;a href=&quot;http://github.com/mirage/mirage-net&quot;&gt;TCP/IP stack&lt;/a&gt; supporting an OCaml &lt;a href=&quot;http://github.com/mirage/ocaml-cohttp&quot;&gt;HTTP&lt;/a&gt; framework that served slides rendered using &lt;a href=&quot;http://lab.hakim.se/reveal-js/&quot;&gt;reveal.js&lt;/a&gt;. The slide deck, including the turbo-boosted &lt;a href=&quot;http://www.youtube.com/watch?v=2Mx8Bd5JYyo&quot;&gt;screencast&lt;/a&gt; of the slide deck compilation, is hosted as another MirageOS virtual machine at &lt;a href=&quot;http://decks.openmirage.org/&quot;&gt;decks.openmirage.org&lt;/a&gt;. We hope to add more slide decks there soon, including resurrecting the tutorial! The source code for all this is in the &lt;a href=&quot;http://github.com/mirage/mirage-decks&quot;&gt;mirage-decks&lt;/a&gt; GitHub repo.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;h3-TheTalk&quot; class=&quot;anchor-toc&quot;&gt; The Talk&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The talk went down pretty well -- given we were in a graveyard slot on Friday after many people had left, attendance was fairly high (around 30-40), and the &lt;a href=&quot;http://www.oscon.com/oscon2013/public/schedule/detail/28956&quot;&gt;feedback scores&lt;/a&gt; have been positive (averaging 4.7/5) with comments including &quot;excellent content and well done&quot; and &quot;one of the most excited projects I heard about&quot; (though we are suspicious that just refers to Anil's usual high-energy presentation style...).&lt;/p&gt;&lt;p&gt; &lt;/p&gt;&lt;p&gt;Probably the most interesting chat after the talk was with the Rust authors at Mozilla (&lt;a href=&quot;http://twitter.com/pcwalton&quot;&gt;@pcwalton&lt;/a&gt; and &lt;a href=&quot;https://github.com/brson&quot;&gt;@brson&lt;/a&gt;) about combining the Mirage &lt;a href=&quot;http://anil.recoil.org/papers/2013-asplos-mirage.pdf&quot;&gt;unikernel&lt;/a&gt; techniques with the &lt;a href=&quot;http://www.rust-lang.org&quot;&gt;Rust&lt;/a&gt; runtime. But perhaps the most surprising feedback was when Anil and I were stopped in the street while walking back from some well-earned sushi, by a cyclist who loudly declared that he'd really enjoyed the talk and thought it was a really exciting project -- never done something that achieved public acclaim from the streets before :)&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;h3-BookSigningandXen.org&quot; class=&quot;anchor-toc&quot;&gt; Book Signing and Xen.org&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Anil also took some time to sit in a book signing for his forthcoming &lt;a href=&quot;http://realworldocaml.org&quot;&gt;Real World OCaml&lt;/a&gt; O'Reilly book.  This is really important to making OCaml easier to learn, especially given that all the Mirage libraries are using it.  Most of the dev team (and especially thanks to &lt;a href=&quot;https://twitter.com/heidiann360&quot;&gt;Heidi Howard&lt;/a&gt; who bravely worked through really early alpha revisions) have been giving us feedback as the book is written, using the online commenting system.&lt;/p&gt;&lt;p&gt;The Xen.org booth was also huge, and we spent quite a while plotting the forthcoming Mirage/Xen/ARM backend. We're pretty much just waiting for the &lt;a href=&quot;http://cubieboard.org&quot;&gt;Cubieboard2&lt;/a&gt; kernel patches to be upstreamed (keep an eye &lt;a href=&quot;http://linux-sunxi.org/Main_Page&quot;&gt;here&lt;/a&gt;) so that we can boot Xen/ARM VMs on tiny ARM devices.  There's a full report about this on the &lt;a href=&quot;http://blog.xen.org/index.php/2013/07/31/the-xen-project-at-oscon/&quot;&gt;xen.org&lt;/a&gt; blog post about OSCon.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;h3-GaloisandHalVM&quot; class=&quot;anchor-toc&quot;&gt; Galois and HalVM&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;We also stopped by the &lt;a href=&quot;http://corp.galois.com&quot;&gt;Galois&lt;/a&gt; to chat with &lt;a href=&quot;https://twitter.com/acwpdx&quot;&gt;Adam Wick&lt;/a&gt;, who is the leader of the &lt;a href=&quot;http://corp.galois.com/halvm&quot;&gt;HalVM&lt;/a&gt; project at Galois. This is a similar project to Mirage, but, since it's written in Haskell, has more of a focus on elegant compositional semantics rather than the more brutal performance and predictability that Mirage currently has at its lower levels.&lt;/p&gt;&lt;p&gt;The future of all this ultimately lies in making it easier for these multi-lingual unikernels to be managed and for all of them to communicate more easily, so we chatted about code sharing and common protocols (such as &lt;a href=&quot;https://github.com/vbmithr/ocaml-vchan&quot;&gt;vchan&lt;/a&gt;) to help interoperability. Expect to see more of this once our respective implementations get more stable.&lt;/p&gt;&lt;p&gt;All-in-all OSCON'13 was a fun event and definitely one that we look forward returning to with a more mature version of MirageOS, to build on the momentum begun this year!  Portland was an amazing host city too, but what happens in Portland, stays in Portland...&lt;/p&gt; 
   &lt;/div&gt;</content:encoded>
	<dc:date>2013-08-08T16:00:00+00:00</dc:date>
	<dc:creator>Richard Mortier</dc:creator>
</item>
<item rdf:about="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2">
	<title>Anil Madhavapeddy: Final Real World OCaml beta; the good, the bad and the ugly</title>
	<link>http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html</link>
	<content:encoded>&lt;p&gt;The second and final public beta of Real World OCaml is now available: &lt;a href=&quot;https://realworldocaml.org&quot;&gt;https://realworldocaml.org&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Release notes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Over 2,000 comments from proofreaders have been resolved. We realize that reading early content is hard work, and hugely appreciate the spirited feedback! The book is now a week away from being handed over to the O&amp;#8217;Reilly production team for copyediting, so the window for changes are limited after that. Comments reset between milestones and so beta2 is a clean slate; we&amp;#8217;re still working through some remaining older issues.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;The chapters on first-class modules, parsing with Menhir, and objects and classes have been significantly revised from beta1. Our thanks to Leo White for contributing significantly to the latter two chapters.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;All the code snippets and terminal outputs are now mechanically generated. The source code is as close to public domain as practical, at: &lt;a href=&quot;https://github.com/realworldocaml/examples&quot;&gt;https://github.com/realworldocaml/examples&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;The final version will have the installation chapter moved to be online only, and we intend to publish updates there to elaborate on installation and packaging mechanisms.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Exercises will be available after we go into production, and also only be available online. We really like the collaborative spirit of the commenting system, and will likely extend this to collecting exercises from our readers on an ongoing basis.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There&amp;#8217;s been quite a bit of feedback and conversation about the book, so this also seemed like a good point to checkpoint the process somewhat.&lt;/p&gt;

&lt;h2 id=&quot;crowd_sourcing_community_feedback&quot;&gt;Crowd sourcing community feedback&lt;/h2&gt;
&lt;a href=&quot;http://realworldocaml.org&quot;&gt;&lt;img align=&quot;right&quot; src=&quot;http://anil.recoil.org/images/oreilly-cover.gif&quot; /&gt;&lt;/a&gt;
&lt;p&gt;&lt;em&gt;Good&lt;/em&gt;: The decision to crowdsource feedback has been exhausting but very worthwhile, with over 2,200 &lt;a href=&quot;http://github.com/ocamllabs/rwo-comments&quot;&gt;comments&lt;/a&gt; posted (and over 2,000 resolved by us too!). O&amp;#8217;Reilly has a similar platform called &lt;a href=&quot;http://atlas.labs.oreilly.com&quot;&gt;Atlas&lt;/a&gt; that wasn&amp;#8217;t quite ready when we started our book, but I&amp;#8217;d highly encourage new authors to go down this route and not stick with a traditional editorial scheme.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s simply not possible for a small group of technical reviewers to notice as many errors as the wider community has. Having said this, it&amp;#8217;s interesting how much more focussed and critical the comments of our editor &lt;a href=&quot;http://radar.oreilly.com/andyo&quot;&gt;Andy Oram&lt;/a&gt; were when compared to most of the wider community feedback, so the commenting system is definitely a complement and not a replacement to the editorial process.&lt;/p&gt;

&lt;h3 id=&quot;the_github_requirement&quot;&gt;The GitHub requirement&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;Bad&lt;/em&gt;: After the first beta, we got criticized on a &lt;a href=&quot;https://news.ycombinator.com/item?id=5893168&quot;&gt;Hacker News&lt;/a&gt; thread for passing around Github oAuth tokens without SSL. This was entirely my fault, and I corrected the site to be pure-SSL within 24 hours.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Ugly&lt;/em&gt;: In my defence though, I &lt;em&gt;dont want&lt;/em&gt; the authority that all the reviewers have granted to me for their Github accounts! We need just two things to enable commenting: an identity service to cut down on spam comments, and the ability to create issues in a &lt;a href=&quot;http://github.com/ocamllabs/rwo-comments&quot;&gt;public repository&lt;/a&gt;. Unfortunately, Github&amp;#8217;s &lt;a href=&quot;http://developer.github.com/v3/oauth/#scopes&quot;&gt;scope&lt;/a&gt; API requires you to also grant us access to commit to public code repositories. Add on the fact that around 6,000 people have clicked through the oAuth API to review RWO, and you start to see just how much code we potentially have access to. I did try to reduce the damage by not actually storing the oAuth tokens on the server-side. Instead, we store it in the client using a secure cookie, so you can easily reset your browser to log out.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s not just about authentication either: another reader &lt;a href=&quot;http://www.reddit.com/r/ocaml/comments/1gil84/public_beta_of_real_world_ocaml/cal811r&quot;&gt;points out&lt;/a&gt; that if they use GitHub during work hours, they have no real way of separating the news streams that result.&lt;/p&gt;

&lt;p&gt;Much of the frustration here is that there&amp;#8217;s nothing I can do to fix this except wait for GitHub to hopefully improve their service. I very much hope that GitHub is listening to this and has internal plans to overhaul their privilege management APIs.&lt;/p&gt;

&lt;h3 id=&quot;infrastructurefree_hosting&quot;&gt;Infrastructure-free hosting&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;Good&lt;/em&gt; and &lt;em&gt;Bad&lt;/em&gt;: One of my goals with the commenting infrastructure was to try and eliminate all server-side code, so that we could simply publish the book onto Github Pages and use JavaScript for the comment creation and listing.&lt;/p&gt;

&lt;p&gt;This &lt;em&gt;almost&lt;/em&gt; worked out. We still need a tiny HTTP proxy for comment creation, as we add contextual information such as a milestone to every new comment to make it easier to index. Setting a milestone requires privileged access to the repository and so our server-side proxy creates the issue using the user-supplied oAuth token (so that it originates from the commenter), and then updates it (via the &lt;a href=&quot;http://github.com/bactrian&quot;&gt;bactrian&lt;/a&gt; account) to add the milestone add insert a little contextual comment pointing back to the book paragraph where the comment originated from.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Good&lt;/em&gt;: The other criticism from the &lt;a href=&quot;http://www.reddit.com/r/programming/comments/1gipea/first_public_beta_of_real_world_ocaml_book/cakmeuz&quot;&gt;online feedback&lt;/a&gt; was the &lt;em&gt;requirement&lt;/em&gt; to have a Github login to read the book at all. This is a restriction that we intend to lift for the final release (which will be freely available online under a &lt;a href=&quot;http://creativecommons.org/licenses/by-nc-nd/3.0/us/&quot;&gt;CC-BY-NC-ND&lt;/a&gt; license), but I think it&amp;#8217;s absolutely the right decision to gateway early adopters to get useful feedback. Even if we lost 90% of our potential reviewers through the Github auth wall, I don&amp;#8217;t think we could have coped with another 10,000 comments in any case.&lt;/p&gt;

&lt;p&gt;On the positive side, we didn&amp;#8217;t have a single spam comment or other abuses of the commenting system at all.&lt;/p&gt;

&lt;p&gt;I&amp;#8217;ve had quite a few queries been open-sourcing the &lt;a href=&quot;http://github.com/realworldocaml/scripts&quot;&gt;scripts&lt;/a&gt; that drive the server-side commenting, and this on my TODO list for after the final book has gone to production.&lt;/p&gt;

&lt;h2 id=&quot;autogenerating_the_examples&quot;&gt;Auto-generating the examples&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Bad&lt;/em&gt;: We tried for far too long during the book writing to stumble through with manual installation instructions and hand-copied code snippets and outputs. Some of our alpha reviewers pointed out &lt;a href=&quot;https://github.com/ocamllabs/rwo-comments/issues/236&quot;&gt;vociferously&lt;/a&gt; that spending time on installation and dealing with code typos was not a good use of their time.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Good&lt;/em&gt;: &lt;a href=&quot;http://bolinfest.com&quot;&gt;Michael Bolin&lt;/a&gt; was entirely correct in his criticism (and incidentally, one of our most superstar reviewers). The latest beta has an entirely mechanically generated toolchain that lets us regenerate the entire book output from a cold start by cloning the &lt;a href=&quot;https://github.com/realworldocaml/examples&quot;&gt;examples&lt;/a&gt; repository. In retrospect, I should have written this infrastructure a year ago, and I&amp;#8217;d recommend any new books of this sort focus hard on automation from the early days.&lt;/p&gt;

&lt;p&gt;Luckily, my automation &lt;a href=&quot;https://github.com/realworldocaml/scripts&quot;&gt;scripts&lt;/a&gt; could crib heavily from existing open-source OCaml projects that had portions of what we needed, such as &lt;a href=&quot;https://github.com/diml/utop&quot;&gt;uTop&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/ocaml.org&quot;&gt;ocaml.org&lt;/a&gt; (and my thanks to &lt;a href=&quot;https://github.com/diml&quot;&gt;Jeremie Dimino&lt;/a&gt; and &lt;a href=&quot;https://github.com/Chris00&quot;&gt;Christophe Troestler&lt;/a&gt; for their help here).&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Awesome&lt;/em&gt;: We&amp;#8217;re hacking on a little surprise for the final online version of the book, based on this build infrastructure. Stay &lt;a href=&quot;http://try.ocamlpro.com&quot;&gt;tuned&lt;/a&gt;!&lt;/p&gt;</content:encoded>
	<dc:date>2013-08-05T23:00:00+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=99">
	<title>Heidi Howard: OCaml Lecture Notes</title>
	<link>http://hh360.user.srcf.net/blog/2013/08/abstractions-and-types-for-concurrent-programming/</link>
	<content:encoded>&lt;p&gt;I just wanted to share these sildes from Yaron Minsky guest lecture at Princeton on &amp;#8220;Abstractions and Types for Concurrent Programming&amp;#8221;: [&lt;a href=&quot;http://www.cs.princeton.edu/~dpw/courses/cos326-12/lec/asynch-and-rpc.pdf&quot;&gt;pdf&lt;/a&gt;]  to the &lt;a href=&quot;http://www.cs.princeton.edu/~dpw/courses/cos326-12/&quot;&gt;COS 326&lt;/a&gt; class and the notes from Cornell&amp;#8217;s OCaml course called &amp;#8220;&lt;a href=&quot;http://www.cs.cornell.edu/Courses/cs3110/2011sp/lecturenotes.asp&quot;&gt;Data Structures and Functional Programming&lt;/a&gt;&amp;#8220;, edit the URL to see notes from different years&lt;/p&gt;</content:encoded>
	<dc:date>2013-08-01T14:40:42+00:00</dc:date>
</item>
<item rdf:about="http://openmirage.org/blog/xen-block-devices-with-mirage">
	<title>MirageOS: Creating Xen block devices with Mirage</title>
	<link>http://openmirage.org/blog/xen-block-devices-with-mirage</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;&lt;a href=&quot;http://www.openmirage.org/&quot;&gt;Mirage&lt;/a&gt; is a &lt;a href=&quot;http://anil.recoil.org/papers/2013-asplos-mirage.pdf&quot;&gt;unikernel&lt;/a&gt; or &quot;library operating system&quot; that allows us to build applications which can be compiled to very diverse environments: the same code can be linked to run as a regular Unix app, relinked to run as a &lt;a href=&quot;https://github.com/pgj/mirage-kfreebsd&quot;&gt;FreeBSD kernel module&lt;/a&gt;, and even linked into a self-contained kernel which can run on the &lt;a href=&quot;http://www.xenproject.org/&quot;&gt;Xen hypervisor&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Mirage has access to an extensive suite of pure OCaml &lt;a href=&quot;https://github.com/mirage&quot;&gt;libraries&lt;/a&gt;, covering everything from Xen &lt;a href=&quot;https://github.com/mirage/ocaml-xen-block-driver&quot;&gt;block&lt;/a&gt; and &lt;a href=&quot;https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml&quot;&gt;network&lt;/a&gt; virtual device drivers, a &lt;a href=&quot;https://github.com/mirage/mirage-net&quot;&gt;TCP/IP stack&lt;/a&gt;, OpenFlow learning switches and controllers, to SSH and &lt;a href=&quot;https://github.com/mirage/ocaml-cohttp&quot;&gt;HTTP&lt;/a&gt; server implementations.&lt;/p&gt;&lt;p&gt;I normally use Mirage to deploy applications as kernels on top of a &lt;a href=&quot;http://www.xenserver.org/&quot;&gt;XenServer&lt;/a&gt; hypervisor. I start by first using the Mirage libraries within a normal Unix userspace application -- where I have access to excellent debugging tools -- and then finally link my app as a high-performance Xen kernel for production.&lt;/p&gt;&lt;p&gt;However Mirage is great for more than simply building Xen kernels. In this post I'll describe how I've been using Mirage to create experimental virtual disk devices for existing Xen VMs (which may themselves be Linux, *BSD, Windows or even Mirage kernels). The Mirage libraries let me easily experiment with different backend file formats and protocols, all while writing only type-safe OCaml code thats runs in userspace in a normal Linux domain 0.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Disk devices under Xen&lt;/b&gt;&lt;/p&gt;&lt;p&gt;The protocols used by Xen disk and network devices are designed to permit fast and efficient software implementations, avoiding the inefficiencies inherent in emulating physical hardware in software. The protocols are based on two primitives:&lt;/p&gt;&lt;ul&gt; &lt;li&gt; &lt;p&gt;&lt;b&gt;shared memory pages&lt;/b&gt;: used for sharing both data and metadata&lt;/p&gt; &lt;/li&gt;&lt;li&gt; &lt;p&gt;&lt;b&gt;event channels&lt;/b&gt;: similar to interrupts, these allow one side to signal the other&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt;&lt;p&gt;In the disk block protocol, the protocol starts with the client (&quot;frontend&quot; in Xen jargon) sharing a page with the server (&quot;backend&quot;). This single page will contain the request/response metadata, arranged as a circular buffer or &quot;ring&quot;. The client (&quot;frontend&quot;) can then start sharing pages containing disk blocks with the backend and pushing request structures to the ring, updating shared pointers as it goes. The client will give the server end a kick via an event channel signal and then both ends start running simultaneously. There are no locks in the protocol so updates to the shared metadata must be handled carefully, using write memory barriers to ensure consistency.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Xen disk devices in Mirage&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Like everything else in Mirage, Xen disk devices are implemented as libraries. The ocamlfind library called &quot;xenctrl&quot; provides support for manipulating blocks of raw memory pages, &quot;granting&quot; access to them to other domains and signalling event channels. There are two implementations of &quot;xenctrl&quot;: &lt;a href=&quot;https://github.com/mirage/mirage-platform/tree/master/xen/lib&quot;&gt;one that invokes Xen &quot;hypercalls&quot; directly&lt;/a&gt; and one which uses the &lt;a href=&quot;https://github.com/xapi-project/ocaml-xen-lowlevel-libs&quot;&gt;Xen userspace library libxc&lt;/a&gt;. Both implementations satisfy a common signature, so it's easy to write code which will work in both userspace and kernelspace.&lt;/p&gt;&lt;p&gt;The ocamlfind library &lt;a href=&quot;https://github.com/mirage/shared-memory-ring&quot;&gt;shared-memory-ring&lt;/a&gt; provides functions to create and manipulate request/response rings in shared memory as used by the disk and network protocols. This library is a mix of 99.9% OCaml and 0.1% asm, where the asm is only needed to invoke memory barrier operations to ensure that metadata writes issued by one CPU core appear in the same order when viewed from another CPU core.&lt;/p&gt;&lt;p&gt;Finally the ocamlfind library &lt;a href=&quot;https://github.com/mirage/ocaml-xen-block-driver&quot;&gt;xenblock&lt;/a&gt; provides functions to hotplug and hotunplug disk devices, together with an implementation of the disk block protocol itself.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Making custom virtual disk servers with Mirage&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Let's experiment with making our own virtual disk server based on the Mirage example program, &lt;a href=&quot;https://github.com/mirage/xen-disk&quot;&gt;xen-disk&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;First, install &lt;a href=&quot;http://www.xen.org/&quot;&gt;Xen&lt;/a&gt;, &lt;a href=&quot;http://www.ocaml.org/&quot;&gt;OCaml&lt;/a&gt; and &lt;a href=&quot;http://opam.ocamlpro.com/&quot;&gt;OPAM&lt;/a&gt;. Second initialise your system:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;opam init
eval `opam config env`
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;At the time of writing, not all the libraries were released as upstream OPAM packages, so it was necessary to add some extra repositories. This should not be necessary after the Mirage developer preview at &lt;a href=&quot;http://www.oscon.com/oscon2013/public/schedule/detail/28956&quot;&gt;OSCON 2013&lt;/a&gt;.&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;opam remote add mirage-dev git&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt;//github.com/mirage/opam-repo-dev
opam remote add xapi-dev git&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt;//github.com/xapi-project/opam-repo-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Install the unmodified &lt;code&gt;xen-disk&lt;/code&gt; package, this will ensure all the build dependencies are installed:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;opam install xen-disk
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When this completes it will have installed a command-line tool called &lt;code&gt;xen-disk&lt;/code&gt;. If you start a VM using your Xen toolstack of choice (&quot;xl create ...&quot; or &quot;xe vm-install ...&quot; or &quot;virsh create ...&quot;) then you should be able to run:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;xen-disk connect &lt;span class=&quot;keyword2&quot;&gt;&amp;lt;&lt;/span&gt;vmname&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;which will hotplug a fresh block device into the VM &quot;&amp;lt;vmname&amp;gt;&quot; using the &quot;discard&quot; backend, which returns &quot;success&quot; to all read and write requests, but actually throws all data away. Obviously this backend should only be used for basic testing!&lt;/p&gt;&lt;p&gt;Assuming that worked ok, clone and build the source for &lt;code&gt;xen-disk&lt;/code&gt; yourself:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;git clone git&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt;//github.com/mirage/xen-disk
cd xen-disk
make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;Making a custom virtual disk implementation&lt;/b&gt;&lt;/p&gt;&lt;p&gt;The &lt;code&gt;xen-disk&lt;/code&gt; program has a set of simple built-in virtual disk implementations. Each one satisifies a simple signature, contained in &lt;a href=&quot;https://github.com/mirage/xen-disk/blob/master/src/storage.mli&quot;&gt;src/storage.mli&lt;/a&gt;:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;&lt;span class=&quot;keyword4&quot;&gt;type&lt;/span&gt; configuration &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword2&quot;&gt;{&lt;/span&gt;
  filename&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;keyword3&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;comments&quot;&gt;(** path where the data will be stored *)&lt;/span&gt;
  format&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;keyword3&quot;&gt;string&lt;/span&gt; option&lt;span class=&quot;keyword2&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;comments&quot;&gt;(** format of physical data *)&lt;/span&gt;
&lt;span class=&quot;keyword2&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;comments&quot;&gt;(** Information needed to &quot;open&quot; a disk *)&lt;/span&gt;

&lt;span class=&quot;keyword4&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;keyword4&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;keyword6&quot;&gt;S &lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword4&quot;&gt;sig&lt;/span&gt;
  &lt;span class=&quot;comments&quot;&gt;(** A concrete mechanism to access and update a virtual disk. *)&lt;/span&gt;

  &lt;span class=&quot;keyword4&quot;&gt;type&lt;/span&gt; t
  &lt;span class=&quot;comments&quot;&gt;(** An open virtual disk *)&lt;/span&gt;

  &lt;span class=&quot;keyword4&quot;&gt;val&lt;/span&gt; open_disk&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt; configuration -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; t option &lt;span class=&quot;keyword5&quot;&gt;Lwt.&lt;/span&gt;t
  &lt;span class=&quot;comments&quot;&gt;(** Given a configuration, attempt to open a virtual disk *)&lt;/span&gt;

  &lt;span class=&quot;keyword4&quot;&gt;val&lt;/span&gt; size&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt; t -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; int64
  &lt;span class=&quot;comments&quot;&gt;(** [size t] is the size of the virtual disk in bytes. The actual
      number of bytes stored on media may be different. *)&lt;/span&gt;

  &lt;span class=&quot;keyword4&quot;&gt;val&lt;/span&gt; read&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt; t -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Cstruct.&lt;/span&gt;t -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; int64 -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;keyword3&quot;&gt;int&lt;/span&gt; -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; unit &lt;span class=&quot;keyword5&quot;&gt;Lwt.&lt;/span&gt;t
  &lt;span class=&quot;comments&quot;&gt;(** [read t buf offset_sectors len_sectors] copies [len_sectors]
      sectors beginning at sector [offset_sectors] from [t] into [buf] *)&lt;/span&gt;

  &lt;span class=&quot;keyword4&quot;&gt;val&lt;/span&gt; write&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt; t -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Cstruct.&lt;/span&gt;t -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; int64 -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;keyword3&quot;&gt;int&lt;/span&gt; -&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; unit &lt;span class=&quot;keyword5&quot;&gt;Lwt.&lt;/span&gt;t
  &lt;span class=&quot;comments&quot;&gt;(** [write t buf offset_sectors len_sectors] copies [len_sectors]
      sectors from [buf] into [t] beginning at sector [offset_sectors]. *)&lt;/span&gt;
&lt;span class=&quot;keyword4&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let's make a virtual disk implementation which uses an existing disk image file as a &quot;gold image&quot;, but uses copy-on-write so that no writes persist. This is a common configuration in Virtual Desktop Infrastructure deployments and is generally handy when you want to test a change quickly, and revert it cleanly afterwards.&lt;/p&gt;&lt;p&gt;A useful Unix technique for file I/O is to &quot;memory map&quot; an existing file: this associates the file contents with a range of virtual memory addresses so that reading and writing within this address range will actually read or write the file contents. The &quot;mmap&quot; C function has a number of flags, which can be used to request &quot;copy on write&quot; behaviour. Reading the &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.Genarray.html&quot;&gt;OCaml manual Bigarray.map_file&lt;/a&gt; it says:&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;If shared is true, all modifications performed on the array are reflected in the file. This requires that fd be opened with write permissions. If shared is false, modifications performed on the array are done in memory only, using copy-on-write of the modified pages; the underlying file is not affected.&lt;/p&gt; &lt;/blockquote&gt;&lt;p&gt;So we should be able to make a virtual disk implementation which memory maps the image file and achieves copy-on-write by setting &quot;shared&quot; to false. For extra safety we can also open the file read-only.&lt;/p&gt;&lt;p&gt;Luckily there is already an &lt;a href=&quot;https://github.com/mirage/xen-disk/blob/master/src/backend.ml#L63&quot;&gt;&quot;mmap&quot; implementation&lt;/a&gt; in &lt;code&gt;xen-disk&lt;/code&gt;; all we need to do is tweak it slightly. Note that the &lt;code&gt;xen-disk&lt;/code&gt; program uses a co-operative threading library called &lt;a href=&quot;http://ocsigen.org/lwt/&quot;&gt;lwt&lt;/a&gt; which replaces functions from the OCaml standard library which might block with non-blocking variants. In particular &lt;code&gt;lwt&lt;/code&gt; uses &lt;code&gt;Lwt_bytes.map_file&lt;/code&gt; as a wrapper for the &lt;code&gt;Bigarray.Array1.map_file&lt;/code&gt; function. In the &quot;open-disk&quot; function we simply need to set &quot;shared&quot; to &quot;false&quot; to achieve the behaviour we want i.e.&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;&lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; open_disk configuration &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; fd &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Unix.&lt;/span&gt;openfile configuration.filename &lt;span class=&quot;keyword2&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Unix.O_RDONLY &lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;keyword8&quot;&gt;0&lt;/span&gt;o0 &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; stats &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Unix.&lt;/span&gt;&lt;span class=&quot;keyword5&quot;&gt;LargeFile.&lt;/span&gt;fstat fd &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; mmap &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Lwt_bytes.&lt;/span&gt;map_file ~fd ~shared&lt;span class=&quot;keyword2&quot;&gt;:&lt;/span&gt;false &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword5&quot;&gt;Unix.&lt;/span&gt;close fd&lt;span class=&quot;keyword2&quot;&gt;;&lt;/span&gt;
  return &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword6&quot;&gt;Some &lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;stats.&lt;span class=&quot;keyword5&quot;&gt;Unix.&lt;/span&gt;&lt;span class=&quot;keyword5&quot;&gt;LargeFile.&lt;/span&gt;st_size, &lt;span class=&quot;keyword5&quot;&gt;Cstruct.&lt;/span&gt;of_bigarray mmap&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The read and write functions can be left as they are:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;&lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; read &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;_&lt;/span&gt;, mmap&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt; buf offset_sectors len_sectors &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; offset_sectors &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Int64.&lt;/span&gt;to_int offset_sectors &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; len_bytes &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; len_sectors &lt;span class=&quot;keyword2&quot;&gt;*&lt;/span&gt; sector_size &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; offset_bytes &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; offset_sectors &lt;span class=&quot;keyword2&quot;&gt;*&lt;/span&gt; sector_size &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword5&quot;&gt;Cstruct.&lt;/span&gt;blit mmap offset_bytes buf &lt;span class=&quot;keyword8&quot;&gt;0&lt;/span&gt; len_bytes&lt;span class=&quot;keyword2&quot;&gt;;&lt;/span&gt;
  return &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; write &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;_&lt;/span&gt;, mmap&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt; buf offset_sectors len_sectors &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; offset_sectors &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword5&quot;&gt;Int64.&lt;/span&gt;to_int offset_sectors &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; offset_bytes &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; offset_sectors &lt;span class=&quot;keyword2&quot;&gt;*&lt;/span&gt; sector_size &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword4&quot;&gt;let&lt;/span&gt; len_bytes &lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt; len_sectors &lt;span class=&quot;keyword2&quot;&gt;*&lt;/span&gt; sector_size &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;keyword5&quot;&gt;Cstruct.&lt;/span&gt;blit buf &lt;span class=&quot;keyword8&quot;&gt;0&lt;/span&gt; mmap offset_bytes len_bytes&lt;span class=&quot;keyword2&quot;&gt;;&lt;/span&gt;
  return &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now if we rebuild and run something like:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;dd &lt;span class=&quot;keyword1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;/dev/zero &lt;span class=&quot;keyword2&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;disk.raw bs&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;keyword6&quot;&gt;M &lt;/span&gt;seek&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;1024&lt;/span&gt; count&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;1&lt;/span&gt;
losetup /dev/loop0 disk.raw
mkfs.ext3 /dev/loop0
losetup -d /dev/loop0

dist/build/xen-disk/xen-disk connect &lt;span class=&quot;keyword2&quot;&gt;&amp;lt;&lt;/span&gt;myvm&lt;span class=&quot;keyword2&quot;&gt;&amp;gt;&lt;/span&gt; --path disk.raw
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inside the VM we should be able to do some basic speed testing:&lt;/p&gt;&lt;div class=&quot;ocaml&quot;&gt;&lt;pre&gt;&lt;code&gt;# dd &lt;span class=&quot;keyword1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;/dev/xvdb &lt;span class=&quot;keyword2&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;/dev/null bs&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;keyword6&quot;&gt;M &lt;/span&gt;iflag&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;direct count&lt;span class=&quot;keyword2&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;100&lt;/span&gt;
&lt;span class=&quot;keyword8&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;0&lt;/span&gt; records &lt;span class=&quot;keyword4&quot;&gt;in&lt;/span&gt;
&lt;span class=&quot;keyword8&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;keyword2&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;0&lt;/span&gt; records out
&lt;span class=&quot;keyword8&quot;&gt;104857600&lt;/span&gt; bytes &lt;span class=&quot;keyword2&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword8&quot;&gt;105&lt;/span&gt; MB&lt;span class=&quot;keyword2&quot;&gt;)&lt;/span&gt; copied, &lt;span class=&quot;keyword8&quot;&gt;0&lt;/span&gt;.&lt;span class=&quot;keyword8&quot;&gt;125296&lt;/span&gt; s, &lt;span class=&quot;keyword8&quot;&gt;837&lt;/span&gt; MB/s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plus we should be able to mount the filesystem inside the VM, make changes and then disconnect (send SIGINT to xen-disk by hitting Control+C on your terminal) without disturbing the underlying disk contents.&lt;/p&gt;&lt;p&gt;&lt;b&gt;So what else can we do?&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Thanks to Mirage it's now really easy to experiment with custom storage types for your existing VMs. If you have a cunning scheme where you want to hash block contents, and use the hashes as keys in some distributed datastructure -- go ahead, it's all easy to do. If you have ideas for improving the low-level block access protocol then Mirage makes those experiments very easy too.&lt;/p&gt;&lt;p&gt;If you come up with a cool example with Mirage, then send us a &lt;a href=&quot;https://github.com/mirage&quot;&gt;pull request&lt;/a&gt; or send us an email to the &lt;a href=&quot;http://www.openmirage.org/about/&quot;&gt;Mirage mailing list&lt;/a&gt; -- we'd love to hear about it!&lt;/p&gt; 
   &lt;/div&gt;</content:encoded>
	<dc:date>2013-07-18T11:20:00+00:00</dc:date>
	<dc:creator>Dave Scott</dc:creator>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=64">
	<title>Heidi Howard: Profiling OCaml – Getting Started Guide</title>
	<link>http://hh360.user.srcf.net/blog/2013/07/profiling-ocaml-getting-started-guide/</link>
	<content:encoded>&lt;p&gt;&amp;#8220;Perf&amp;#8221; is a common command line linux tool used for code profiling, (&lt;a href=&quot;https://perf.wiki.kernel.org/index.php/Tutorial&quot;&gt;perf wiki&lt;/a&gt;). A alpha version of a OCaml native code compiler that output code, that can be analysis by perf is now avalaible in OPAM&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Installation&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Installing the perf compatible OCaml compiler is straight forward with OPAM, though quite time-consuming due to the need to re-install many packages&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;$ opam remote add perf git:&lt;span&gt;//&lt;/span&gt;github.com&lt;span&gt;/&lt;/span&gt;mshinwell&lt;span&gt;/&lt;/span&gt;opam-repo-dev
$ opam switch &lt;span&gt;4.01&lt;/span&gt;-perf-annotate
$ &lt;span&gt;eval&lt;/span&gt; &lt;span&gt;`&lt;/span&gt;opam config &lt;span&gt;env&lt;/span&gt;&lt;span&gt;`&lt;/span&gt;
$ opam &lt;span&gt;install&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Installing perf was also straight forward, in fact I already had it via the linux-tools package in apt-get for Ubuntu.&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;&lt;span&gt;sudo&lt;/span&gt; &lt;span&gt;apt-get install&lt;/span&gt; linux-tools&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Usage&lt;/strong&gt;&lt;br /&gt;
Compiling with the new perf-compatable Ocaml compiler was beautifully simple, running make within an existing project working first time without any further changes necessary.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Basics&lt;/strong&gt;&lt;br /&gt;
Basic reporting is collected and viewed using:&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;&lt;span&gt;sudo&lt;/span&gt; perf record .&lt;span&gt;/&lt;/span&gt;myprogram.native &lt;span&gt;-o&lt;/span&gt; myreport.data
&lt;span&gt;sudo&lt;/span&gt; perf report &lt;span&gt;-i&lt;/span&gt; myreport.data
&lt;span&gt;sudo&lt;/span&gt; perf script &lt;span&gt;-i&lt;/span&gt; myreport.data&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Similarly basic stats can be collected using:&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;&lt;span&gt;sudo&lt;/span&gt; perf &lt;span&gt;stat&lt;/span&gt; .&lt;span&gt;/&lt;/span&gt;myprogram.native &lt;span&gt;-o&lt;/span&gt; myreport.data
&lt;span&gt;sudo&lt;/span&gt; &lt;span&gt;cat&lt;/span&gt; myreport.data&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;When finished you can switch back to your normal compiler version, i.e.&lt;/p&gt;

&lt;div class=&quot;wp_syntax&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre class=&quot;bash&quot;&gt;$ opam switch 4.00.1
$ &lt;span&gt;eval&lt;/span&gt; &lt;span&gt;`&lt;/span&gt;opam config &lt;span&gt;env&lt;/span&gt;&lt;span&gt;`&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</content:encoded>
	<dc:date>2013-07-10T07:10:37+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/?p=90">
	<title>Heidi Howard: Learning Async</title>
	<link>http://hh360.user.srcf.net/blog/2013/07/learning-async/</link>
	<content:encoded>&lt;p&gt;If your taking your first steps in Janestreet&amp;#8217;s Async library, here&amp;#8217;s some sources of help &amp;amp; support:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;My top 5 sources of Async Documentation&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Official Janestreet Docs for Async/Core: &lt;a href=&quot;https://ocaml.janestreet.com/ocaml-core/latest/doc/&quot;&gt;https://ocaml.janestreet.com/ocaml-core/latest/doc/&lt;/a&gt; These are generated from the .mli&amp;#8217;s in the Async source and you will quickly find places where ocamldoc has failed to cope with Core/Async complex module structure. In this case, I recommend the source code: &lt;a href=&quot;https://github.com/janestreet/async&quot;&gt;https://github.com/janestreet/async&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Dummy&amp;#8217;s guide to Async, a useful intro to bind, upon and map (the 3 fundemental functions): &lt;a href=&quot;http://janestreet.github.io/guide-async.html&quot;&gt;http://janestreet.github.io/guide-async.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Real World OCaml chapter on Async, covers Deferred basics, Ivars, Reader/Writer, TCP server, running the scheduler, Command, Pipes, Monitors, Delays, Choose and System Threads: &lt;a href=&quot;https://realworldocaml.org/beta3/en/html/concurrent-programming-with-async.html&quot;&gt;https://realworldocaml.org/beta3/en/html/concurrent-programming-with-async.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Yaron Minsky (one of co-authors of RWO) provides a nice little example of Async&amp;#8217;s RPC libraries: &lt;a href=&quot;https://bitbucket.org/yminsky/core-hello-world&quot;&gt;https://bitbucket.org/yminsky/core-hello-world&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;My favourite project for example Async and Lwt code is cohttp: &lt;a href=&quot;https://github.com/mirage/ocaml-cohttp&quot;&gt;https://github.com/mirage/ocaml-cohttp&lt;/a&gt;, otherwise there&amp;#8217;s OPAM&amp;#8217;s list of Async dependent project, useful for finding more example code: &lt;a href=&quot;http://opam.ocamlpro.com/pkg/async.109.38.00.html&quot;&gt;http://opam.ocamlpro.com/pkg/async.109.38.00.html&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Community&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Google group for Janestreet&amp;#8217;s Core &amp;amp; Async, the JS team are really helpful &lt;img src=&quot;http://hh360.user.srcf.net/blog/wp-includes/images/smilies/icon_smile.gif&quot; alt=&quot;:)&quot; class=&quot;wp-smiley&quot; /&gt;  : &lt;a href=&quot;https://groups.google.com/forum/#!forum/ocaml-core&quot;&gt;https://groups.google.com/forum/#!forum/ocaml-core&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Async issue tracker on Github is quiet but still a good point to start a conversation: &lt;a href=&quot;https://github.com/janestreet/async/issues?state=open&quot;&gt;https://github.com/janestreet/async/issues?state=open&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Installation&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I recommend the installation chapter of Real World Ocaml: &lt;a href=&quot;https://realworldocaml.org/beta3/en/html/installation.html&quot;&gt;https://realworldocaml.org/beta3/en/html/installation.html&lt;/a&gt; and install instructions for OPAM: &lt;a href=&quot;http://opam.ocamlpro.com/doc/Quick_Install.html&quot;&gt;http://opam.ocamlpro.com/doc/Quick_Install.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Janestreet provide some installation hints, though this is covered for comprehensively in RWO (linked above): &lt;a href=&quot;http://janestreet.github.io/installation.html&quot;&gt;http://janestreet.github.io/installation.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Very light background reading: &lt;a href=&quot;https://ocaml.janestreet.com/?q=node/100&quot;&gt;https://ocaml.janestreet.com/?q=node/100&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</content:encoded>
	<dc:date>2013-07-03T12:00:38+00:00</dc:date>
</item>
<item rdf:about="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available">
	<title>Anil Madhavapeddy: Phew, Real World OCaml beta now available.</title>
	<link>http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available.html</link>
	<content:encoded>&lt;p&gt;When I finished writing my PhD, I swore (as most recent graduates do) to never write a thesis again. Instead, life would be a series of pleasantly short papers, interspersed with the occasional journal article, and lots of not-writing-huge-book-activity in general.&lt;/p&gt;
&lt;a href=&quot;http://realworldocaml.org&quot;&gt;&lt;img align=&quot;right&quot; src=&quot;http://anil.recoil.org/images/oreilly-cover.gif&quot; /&gt;&lt;/a&gt;
&lt;p&gt;Then &lt;a href=&quot;http://cufp.org/conference/2011&quot;&gt;CUFP 2011&lt;/a&gt; happened, and I find myself in a bar in Tokyo with &lt;a href=&quot;https://twitter.com/yminsky&quot;&gt;Yaron Minsky&lt;/a&gt; and &lt;a href=&quot;http://monkey.org/~marius&quot;&gt;Marius Eriksen&lt;/a&gt;, and a dangerous bet ensued. A few short weeks after that, and Yaron and I are chatting with &lt;a href=&quot;https://plus.google.com/111219778721183890368&quot;&gt;Jason Hickey&lt;/a&gt; in California about writing a book about the language we love. I&amp;#8217;m still telling myself that this will never actually happen, but then everyone&amp;#8217;s favourite Californirishman &lt;a href=&quot;http://www.serpentine.com/blog/&quot;&gt;Bryan O&amp;#8217;Sullivan&lt;/a&gt; puts us in touch with O&amp;#8217;Reilly, who published his excellent &lt;a href=&quot;http://realworldhaskell.org&quot;&gt;Haskell&lt;/a&gt; tome.&lt;/p&gt;

&lt;p&gt;O&amp;#8217;Reilly arranged everything incredibly fast, with our editor &lt;a href=&quot;http://radar.oreilly.com/andyo&quot;&gt;Andy Oram&lt;/a&gt; driving us through the process. We decided early on that we wanted to write a book that had opinions based our personal experience: about how OCaml code should be written, about the standard library involved, and generally making functional programming more accessible. Along the way, we&amp;#8217;ve been working incredibly hard on the underlying software platform too, with &lt;a href=&quot;http://ocaml.janestreet.com&quot;&gt;Jane Street&lt;/a&gt;, &lt;a href=&quot;http://ocamlpro.com&quot;&gt;OCamlPro&lt;/a&gt; and my own group &lt;a href=&quot;http://ocaml.io&quot;&gt;OCaml Labs&lt;/a&gt; working together on all the pieces. There&amp;#8217;s still a lot of work left to do, of course, but we&amp;#8217;re right on track to get all this released very soon now.&lt;/p&gt;

&lt;p&gt;So, without further ado, I was very pleased to send this e-mail this morning. (and once again reaffirm my committment to never writing another book ever again. Until next time!)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Yaron Minsky, Jason Hickey and I are pleased to announce the beta release of our forthcoming O&amp;#8217;Reilly book, called &amp;#8220;Real World OCaml&amp;#8221;, available online at &lt;a href=&quot;http://realworldocaml.org&quot;&gt;http://realworldocaml.org&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The book is split into three parts: language concepts, tools and techniques, and understanding the runtime. As promised last year, we are making a public beta available for community review and to help us hunt down inaccuracies and find areas that need more clarification.&lt;/p&gt;

&lt;p&gt;We&amp;#8217;ve had the book in closed alpha for six months or so and have developed a feedback system that uses Github to record your comments. This lets us follow up to each review with clarifications and keep track of our progress in fixing issues. During alpha, we&amp;#8217;ve received over 1400 comments in this fashion (and addressed the vast majority of them!). However, since we anticipate more comments coming in from a public beta, we would request that you read the FAQ to avoid drowning us in repeat comments: &lt;a href=&quot;http://www.realworldocaml.org/#faq&quot;&gt;http://www.realworldocaml.org/#faq&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;(TL;DR followup another comment on Github directly if you can instead of creating a new issue via the web interface)&lt;/p&gt;

&lt;p&gt;This release is available in HTML format online at: &lt;a href=&quot;http://realworldocaml.org&quot;&gt;http://www.realworldocaml.org&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;O&amp;#8217;Reilly is currently preparing a Rough Cuts release that will make the beta available as PDF and in popular eBook formats. We anticipate that this will be available later this week, and I&amp;#8217;ll send a followup when that happens.&lt;/p&gt;

&lt;p&gt;Finally, we would especially like to thank our alpha reviewers. Their &lt;a href=&quot;https://github.com/ocamllabs/rwo-comments/issues&quot;&gt;feedback&lt;/a&gt; has been invaluable to the beta release. The book also includes substantial contributions to individual chapters from Jeremy Yallop (FFI), Stephen Weeks (GC) and Leo White (objects).&lt;/p&gt;

&lt;p&gt;If you have any comments that you&amp;#8217;d like to send directly by e-mail, please contact us at &lt;a href=&quot;mailto:rwo-authors@recoil.org&quot;&gt;rwo-authors@recoil.org&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Release notes for beta1:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The first-class modules chapter is incomplete, pending some portability improvements to the ocaml-plugins Core library.&lt;/li&gt;

&lt;li&gt;The binary serialization chapter is also incomplete, but has just enough to teach you about the Async RPC library.&lt;/li&gt;

&lt;li&gt;The installation chapter will be revised in anticipation of the OCaml 4.1 release, and is currently quite source-based.&lt;/li&gt;

&lt;li&gt;The packaging and build systems chapter hasn&amp;#8217;t been started yet. We&amp;#8217;re still deciding whether or not to make this an online pointer rather than a print chapter, since it&amp;#8217;s likely to change quite fast.&lt;/li&gt;

&lt;li&gt;We are preparing exercises per chapter that are not included in this particular beta release, but will be available online as soon as possible.&lt;/li&gt;

&lt;li&gt;The code examples will all be clonable as a separate repository in beta2.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;best, Yaron, Jason and Anil&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded>
	<dc:date>2013-06-16T23:00:00+00:00</dc:date>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-06-01">
	<title>Monthly News: Jun 2013 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jun%202013</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/rwo-celebration.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/rwo-celebration-thumb.jpg&quot; class=&quot;left&quot; /&gt;&lt;/a&gt;
The rain continues to plummet down relentlessly as &quot;summer&quot; starts in OCaml
Labs. The most exciting news has been the public release of the &lt;a href=&quot;https://realworldocaml.org&quot;&gt;Real World
OCaml&lt;/a&gt;, which hit the front page of the usual news
aggregators and generated huge interest!  This (reminiscent of the Xen 1.0
release) promptly took down servers for a couple of hours, but we managed to
minimise downtime in time for the Californians waking up.&lt;/p&gt;
&lt;p&gt;O'Reilly has also started selling PDF copies of the book under their &lt;a href=&quot;http://shop.oreilly.com/product/0636920024743.do&quot;&gt;Rough
Cuts&lt;/a&gt; program.  This gives you
a copy of the final book when it's released too.  Commenting is still open
on the &lt;a href=&quot;http://realworldocaml.org&quot;&gt;online version&lt;/a&gt;, so please do feel free to
participate there if you have time.&lt;/p&gt;
&lt;h3 id=&quot;SystemsProjects&quot;&gt; Systems Projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Mirage&lt;/b&gt;: Anil and Dave did the last of the sweeping build changes to make
Mirage friendlier to use for beginners.  Previously, we required a custom OPAM
switch to build kernels, but now we use &lt;a href=&quot;http://www.openmirage.org/wiki/weekly-2013-06-11&quot;&gt;virtual
packages&lt;/a&gt; to separate the
choice of compiler and packages.  This of course breaks all our documentation,
but we're going to do a big sweep in July before
&lt;a href=&quot;http://www.oscon.com/oscon2013/public/schedule/speaker/109140&quot;&gt;OSCON&lt;/a&gt; with the
new scheme.  Vincent has also been burning through the core platform libraries,
cleaning them up and adding documentation strings.  He is also building a
shared memory &lt;a href=&quot;http://github.com/vbmithr/ocaml-vchan&quot;&gt;vchan&lt;/a&gt; driver that will
make parallel-Mirage unikernels very easy to coordinate on the same host.&lt;/p&gt;
&lt;p&gt;The huge news from our friends at Citrix is the open-sourcing of
&lt;a href=&quot;http://www.xenserver.org&quot;&gt;XenServer&lt;/a&gt;, which is the popular Citrix product that
embeds the &lt;a href=&quot;https://github.com/xapi-project&quot;&gt;OCaml XAPI&lt;/a&gt; cloud management
stack.  There are almost 100 major components
&lt;a href=&quot;http://github.com/xenserver&quot;&gt;released&lt;/a&gt; as part of this, several of which can
be directly reused with Mirage.  Mirage was always an ambitious project, but
it's all coming together now thanks to bold moves such as this from Citrix!&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Signpost:&lt;/b&gt; We woke up to the excellent but slightly scary news that
our &lt;a href=&quot;https://www.usenix.org/conference/foci13&quot;&gt;USENIX FOCI&lt;/a&gt; paper was accepted.
This now means that we get to present it in August at USENIX Security, but
the team is now racing to pull together the prototypes into a complete system
before the conference.  Nothing like a deadline to focus the mind!  We're
also working on the camera-ready version of the paper, which we will share
here when it's ready.&lt;/p&gt;
&lt;h3 id=&quot;PlatformProjects&quot;&gt; Platform Projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;OCamlot:&lt;/b&gt; David Sheets did an astounding job at pulling together a
working continuous build system in a very short amount of time, and promptly
managed to melt some of the older &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool&quot;&gt;non-x86
machines&lt;/a&gt; in Anil's office.  Once Anil
sadly replaced them, the builder churned through a matrix of different compiler
versions (4.0,4.1dev,4.2dev), architectures (x86, x86_64, ARM, PowerPC), and
operating systems (Debian, Ubuntu, FreeBSD, OpenBSD to start with).  There's
a &lt;a href=&quot;https://ocaml-www3.ocamllabs.cl.cam.ac.uk/github/OCamlPro/opam-repository&quot;&gt;development URL&lt;/a&gt;, but
the next step is to retire this and move it to a proper home at &lt;a href=&quot;http://ocaml.org&quot;&gt;ocaml.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Having continuous build for OPAM is really, really useful though, as it lets us
vet pull requests on several architectures before merging them. It also let
Anil repair OCaml on &lt;a href=&quot;https://github.com/avsm/ocaml/commit/c1da5f35cda0ee85e576197b88f503333ed9e9a1&quot;&gt;OpenBSD/macppc&lt;/a&gt;
too, which is possibly the most obscure fix he's done in a while.&lt;/p&gt;
&lt;p&gt;The next steps with OCamlot are to take a shot at porting the core to
&lt;a href=&quot;http://github.com/janestreet/jenga&quot;&gt;Jenga&lt;/a&gt;, which is Jane Street's next-generation
distributed build system.  This should let us improve the fault-tolerance and
logging aspects of it before putting it properly into production later in the summer.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Ctypes:&lt;/b&gt; The May &lt;a href=&quot;http://github.com/ocamllabs/ocaml-ctypes&quot;&gt;release&lt;/a&gt;
brought with it a good chunk of feedback, so Jeremy spent time incorporating
that and contributing to the Real World OCaml ctypes chapter.  He also added
support for garbage-collecting closures passed to C, and also very cool support
for &lt;a href=&quot;https://github.com/ocamllabs/ocaml-ctypes/pull/27&quot;&gt;printing C types and values&lt;/a&gt;.
Our friends at Citrix have started looking at ctypes, and Rob Hoes has already
used it to write &lt;a href=&quot;https://github.com/robhoes/ocaml-libnl&quot;&gt;bindings&lt;/a&gt; to the
Netlink Protocol Library Suite.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/daniel-presentation-vg.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/daniel-presentation-vg-thumb.jpg&quot; class=&quot;right&quot; /&gt;&lt;/a&gt;
&lt;b&gt;OPAM-doc&lt;/b&gt;: Vincent Botbol got the documentation generator stable enough
to pass the Core library through.  This is particularly challenging since Core
exercises pretty much every trick in the book when it comes to the use of the
module system.  However, Vincent successfully demonstrated the workflow of
OPAM-doc at the end-of-month meeting, and is aiming to have a public release
via OPAM in July (hopefully in time for the next beta release of Real World OCaml,
which uses Core heavily).&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Visualisation libraries:&lt;/b&gt; &lt;a href=&quot;http://erratique.ch/contact.en&quot;&gt;Daniel Bünzli&lt;/a&gt; has
been spending a few months based in Citrix, working on a foundational new
declarative drawing library written in pure OCaml.  The &lt;a href=&quot;http://erratique.ch/software/vg&quot;&gt;Vg&lt;/a&gt; is already quite functional despite
still being in beta, and features a &lt;a href=&quot;http://erratique.ch/software/vg/demos/rhtmlc.html#arrowhead&quot;&gt;Javascript backend&lt;/a&gt;
that renders to both SVG and Canvas in HTML5.  That's not all though!  He's
also developing the &lt;a href=&quot;http://erratique.ch/software/vz&quot;&gt;Vz&lt;/a&gt; visualization library
that uses Vg to assemble more complex scenes and graphs.  Daniel's going to
join us in OCaml Labs for the remainder of the summer, so we're looking
forward to developing this more and using it on our various Platform projects
such as OCamlot.&lt;/p&gt;
&lt;h3 id=&quot;Outreach&quot;&gt; Outreach&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Real World OCaml:&lt;/b&gt; As mentioned earlier, the beta release of RWO went
splendidly, with a pleasing vibe that the book is what people expected.  There
were some interesting criticisms of the choice of Github authentication, but
we've had over 6000 registered commentators despite this (and of course, we
have plans &lt;a href=&quot;http://nymote.org&quot;&gt;brewing&lt;/a&gt; to tackle the identity problem).&lt;/p&gt;
&lt;p&gt;No beta release is perfect, of course, and our now-public commenting system has
resulted in &lt;a href=&quot;https://github.com/ocamllabs/rwo-comments/issues&quot;&gt;over 1500&lt;/a&gt;
issues being raised.  Well, that's all of Yaron, Anil and Jason's free time
gone for some time!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/amir-shisha.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/amir-shisha-thumb.jpg&quot; class=&quot;right&quot; /&gt;&lt;/a&gt;
&lt;b&gt;OCaml.org&lt;/b&gt;: We're in the process of looking at the site as a whole and
designing the workflow we'd like to have for growing and maintaining it.  Some
discussions have taken place about using Markdown in place of the current HTML
snippets, which would make it easier for external contributors to get involved.
In the meantime, Amir has converted the current site to Markdown format to see
how this process would work in practice.  You can see his experimenting and
scripts in the &lt;a href=&quot;https://github.com/ocamllabs/ocaml.org-temp&quot;&gt;temporary repo&lt;/a&gt; in
the &lt;code&gt;markdown-site/&lt;/code&gt; folder.
Philippe also showed off &lt;a href=&quot;https://github.com/pw374/MPP-language-blender&quot;&gt;MPP&lt;/a&gt;
at the internal meetings, and is stabilising it for a public release this
summer (once it has been integrated into the ocaml.org workflow).&lt;/p&gt;
&lt;p&gt;This month also had a number of programming language gurus show up at the Lab
for the &lt;em&gt;Algebraic Effects and Handlers&lt;/em&gt; workshop organised by &lt;a href=&quot;http://www.cl.cam.ac.uk/~ss368/&quot;&gt;Sam
Staton&lt;/a&gt;.  Most of the group attended this, as
we're all interested in how to encode effects for several of our projects (most
notably &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html#Irminsule&quot;&gt;Irminsule&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;We also enjoyed a visit by &lt;a href=&quot;https://github.com/bvaugon&quot;&gt;Benoît Vaugon&lt;/a&gt;, who gave a talk on his
&lt;a href=&quot;http://oud.ocaml.org/2012/slides/oud2012-paper10-slides.pdf&quot;&gt;OCamlCC&lt;/a&gt;
OCaml-to-C compiler, and also participated in a talk on
&lt;a href=&quot;http://www.algo-prog.info/ocaml_for_pic/web/index.php?id=ocapic&quot;&gt;OCAPIC&lt;/a&gt;. He
also chatted with us about his alternative &lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=6017&quot;&gt;GADT-based implementation of
Printf&lt;/a&gt;, which promises to both
speed up and simplify the printer support in OCaml (and also relieve Mirage of
another dependency on &lt;code&gt;libc&lt;/code&gt;).&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;&lt;i&gt;Link roundup:&lt;/i&gt;&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http://blog.xen.org/index.php/2013/06/25/xenserver-org-and-the-xen-project/&quot; class=&quot;icon-community&quot;&gt;XenServer open-sourced!&lt;/a&gt; &lt;em&gt;(Jun 25th)&lt;/em&gt;
 &lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;http://realworldocaml.org&quot; class=&quot;icon-quick-links&quot;&gt;Real World OCaml public beta now available.&lt;/a&gt; &lt;em&gt;(Jun 17th)&lt;/em&gt;
 &lt;/li&gt;
&lt;/ul&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2013-06-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://openmirage.org/blog/the-road-to-a-dev-release">
	<title>MirageOS: The road to a developer preview at OSCON 2013</title>
	<link>http://openmirage.org/blog/the-road-to-a-dev-release</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;There's been a crazy stream of activity since the start of the year, but the most important news is that we have a release target for an integrated developer preview of the Mirage stack: a talk at &lt;a href=&quot;http://www.oscon.com/oscon2013/public/schedule/detail/28956&quot;&gt;O'Reilly OSCon&lt;/a&gt; in July!  Do turn up there and find &lt;a href=&quot;http://dave.recoil.org&quot;&gt;Dave Scott&lt;/a&gt; and &lt;a href=&quot;http://anil.recoil.org&quot;&gt;Anil Madhavapeddy&lt;/a&gt; showing off interactive demonstrations.&lt;/p&gt;&lt;p&gt;Meanwhile, another significant announcement has been that Xen is &lt;a href=&quot;http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project&quot;&gt;joining the Linux Foundation&lt;/a&gt; as a collaborative project.  This is great news for Mirage: as a library operating system, we can operate just as easily under other hypervisors, and even on bare-metal devices such as the &lt;a href=&quot;http://raspberrypi.org&quot;&gt;Raspberry Pi&lt;/a&gt;.  We're very much looking forward to getting the Xen-based developer release done, and interacting with the wider Linux community (and FreeBSD, for that matter, thanks to Gabor Pali's &lt;a href=&quot;https://github.com/pgj/mirage-kfreebsd&quot;&gt;kFreeBSD&lt;/a&gt; backend).&lt;/p&gt;&lt;p&gt;Here's some other significant news from the past few months:&lt;/p&gt;&lt;ul&gt; &lt;li&gt; &lt;p&gt;&lt;a href=&quot;http://www.ocamlpro.com/blog/2013/03/14/opam-1.0.0.html&quot;&gt;OPAM 1.0 was released&lt;/a&gt;, giving Mirage a solid package manager for handling the many libraries required to glue an application together.  &lt;a href=&quot;https://github.com/vbmithr&quot;&gt;Vincent Bernardoff&lt;/a&gt; joined the team at Citrix and has been building a Mirage build-frontend called &lt;a href=&quot;https://github.com/mirage/mirari&quot;&gt;Mirari&lt;/a&gt; to hide much of the system complexity from a user who isn't too familiar with either Xen or OCaml.&lt;/p&gt; &lt;/li&gt;&lt;li&gt; &lt;p&gt;A new group called the &lt;a href=&quot;http://ocaml.io&quot;&gt;OCaml Labs&lt;/a&gt; has started up in the &lt;a href=&quot;http://www.cl.cam.ac.uk&quot;&gt;Cambridge Computer Laboratory&lt;/a&gt;, and is working on improving the OCaml toolchain and platform.  This gives Mirage a big boost, as we can re-use several of the documentation, build and test improvements in our own releases.  You can read up on the group's activities via the &lt;a href=&quot;http://ocaml.io/news&quot;&gt;monthly updates&lt;/a&gt;, or browse through the various &lt;a href=&quot;http://ocaml.io/tasks&quot;&gt;projects&lt;/a&gt;.  One of the more important projects is the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot&quot;&gt;OCamlot&lt;/a&gt; continuous build infrastructure, which will also be testing Mirage kernels as one of the supported backends.&lt;/p&gt; &lt;/li&gt;&lt;li&gt; &lt;p&gt;As we head into release mode, we've started &lt;a href=&quot;http://openmirage.org/wiki/tag/overview/meetings&quot;&gt;weekly meetings&lt;/a&gt; to coordinate all the activities.  We're keeping notes as we go along, so you should be able to skim the notes and &lt;a href=&quot;https://lists.cam.ac.uk/pipermail/cl-mirage/&quot;&gt;mailing list archives&lt;/a&gt; to get a feel for the overall activities.  Anil is maintaining a &lt;a href=&quot;http://openmirage.org/wiki/dev-preview-checklist&quot;&gt;release checklist&lt;/a&gt; for the summer developer preview.&lt;/p&gt; &lt;/li&gt;&lt;li&gt; &lt;p&gt;Anil (along with Yaron Minsky and Jason Hickey) is finishing up an O'Reilly book on &lt;a href=&quot;http://realworldocaml.org&quot;&gt;Real World OCaml&lt;/a&gt;, which will be a useful guide to using OCaml for systems and network programming. If you'd like to review an early copy, please get in touch.  The final book is anticipated to be released towards the end of the year, with a &lt;a href=&quot;http://shop.oreilly.com/category/roughcuts.do&quot;&gt;Rough Cut&lt;/a&gt; at the end of the summer.&lt;/p&gt; &lt;/li&gt;&lt;li&gt; &lt;p&gt;The core system was described in an &lt;a href=&quot;http://anil.recoil.org/papers/2013-asplos-mirage.pdf&quot;&gt;ASPLOS 2013&lt;/a&gt; paper, which should help you understand the background behind library operating systems. Some of the Mirage libraries are also currently being integrated into the next-generation &lt;a href=&quot;http://blogs.citrix.com/2012/05/17/introducing-windsor-a-new-xen-based-virtualization-architecture/&quot;&gt;Windsor&lt;/a&gt; release of the Xen Cloud Platform, which means that several of the libraries will be used in production and hence move beyond research-quality code.&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt;&lt;p&gt;In the next few months, the installation notes and getting started guides will all be revamped to match the reality of the new tooling, so expect some flux there.   If you want to take an early try of Mirage beforehand, don't forget to hop on the &lt;code&gt;#mirage&lt;/code&gt; IRC channel on Freenode and ping us with questions directly.  We will also be migrating some of the project infrastructure to be fully self-hosted on Mirage and Xen, and placing some of the services onto the new &lt;a href=&quot;http://xenproject.org&quot;&gt;xenproject.org&lt;/a&gt; infrastructure.&lt;/p&gt; 
   &lt;/div&gt;</content:encoded>
	<dc:date>2013-05-20T16:20:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-05-01">
	<title>Monthly News: May 2013 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#May%202013</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/thomas-nycoug-2013.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/thomas-nycoug-2013-thumb.jpg&quot; class=&quot;left&quot; /&gt;&lt;/a&gt;
May is exam time in Cambridge, and the corridors of the OCaml Labs resounded
with the wailing of frantic students finishing their dissertations and
preparing for exams.  We welcomed &lt;a href=&quot;https://github.com/vincent-botbol&quot;&gt;Vincent Botbol&lt;/a&gt; to join us for a summer internship,
and he started hacking on the new &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OPAM%20Doc&quot;&gt;opam-doc&lt;/a&gt;
right away.&lt;/p&gt;
&lt;p&gt;Anil, Thomas, Leo and Amir also visited &lt;a href=&quot;http://janestreet.com&quot;&gt;Jane
Street&lt;/a&gt; HQ in New York City, where we had a productive
couple of days reviewing our projects and getting feedback from them about
approaches to multicore and type system enhancements. &lt;a href=&quot;http://ashishagarwal.org&quot;&gt;Ashish
Agarwal&lt;/a&gt; also organised a fun evening with the &lt;a href=&quot;http://www.meetup.com/NYC-OCaml/events/117222022/&quot;&gt;New
York OCaml Users Group&lt;/a&gt;,
where Anil and Thomas presented our plans for the nascent OCaml Platform.&lt;/p&gt;
&lt;h3 id=&quot;SystemsProjects&quot;&gt; Systems Projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Mirage:&lt;/b&gt; This was a month of consolidation and bugfixing in Mirage.  We've
been settling into weekly meetings to coordinate the hacking between us and
Citrix, and the minutes (&lt;a href=&quot;http://www.openmirage.org/wiki/weekly-2013-05-14&quot;&gt;1&lt;/a&gt;
&lt;a href=&quot;http://www.openmirage.org/wiki/weekly-2013-05-21&quot;&gt;2&lt;/a&gt;
&lt;a href=&quot;http://www.openmirage.org/wiki/weekly-2013-05-28&quot;&gt;3&lt;/a&gt;) may be useful if you
want to catch up.  The biggest bugbear is always the build system, and we've
been exploring the use of &lt;a href=&quot;http://github.com/janestreet/jenga&quot;&gt;Jenga&lt;/a&gt; as the
eventual async-aware coordination and build system for running Mirage kernels.
Dave made great progress with a
&lt;a href=&quot;http://github.com/djs55/message-switch&quot;&gt;message-switch&lt;/a&gt; that coordinates
multiple kernels, and Balraj fixed several performance regressions in the
TCP/IP stack by building unit tests that spawn millions of parallel TCP
connections.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Signpost:&lt;/b&gt; We took a break from building prototypes to submit a paper on the
basic design to the USENIX Free and Open Communications (&lt;a href=&quot;https://www.usenix.org/conference/foci13&quot;&gt;FOCI
2013&lt;/a&gt;) workshop.  Haris and Heidi
blazed a path on writing this paper, and we've got even more ideas rolling
around about how to use DNSSEC to break the cloud deadlock.  The
&lt;a href=&quot;http://github.com/mirage/ocaml-dns&quot;&gt;ocaml-dns&lt;/a&gt; continues to grow features too.&lt;/p&gt;
&lt;h3 id=&quot;PlatformProjects&quot;&gt; Platform Projects&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/nycoug-drinkup-2013.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/nycoug-drinkup-2013-thumb.jpg&quot; class=&quot;right&quot; /&gt;&lt;/a&gt;
&lt;b&gt;Ctypes:&lt;/b&gt; Jeremy
&lt;a href=&quot;https://sympa.inria.fr/sympa/arc/caml-list/2013-06/msg00046.html&quot;&gt;announced&lt;/a&gt;
the first release of a new foreign-function mechanism for OCaml that doesn't
require you to write any C stubs at all!  You can browse the &lt;a href=&quot;https://github.com/ocamllabs/ocaml-ctypes&quot;&gt;source
code&lt;/a&gt; and
&lt;a href=&quot;https://github.com/ocamllabs/ocaml-ctypes/wiki/ctypes-tutorial&quot;&gt;tutorial&lt;/a&gt;, and
install it via OPAM.  This is very much the first 0.1 release, and we have
exciting future developments to turn this into a full-fledged replacement for
the fast-but-rather-difficult-to-use-right OCaml FFI.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;OPAM-doc:&lt;/b&gt; Vincent Botbol started building on Leo's work on the new
&lt;a href=&quot;http://github.com/vincent-botbol/opam-doc&quot;&gt;opam-doc&lt;/a&gt; tool. This is intended to
replace the venerable &lt;code&gt;ocamldoc&lt;/code&gt; with one that uses all the latest features of
the compiler.  In particular, it can use the new typed AST &lt;code&gt;cmt&lt;/code&gt; output to
avoid duplicating the compiler functionality, and can also build up a global
package table to generate complete cross-references across an entire OPAM 
collection.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;OCamlot:&lt;/b&gt; David has been building up the libraries and tools needed for
the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot%200.2.0&quot;&gt;continuous build&lt;/a&gt; infrastructure.
This includes much-improved
&lt;a href=&quot;http://github.com/avsm/ocaml-github&quot;&gt;ocaml-github&lt;/a&gt;, bindings, which are now
being used to power the &lt;a href=&quot;https://realworldocaml.org&quot;&gt;Real World OCaml&lt;/a&gt; site as
well as well as OCamlot.  In addition, he's got an interesting collection of
regular expressions to automatically triage common failures from OPAM
(such as missing external dependencies), that should help reduce the manual
burden of getting thousands of tests results dumped on the small OPAM team.&lt;/p&gt;
&lt;h3 id=&quot;CompilerProjects&quot;&gt; Compiler Projects&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/janestreet-hq-2013.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/janestreet-hq-2013-thumb.jpg&quot; class=&quot;left&quot; /&gt;&lt;/a&gt;
&lt;b&gt;OCaml-Java&lt;/b&gt;: Xavier Clerc has been hacking away at his next-generation
OCaml-Java backend (using many new features in JDK7). He's released a
&lt;a href=&quot;http://ocamljava.x9c.fr/preview/concurrency.html&quot;&gt;preview&lt;/a&gt; of the bindings to
Java concurrency, and is looking for feedback on it.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Performance profiling&lt;/b&gt;: Mark Shinwell has been hacking on improving the
integration of the runtime with &lt;code&gt;perf&lt;/code&gt;.  This should give us the hooks to
reliably track where memory was allocated.  His branch isn't going to land in
OCaml 4.1, but should be available as an OPAM switch for people to easily
try out when it's more stable.&lt;/p&gt;
&lt;h3 id=&quot;Outreach&quot;&gt; Outreach&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;OCaml.org:&lt;/b&gt; Philippe and Amir have been putting their heads together with
Christophe and Ashish to turn the &lt;a href=&quot;http://ocaml.org&quot;&gt;ocaml.org&lt;/a&gt; build pipeline
into something a little more structured.  Philippe is building a &lt;a href=&quot;https://github.com/pw374/MPP-language-blender&quot;&gt;template
processor&lt;/a&gt; for this purpose.
The OCaml site is a more complicated than the average site due to our desire to
embed &lt;a href=&quot;http://ocsigen.org/js_of_ocaml&quot;&gt;js_of_ocaml&lt;/a&gt; interactive toplevels
throughout the tutorials, and also to have active OPAM integration throughout
the site to make it easier for newcomers to sample the language.&lt;/p&gt;
&lt;p&gt;The design of a handful of pages are also now available to preview, if you
don't mind some manual git cloning. The best way to do this is to clone the
&lt;a href=&quot;https://github.com/ocamllabs/ocaml.org-temp&quot;&gt;temporary repo&lt;/a&gt; onto your local
machine and look in the &lt;code&gt;new-design/_site&lt;/code&gt; directory.  There are examples of
the home page, 100 lines of OCaml page and several others.  Since we're just
getting started with applying these changes the site isn't clicky (yet).  For
some extra fun, try resizing your browser window and see how the pages reflow
to suit smaller (mobile) screens!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/nyc-trip-balcony-view-2013.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/nyc-trip-balcony-view-2013-thumb.jpg&quot; class=&quot;right&quot; /&gt;&lt;/a&gt;
&lt;b&gt;Real World OCaml:&lt;/b&gt; Anil, Yaron and Jason continue to work hard on getting
a release out of the door.  We shipped a final alpha6 this month that is 
chapter-complete, and have been preparing for a big public June release of
the book.  Thousands of comments have been received and closed already,
making this an unusually active (but incredibly useful) ongoing review
process.  Leo and Jeremy also contributed portions of text for the Objects
and FFI chapters in alpha6, and join Stephen Weeks as external contributors
to the book.&lt;/p&gt;
&lt;p&gt;Meanwhile, Leo himself has recovered from the elation of being granted his PhD,
to the harsh reality of having to finish corrections.  He has been forced by
his colleagues to stop hacking on OCaml and submit his final thesis.  Rumours
are that he will reemerge in June after delivering his &lt;a href=&quot;http://staticanalysis.org/SAS13/papers.html&quot;&gt;SAS
2013&lt;/a&gt; talk on using an
implication-algebra generalisation of logic programming to concisely analyse
OpenMP programs for parallisation opportunities.&lt;/p&gt;
&lt;p&gt;This month's talk was courtesy of &lt;a href=&quot;http://www.lip6.fr/actualite/personnes-fiche.php?ident=D1161&amp;LANG=en&quot;&gt;Mathias Bourgoin&lt;/a&gt;,
who visited from France and gave a talk on his PhD work on GPU processing.  His
tool, &lt;a href=&quot;http://www.algo-prog.info/spoc/web/index.php?id=spoc&quot;&gt;SPOC&lt;/a&gt; has been
released onto OPAM and is a set of easy-to-use tools for generating CUDA and
OpenCL code, and also a camlp4 extension to write external kernels directly in
OCaml.  Thanks for visiting, Mathias!&lt;/p&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2013-05-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-04-01">
	<title>Monthly News: Apr 2013 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Apr%202013</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/leo-oculus.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/leo-oculus-thumb.jpg&quot; class=&quot;left&quot; width=&quot;150px&quot; /&gt;&lt;/a&gt;
It's been a heads-down month of hacking at the Labs for April, as the
group have settled into their projects and are concentrating on getting code
out.  We did take the opportunity to redesign the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html&quot;&gt;project pages&lt;/a&gt; as the active projects grew.&lt;/p&gt;
&lt;p&gt;We welcomed &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/euan.html&quot;&gt;Euan Harris&lt;/a&gt; as a new visitor, and he has
begun work on a distributed actor library in the vein of Erlang's
&lt;a href=&quot;https://github.com/erlang/otp&quot;&gt;OTP&lt;/a&gt;.  The prolific &lt;a href=&quot;http://erratique.ch&quot;&gt;Daniel Bünzli&lt;/a&gt; also joined us for the summer to work on his &lt;a href=&quot;http://erratique.ch/software/vg/&quot;&gt;Vg&lt;/a&gt; visualisation library.  He's based out of the Citrix offices, and is also contributing to the Xen project.&lt;/p&gt;
&lt;h3 id=&quot;Platformprojects&quot;&gt; Platform projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;OPAM: &lt;/b&gt; The project has entered a bug fixing stage after its release, and
the package set has steadily grown via external contributors. David Sheets has
been hacking away on the automated &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#OCamlot&quot;&gt;OCamlot&lt;/a&gt;
bot, and we released improved &lt;a href=&quot;https://github.com/avsm/ocaml-github&quot;&gt;Github&lt;/a&gt;
API bindings.  We're aiming to get OCamlot live and running in May, so stay
tuned!  There is a &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool&quot;&gt;steadily growing
collection&lt;/a&gt; of odd ARM and PowerPC
devices in Anil's desk that will generally make it easier to test your OCaml
code in unusual environments.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;OCaml.org redesign:&lt;/b&gt; Progress on the website continues and we're now
working on the actual HTML/CSS from the earlier
&lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Site-Redesign&quot;&gt;mockups&lt;/a&gt;.  We'll be
publishing these in a fork of the website
&lt;a href=&quot;https://github.com/ocamllabs/ocaml.org&quot;&gt;repository&lt;/a&gt;, so do feel free to create
issues there with your comments.  Philippe has begun the
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#Meta%20preprocessor&quot;&gt;MPP&lt;/a&gt; templating tool to glue together
all the website scripts more coherently. Discussions about this take place on
the &lt;a href=&quot;http://lists.ocaml.org/listinfo/infrastructure&quot;&gt;infrastructure&lt;/a&gt; mailing
list, which is open to all.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/makespace-apr-2013.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/makespace-apr-2013-thumb.jpg&quot; class=&quot;left&quot; width=&quot;150px&quot; /&gt;&lt;/a&gt;
The monthly OCaml get togethers in the &lt;a href=&quot;http://makespace.org&quot;&gt;Cambridge
Makespace&lt;/a&gt; are also really fun.  This month saw around 30
people wander through the doors, and work through the latest excerpts of
&lt;a href=&quot;http://realworldocaml.org&quot;&gt;Real World OCaml&lt;/a&gt;. And around midnight, Jeremy and
Leo competed to find more and more obscure
&lt;a href=&quot;http://caml.inria.fr/mantis/view.php?id=5992&quot;&gt;bugs&lt;/a&gt; in the corners of the
OCaml type system...  You can track the subsequent meetups via the &lt;a href=&quot;http://www.meetup.com/Cambridge-NonDysFunctional-Programmers/events/114286762/&quot;&gt;NonDysFunctional Meetup group&lt;/a&gt;, which includes functional programmers from around the Cambridgeshire area.  Jon and Anil also attended the &lt;a href=&quot;http://developer.yahoo.com/events/hack_europe_london/&quot;&gt;Yahoo Hackday&lt;/a&gt; in London, where Jon met a giant robot and started &lt;a href=&quot;https://github.com/jonludlam/mssl&quot;&gt;SSL bindings&lt;/a&gt;, and Anil experimented with &lt;a href=&quot;http://github.com/avsm/ocaml-js-localstorage&quot;&gt;js_of_ocaml LocalStorage&lt;/a&gt; for Irminsule.&lt;/p&gt;
&lt;h3 id=&quot;Systemsprojects&quot;&gt; Systems projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Mirage&lt;/b&gt;: We've finally got a release date for the first preview of
Mirage, which will be at &lt;a href=&quot;http://www.oscon.com/oscon2013/public/schedule/detail/28956&quot;&gt;O'Reilly OSCON&lt;/a&gt; this July!  Pulling together the release is a big endeavour, and the
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;team&lt;/a&gt; has started weekly calls to work through the
project.  The minutes for these are online, so you can
&lt;a href=&quot;http://www.openmirage.org/wiki/tag/overview/meetings&quot;&gt;browse&lt;/a&gt; them to catch
up. There's also a slightly scary
&lt;a href=&quot;http://www.openmirage.org/wiki/dev-preview-checklist&quot;&gt;checklist&lt;/a&gt; of all the
libraries that need to be released before July, so the team has its work cut
out for it!  The Xen group also announced that it is joining the Linux Foundation,
and the &lt;a href=&quot;http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project&quot;&gt;press release&lt;/a&gt; gave Mirage a prominent mention as one of the key recent developments in Xen.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/jon-robot-yahoo.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/jon-robot-yahoo-thumb.jpg&quot; class=&quot;right&quot; width=&quot;120px&quot; /&gt;&lt;/a&gt;
&lt;b&gt;Irminsule&lt;/b&gt;: Thomas now has a full implementation of the git file format
in his &lt;a href=&quot;http://github.com/samoht/cagit&quot;&gt;cagit&lt;/a&gt; repository, and the interfaces
for Irminsule's branch-consistent model are coming together.  He gave a demo to
the Mirage team, with &lt;a href=&quot;http://www.openmirage.org/wiki/weekly-2013-04-23&quot;&gt;discussion
notes&lt;/a&gt; available.&lt;/p&gt;
&lt;h3 id=&quot;Compilerprojects&quot;&gt; Compiler projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Multicore and Concurrency&lt;/b&gt;: Stephen Dolan's made great progress on bringing up a multicore
runtime using &lt;a href=&quot;https://github.com/stedolan/ocaml&quot;&gt;thread-local storage&lt;/a&gt;, which results
in a surprisingly compact diff to the OCaml runtime.  We're now moving onto the
higher-level bindings to use the parallel runtimes effectively from within OCaml.
We also began a &lt;a href=&quot;http://lists.ocaml.org/listinfo/wg-parallel&quot;&gt;wg-parallel&lt;/a&gt; working
group in order to start figuring out the evolution of the &lt;a href=&quot;http://ocsigen.org/lwt&quot;&gt;Lwt&lt;/a&gt; and 
&lt;a href=&quot;https://github.com/janestreet/async&quot;&gt;Async&lt;/a&gt; concurrency libraries.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;libffi&lt;/b&gt;: Jeremy got frustrated by the difficulty of writing safe C bindings,
and started the &lt;a href=&quot;http://github.com/ocamllabs/ocaml-ctypes&quot;&gt;ctypes&lt;/a&gt; library, which
offers a pure OCaml solution. This even includes managing callbacks across the
OCaml/C divide, and uses &lt;a href=&quot;https://github.com/atgreen/libffi&quot;&gt;libffi&lt;/a&gt; under the hood
to remain efficient and platform-independent.  There is the exciting possibility
about hooking this library with the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/compiler.html#Compile-time%20meta%20programming&quot;&gt;compile-time metaprogramming&lt;/a&gt; to eliminate all performance cost, so we're going to spend some time
on this project to make it a well-documented alternative to the existing C FFI.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/mezzo-talk.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/mezzo-talk.jpg&quot; class=&quot;right&quot; width=&quot;120px&quot; /&gt;&lt;/a&gt;
The OCaml Labs talk series continued with a visit from &lt;a href=&quot;http://gallium.inria.fr/~fpottier/&quot;&gt;Francois
Pottier&lt;/a&gt; ad &lt;a href=&quot;http://www.xulforum.org&quot;&gt;Jonathan
Protzenko&lt;/a&gt; from the INRIA
&lt;a href=&quot;http://gallium.inria.fr&quot;&gt;Gallium&lt;/a&gt; research team.  Jonathan presented their
&lt;a href=&quot;http://gallium.inria.fr/~protzenk/mezzo-lang&quot;&gt;Mezzo&lt;/a&gt; language, which places
emphasis on aliasing and controlled access to mutation.  This is of particular
interest to several of our systems projects that do not require the full power of
OCaml to build low-level systems components, and Raphael, Alan, Leo and Anil
had productive discussions about how we could try Mezzo out when it's released.&lt;/p&gt;
&lt;p&gt;&lt;i&gt;Link roundup:&lt;/i&gt;&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http://www.linuxfoundation.org/news-media/announcements/2013/04/xen-become-linux-foundation-collaborative-project&quot; class=&quot;icon-rss&quot;&gt;Xen and MirageOS to join Linux Foundation&lt;/a&gt; &lt;em&gt;(Apr 14th)&lt;/em&gt;
 &lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;http://www.meetup.com/Cambridge-NonDysFunctional-Programmers/events/114286762/&quot; class=&quot;icon-community&quot;&gt;OCaml Hacking/Meetup Session&lt;/a&gt; &lt;em&gt;(Apr 18th)&lt;/em&gt;
 &lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;http://www.oscon.com/oscon2013/public/schedule/detail/28956&quot; class=&quot;icon-quick-links&quot;&gt;OSCon Mirage talk selected.&lt;/a&gt; &lt;em&gt;(Apr 21st)&lt;/em&gt;
 &lt;/li&gt;
&lt;/ul&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2013-04-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://amirchaudhry.com/wireframe-demos-for-ocamlorg">
	<title>Amir Chaudhry: Wireframe demos for OCaml.org</title>
	<link>http://amirchaudhry.com/wireframe-demos-for-ocamlorg</link>
	<content:encoded>&lt;h3 id=&quot;making_mockups&quot;&gt;Making mockups&lt;/h3&gt;

&lt;p&gt;Over the last few months, I&amp;#8217;ve been working on various aspects of the &lt;a href=&quot;http://ocaml.org&quot;&gt;OCaml.org&lt;/a&gt; design project. This covers things like the design, information architecture and how to incorporate new functionality. One of the methods for thinking through these was to put together a bunch of wireframes using &lt;a href=&quot;http://www.balsamiq.com&quot;&gt;Balsamiq&lt;/a&gt; and use these to express (and generate) ideas as well as get feedback quickly.&lt;/p&gt;

&lt;p&gt;If you haven&amp;#8217;t used wireframes before, think of them as a slightly more advanced form of sketching things out on a whiteboard. The best aspect is that it&amp;#8217;s far quicker, easier and &lt;em&gt;cheaper&lt;/em&gt; to iterate using wireframes than on an actual website. As you&amp;#8217;ll see below, you can also convey a lot of information about how a site might work by showing people a clickable demo.&lt;/p&gt;

&lt;p&gt;I want to make this work public and I thought the best way would be to show you some screencasts of how the upcoming &lt;a href=&quot;http://ocaml.org&quot;&gt;OCaml.org&lt;/a&gt; website might work and also make the demo available to all of you. The three videos below cover three aspects of the site and I&amp;#8217;d encourage you to go through them in order (about 16 minutes in total). Apologies if my screen isn&amp;#8217;t particularly clear in the videos but you can visit the demo for yourself and see things in more detail (link and info on feedback at the end of this post).&lt;/p&gt;

&lt;h3 id=&quot;video_walkthroughs&quot;&gt;Video walkthroughs&lt;/h3&gt;

&lt;p&gt;For those who&amp;#8217;d like to watch the videos back-to-back and scaled to fit your browser window, you can &lt;a href=&quot;http://vimeo.com/couchmode/album/2301640&quot;&gt;view the Vimeo album in &amp;#8216;couchmode&amp;#8217;&lt;/a&gt;. Otherwise, individual videos are embedded below (total time 16m17s).&lt;/p&gt;

&lt;p&gt;&amp;#32; Video Part 1 - Overview - http://player.vimeo.com/video/61768157&lt;/p&gt;

&lt;p&gt;&amp;#32; Video Part 2 - Documentation - http://player.vimeo.com/video/61768235&lt;/p&gt;

&lt;p&gt;&amp;#32; Video Part 3 - Continuous Integration - http://player.vimeo.com/video/61768273&lt;/p&gt;

&lt;h3 id=&quot;public_wireframe_demo&quot;&gt;Public wireframe demo&lt;/h3&gt;

&lt;p&gt;A demo you can interact with can be found at &lt;a href=&quot;https://ocaml.mybalsamiq.com/projects/public-demo/naked/0_home?key=b897ea86d8a8199c6e46b3295ddf630dfa33e5e1&quot;&gt;OCaml.org wireframe demo&lt;/a&gt; and image files for each page are available on the &lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Wireframes&quot;&gt;github ocaml.org wiki&lt;/a&gt;. Please bear in mind the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Not everything that looks like it might be clickable actually is (and vice versa). There&amp;#8217;ll be a toggle on the bottom right of the browser window that will highlight what can be clicked.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;There are parts of the site which are &amp;#8216;work in progress&amp;#8217; and are marked as such.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;The designs you see aren&amp;#8217;t necessarily final. Your feedback will help shape our decisions and the best way to provide it is via the &lt;a href=&quot;http://lists.ocaml.org/listinfo/infrastructure&quot;&gt;infrastructure mailing list&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded>
	<dc:date>2013-03-14T07:00:00+00:00</dc:date>
</item>
<item rdf:about="http://lpw25.net/2013/03/10/ocaml-namespaces">
	<title>Leo White: Adding namespaces to OCaml</title>
	<link>http://lpw25.net/2013/03/10/ocaml-namespaces.html</link>
	<content:encoded>&lt;div class=&quot;well well-small&quot;&gt;
  &lt;h4&gt;
Contents
&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#problems-with-pack&quot;&gt;Problems with pack&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#formal-semantics&quot;&gt;Formal semantics&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#design-goals&quot;&gt;Design goals&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#design-choices&quot;&gt;Design choices&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#flat-or-hierarchical&quot;&gt;Flat or hierarchical?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#should-namespaces-be-opened-explicitly-in-source-code&quot;&gt;Should namespaces be opened explicitly in source code?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#how-should-the-compiler-find-modules-in-the-presence-of-namespaces&quot;&gt;How should the compiler find modules in the presence of namespaces?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#how-should-namespaces-specified&quot;&gt;How should namespaces specified?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#how-rich-should-a-description-language-be&quot;&gt;How rich should a description language be?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#should-namespaces-support-automatically-opened-members&quot;&gt;Should namespaces support automatically opened members?&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#proposal&quot;&gt;Proposal&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#simple-namespaces-through-filenames&quot;&gt;Simple namespaces through filenames&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#an-alternative-to-search-paths&quot;&gt;An alternative to search paths&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#the--name-argument&quot;&gt;The “-name” argument&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/atom.xml#the--open-argument&quot;&gt;The “-open” argument&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;

&lt;p&gt;Recently there has been a lot of discussion on
&lt;a href=&quot;http://lists.ocaml.org/listinfo/platform&quot;&gt;platform@lists.ocaml.org&lt;/a&gt; about
proposals for adding namespaces to OCaml. I’ve written this post to summarise
the design decisions for such a proposal and to make my own proposal.&lt;/p&gt;

&lt;p&gt;Before discussing what namespaces are and the issues surrounding their
implementation, it is important to explain why they are needed in the first
place. &lt;/p&gt;

&lt;p&gt;The most important reason for adding namespaces is to provide some means for
grouping the components of a library together. Up to now this has been
achieved using the OCaml module system. Since the components of an OCaml
library are modules, a module can be created that contains all the components
of the library as sub-modules. The “-pack” option for the compiler was created
to allow this module to be created while still keeping each component of the
library in its own file.&lt;/p&gt;

&lt;h3 id=&quot;problems-with-pack&quot;&gt;Problems with pack&lt;/h3&gt;

&lt;p&gt;There are some critical problems with using “-pack” to create a single module
containing the whole library:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;The packed module is a single unit that has to be linked or not as a
unit. This means that any program using part of the library must include the
entire library.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The packed module is a choke-point in the dependency graph.  If a file
depends on one thing in the packed module then it needs to be recompiled if
anything in the packed module changes.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Opening a large packed module is very slow and can seriously affect build
performance.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These problems are all caused by the fact that pack creates an OCaml
module. To understand this consider the run-time semantics of the module
system.&lt;/p&gt;

&lt;p&gt;At run-time a module is a record. Initialising a module involves initialising
every component of the module and placing them in this record.  Initialising
these components can involve executing arbitrary code; in fact the execution
of an OCaml program is simply the initialisation of all its modules.&lt;/p&gt;

&lt;p&gt;The problems with pack are related to these dynamic semantics. In order to
be a module pack must create a record to represent this module. This means
that it must initialise all of its components. It is this (rather than any
detail of pack’s implementation) that causes the problems identified above.&lt;/p&gt;

&lt;p&gt;Access to the components of a top-level module could proceed without the
existence of this record. However, the record is required in order to “alias”
the module, use the module as a first-class value or use it as the argument to
a functor.&lt;/p&gt;

&lt;p&gt;Any attempt to overcome the problems with pack, whilst still maintaining
the illusion that the “pack” is a normal module, would result (at the very
least) in one of the following unhealthy situations:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;The module type of the “packed module” would depend on which of its
components were accessed by the program.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Any use of the “packed module” other than as a simple container
(e.g.
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;CS&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Std&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; 
) could have a dramatic effect on what was
linked into the program and potentially on the semantics of the program.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Namespaces are basically modules that can only be used as a simple
container. This means that they do not need a corresponding record at
run-time (or any other run-time representation). This avoids the problems
with pack as well as enabling other useful features.&lt;/p&gt;

&lt;h3 id=&quot;formal-semantics&quot;&gt;Formal semantics&lt;/h3&gt;

&lt;p&gt;Following the semantics and description language for namespaces described by
&lt;a href=&quot;http://gallium.inria.fr/~scherer/namespaces/spec.pdf&quot;&gt;Gabriel Scherer et al&lt;/a&gt;,
I will consider namespaces to be name-labelled trees whose leaves are
compilation units. I will use 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; 
to represent projection on namespaces, so the 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
member of the 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
namespace will be referred to as 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;h3 id=&quot;design-goals&quot;&gt;Design goals&lt;/h3&gt;

&lt;p&gt;Some design goals that we might want from a proposal for adding namespaces to
OCaml include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Allow library components to be grouped together without creating a module
containing them.&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Allow users to group together modules from different libraries as they see
fit.&lt;/strong&gt; This means letting people change which namespace a library module is
in.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Allow library components to be given multiple names.&lt;/strong&gt; For example
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Lib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
and 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Lib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Stable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
, where 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Lib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Stable&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
is a namespace containing only those components whose interfaces are stable.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Be simple and easy to explain to beginners.&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Allow multiple source files to share the same filename.&lt;/strong&gt; Each module that
is linked into an OCaml program must have a unique name. Currently, a
module’s name is completely determined by its filename. This forces library
developers to either use pack (which gives its components new long names) or
give their source files long names like “libName_Foo.ml”. A namespaces
proposal may be able to alleviate this problem.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Allow libraries to control which modules are open by default.&lt;/strong&gt; By default
OCaml opens the standard library’s 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Pervasives&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
module. Libraries that wish to replace the standard library may also wish to
provide their own
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Pervasives&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
module and have it opened by default.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Support libraries that wish to remain compatible with versions of OCaml
without namespaces.&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Require minimal changes to existing build systems.&lt;/strong&gt; Since a namespace
proposal changes how a library’s components are named, it may require
changes to some build systems. If these changes are too invasive then users
of some build systems will probably be unable to use namespaces in the near
future.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;design-choices&quot;&gt;Design choices&lt;/h3&gt;

&lt;h4 id=&quot;flat-or-hierarchical&quot;&gt;Flat or hierarchical?&lt;/h4&gt;

&lt;p&gt;In order to replace pack, namespaces must be able to contain modules. It is
not clear, however, whether they need to be able to contain other
namespaces. We call namespaces that can contain other namespaces
&lt;em&gt;hierarchical&lt;/em&gt;, as opposed to &lt;em&gt;flat&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;In favour of flat namespaces:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Hierarchical namespaces might lead to arbitrary categorising of components
(e.g.&lt;br /&gt;
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Array&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
). These add syntactic clutter and do not bring any real benefit.  &lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Hierarchical namespaces might lead to deep java-style hierarchies
(e.g.&lt;br /&gt;
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Com&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Janestreet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Std&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
). These add syntactic clutter without adding any actual information.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In favour of hierarchical namespaces:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
A library may wish to provide multiple versions of some of its components. For
example:

&lt;ul&gt;
&lt;li&gt;    
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Async&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;IO&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
 and 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Lwt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;IO&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Windows&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Directories&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
and 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Unix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Directories&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Mutex&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
and 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Testing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Mutex&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ul&gt;

In such situations it is useful to be able to write both


&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[...]&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;Testing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Mutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


and


&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Testing&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[...]&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;Mutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
None of the systems of namespaces that have been proposed have any
additional cost for supporting hierarchical namespaces.
&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;should-namespaces-be-opened-explicitly-in-source-code&quot;&gt;Should namespaces be opened explicitly in source code?&lt;/h4&gt;

&lt;p&gt;There was some debate on the platform mailing list about whether to support
opening namespaces explicitly in source code. This means allowing a syntax
like:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;
&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;that allows the members of namespace 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
to be referenced directly (i.e.
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
can be referred to as 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;).&lt;/p&gt;

&lt;p&gt;The alternative would be to only support opening namespaces through a
command-line argument.&lt;/p&gt;

&lt;p&gt;In favour of supporting explicit opens:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;If you open two namespaces with commonly named sub-components then the order
of those opens matters. If the opens are command-line arguments then the
order of those command-line arguments (often determined by build systems and
other tools) matters. This is potentially very fragile.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Explicit opens in a source file give valuable information about which
libraries are being used by that source file. If a file contains “open
namespace Core” then you know it uses the Core library.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Local namespace opens provide users more precise control over their naming
environment.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Against supporting explicit opens:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;They require a new syntactic construct.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;how-should-the-compiler-find-modules-in-the-presence-of-namespaces&quot;&gt;How should the compiler find modules in the presence of namespaces?&lt;/h4&gt;

&lt;p&gt;Currently, when looking for a module 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
that is not in the current environment, the OCaml compiler will search the
directories in its search path for a file called “bar.cmi”.&lt;/p&gt;

&lt;p&gt;In the presence of namespaces this becomes more complicated: how does the
compiler find the module 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
?&lt;/p&gt;

&lt;p&gt;The suggested possible methods for finding modules in the presence of
namespaces fall into four categories.&lt;/p&gt;

&lt;h5 id=&quot;using-filenames&quot;&gt;Using filenames&lt;/h5&gt;

&lt;p&gt;By storing the interface for 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
in a file named “foo-bar.cmi” the compiler can continue to simply look-up
modules in its search path.&lt;/p&gt;

&lt;p&gt;Note that “-“ is an illegal character in module names so there is no risk of
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
being confused with a module called 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo-bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;This simple scheme does not support placing a module within multiple
namespaces or allowing users to put existing modules in a new namespace.&lt;/p&gt;

&lt;h5 id=&quot;checking-multiple-cmi-files&quot;&gt;Checking multiple “.cmi” files&lt;/h5&gt;

&lt;p&gt;The name of the namespace containing a compilation unit could be included in
the “.cmi” file of that unit. Then, when looking for a module 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
, the compiler would try every “bar.cmi” file in its search path until it
found one that was part of the “Foo” namespace. This may require the compiler
to open all the “bar.cmi” files on its search path, which could be expensive
on certain operating systems.&lt;/p&gt;

&lt;p&gt;This scheme does not support allowing users to put existing modules in a new
namespace, but can support placing a module in multiple namespaces.&lt;/p&gt;

&lt;p&gt;It is difficult to detect typos in namespace open statements using this
scheme. For example, detecting that
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;open&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Sdt&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; 
should have been
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;open&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Std&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
would require the compiler to check every file in its search path for one that
was part of namespace
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Sdt&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;h5 id=&quot;using-namespace-description-files&quot;&gt;Using namespace description files&lt;/h5&gt;

&lt;p&gt;The compiler could find a member of a namespace by consulting a file that
describes the members of that namespace.&lt;/p&gt;

&lt;p&gt;For example, if namespace 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
was described by a file “foo.ns” that was on the compiler’s search path then
the compiler could find
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
by locating “foo.ns” and using it to look-up the location of the “.cmi” file
for
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;These namespace description files could be created automatically by some
tool. However, they must be produced before detecting dependencies with
OCamlDep, which could complicate the build process.&lt;/p&gt;

&lt;h5 id=&quot;using-environment-description-files&quot;&gt;Using environment description files&lt;/h5&gt;

&lt;p&gt;The compiler could find a member of a namespace by consulting a file that
describes a mapping between module names and “.cmi” files.&lt;/p&gt;

&lt;p&gt;For example, if a file “foo.mlpath” included the mapping “Foo#Bar:
foo/bar.cmi” then that file could be passed as a command-line argument to the
compiler and used to look up the “bar.cmi” file directly.&lt;/p&gt;

&lt;p&gt;Looking up modules using this scheme may speed up compilation by avoiding the
need to scan directories for files.&lt;/p&gt;

&lt;h4 id=&quot;how-should-namespaces-specified&quot;&gt;How should namespaces specified?&lt;/h4&gt;

&lt;p&gt;Perhaps the most important question for any namespaces proposal is how
namespaces are specified. It is closely related to the above question of how
the compiler finds modules in the presence of namespaces.&lt;/p&gt;

&lt;p&gt;The suggested possible methods for specifying namespaces fall into five
categories.&lt;/p&gt;

&lt;h5 id=&quot;explicitly-in-the-source-files&quot;&gt;Explicitly in the source files&lt;/h5&gt;

&lt;p&gt;Namespaces could be specified by adding a line like:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;
&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;to the beginning of each compilation unit that is part of the 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; 
namespace. &lt;/p&gt;

&lt;p&gt;This has the benefit of making namespaces explicitly part of the language
itself, however it does mean that the full name of a module is specified in
two locations: partly in the filename and partly within the file itself.&lt;/p&gt;

&lt;h5 id=&quot;through-command-line-arguments&quot;&gt;Through command-line arguments&lt;/h5&gt;

&lt;p&gt;Namespaces could be specified by passing a command-line argument to the
compiler. For example, 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; 
could be compiled with the command-line:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sh&quot;&gt;ocamlc -c -namespace Foo bar.ml 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This scheme also means that the full name of a module is specified in two
locations: partly in the build system and partly in the filename.&lt;/p&gt;

&lt;h5 id=&quot;through-filenames&quot;&gt;Through filenames&lt;/h5&gt;

&lt;p&gt;Namespaces could be specified using the filenames of source files. For
example, 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; 
would be created by compiling a file “foo-bar.ml”&lt;/p&gt;

&lt;p&gt;This scheme is simple and very similar to how modules are currently named, but
it would require all source files to have long unique names.&lt;/p&gt;

&lt;h5 id=&quot;through-namespace-description-files&quot;&gt;Through namespace description files&lt;/h5&gt;

&lt;p&gt;Namespaces could be specified using namespace description files. The 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
namespace would be specified by a file “foo.ns” that described the members of
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;module Bar = &quot;foo_bar.cmi&quot;
namespace Testing = &quot;testing.ns&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h5 id=&quot;through-environment-description-files&quot;&gt;Through environment description files&lt;/h5&gt;

&lt;p&gt;Namespaces could be specified using environment description files. A namespace
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
would be defined by passing an environment description file to the compiler
that included mappings for each of the members of
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Foo#Bar: &quot;foo_bar.cmi&quot;
Foo#Testing#Bar: &quot;foo_testing_bar.cmi&quot;
Baz: &quot;baz.cmi&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In addition to specifying namespaces, this system allows users (or a tool like
OCamlFind) to have complete control the naming environment of a program.&lt;/p&gt;

&lt;h4 id=&quot;how-rich-should-a-description-language-be&quot;&gt;How rich should a description language be?&lt;/h4&gt;

&lt;p&gt;For namespace proposals that use namespace or environment description files,
they must decide how rich their description language should be.&lt;/p&gt;

&lt;p&gt;For example, &lt;a href=&quot;http://gallium.inria.fr/~scherer/namespaces/spec.pdf&quot;&gt;Gabriel Scherer et
al&lt;/a&gt; describe a very rich
environment description language including many different operations that can
be performed on namespaces.&lt;/p&gt;

&lt;p&gt;A rich description language can produce shorter descriptions. However, the
more operations a language supports the more syntax that users must understand
in order to read description files. The majority of description files are
unlikely to require complex operations.&lt;/p&gt;

&lt;h4 id=&quot;should-namespaces-support-automatically-opened-members&quot;&gt;Should namespaces support automatically opened members?&lt;/h4&gt;

&lt;p&gt;A feature of namespaces that has been proposed on the mailing list is to allow
some modules within a namespace to be automatically opened when the namespace
is also opened. This makes it seem that the namespace has values and types as
members.&lt;/p&gt;

&lt;p&gt;This feature is based on the current design of Jane Street’s Core
library. Users of the Core library are expected to open the
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Core&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;Std&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
 module before using the library. Opening this module provides access to all
the other modules of the library (much like opening a namespace), but it also
provides types and values similar to those provided by the standard library’s
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Pervasives&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; module.&lt;/p&gt;

&lt;p&gt;Supporting auto-opened modules would allow 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Core&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;Std&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
to be directly replaced by a namespace. However, the semantics of this feature
could be awkward due to potential conflicts between members of the namespace
and sub-modules of the auto-opened modules. It also increases the overlap
between namespaces and modules.&lt;/p&gt;

&lt;h3 id=&quot;proposal&quot;&gt;Proposal&lt;/h3&gt;

&lt;p&gt;In the last section of this post I will outline a namespaces proposal that I
think satisfies the design goals set out earlier.&lt;/p&gt;

&lt;p&gt;I think that satisfying these design goals requires a combination of
extensions to OCaml. My proposal is made up of four such extensions. To keep
things simple for users to understand, I have tried to keep each of these
extensions completely independent of the others and with a clearly defined
goal.&lt;/p&gt;

&lt;h4 id=&quot;simple-namespaces-through-filenames&quot;&gt;Simple namespaces through filenames&lt;/h4&gt;

&lt;p&gt;Currently, the name of a module is completely defined by its filename, and
modules are looked up using a simple search path. While it has some problems,
this simple paradigm has served OCaml well and I think that it is important to
provide some support for namespaces within this paradigm.&lt;/p&gt;

&lt;p&gt;This means allowing simple namespaces to be specified using source file
names. For example, to create a module 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
within the namespace 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
developers can simply create an implementation file “foo-bar.ml” and an
interface file “foo-bar.mli”. This interface file would be compiled to a
“foo-bar.cmi” file. Hierarchical namespaces would be created by files with
names like “foo-bar-baz.ml”.&lt;/p&gt;

&lt;p&gt;These namespaced modules can be referred to using the syntax 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;. 
This syntax simply causes the compiler to look in its search path for a
“foo-bar.cmi” file.&lt;/p&gt;

&lt;p&gt;I also propose supporting a namespace opening syntax like:
&amp;lt;div class=&quot;highlight&quot;&amp;gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;
[...]
&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;lt;/div&amp;gt;&lt;/p&gt;

&lt;h4 id=&quot;an-alternative-to-search-paths&quot;&gt;An alternative to search paths&lt;/h4&gt;

&lt;p&gt;Forcing the name of a module to be completely defined by its (compiled)
filename makes it easy to look-up modules in a search path. However, it
prevents modules from being given multiple names or being renamed by users. So
I propose supporting an alternative look-up mechanism.&lt;/p&gt;

&lt;p&gt;I propose supporting environment description files called &lt;em&gt;search path
files&lt;/em&gt;. These files would have a syntax like:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Foo#Bar : &quot;other_bar.cmi&quot;
Foo#Baz : Foo#Bar
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This file can be given to the “-I” command-line argument instead of a
directory and used to look-up the locations of “.cmi” files for given module
names.&lt;/p&gt;

&lt;p&gt;These search path files can be used to alias modules and to create new
namespaces. They also allow a module to be available under multiple namespaces.&lt;/p&gt;

&lt;p&gt;I envisage two particular modes of use:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Library authors can write “.mlpath” files and tell OCamlFind to use that
file as its search path instead of a list of directories.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A user (or potentially OCamlFind) can create search path files to define
their entire naming environment as they see fit.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;the--name-argument&quot;&gt;The “-name” argument&lt;/h4&gt;

&lt;p&gt;While the hard link between a module’s name and the name of its source file
makes life easier for build systems (“list.cmi” can only be produced by
compiling “list.ml”), it forces library authors to give their source files long
unique names.&lt;/p&gt;

&lt;p&gt;I propose adding a “-name” command-line argument to the OCaml compiler. This
would be used as follows:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sh&quot;&gt;ocamlc -c -name Foo#Bar other.ml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This command would produce a “foo-bar.cmi” file defining a module named
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
. This means that “.cmi” files would still be expected to be unique, but
source files could be named however the developer wants.&lt;/p&gt;

&lt;p&gt;Obviously, any tools that assume that a module 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
must be compiled from a file called “bar.ml” will not work in this
situation. However, the only OCaml tool that absolutely relies on this
assumption is “OCamlDep” when it is producing makefile formatted output.&lt;/p&gt;

&lt;p&gt;Build systems would not be required to support the “-name” argument, however
it would make it easy for them to provide features such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Creating namespaces to reflect a directory structure (e.g. “foo/bar.mli” becomes “foo-bar.cmi”).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Placing all the modules of a library under a common namespace (e.g. “bar.mli” becomes “foo-bar.cmi”)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This would mean that the names of source files could be kept conveniently
short.&lt;/p&gt;

&lt;h4 id=&quot;the--open-argument&quot;&gt;The “-open” argument&lt;/h4&gt;

&lt;p&gt;My proposals do not include support for automatically opened modules within
namespaces. I feel that this feature conflates two separate issues and it
would be better to solve the problem of automatically opened modules elsewhere. &lt;/p&gt;

&lt;p&gt;Auto-opened modules are meant to allow libraries to provide their own
equivalent of the standard library’s 
&lt;span class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;Pervasives&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;
module. I think that it would be more appropriate to have these “pervasive”
modules opened by default in any program compiled using one of these
libraries.&lt;/p&gt;

&lt;p&gt;I propose adding a command-line argument “-open” that could be used to open a
module by default:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sh&quot;&gt;ocamlc -c -open core-pervasives.cmi foo.ml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;By adding support for this feature to OCamlFind, libraries could add this
argument to every program compiled using them. This amounts to having
automatically opened modules as part of the package system rather than part of
the namespace system.&lt;/p&gt;</content:encoded>
	<dc:date>2013-03-10T08:00:00+00:00</dc:date>
	<dc:creator>Leo White</dc:creator>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-03-01">
	<title>Monthly News: Mar 2013 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Mar%202013</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;The OCaml Labs hackers continue to arrive, with &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html&quot;&gt;David
Sheets&lt;/a&gt; arriving from sunny San Francisco, and &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/xclerc.html&quot;&gt;Xavier Clerc&lt;/a&gt; visiting from the less-sunny
&lt;a href=&quot;http://www.inria.fr&quot;&gt;INRIA&lt;/a&gt; in France.  David's done great work on several
OCaml libraries such as &lt;a href=&quot;http://github.com/avsm/ocaml-cohttp&quot;&gt;Cohttp&lt;/a&gt; and on
&lt;a href=&quot;http://www.youtube.com/watch?v=ll9z1ULtgqo&amp;feature=plcp&quot;&gt;WebGL&lt;/a&gt;, and he's diving
straight into a first release of &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html&quot;&gt;OCamlot&lt;/a&gt; before
starting his PhD later in the year. Xavier will
work on releasing his &lt;a href=&quot;http://ocamljava.x9c.fr/preview/&quot;&gt;OCaml Java
2.0&lt;/a&gt; rewrite this summer, which takes
advantage of all the latest JDK features for non-Java languages.&lt;/p&gt;
&lt;p&gt;A new research grant has also been awarded to &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/crowcroft.html&quot;&gt;Jon Crowcroft&lt;/a&gt;.
The &lt;a href=&quot;http://hubofallthings.wordpress.com&quot;&gt;Hub of All Things&lt;/a&gt; is a £1.2m multi-disciplinary
project funded by the &lt;a href=&quot;http://www.rcuk.ac.uk/research/xrcprogrammes/Digital/Pages/home.aspx&quot;&gt;RCUK Digital Economy Programme&lt;/a&gt; and led by 
&lt;a href=&quot;http://www2.warwick.ac.uk/fac/sci/wmg/people/profile/?wmgid=849&quot;&gt;Irene Ng&lt;/a&gt; 
in Warwick.  HAT aims to create a home platform, under the user's control, 
where a market to exchange their personal data for new products and 
personalised services could exist.  The Cambridge piece of this work will use
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;Mirage&lt;/a&gt; for embedded systems programming, and
&lt;a href=&quot;http://signpost.io&quot;&gt;Signpost&lt;/a&gt;, to enable devices to connect and communicate
with each-other across the edge network.&lt;/p&gt;
&lt;h3 id=&quot;Platformprojects&quot;&gt; Platform projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;OPAM: &lt;/b&gt; &lt;a href=&quot;http://opam.ocamlpro.com&quot;&gt;OPAM&lt;/a&gt;, the popular OCaml Package Manager, recently had its &lt;a href=&quot;http://www.ocamlpro.com/blog/2013/03/14/opam-1.0.0.html&quot;&gt;1.0
release&lt;/a&gt;!  OPAM has
been in development for just over a year, and this is a significant milestone
for the project.  The OPAM &lt;a href=&quot;https://github.com/OCamlPro/opam-repository/issues&quot;&gt;package repository&lt;/a&gt; has had over 500 issues, closed over 400 pull requests and now contains over 450 packages
(and more than twice that number if you consider that multiple versions are
available).  This kind of user adoption is a fantastic sign for the OCaml
community.  We're very happy to be using OPAM as a key piece of the upcoming
OCaml Platform and the continuous integration and test system.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Site-Redesign&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/ocaml_home_v2-2-thumb.jpg&quot; class=&quot;right&quot; width=&quot;220px&quot; /&gt;&lt;/a&gt;
&lt;b&gt;OCaml.org redesign:&lt;/b&gt; Amir extended the Balsamiq mockups into more
realistic static site designs that can be &lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Site-Redesign&quot;&gt;found on the
wiki&lt;/a&gt;.  We're building
on the theme we began with the &lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Draft-OCaml-Logos&quot;&gt;OCaml Logo&lt;/a&gt;, but also
including the full functionality we want for the revamped site.  The samples
should give people an idea of the colour schemes and images we'll be using, and
feedback is &lt;em&gt;very&lt;/em&gt; welcome.  Next, we're creating the HTML/CSS templates we
need to make these mockups a reality.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;OCamlot&lt;/b&gt;: Within hours of getting off the plane, David was already 
getting well into the OCaml-based test tool and working on the pieces we 
need to get to a usable first version.  The OCamlot workflow was last 
described in Amir's
&lt;a href=&quot;http://amirchaudhry.com/wireframe-demos-for-ocamlorg/&quot;&gt;Balsamiq mockups&lt;/a&gt;
in case you want to catch up.  This work is made all the more important as 
Jane Street continues to demonstrate their strong commitment to open-source 
by sending in OPAM pull requests 
&lt;a href=&quot;https://github.com/OCamlPro/opam-repository/pull/644&quot;&gt;every week&lt;/a&gt; 
for new releases of their &lt;a href=&quot;http://janestreet.github.io&quot;&gt;libraries&lt;/a&gt;.  The 
testing for these releases is currently handled manually and we're really 
looking forward to having them dealt with automatically!&lt;/p&gt;
&lt;h3 id=&quot;Systemsprojects&quot;&gt; Systems projects&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/asplos-mort.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/asplos-mort-thumb.jpg&quot; class=&quot;right&quot; width=&quot;120px&quot; /&gt;&lt;/a&gt;
&lt;b&gt;Mirage&lt;/b&gt;: There is much preparation ongoing for the big 
&lt;a href=&quot;http://wiki.xen.org/wiki/Mirage_Incubation_Project_Proposal&quot;&gt;xen.org incubation&lt;/a&gt;, 
which has now been approved by the Xen community board. Vincent's work on 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;Mirari&lt;/a&gt; is going very well, and he's updated the 
&lt;a href=&quot;http://www.openmirage.org/wiki/install&quot;&gt;Mirage installation&lt;/a&gt; instructions 
to use Mirari instead of the manual process required before. 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/avsm.html&quot;&gt;Anil&lt;/a&gt; and &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/mort.html&quot;&gt;Mort&lt;/a&gt; also attended 
and presented the 
&lt;a href=&quot;http://anil.recoil.org/papers/2013-asplos-mirage.pdf&quot;&gt;ASPLOS 2013&lt;/a&gt; paper in 
Houston.  For the curious, 
&lt;a href=&quot;http://www.yelp.co.uk/biz/bens-beans-houston&quot;&gt;Ben's Beans&lt;/a&gt; is the only good 
coffee we could find suitable for a European in Texas.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Irminsule&lt;/b&gt;: Now that the core of Mirage is heading for release, the 
team is turning their attention to the storage and distributed programming 
challenge. &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/tg.html&quot;&gt;Thomas&lt;/a&gt; and Anil have been working on a new 
policy-free, branch-consistent storage layer that exposed a raw git-like 
universe to Mirage applications. We're working on as part of the 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html&quot;&gt;Trilogy2&lt;/a&gt; that's investigating how to improve the 
reliability of congested datacenters.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/heidi-signposts.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/heidi-signposts-thumb.jpg&quot; class=&quot;right&quot; width=&quot;130px&quot; /&gt;&lt;/a&gt;
&lt;b&gt;Signposts&lt;/b&gt;: &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/heidi.html&quot;&gt;Heidi&lt;/a&gt; gave an &lt;em&gt;excellent&lt;/em&gt; talk 
about Signpost and the benefits it can offer internet users today
&lt;i&gt;(see right)&lt;/i&gt;. This was one of a set of talks that took place in the 
Computer Lab, organised by &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/mycroft.html&quot;&gt;Alan Mycroft&lt;/a&gt;, on open 
software and open hardware with speakers such as
&lt;a href=&quot;http://en.wikipedia.org/wiki/Jon_Hall_(programmer)&quot;&gt;Jon 'maddog' Hall&lt;/a&gt; of
Linux International. There was fairly unanimous agreement that Heidi's 
slides were better than Anil's.&lt;/p&gt;
&lt;h3 id=&quot;Compilerprojects&quot;&gt; Compiler projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Multicore&lt;/b&gt;: Once the dreaded ICFP deadline was out of the way, 
Stephen, Leo, Raphael and Anil put their heads together to start 
architecting the support for parallel multicore support in the OCaml runtime.
A key part of the design space is to maintain the sequential performance and 
simplicity of the existing runtime, but still make it easy to extend shared 
memory onto different cores.  We'll have more details on this shortly when 
early prototypes are done and some benchmarks run.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Namespaces:&lt;/b&gt; Leo's also been extremely busy in the 
&lt;a href=&quot;http://lists.ocaml.org/listinfo/platform&quot;&gt;platform mailing list&lt;/a&gt;, which has 
been the location for the discussion of namespaces.  A few hundred emails 
have been exchanged on this topic and Leo has summarised the discussion and 
made proposals in his blog post about 
&lt;a href=&quot;http://www.lpw25.net/2013/03/10/ocaml-namespaces.html&quot;&gt;OCaml namespaces&lt;/a&gt;.  Although this is a complex issue, aspects of namespaces will be important to 
the work on the OCaml Platform so we look forward to the outcome of these 
discussions.&lt;/p&gt;
&lt;p&gt;&lt;i&gt;Link roundup:&lt;/i&gt;&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http://lists.ocaml.org/pipermail/platform/2013-March/000291.html&quot; class=&quot;icon-email&quot;&gt;OPAM 1.0 Released!&lt;/a&gt; &lt;em&gt;(Mar 14th)&lt;/em&gt;
 &lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;http://amirchaudhry.com/wireframe-demos-for-ocamlorg/&quot; class=&quot;icon-rss&quot;&gt;Wireframe demos for OCaml.org&lt;/a&gt; &lt;em&gt;(Mar 14th)&lt;/em&gt;
 &lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/2013/03/10/ocaml-namespaces.html&quot; class=&quot;icon-rss&quot;&gt;Adding namespaces to OCaml&lt;/a&gt; &lt;em&gt;(Mar 10th)&lt;/em&gt;
 &lt;/li&gt;
&lt;/ul&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2013-03-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://lpw25.net/2013/02/05/camlp4-alternative-part-2">
	<title>Leo White: An alternative to camlp4 - Part 2</title>
	<link>http://lpw25.net/2013/02/05/camlp4-alternative-part-2.html</link>
	<content:encoded>&lt;p&gt;In my &lt;a href=&quot;http://www.lpw25.net/2013/01/23/camlp4-alternative-part-1.html&quot;&gt;previous blog post&lt;/a&gt; I
discussed how we might use AST transformers, attributes and quotations as a
simpler alternative to camlp4. While AST transformers are much simpler to use
than camlp4 they still require knowledge of the OCaml syntax tree, and they are
still implemented outside of the language as preprocessors.&lt;/p&gt;

&lt;p&gt;In this post I’ll explore how to implement extensions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;within the language itself without external preprocessors&lt;/li&gt;
  &lt;li&gt;without the need for detailed knowledge of the OCaml syntax tree&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By including these extensions in the language itself the increasing number of
tools being built to support OCaml (e.g. typerex) can handle them directly. For
instance, IDEs could show the expansions of quotations by using the information
in “.cmt” files.&lt;/p&gt;

&lt;p&gt;I will start with quotations, which can be implemented without any knowledge of
the OCaml syntax tree, and then expand my proposal to include other kinds of
extension.&lt;/p&gt;

&lt;p&gt;Since my previous post, there has been a lot of discussion on
&lt;a href=&quot;http://lists.ocaml.org/listinfo/wg-camlp4&quot;&gt;wg-camlp4@lists.ocaml.org&lt;/a&gt; about
possible syntaxes for quotations and attributes and other kinds of extension. In
keeping with those ongoing discussions, I will use &lt;code&gt;{:id { string }}&lt;/code&gt; as the
syntax for quotations (which transform a string into an AST node) and &lt;code&gt;(:id
expr)&lt;/code&gt; as the syntax for extensions that transform an OCaml expression into an
AST node.&lt;/p&gt;

&lt;p&gt;Note that the proposals in this post are more long-term than the “ppx” solution
discussed in the previous post. Moving an extension from ppx to the mechanism
described in this post would require only minimal work. So in the short/medium
term extension authors should implement their extensions using ppx.&lt;/p&gt;

&lt;h4 id=&quot;quotations&quot;&gt;Quotations&lt;/h4&gt;

&lt;p&gt;A quotation is simply a function which takes a string and returns an AST
node. To provide built-in support we need to, for every quotation &lt;code&gt;{:foo { bar
}}&lt;/code&gt;:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;find a function that corresponds to &lt;code&gt;foo&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;apply it to the string “ bar “ &lt;/li&gt;
  &lt;li&gt;copy the resulting AST node in place of the original quotation&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&quot;quotations-in-modules&quot;&gt;Quotations in modules&lt;/h5&gt;

&lt;p&gt;We might want to find the function corresponding to quotation &lt;code&gt;foo&lt;/code&gt; by simply
looking in the current module, or one of the other modules in our environment,
for a function called &lt;code&gt;foo&lt;/code&gt;. However there are a few problems with this simple
scheme:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The function we call must exist and be compiled before we can use it.&lt;/li&gt;
  &lt;li&gt;There is no clear separation between what is being executed at compile-time
and what is being executed and run-time.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The first problem basically means that we can only use functions defined in
other files. The other problem is more subtle.&lt;/p&gt;

&lt;p&gt;OCaml modules do not really exist at compile time. They are created at run-time,
and their creation encompasses the entire execution of the program. For example,
consider this simple module:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* main.ml *)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Hello, world!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To create the &lt;code&gt;Main&lt;/code&gt; module, we must create its member &lt;code&gt;x&lt;/code&gt;. Once the creation of
&lt;code&gt;Main&lt;/code&gt; is finished the &lt;code&gt;printf&lt;/code&gt; has been executed and the whole program has
completed. Now if we add a quotation function &lt;code&gt;foo&lt;/code&gt; to this module:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* main.ml *)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Hello, world!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keywords&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Hashtbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;(* Some expression using keywords *)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;How do we distinguish between data such as &lt;code&gt;keywords&lt;/code&gt; which are needed at
compile-time when the quotation is run, and data like &lt;code&gt;x&lt;/code&gt; whose creation is
meant to drive the program at run-time? There is nothing explicit in the
definitions of &lt;code&gt;foo&lt;/code&gt; or &lt;code&gt;keywords&lt;/code&gt; that indicates that they are intended for
compile-time execution.&lt;/p&gt;

&lt;p&gt;These problems are related to the fact that OCaml is an impure language. Any
expression (including module definitions) can have side-effects, and the
run-time behaviour of the program is simply the combination of all these
side-effects. This makes it difficult to separate the side-effects that are
related to a quotation from the side-effects that are part of the program’s
execution.&lt;/p&gt;

&lt;p&gt;Despite appearing alongside other functions in the program, &lt;code&gt;foo&lt;/code&gt; must be
executed in a completely separate environment. Any side-effects (e.g. mutable
state, I/O) that are produced while creating and executing &lt;code&gt;foo&lt;/code&gt; will be
completely separate from the side-effects of the other functions in its module.&lt;/p&gt;

&lt;h5 id=&quot;where-can-we-put-them&quot;&gt;Where can we put them?&lt;/h5&gt;

&lt;p&gt;If we don’t want to put quotation functions in our modules, where should we put
them? The module system provides the only mechanism for referring to functions in
other files, how can we refer to functions which are not included in a module?&lt;/p&gt;

&lt;p&gt;The answer to these questions comes from the idea of &lt;em&gt;namespaces&lt;/em&gt;. Namespaces
are a way to give longer names to top-level modules without changing the
module’s filename. They also allow these top-level modules to be grouped
together.&lt;/p&gt;

&lt;p&gt;The details of proposals for namespaces vary on their details, but they
basically allow you to take the module defined by a file “baz.ml” and refer to
it as “Bar.Baz”. Here “Bar” is not a module (it cannot be used as the argument
to a functor) but a namespace.&lt;/p&gt;

&lt;p&gt;Namespaces seem likely to be included in OCaml in the near future,
and they provide a convenient way to refer to quotations without putting
quotations within modules.&lt;/p&gt;

&lt;p&gt;The idea is to write quotations in a “bar.mlq” file (compiled to
“bar.cmq”). These quotations would then be placed in the namespace “Bar”.&lt;/p&gt;

&lt;p&gt;Quotations would be defined with a syntax like:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* bar.mlq *)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;quotation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This could then be used with the syntax:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;o&quot;&gt;{:&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This will make it easy for quotations to be provided by libraries. So that the
following code would perfectly possible:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;o&quot;&gt;{:&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Core&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;world&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5 id=&quot;quotations-in-different-contexts&quot;&gt;Quotations in different contexts&lt;/h5&gt;

&lt;p&gt;So far, we have ignored the question of what type is used to represent an AST
node. The standard library would need to provide such a type so that quotations
could be written without linking to compiler-libs. There would also need to be
different types for different kinds of AST nodes. We do not want a quotation
used as an expression returning an AST node that represents a pattern&lt;/p&gt;

&lt;p&gt;However, we also might want to create quotations that can be used as both
expressions and patterns. This means that the quotation must return a different
type depending on where it is used.&lt;/p&gt;

&lt;p&gt;The solution to this issue is to give quotations the type &lt;code&gt;'a ctx -&amp;gt; string -&amp;gt;
'a&lt;/code&gt;.  The &lt;code&gt;ctx&lt;/code&gt; type would be a GADT that described what context a quotation was
being used from. It could also contain other information about the context, such
as its location in the source file.&lt;/p&gt;

&lt;h5 id=&quot;building-quotations&quot;&gt;Building Quotations&lt;/h5&gt;

&lt;p&gt;Creating the quotation functions requires some facility for creating AST
nodes. For this purpose, the standard library would include special quotations,
for example: &lt;code&gt;{:Ast.expr{ x + 3 }}&lt;/code&gt;. These quotations would be implemented
directly using the compiler’s lexer and parser.&lt;/p&gt;

&lt;p&gt;It would also be useful (especially for handling anti-quotations) to allow
quotations to be built from other quotations. For this we could provide another
syntax: &lt;code&gt;{:foo}&lt;/code&gt; that would refer directly to the quotation function
&lt;code&gt;foo&lt;/code&gt;. Obviously, this syntax would only be allowed within “.mlq” files.&lt;/p&gt;

&lt;h4 id=&quot;other-extensions&quot;&gt;Other extensions&lt;/h4&gt;

&lt;p&gt;This system could easily be extended to other kinds of extension. Rather than
declaring “quotations” with type &lt;code&gt;'a ctx -&amp;gt; string -&amp;gt; 'a&lt;/code&gt;, we could declare
&lt;em&gt;templates&lt;/em&gt; with type &lt;code&gt;'a ctx -&amp;gt; 'a&lt;/code&gt;. The context would contain the arguments to
the template (a string for quotations, an AST node for other templates).&lt;/p&gt;

&lt;p&gt;So a template declared as:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* bar.mlq *)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;could be used with the syntax:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;o&quot;&gt;(:&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Unlike quotations, more general templates must be able to interpret AST nodes
themselves. This means we must provide mechanisms for handling AST nodes. For
this purpose, the standard library would include a simpler version of the
&lt;code&gt;AstMapper&lt;/code&gt; module that is in compiler-libs.&lt;/p&gt;

&lt;p&gt;We could also allow the AST quotations (e.g. `Ast.expr) to be used as
patterns. This approach can be a bit fragile because syntactic sugar can cause a
pattern to match ASTs that it was not expected to match. However, for matching
simple AST nodes it is probably fairly robust.&lt;/p&gt;

&lt;h4 id=&quot;summary&quot;&gt;Summary&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;Allow extensions to be written as OCaml functions within “.mlq” files.&lt;/li&gt;
  &lt;li&gt;Refer to these functions by attaching them directly to namespaces.&lt;/li&gt;
  &lt;li&gt;Require these functions to have type &lt;code&gt;'a ctx -&amp;gt; 'a&lt;/code&gt;, where &lt;code&gt;ctx&lt;/code&gt; includes a
GADT describing the context that the extension has been used in.&lt;/li&gt;
  &lt;li&gt;Provide AST quotations in the standard library (e.g. &lt;code&gt;{:Ast.expr{ x + 3 }}&lt;/code&gt;)
which use the compiler’s own lexer and parser.&lt;/li&gt;
&lt;/ol&gt;</content:encoded>
	<dc:date>2013-02-05T08:00:00+00:00</dc:date>
	<dc:creator>Leo White</dc:creator>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-02-01">
	<title>Monthly News: Feb 2013 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Feb%202013</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;Two new people joined the core team at Cambridge: &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/yallop.html&quot;&gt;Jeremy Yallop&lt;/a&gt; and &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/pwang.html&quot;&gt;Philippe Wang&lt;/a&gt;!
Jeremy has extensive expertise with meta-programming and generic programming,
and is initially looking at the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/compiler.html#Camlp4%20redesign&quot;&gt;camlp4 redesign&lt;/a&gt;.
Philippe has been taking on the challenge of running OCaml well on restricted embedded systems, which
will also have knock-on benefits to x86 compilation with the same optimisations.
&lt;a href=&quot;http://www.x9c.fr&quot;&gt;Xavier Clerc&lt;/a&gt; also joined us for a day in advance of his
visit in April, with much interest in his &lt;a href=&quot;http://argot.x9c.fr&quot;&gt;Argot&lt;/a&gt; project
and the upcoming &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign&quot;&gt;redesign of OCaml.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Two new research grants have been awarded that are relevant to the OCaml Labs mission:&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http://gow.epsrc.ac.uk/NGBOViewGrant.aspx?GrantRef=EP/K032968/1&quot;&gt;Network-as-a-Service&lt;/a&gt; is a 3-year grant to solve pressing problems in &quot;Big Data&quot; processing, and will enable us to continue to develop &lt;a href=&quot;http://openmirage.org&quot;&gt;MirageOS&lt;/a&gt; and the use of OCaml and functional programming in this space.  We're going to be collaborating with Imperial and Nottingham on this, with the Cambridge efforts led by &lt;a href=&quot;http://www.cl.cam.ac.uk/~awm22/&quot;&gt;Andrew Moore&lt;/a&gt;, &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/crowcroft.html&quot;&gt;Jon Crowcroft&lt;/a&gt; and &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/avsm.html&quot;&gt;Anil Madhavapeddy&lt;/a&gt;.
 &lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;http://rems.io&quot;&gt;Rigorous Engineering of Mainstream Systems&lt;/a&gt; asks how we can use rigorous maths to improve the quality of mainstream computer systems.  It is led by &lt;a href=&quot;http://www.cl.cam.ac.uk/~pes20&quot;&gt;Peter Sewell&lt;/a&gt; at Cambridge, and most of the tools (including &lt;a href=&quot;http://www.cl.cam.ac.uk/~pes20/ott/&quot;&gt;Ott&lt;/a&gt; and &lt;a href=&quot;http://www.cs.kent.ac.uk/people/staff/sao/lem/&quot;&gt;Lem&lt;/a&gt;) are written in OCaml and will benefit from the ongoing work at OCaml Labs.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;Platformprojects&quot;&gt; Platform projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;OPAM&lt;/b&gt;: &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/rdc-talk.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/rdc-talk-thumb.jpg&quot; class=&quot;right&quot; width=&quot;130px&quot; /&gt;&lt;/a&gt;
We've been working hard on an OPAM 1.0 release, and Thomas and Anil have been sweeping through the package tree to stabilise the repository via automated builds.
We also had a brilliant visit from &lt;a href=&quot;http://www.dicosmo.org/index.html.en&quot;&gt;Roberto Di Cosmo&lt;/a&gt; from &lt;a href=&quot;http://www.pps.univ-paris-diderot.fr&quot;&gt;PPS&lt;/a&gt;, who has contributed extensively to the open-source community over the years.  He gave a talk on the &lt;a href=&quot;http://upsilon.cc/~zack/research/publications/infsof2012-mpm.pdf&quot;&gt;challenges of handling large-scale versioning&lt;/a&gt; of packages from a mathematical perspective (particularly applied to Debian), which is very useful input for the ongoing OPAM work.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Mailing lists&lt;/b&gt;: A new &lt;a href=&quot;http://lists.ocaml.org/listinfo/opengl&quot;&gt;opengl@lists.ocaml.org&lt;/a&gt; was
set up for those interested in OpenGL and WebGL on OCaml, and discussion so far
has covered LabGL on the Raspberry Pi. There are also still plans to begin
working groups for build systems and parallelism but will be announced in due
course once the preparatory work has been completed.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Real World OCaml&lt;/b&gt;: The book is now on &lt;a href=&quot;http://www.realworldocaml.org&quot;&gt;alpha3&lt;/a&gt;,
where Part 1 is nearly complete.  New sections on installation and a more
expanded prologue have also been included in this version.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Redesign: &lt;/b&gt; As part of the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign&quot;&gt;redesign
work&lt;/a&gt;, and to showcase the kind of
additional functionality we'd like to create, Amir put together a set of
screencasts that talk though a wireframe demo of the new site.  These short
videos covered elements of design, the new documentation system and an overview
of how the continuous integration system would work.  You can read more and
experience the clickable demo via &lt;a href=&quot;http://amirchaudhry.com/wireframe-demos-for-ocamlorg&quot;&gt;Amir's blog post&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;Systemsandcompilerprojects&quot;&gt; Systems and compiler projects&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Mirage&lt;/b&gt;: Anil gave two tech talks about &lt;a href=&quot;http://openmirage.org&quot;&gt;Mirage&lt;/a&gt; this month at Citrix and Microsoft Research, as practise talks for &lt;a href=&quot;http://asplos13.rice.edu&quot;&gt;ASPLOS 2013&lt;/a&gt;. Mirage itself is nearing a release, and &lt;a href=&quot;https://github.com/vbmithr&quot;&gt;Vincent Bernardoff&lt;/a&gt; has joined the Citrix engineering team to help drive it to release. He's been primarily focussed on the build frontend (dubbed &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html#Mirari&quot;&gt;Mirari&lt;/a&gt;) to make Mirage applications easier to compile out-of-the-box.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;camlp4 redesign:&lt;/b&gt; There has been more discussion about the future of camlp4 and &lt;a href=&quot;http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html&quot;&gt;Leo posted another summary&lt;/a&gt; on his thoughts for an alternative apporach to quotations.&lt;/p&gt;
&lt;p&gt;&lt;i&gt;Link roundup:&lt;/i&gt;&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html&quot; class=&quot;icon-rss&quot;&gt;An alternative to camlp4 - Part 2&lt;/a&gt; &lt;em&gt;(Feb 5th)&lt;/em&gt;
 &lt;/li&gt;
&lt;/ul&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2013-02-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://lpw25.net/2013/01/23/camlp4-alternative-part-1">
	<title>Leo White: An alternative to camlp4 - Part 1</title>
	<link>http://lpw25.net/2013/01/23/camlp4-alternative-part-1.html</link>
	<content:encoded>&lt;p&gt;Since its creation camlp4 has proven to be a very useful tool. People have used
it to experiment with new features for OCaml and to provide interesting
meta-programming facilities. However, there is general agreement that camlp4 is
too powerful and complex for the applications that it is most commonly used for,
and there is a growing movement to provide a simpler alternative.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;http://lists.ocaml.org/listinfo/wg-camlp4&quot;&gt;wg-camlp4@lists.ocaml.org&lt;/a&gt;
mailing list has been created to discuss implementing this simpler
alternative. This blog post is a way of kick-starting the discussion on this
list, by explaining my thoughts on what needs to be done.&lt;/p&gt;

&lt;p&gt;Personally, I think that providing a real alternative to camlp4 involves two
phases. The first phase is to provide support for implementing the most popular
camlp4 extensions without camlp4. Since the people who have implemented these
extensions already require good knowledge of the OCaml grammar it is not
unreasonable to expect a similar level of expertise to use the alternative. This
phase can easily be implemented before the next OCaml release, and I will
discuss what I think that will involve in the remainder of this post.&lt;/p&gt;

&lt;p&gt;The second phase involves extending this support to allow general OCaml
programmers to write extensions, and to include such extensions within the
language itself rather than as part of a pre-processor. I will discuss my
thoughts on this phase in a later blog post.&lt;/p&gt;

&lt;h4 id=&quot;camlp4-in-the-wild&quot;&gt;Camlp4 in the wild&lt;/h4&gt;

&lt;p&gt;Camlp4 works by producing pre-processors that parse an OCaml file and then output
a syntax tree directly into the compiler. Extensions are written by extending
the default OCaml parser and converting any new syntax tree nodes into existing
OCaml nodes. Most of the complexity in camlp4 comes from its extensible
grammars, which gives camlp4 the ability to extend the OCaml syntax
arbitrarily. However, most applications do not need this ability. &lt;/p&gt;

&lt;p&gt;From an ad-hoc survey of camlp4 extensions in the OPAM repository, most of the
popular camlp4 extensions seem to fall into one of three categories: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
Type-conv style extensions such as 
&lt;a href=&quot;https://bitbucket.org/yminsky/ocaml-core/wiki/Home&quot;&gt;sexplib&lt;/a&gt;, 
&lt;a href=&quot;https://github.com/mirage/orm&quot;&gt;ORM&lt;/a&gt; and 
&lt;a href=&quot;https://github.com/mirage/dyntype&quot;&gt;dyntype&lt;/a&gt;. 
These extend the syntax to allow code such as:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sexp_drop_default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sexp_drop_if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z_test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sexp&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
Extensions using camlp4's quotations syntax such as 
&lt;a href=&quot;https://github.com/mirage/ocaml-cow&quot;&gt;COW&lt;/a&gt;. These look like:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hello&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;world&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
Other syntax extensions that could be expressed using existing syntax or the
camlp4 quotation syntax. For example, 
&lt;a href=&quot;http://ocsigen.org/js_of_ocaml/&quot;&gt;js_of_ocaml&lt;/a&gt; provides a
&lt;code&gt;##&lt;/code&gt; operator for accessing javascript objects. This could easily be replaced by
a valid operator such as &lt;code&gt;%%&lt;/code&gt;.
&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By providing support for these specific kinds of extension, we can provide an
alternative to camlp4 for the majority of its applications.&lt;/p&gt;

&lt;h4 id=&quot;ast-transformers-attributes-and-quotations&quot;&gt;AST transformers, attributes and quotations&lt;/h4&gt;

&lt;p&gt;A much simpler alternative to allowing arbitrary syntax extensions is to use
&lt;em&gt;AST transformers&lt;/em&gt;, &lt;em&gt;attributes&lt;/em&gt; and &lt;em&gt;quotations&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;AST transformers are simply functions that perform transformations on the OCaml
syntax tree. These can already be implemented using the new
“&lt;a href=&quot;http://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do-it&quot;&gt;-ppx&lt;/a&gt;”
command line option that has been included on the OCaml development trunk by
Alain Frisch. This option accepts a program as an argument, and pipes the syntax
tree through that program after parsing and before type checking.&lt;/p&gt;

&lt;p&gt;Attributes are places in the grammar where generic data can be attached to the
syntax tree. This data is simply ignored by the main OCaml compiler, but it can
used be AST transformers to control transformations. &lt;/p&gt;

&lt;p&gt;Quotations are any construct that is not lexed or parsed by the compiler. These
can be attributes, expressions, patterns etc. The contents of a quotation can be
lexed and parsed by an AST transformer and converted into a regular AST node.&lt;/p&gt;

&lt;p&gt;Before support for attributes and quotations can be added to the compiler
decisions need to be made about what kinds of attributes and quotations to
support. Personally I prefer quotation attributes to attributes that are parsed
by the compiler because they are more flexible. However there is no reason that
both kinds cannot be supported by the compiler using different syntax.&lt;/p&gt;

&lt;p&gt;I think that it is important to support at least the following kinds of attribute:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
Simple named quotations for expressions, patterns and type expressions:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;:&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
Type constructor quotation attributes:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
Type-conv style definition attributes:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;(* some valid expression *)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
Annotating types with syntactically valid expressions:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;(* some valid expression *)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Once support for these attributes and quotations is added to OCaml I think that
the majority of camlp4 applications could be easily converted into AST
transformers.&lt;/p&gt;

&lt;p&gt;In order to make this transition easy, work must also be done to provide tools
for manipulating OCaml’s AST and parsing quotations. It would also be worthwhile
trying to normalise some of the stranger corners of the OCaml syntax tree. This
will make writing AST transformers simpler and more robust&lt;/p&gt;

&lt;p&gt;Finally, the “-ppx” option must be integrated into the many OCaml build
systems.&lt;/p&gt;

&lt;h4 id=&quot;join-the-discussion&quot;&gt;Join the discussion&lt;/h4&gt;

&lt;p&gt;The above suggestions are just the attributes and quotations that I think will
be necessary to provide a viable alternative to camlp4. However, I suspect that
they are not sufficient. It would be very useful to hear from anyone who has
written camlp4 extensions about what kind of extensions they have written, and
what they think would be necessary to support their extensions without
camlp4. So please join the
&lt;a href=&quot;http://lists.ocaml.org/listinfo/wg-camlp4&quot;&gt;wg-camlp4@lists.ocaml.org&lt;/a&gt; list and post
your thoughts.&lt;/p&gt;</content:encoded>
	<dc:date>2013-01-23T08:00:00+00:00</dc:date>
	<dc:creator>Leo White</dc:creator>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2013-01-01">
	<title>Monthly News: Jan 2013 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Jan%202013</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;There's a lot of interest in the work we're doing, and the number of collaborative &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html&quot;&gt;projects&lt;/a&gt; is increasing fast. 
We held the first monthly meeting in the Computer Lab, where &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/avsm.html&quot;&gt;Anil&lt;/a&gt; provided
an overview of the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/index.html&quot;&gt;research work&lt;/a&gt; that OCaml Labs is
starting. An interesting theme of the discussion that followed was
related to undergraduate teaching and how things like the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html&quot;&gt;OCaml
Platform&lt;/a&gt; and infrastructure would make it easier for
students to get to grips with programming.&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;For the evening after the meeting, &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/amirmc.html&quot;&gt;Amir&lt;/a&gt; set up 
an informal OCaml hacking/tutorial session in Cambridge.  Around 15 eager 
people attended the event in &lt;a href=&quot;http://makespace.org&quot;&gt;Makespace&lt;/a&gt; (a community 
workshop), with most of them being new to the language.  Anil introduced 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#Book%20review%20site&quot;&gt;Real World OCaml&lt;/a&gt; 
and shared the 
introductory chapters while Thomas provided help with OPAM.  This turned out 
to be a great test of the installation process for newcomers to OCaml, as 
well as the book's instructions. A number of issues came to light, partly 
related to a perfect storm of package issues, which everyone is keen to 
improve.  Despite these problems, attendees were very positive and were keen 
to see more gatherings like this in future.  When Amir asked for feedback, 
pretty much everyone commented on how great the pizza was.&lt;/p&gt;
&lt;h3 id=&quot;Platformprojects&quot;&gt; Platform projects&lt;/h3&gt;
&lt;p&gt;OCaml Labs also hosted its first visitor this month as &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/tg.html&quot;&gt;Thomas
Gazagnaire&lt;/a&gt;, the CTO of OCamlPro, spent three weeks in
Cambridge.  Much effort was put into preparing Mirage for release, discussions
about parallelism and the OCaml Platform, and anything where OPAM is a crucial
component.  Worth noting is that (at time of writing) the 
&lt;a href=&quot;https://github.com/OCamlPro/opam-repository&quot;&gt;opam-repository&lt;/a&gt; has now 
become the &lt;a href=&quot;https://github.com/languages/OCaml&quot;&gt;overall most forked OCaml project on Github&lt;/a&gt;.&lt;br /&gt;

The &lt;a href=&quot;http://lists.ocaml.org/pipermail/platform/&quot;&gt;Platform mailing list&lt;/a&gt; 
has also been formed for discussion regarding the OCaml Platform.  Anyone 
interested in the discussions about the platform, which will include 
development on OPAM, should join this list.&lt;/p&gt;
&lt;p&gt;Part of the Platform work involves creating a new 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html&quot;&gt;design for OCaml.org&lt;/a&gt;, which also 
&lt;a href=&quot;http://lists.ocaml.org/pipermail/infrastructure/2013-February/000194.html&quot;&gt;kicked-off this week&lt;/a&gt;.&lt;br /&gt;

Amir will keep people updated about progress via updates to the 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign&quot;&gt;OCL website&lt;/a&gt;, 
&lt;a href=&quot;http://lists.ocaml.org/pipermail/infrastructure/&quot;&gt;Infrastructure mailing list&lt;/a&gt; and also by posting things to the 
&lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki&quot;&gt;OCaml.org Github wiki&lt;/a&gt;.  The 
current stage of work involves thinking of the types of pages OCaml.org 
requires, in order to refine the templates we need.  As part of this, we 
also commissioned a new logo for OCaml and although it's still under 
development, you can see the latest draft on the 
&lt;a href=&quot;https://github.com/ocaml/ocaml.org/wiki/Draft-OCaml-Logos&quot;&gt;OCaml.org wiki&lt;/a&gt;.
  Please send any feedback directly to Amir.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-2.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-2-thumb.jpg&quot; class=&quot;right&quot; width=&quot;130px&quot; /&gt;&lt;/a&gt;
The Real World OCaml book website was released as a 
&lt;a href=&quot;http://www.realworldocaml.org&quot;&gt;limited alpha&lt;/a&gt; earlier in the month, with 
the aim of getting early feedback and comments. Each paragraph of the online 
book has commenting functionality, using Github issues as a backend.  This 
means that each comment made on the book website creates a new issue on 
Github, which authors/commenters can track and discuss before editing the 
content.  So far there have been over 250 comments on the alpha, with half 
them being dealt with already.&lt;/p&gt;
&lt;p&gt;A new EU project also kicked-off called &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/t2.html&quot;&gt;Trilogy 2&lt;/a&gt;, which builds on the 
award-winning work from the original &lt;a href=&quot;http://www.trilogy-project.org&quot;&gt;Trilogy&lt;/a&gt; project.  OnApp (a member of Trilogy 2), will be providing the &lt;a href=&quot;http://lists.ocaml.org/pipermail/infrastructure/2013-February/000198.html&quot;&gt;cloud Infrastructure for ocaml.org&lt;/a&gt;, and Thomas and Anil will be expanding the Mirage project into distributed computing under this umbrella.  As befits an EU project, it kicked off with an especially nice dinner at &lt;a href=&quot;http://www.christs.cam.ac.uk&quot;&gt;Christ's College&lt;/a&gt;...&lt;/p&gt;
&lt;h3 id=&quot;Systemsresearch&quot;&gt; Systems research&lt;/h3&gt;
&lt;p&gt;&lt;b&gt;Mirage:&lt;/b&gt; This was formally proposed as an 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;incubated Xen.org project&lt;/a&gt; and the proposal was put forward for 
&lt;a href=&quot;http://wiki.xen.org/wiki/Mirage_Incubation_Project_Proposal&quot;&gt;community review&lt;/a&gt;. There were many positive 
comments on the Xen mailing lists (along the lines of 
&lt;a href=&quot;http://lists.xen.org/archives/html/xen-devel/2013-01/msg01084.html&quot;&gt;&quot;Mirage is cool stuff&quot;&lt;/a&gt;)
and voting is currently underway by eligible members of the Xen community.
Assuming a positive outcome, incubation would give the Mirage project greater
visibility and access to resources.  This would accelerate progress towards an
alpha release in Q1/Q2 this year.  In 
addition to this, a proposal for an 
&lt;a href=&quot;http://www.oscon.com/oscon2013&quot;&gt;OSCON talk&lt;/a&gt; was also submitted and the camera-ready version of the ASPLOS paper is 
&lt;a href=&quot;http://anil.recoil.org/papers/2013-asplos-mirage.pdf&quot;&gt;now available&lt;/a&gt;.&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Illuminate&lt;/b&gt;: A related research topic where Mirage could be useful is in embedded systems 
and the Internet of Things.  One specific use case is the 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/illuminate.html&quot;&gt;Illuminate Project&lt;/a&gt;, where Mirage can be used 
to create appliances running on the ARM microcontrollers alongside an LED 
lighting network.  Such a lighting system is now deployed in large parts of 
the Computer Laboratory and will form an excellent test-bed to explore these 
ideas further.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Signpost:&lt;/b&gt;: &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-1.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/t2-kickoff-1-thumb.jpg&quot; class=&quot;right&quot; width=&quot;130px&quot; /&gt;&lt;/a&gt;
Signpost is also achieving greater outreach with 
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/crowcroft.html&quot;&gt;Jon Crowcroft&lt;/a&gt; discussing such technologies at a 
meeting in Dagstul on &lt;a href=&quot;http://www.dagstuhl.de/en/program/calendar/semhp/?semnr=13062&quot;&gt;Decentralized Systems for Privacy
Preservation&lt;/a&gt;.
Cambridge also hosted &lt;a href=&quot;http://en.wikipedia.org/wiki/Eric_Schmidt&quot;&gt;Eric Schmidt&lt;/a&gt;
from Google, where he is the Humanitas Visiting Professor in Media for 2013.
Eric delivered a &lt;a href=&quot;http://www.crassh.cam.ac.uk/events/2332/&quot;&gt;talk&lt;/a&gt; on the future
of conflict, combat and intervention.  Anil and Jon got an opportunity to
discuss Signposts with him for 20 minutes, which was an interesting clash of
opinions (we want decentralised identity, Google want it all to go through
them).  Either way, we're even more motivated to get the Signpost tech out to
the big bad world as soon as possible.  Meanwhile, Haris found his identical
twin brother in &lt;a href=&quot;http://en.wikipedia.org/wiki/St_John%27s_College,_Cambridge#The_Master.27s_Lodge_and_Garden&quot;&gt;St Johns Masters Lodge&lt;/a&gt;...&lt;/p&gt;
&lt;h3 id=&quot;Compilerprojects&quot;&gt; Compiler projects&lt;/h3&gt;
&lt;p&gt;Several mailing lists are in progress for various community-driven projects.
The first of these is a working group on the future of syntax extensions in 
OCaml (&lt;a href=&quot;http://lists.ocaml.org/pipermail/wg-camlp4&quot;&gt;wg-camlp4&lt;/a&gt;).  This group is 
chaired by &lt;a href=&quot;http://alain.frisch.fr&quot;&gt;Alain Frisch&lt;/a&gt; and Leo White and has 
generated a great deal of discussion in the last two weeks.  Leo is 
summarising his thoughts in a series of &lt;a href=&quot;http://www.lpw25.net&quot;&gt;blog posts&lt;/a&gt; 
as he goes.  Further working groups on parallelism in OCaml and build systems are under 
discussion and will be announced in due course.&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;As well as all the research and development activity we've also been 
recruiting.  We've had several rounds of interviews and made a number of 
offers so hopefully we'll be announcing new members of the OCaml Labs team 
in the coming months.  In addition, we'd also like to mention that Leo 
successfully defended his PhD Thesis in January.  Finally, we'd like to 
welcome a new honorary member of OCaml Labs, Nathan Scott, born on 30th 
January.  Congratulations &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/people/djs.html&quot;&gt;Dave&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;&lt;i&gt;Link roundup:&lt;/i&gt;&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;a href=&quot;http://www.lpw25.net/2013/01/23/camlp4-alternative-part-1.html&quot; class=&quot;icon-rss&quot;&gt;An alternative to camlp4 - Part 1&lt;/a&gt; &lt;em&gt;(Jan 23rd)&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;


   &lt;/div&gt;</content:encoded>
	<dc:date>2013-01-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-12-01">
	<title>Monthly News: Dec 2012 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Dec%202012</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/cam-snow.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/cam-snow-thumb.jpg&quot; class=&quot;right&quot; width=&quot;130px&quot; /&gt;&lt;/a&gt;
OCaml Labs kicked-off with an internal meeting of the Cambridge-based members,
who battled endless snow to make it to the meeting.
There are over 20 people involved just within the building and over 30
including those outside the University. We welcomed a few new members,
including Leo White (Postdoc), Raphael Proust (PhD student) and Stephen Dolan
(PhD student).  At this initial gathering Anil talked over some of the projects
that were already taking place in the Lab, as well as the new work that would
be supported by OCaml Labs.&lt;/p&gt;
&lt;p&gt;Significant progress was made on the research side too.
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;Mirage&lt;/a&gt; has had a flurry of new releases as we
prepare for a first public release, and we're in the final stages of being
officially incubated as a &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;xen.org project&lt;/a&gt;.
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/illuminate.html#Signpost%20prototype&quot;&gt;Signpost&lt;/a&gt; is also
taking shape, mainly due to the addition of DNSSEC to the
&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/illuminate.html#Signpost%20prototypew&quot;&gt;ocaml-dns&lt;/a&gt; implementation.
There's been industrial interest in the applications of Signpost and the team
is pursuing these for more use cases.&lt;/p&gt;
&lt;p&gt;We also began work on a new website for the &lt;a href=&quot;http://realworldocaml.org&quot;&gt;Real World
OCaml&lt;/a&gt;.  We took inspiration from our friends who wrote
Real World Haskell, and the site will have commenting functionality so that
people can suggest improvements before the book is finalised.  As part of this,
we also worked with a design firm to begin creating a &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/outreach.html#OCaml.org%20redesign&quot;&gt;new logo for the OCaml
language&lt;/a&gt;.&lt;br /&gt;

The logo will be placed into the
public domain for use by anyone.&lt;/p&gt;
&lt;p&gt;Last, but certainly not least, Ashish put the new &lt;a href=&quot;http://ocaml.org&quot;&gt;ocaml.org&lt;/a&gt;
website live, to much electronic &lt;a href=&quot;https://twitter.com/jakedonham/status/281170330700095488&quot;&gt;applause&lt;/a&gt;.
A great way to end 2012!&lt;/p&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2012-12-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/">
	<title>Heidi Howard: System programming in OCaml – Part 2</title>
	<link>http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-2/</link>
	<content:encoded>&lt;p&gt;Now we are going to take a look at manipulating files in OCaml. We will be focusing on the Unix file system.&lt;/p&gt;
&lt;p&gt;In Unix the term &amp;#8220;file&amp;#8221; refers to a greater range of objects that you might expect. This includes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;standard files like .txt, .html, .doc or .ml&lt;/li&gt;
&lt;li&gt;directories (or folders if your used to windows) like /photos or /music&lt;/li&gt;
&lt;li&gt;symbolic links (or shortcuts if your used to windows)&lt;/li&gt;
&lt;li&gt;special files to access devices i.e. files in /dev&lt;/li&gt;
&lt;li&gt;named pipe ( this is a named version of using | in the terminal )&lt;/li&gt;
&lt;li&gt;sockets&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All files are represented by an i-node, a data structure which holds the meta-data on the file. Directories are files that map filenames to i-nodes. The directories form a tree structure, where all files are directly or indirectly children of the root directory called &amp;#8216;/&amp;#8217;.&lt;/p&gt;
&lt;p&gt;A absolute path name of the file is one that begins at the root. A relative path name is one that begins in the current directory. Every directory has &amp;#8216;.&amp;#8217; and &amp;#8216;..&amp;#8217; which are symbolic links to the current and parent directories.&lt;/p&gt;
&lt;p&gt;OCaml makes use of the &lt;a href=&quot;http://caml.inria.fr/pub/docs/manual-ocaml/libref/Filename.html&quot;&gt;Filename module&lt;/a&gt; to help handle paths in a portable manner&lt;/p&gt;</content:encoded>
	<dc:date>2012-11-29T23:00:00+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/">
	<title>Heidi Howard: Ocaml 2 HTML</title>
	<link>http://hh360.user.srcf.net/blog/2012/11/ocaml-2-html/</link>
	<content:encoded>&lt;div&gt;&lt;a href=&quot;http://1.bp.blogspot.com/-r31qRagcDkA/ULZ_402U4NI/AAAAAAAAAMg/yEQ5QdhTGnM/s1600/images.jpeg&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;http://1.bp.blogspot.com/-r31qRagcDkA/ULZ_402U4NI/AAAAAAAAAMg/yEQ5QdhTGnM/s1600/images.jpeg&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;p&gt;As I&amp;#8217;m often adding OCaml code to blog posts I really wanted to find an automatic way to add syntax highlighting. The first solution that I have found is &lt;a href=&quot;http://caml.inria.fr/cgi-bin/hump.en.cgi?contrib=61&quot;&gt;caml2html&lt;/a&gt; but I&amp;#8217;m still looking for something better &amp;#8230; suggestions welcome&lt;/p&gt;</content:encoded>
	<dc:date>2012-11-28T22:13:00+00:00</dc:date>
</item>
<item rdf:about="http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/">
	<title>Heidi Howard: System programming in OCaml – Part 1</title>
	<link>http://hh360.user.srcf.net/blog/2012/11/system-programming-in-ocaml-part-1/</link>
	<content:encoded>&lt;p&gt;This series of articles will follow my journey through &amp;#8220;Unix system programming in OCaml&amp;#8221;, available as a pdf &lt;a href=&quot;http://ocamlunix.forge.ocamlcore.org/&quot;&gt;here&lt;/a&gt;. After this series, I hope to move onto a series on Mirage system programming in OCaml and working with Signposts (a framework for managing end-to-end connectivity between devices using DNS infrastructure for signalling)&lt;/p&gt;
&lt;h4&gt;Introducing the Sys and Unix&lt;/h4&gt;
&lt;div&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-1RDROc_BYpo/ULaAP6BBbLI/AAAAAAAAAMo/UmCCrs1WqOA/s1600/unix_plate.jpg&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;http://3.bp.blogspot.com/-1RDROc_BYpo/ULaAP6BBbLI/AAAAAAAAAMo/UmCCrs1WqOA/s320/unix_plate.jpg&quot; width=&quot;320&quot; height=&quot;162&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;p&gt;The modules that give access to the system in OCaml are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sys &amp;#8211; functions common to all OS&amp;#8217;s that run OCaml&lt;/li&gt;
&lt;li&gt;Unix &amp;#8211; functions specific to unix&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To make use of these modules in some OCaml code, we can add open Sys or/and open Unix to the top of the OCaml program.&lt;/p&gt;
&lt;p&gt;NOTE that Unix and Sys can overwrite some of the functions in the Pervasive module, so to access a function from the Pervasive module you need to add Pervasives. in front of the function call.&lt;/p&gt;
&lt;p&gt;When using ocamlc to compile OCaml programs that made use of  Unix, you need to pass unix.cma to the compiler e.g.&lt;/p&gt;
&lt;p&gt;$ ocamlc unix.cma hello.ml -o hello&lt;/p&gt;
&lt;p&gt;The same is not true of sys.cma&lt;/p&gt;
&lt;h4&gt;PASSING INFORMATION TO YOUR PROGRAM&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-4dF_PbMKaCY/ULaAv9rtW5I/AAAAAAAAAMw/mO_Ksnyby4o/s1600/letter_tiles1.png&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;http://4.bp.blogspot.com/-4dF_PbMKaCY/ULaAv9rtW5I/AAAAAAAAAMw/mO_Ksnyby4o/s1600/letter_tiles1.png&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;Now we are going to consider 2 different ways of passing information from your terminal to your ocaml program&lt;/p&gt;
&lt;p&gt;1) Passing the information as arguments to the executable. For this we are going to use Sys.argv which will return a string array of arguments passed to the program. The first index of the argument array that we use here is 1, this is because the 0th element in the array is the command used to call the program. Consider the following simple example:&lt;/p&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;i&gt;open Sys;;&lt;br /&gt;
print_string argv.(1)&lt;/i&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;Now provided that at least one argument is passed to the program, this argument will be printed. We can now extend this program, to print the number of arguments and then exactly what the user will have just entered&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;i&gt;open Sys;;&lt;/i&gt;&lt;/div&gt;
&lt;p&gt;let args = Array.length argv;;&lt;br /&gt;
print_int args ;;&lt;br /&gt;
print_newline ();;&lt;br /&gt;
for i=0 to args-1 do&lt;br /&gt;
print_string argv.(i);&lt;br /&gt;
print_char &amp;#8216; &amp;#8216;;&lt;br /&gt;
done;&lt;/p&gt;
&lt;p&gt;2a ) Passing information using the environment variables, this can be fetched from within the OCaml programing using Sys.enviroment, this will return as array of environment variables&lt;/p&gt;
&lt;p&gt;open Unix;;&lt;/p&gt;
&lt;p&gt;let env = environment();;&lt;br /&gt;
for i=0 to (Array.length env) -1  do&lt;br /&gt;
print_string env.(i);&lt;br /&gt;
print_newline);&lt;br /&gt;
done;&lt;/p&gt;
&lt;p&gt;Don&amp;#8217;t forget then when you compile this, you need to add unix.cma to the command as we are making use of the Unix library&lt;/p&gt;
&lt;p&gt;2b ) We can also lookup the values of environment variables using the Sys.getenv (or Unix.getenv) functions that takes a variable name and returns the value associated with it&lt;/p&gt;
&lt;p&gt;&lt;i&gt;open Sys;;&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;let var = argv.(1);;&lt;br /&gt;
print_string (getenv var)&lt;/p&gt;
&lt;h4&gt;Exceptions&lt;/h4&gt;
&lt;p&gt;Unless otherwise stated in the documentation, all function in the Unix module raise the exception Unix_error.&lt;/p&gt;
&lt;p&gt;&lt;i&gt;Exception Unix_error of error * string * string&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;The first argument is the error code, the second argument is the name of the system call that raised the error and third argument identifies the object on which the error was called.&lt;/p&gt;
&lt;p&gt;If an exception reaches the top-level then the program will halt. The Unix module provides a function for clearly describing exceptions. We can make 2a use this function as follows:&lt;br /&gt;
&lt;i&gt;&lt;br /&gt;
&lt;/i&gt;&lt;i&gt;open Unix;;&lt;/i&gt;&lt;br /&gt;
&lt;i&gt;&lt;br /&gt;
let prog () =  &lt;/i&gt;&lt;br /&gt;
&lt;i&gt;  let env = environment();;&lt;br /&gt;
for i=0 to (Array.length env) -1  do&lt;br /&gt;
print_string env.(i);&lt;br /&gt;
print_newline);&lt;br /&gt;
done;&lt;/i&gt;&lt;br /&gt;
&lt;i&gt; done;&lt;/i&gt;&lt;/p&gt;
&lt;p&gt;&lt;i&gt; handle_unix_error prog ();;&lt;/i&gt;&lt;/p&gt;
&lt;div&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-kgybOBLFeGU/ULaBNfKRf8I/AAAAAAAAAM4/eVjnpihDSGw/s1600/289-rule-34-no-exceptions.jpg&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;http://4.bp.blogspot.com/-kgybOBLFeGU/ULaBNfKRf8I/AAAAAAAAAM4/eVjnpihDSGw/s640/289-rule-34-no-exceptions.jpg&quot; width=&quot;640&quot; height=&quot;508&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;&lt;/div&gt;</content:encoded>
	<dc:date>2012-11-28T22:10:00+00:00</dc:date>
</item>
<item rdf:about="http://www.cl.cam.ac.uk/projects/ocamllabs/news/2012-11-01">
	<title>Monthly News: Nov 2012 news update</title>
	<link>http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Nov%202012</link>
	<content:encoded>&lt;div&gt;
      &lt;p&gt;OCaml Labs finally opened its doors with announcements from
&lt;a href=&quot;https://ocaml.janestreet.com/?q=node/109&quot;&gt;Yaron&lt;/a&gt; and
&lt;a href=&quot;http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html&quot;&gt;Anil&lt;/a&gt;!  Although
much of the remainder of November was spent on administration and wiring up
machines for the forthcoming &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html#Machine%20Pool&quot;&gt;test cluster&lt;/a&gt;, we
also celebrated the acceptance of a paper on &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/mirage.html&quot;&gt;Mirage&lt;/a&gt;
to &lt;a href=&quot;http://anil.recoil.org/papers/2013-asplos-mirage.pdf&quot;&gt;ASPLOS 2013&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/caml-consortium-20121101.jpg&quot;&gt;&lt;img src=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/images/caml-consortium-20121101-thumb.jpg&quot; class=&quot;right&quot; width=&quot;130px&quot; /&gt;&lt;/a&gt;
We also had a very productive visit from &lt;a href=&quot;http://www.ocamlpro.com&quot;&gt;OCamlPro&lt;/a&gt;.
Fabrice, Thomas and Pierre came over to discuss the new
&lt;a href=&quot;http://opam.ocamlpro.com&quot;&gt;OPAM&lt;/a&gt; package manager and the plans for building an
OCaml Platform in 2013. This was in preparation for the subsequent Consortium
meeting of the industrial board of OCaml, where Anil was able to present (and
get approved) an overview of what &lt;a href=&quot;http://ocaml.org&quot;&gt;ocaml.org&lt;/a&gt; would become.
You can see the &lt;a href=&quot;http://anil.recoil.org/slides/OCaml-Consortium-2012-OCamlLabs.pdf&quot;&gt;slides of his talk online&lt;/a&gt;.  An
interesting thing to note is just how broad the set of OCaml language users
are: right the way from formal methods, to systems projects, and even web
developers.&lt;/p&gt;
&lt;p&gt;Since the Consortium meeting, the infrastructure behind ocaml.org is being
built out and there's already been helpful input via the
&lt;a href=&quot;http://lists.ocaml.org/listinfo/infrastructure&quot;&gt;infrastructure mailing list&lt;/a&gt;.  A continuous build system has been put together for internal testing, with
support from Citrix, and &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/news/#opam&quot;&gt;OPAM&lt;/a&gt; itself continues to mature and grow in
popularity.&lt;/p&gt;

   &lt;/div&gt;</content:encoded>
	<dc:date>2012-11-01T12:00:00+00:00</dc:date>
	<dc:creator>Anil Madhavapeddy</dc:creator>
</item>
<item rdf:about="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs">
	<title>Anil Madhavapeddy: Announcing the OCaml Labs project</title>
	<link>http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html</link>
	<content:encoded>&lt;p&gt;I&amp;#8217;m very excited to announce &lt;em&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs&quot;&gt;OCaml Labs&lt;/a&gt;&lt;/em&gt;, the latest project to hit the Cambridge Computer Lab. As anyone that hangs out near me probably realises, I very much enjoy functional programming. My weapon of choice tends to be &lt;a href=&quot;http://www.ocaml-lang.org&quot;&gt;OCaml&lt;/a&gt;, as it condenses &lt;a href=&quot;http://events.inf.ed.ac.uk/Milner2012/X_Leroy-html5-mp4.html&quot;&gt;decades of research&lt;/a&gt; into a pragmatic blend of functional, imperative and object-oriented programming styles. What&amp;#8217;s perhaps less well known are the steady &lt;a href=&quot;http://www.ocaml-lang.org/companies.html&quot;&gt;inroads&lt;/a&gt; that OCaml has been making into mission-critical areas of industry. At &lt;a href=&quot;http://ocaml.janestreet.com&quot;&gt;Jane Street&lt;/a&gt;, billions of dollars of transactions are routed through a huge ML code-base that is designed to catch bugs &lt;a href=&quot;http://vimeo.com/14313378&quot;&gt;at compile-time&lt;/a&gt;. At &lt;a href=&quot;http://github.com/xen-org/xen-api&quot;&gt;Citrix&lt;/a&gt;, the Xen management toolstack that powers &lt;a href=&quot;http://blogs.citrix.com/2012/10/09/one-in-a-million/&quot;&gt;millions&lt;/a&gt; of hosts in the cloud is &lt;a href=&quot;http://anil.recoil.org/papers/2010-icfp-xen.pdf&quot;&gt;largely written in OCaml&lt;/a&gt;. Facebook does sophisticated &lt;a href=&quot;https://github.com/facebook/pfff/wiki/Main&quot;&gt;static analysis&lt;/a&gt; using OCaml over their vast PHP codebase to close security holes.&lt;/p&gt;

&lt;p&gt;The OCaml community is small but dedicated, but there is always more to do to improve the language and ecosystem. So, thanks to a generous platform grant from &lt;a href=&quot;http://ocaml.janestreet.com&quot;&gt;Jane Street&lt;/a&gt;, we are launching a program to help with the open-source development of OCaml from Cambridge.&lt;/p&gt;

&lt;p&gt;The &lt;em&gt;&lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/&quot;&gt;OCaml Labs&lt;/a&gt;&lt;/em&gt; are based in the &lt;a href=&quot;http://www.cl.cam.ac.uk&quot;&gt;Cambridge Computer Lab&lt;/a&gt; and led my myself, &lt;a href=&quot;http://www.cl.cam.ac.uk/~am21/&quot;&gt;Alan Mycroft&lt;/a&gt; and &lt;a href=&quot;http://www.cl.cam.ac.uk/~iml1/&quot;&gt;Ian Leslie&lt;/a&gt;. We&amp;#8217;re closely affiliated with other &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/collaboration.html&quot;&gt;groups&lt;/a&gt;, and will be:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;developing the OCaml Platform, which will bundle the official OCaml compiler from INRIA with a tested set of community libraries that refreshed every six months.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;working with the core OCaml team at INRIA&amp;#8217;s &lt;a href=&quot;http://gallium.inria.fr/&quot;&gt;Gallium&lt;/a&gt; group on the compiler, and with commercial partners like &lt;a href=&quot;http://ocamlpro.com&quot;&gt;OCamlPro&lt;/a&gt; on tool development. OCamlPro are making some very impressive progress already with the &lt;a href=&quot;http://opam.ocamlpro.com&quot;&gt;OPAM&lt;/a&gt; packge manager and &lt;a href=&quot;http://www.typerex.org&quot;&gt;TypeRex&lt;/a&gt; IDE helper.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;supporting the online presence with more teaching material and content. Yaron, Jason and I are working hard on a &lt;a href=&quot;http://realworldocaml.org&quot;&gt;new book&lt;/a&gt; that will be published next year, and the OCaml Web team (led by &lt;a href=&quot;http://ashishagarwal.org&quot;&gt;Ashish&lt;/a&gt; and &lt;a href=&quot;https://plus.google.com/109604597514379193052/posts&quot;&gt;Christophe&lt;/a&gt;) have made great progress on a &lt;a href=&quot;http://www.ocaml-lang.org&quot;&gt;brand new website&lt;/a&gt; that we will move to the &lt;code&gt;ocaml.org&lt;/code&gt; domain soon.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;research_efforts&quot;&gt;Research efforts&lt;/h3&gt;

&lt;p&gt;Of course, it is difficult to hack on a language in a void, and we also &lt;em&gt;use&lt;/em&gt; OCaml heavily in our own research. The other half of OCaml Lab&amp;#8217;s goals are more disruptive (and riskier!):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The upcoming first beta release of &lt;a href=&quot;http://openmirage.org&quot;&gt;Mirage&lt;/a&gt;, which is an operating system designed for cloud and embedded environments, and is written almost entirely from the ground up in OCaml. The outputs of Mirage include a &lt;a href=&quot;http://www.openmirage.org/blog/breaking-up-is-easy-with-opam&quot;&gt;large number of libraries&lt;/a&gt; which are usable separately, such as pure implementations of TCP/IP, DNS, SSH, DHCP and HTTP. The Xen hackers, led by &lt;a href=&quot;http://dave.recoil.org&quot;&gt;David Scott&lt;/a&gt;, are out in force to integrate Mirage into their &lt;a href=&quot;http://www.xen.org/xensummit/xs12na_talks/T2.html&quot;&gt;next-generation&lt;/a&gt; platform. Meanwhile, Raphael Proust is busy eliminating the &lt;a href=&quot;http://anil.recoil.org/papers/drafts/2012-places-limel-draft1.pdf&quot;&gt;garbage collector&lt;/a&gt; with his cut-down &amp;#8220;LinearML&amp;#8221; variant.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Working with our collaborators at the &lt;a href=&quot;http://horizon.ac.uk&quot;&gt;Horizon Institute&lt;/a&gt; on privacy-preserving technologies such as &lt;a href=&quot;http://anil.recoil.org/papers/2012-sigcomm-signposts-demo.pdf&quot;&gt;Signposts&lt;/a&gt; which let you build and maintain your own personal clouds that operate &lt;a href=&quot;http://anil.recoil.org/papers/2011-icdcn-droplets.pdf&quot;&gt;autonomously&lt;/a&gt; from the central cloud. You can read more about our &lt;a href=&quot;http://www.cam.ac.uk/research/features/privacy-by-design/&quot;&gt;privacy-by-design&lt;/a&gt; philosophy too.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Extending OCaml to run on secure hardware platforms that doesn&amp;#8217;t compromise on performance, using the MIPS64-based &lt;a href=&quot;http://www.cl.cam.ac.uk/research/security/ctsrd/cheri.html&quot;&gt;capability processor&lt;/a&gt; that is being developed at at the Lab.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;The &lt;a href=&quot;http://www.trilogy-project.org&quot;&gt;Trilogy&lt;/a&gt; was a hugely successful EU-funded effort on future evolution of the Internet, and resulted in &lt;a href=&quot;http://trilogy-project.org/publications/standards-contributions.html&quot;&gt;numerous RFCs&lt;/a&gt; on subjects such as multipath-TCP. We&amp;#8217;re partipating in the follow-up (imaginatively dubbed &amp;#8220;Trilogy2&amp;#8221;), and look forward to working on more structured abstractions for programming large-scale networks.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;getting_involved&quot;&gt;Getting involved&lt;/h3&gt;

&lt;p&gt;So, how can you get involved? We are initially advertising three positions for full-time developers and researchers (&lt;a href=&quot;http://www.jobs.cam.ac.uk/job/-21662/&quot;&gt;junior&lt;/a&gt; and &lt;a href=&quot;http://www.jobs.cam.ac.uk/job/-21942/&quot;&gt;senior&lt;/a&gt;) to help us get started with the OCaml Platform and compiler development. These aren&amp;#8217;t conventional pure research jobs, and a successful candidate should enjoy the open-source development cycle (you retain your own copyright for your own projects). The Computer Lab offers a pretty unique environment: a friendly, non-hierarchical group in a beautiful city, and some of the best faculty and students you could hope to hang out with.&lt;/p&gt;

&lt;p&gt;And finally, there is a longer lead time on &lt;a href=&quot;http://www.cl.cam.ac.uk/admissions/phd/&quot;&gt;applying for PhDs&lt;/a&gt;, but this is a great time to get involved. When I started at the Lab in 2002, a little project called &lt;a href=&quot;http://xen.org&quot;&gt;Xen&lt;/a&gt; was just kicking off, and many of us had a wild (and oft great) time riding that wave. Get in touch with myself, &lt;a href=&quot;http://www.cl.cam.ac.uk/~am21/&quot;&gt;Alan&lt;/a&gt;, &lt;a href=&quot;http://www.cl.cam.ac.uk/~iml1/&quot;&gt;Ian&lt;/a&gt; or &lt;a href=&quot;http://www.cl.cam.ac.uk/~jac22/&quot;&gt;Jon&lt;/a&gt; soon if you are interested in applying! There&amp;#8217;s some more information available on the &lt;a href=&quot;http://www.cl.cam.ac.uk/projects/ocamllabs/collaboration.html&quot;&gt;OCaml Labs pages&lt;/a&gt; about options.&lt;/p&gt;</content:encoded>
	<dc:date>2012-10-18T23:00:00+00:00</dc:date>
</item>

</rdf:RDF>
